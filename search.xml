<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ç›¸å†Œè®¾ç½®</title>
      <link href="/posts/fb80.html"/>
      <url>/posts/fb80.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ·»åŠ ç›¸å†Œ"><a href="#æ·»åŠ ç›¸å†Œ" class="headerlink" title="æ·»åŠ ç›¸å†Œ"></a>æ·»åŠ ç›¸å†Œ</h1><h2 id="ä¸ºä»€ä¹ˆæ·»åŠ ç›¸å†Œ"><a href="#ä¸ºä»€ä¹ˆæ·»åŠ ç›¸å†Œ" class="headerlink" title="ä¸ºä»€ä¹ˆæ·»åŠ ç›¸å†Œ"></a>ä¸ºä»€ä¹ˆæ·»åŠ ç›¸å†Œ</h2><p>ä¸ªäººåšå®¢ä¸­æ·»åŠ ç›¸å†ŒåŠŸèƒ½ï¼Œä¸ä»…å…·å¤‡å¤šé¡¹å®ç”¨æ€§ä¸å¨±ä¹æ€§ä¼˜ç‚¹ï¼Œè€Œä¸”èƒ½å¤Ÿä¸°å¯Œåšå®¢çš„è¡¨è¾¾å½¢å¼ä¸å†…å®¹å±‚æ¬¡ï¼š</p><ol><li><strong>ä¿å­˜å’Œå±•ç¤ºå›¾ç‰‡</strong>ï¼šåšä¸»å¯ä»¥å°†è‡ªå·±æ‹æ‘„æˆ–æ”¶é›†åˆ°çš„å„ç§å–œæ¬¢çš„å›¾ç‰‡ä¸Šä¼ è‡³ç›¸å†Œï¼Œå¦‚æ—…è¡Œç…§ç‰‡ã€ä½œå“é›†ã€çµæ„Ÿç´ æç­‰ï¼Œä¸ºè‡ªå·±çš„åšå®¢åˆ›å»ºä¸€ä¸ªç‹¬ç‰¹çš„è§†è§‰æ¡£æ¡ˆåº“ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥çœ‹å’Œåˆ†äº«ã€‚</li><li><strong>è®°å½•æ—¥å¸¸ç”Ÿæ´»</strong>ï¼šé€šè¿‡ç›¸å†ŒåŠŸèƒ½ï¼Œåšä¸»èƒ½å¤Ÿä»¥ç›´è§‚ä¸”ç”ŸåŠ¨çš„æ–¹å¼è®°å½•ä¸‹ç”Ÿæ´»ä¸­çš„ç‚¹ç‚¹æ»´æ»´ï¼Œå¦‚ç¾é£Ÿåˆ¶ä½œè¿‡ç¨‹ã€å®¶åº­èšä¼šç¬é—´ã€å­¦ä¹ å·¥ä½œè¿›å±•ã€æˆ·å¤–æ¢é™©ç»å†ç­‰ã€‚è¿™äº›å›¾åƒèµ„æ–™æ—¢æ˜¯å¯¹ç”Ÿæ´»è®°å¿†çš„æœ‰æ•ˆç•™å­˜ï¼Œä¹Ÿæ˜¯å‘è¯»è€…å±•ç°çœŸå®è‡ªæˆ‘ã€å¢è¿›æƒ…æ„Ÿäº¤æµçš„é‡è¦è½½ä½“ã€‚</li><li><strong>æ¿€å‘åˆ›ä½œçµæ„Ÿ</strong>ï¼šå¯¹äºè‰ºæœ¯åˆ›ä½œè€…æˆ–è€…å†™ä½œè€…æ¥è¯´ï¼Œè¿‡å¾€çš„å›¾ç‰‡è®°å½•å¯èƒ½æ˜¯æœªæ¥çš„åˆ›ä½œæºæ³‰ï¼Œç›¸å†Œçš„å­˜åœ¨å¯ä»¥å¸®åŠ©ä»–ä»¬å›é¡¾è¿‡å»ï¼ŒæŒ–æ˜æ–°çš„åˆ›æ„çµæ„Ÿã€‚</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨ä¸ªäººåšå®¢ä¸­æ·»åŠ ç›¸å†ŒåŠŸèƒ½ï¼Œä¸ä»…å¯ä»¥æ»¡è¶³åšä¸»ä¸ªæ€§åŒ–çš„éœ€æ±‚ï¼Œè¿˜èƒ½æœ‰æ•ˆå¢å¼ºåšå®¢çš„å¸å¼•åŠ›ï¼Œæå‡ç”¨æˆ·çš„æµè§ˆæ»¡æ„åº¦ï¼Œå¹¶ä¸ºåšä¸»æä¾›ä¸€ä¸ªçè´µçš„è®°å¿†å®åº“å’ŒæŒç»­åˆ›æ–°çš„åŠ¨åŠ›æ¥æºã€‚</p><h2 id="æ ·å¼ä¸€"><a href="#æ ·å¼ä¸€" class="headerlink" title="æ ·å¼ä¸€"></a>æ ·å¼ä¸€</h2><h3 id="æ¼”ç¤ºæ•ˆæœ"><a href="#æ¼”ç¤ºæ•ˆæœ" class="headerlink" title="æ¼”ç¤ºæ•ˆæœ"></a>æ¼”ç¤ºæ•ˆæœ</h3><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202402022017255.png" alt="galleries"></p><h3 id="æ·»åŠ ã€ç›¸å†Œã€‘èœå•"><a href="#æ·»åŠ ã€ç›¸å†Œã€‘èœå•" class="headerlink" title="æ·»åŠ ã€ç›¸å†Œã€‘èœå•"></a>æ·»åŠ ã€ç›¸å†Œã€‘èœå•</h3><ol><li><p>è¿›å…¥ä¸»é¢˜ï¼ˆmateryï¼‰ä¸‹çš„é…ç½®æ–‡ä»¶_config.ymlï¼Œåœ¨menuä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">Galleries</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /galleries    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fa<span class="token punctuation">-</span>photo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ä¸»é¢˜ï¼ˆmateryï¼‰ä¸‹çš„languagesä¸‹çš„</p><p>default.ymlï¼ˆè‹±æ–‡ï¼‰æ·»åŠ ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">galleries</span><span class="token punctuation">:</span> galleries<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>zh-CN.ymlï¼ˆä¸­æ–‡ï¼‰æ·»åŠ ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">galleries</span><span class="token punctuation">:</span> ç›¸å†Œ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨matery&#x2F;layout&#x2F;_partial&#x2F;ä¸‹çš„<code>navigation.ejs</code>å’Œ<code>mobile-nav.ejs</code>æ–‡ä»¶é‡Œæ·»åŠ ï¼š</p><p>è‡³äºæ·»åŠ çš„ä½ç½®ï¼Œæ‰“å¼€æ–‡ä»¶åå°±çŸ¥é“äº†ï¼Œé‡Œé¢ä¼šæœ‰ç±»ä¼¼æ ¼å¼çš„ä»£ç ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°çš„</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">menuMap.set("Galleries"<span class="token punctuation">,</span> "ç›¸å†Œ");<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨ç«™ç‚¹æ ¹ç›®å½•sourceä¸‹æ–°å»ºgalleriesæ–‡ä»¶ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹æ–°å»ºindex.mdï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> ç›¸å†Œ<span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"galleries"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="è®¾ç½®æ ·å¼"><a href="#è®¾ç½®æ ·å¼" class="headerlink" title="è®¾ç½®æ ·å¼"></a>è®¾ç½®æ ·å¼</h3><p>åœ¨matery&#x2F;source&#x2F;cssä¸‹æ–°å»ºgallery.cssæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹æ ·å¼ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.gallery-wrapper</span><span class="token punctuation">&#123;</span>  <span class="token property">padding-top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.gallery-wrapper .gallery-box</span><span class="token punctuation">&#123;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> 5px <span class="token important">!important</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.gallery-wrapper .gallery-item</span> <span class="token punctuation">&#123;</span>  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>  <span class="token property">-moz-box-shadow</span><span class="token punctuation">:</span> 0 1px 3px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> 0 1px 3px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 3px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.gallery-cover-box</span><span class="token punctuation">&#123;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>  <span class="token property">padding-top</span><span class="token punctuation">:</span> 60%<span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>  <span class="token property">background</span><span class="token punctuation">:</span> center center no-repeat<span class="token punctuation">;</span>  <span class="token property">-webkit-background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>  <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.gallery-cover-box .gallery-cover-img</span> <span class="token punctuation">&#123;</span>  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.gallery-item .gallery-name</span><span class="token punctuation">&#123;</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.waterfall</span> <span class="token punctuation">&#123;</span>  <span class="token property">column-count</span><span class="token punctuation">:</span> 3<span class="token punctuation">;</span>  <span class="token property">column-gap</span><span class="token punctuation">:</span> 1em<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.photo-wrapper</span><span class="token punctuation">&#123;</span>  <span class="token property">padding-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.photo-item</span> <span class="token punctuation">&#123;</span>  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token property">-moz-page-break-inside</span><span class="token punctuation">:</span> avoid<span class="token punctuation">;</span>  <span class="token property">-webkit-column-break-inside</span><span class="token punctuation">:</span> avoid<span class="token punctuation">;</span>  <span class="token property">break-inside</span><span class="token punctuation">:</span> avoid<span class="token punctuation">;</span>  <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>  <span class="token property">-moz-box-shadow</span><span class="token punctuation">:</span> 0 1px 3px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> 0 1px 3px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 3px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.photo-item img</span> <span class="token punctuation">&#123;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.photo-item .photo-name</span><span class="token punctuation">&#123;</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>  <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #dddddd<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*é€‚é…ç§»åŠ¨ç«¯å¸ƒå±€*/</span><span class="token atrule"><span class="token rule">@media</span> <span class="token keyword">only</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 601px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>  <span class="token selector">.waterfall</span> <span class="token punctuation">&#123;</span>    <span class="token property">column-count</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>    <span class="token property">column-gap</span><span class="token punctuation">:</span> 1em<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨matery&#x2F;layoutç›®å½•ä¸‹</p><ul><li><p>æ–°å»ºgalleries.ejsæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-ej" data-language="ej"><code class="language-ej">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#x2F;css&#x2F;gallery.css&quot;&gt;&lt;%- partial(&#39;_partial&#x2F;bg-cover&#39;) %&gt;&lt;main class&#x3D;&quot;content&quot;&gt;    &lt;div class&#x3D;&quot;container&quot;&gt;        &lt;% if (site.data &amp;&amp; site.data.galleries) &#123; %&gt;        &lt;% var galleries &#x3D; site.data.galleries; %&gt;        &lt;div class&#x3D;&quot;gallery-wrapper row&quot;&gt;            &lt;% for (var i &#x3D; 0, len &#x3D; galleries.length; i &lt; len; i++) &#123; %&gt;            &lt;% var gallery &#x3D; galleries[i]; %&gt;            &lt;div class&#x3D;&quot;col s6 m4 l4 xl3 gallery-box&quot;&gt;                &lt;a href&#x3D;&quot;.&#x2F;&lt;%- gallery.name %&gt;&quot; class&#x3D;&quot;gallery-item&quot; data-aos&#x3D;&quot;zoom-in-up&quot;&gt;                    &lt;div class&#x3D;&quot;gallery-cover-box&quot; style&#x3D;&quot;background-image: url(http:&#x2F;&#x2F;å›¾ç‰‡åœ°å€.com&#x2F;&lt;%- gallery.cover%&gt;);&quot;&gt;                    &lt;&#x2F;div&gt;                    &lt;p class&#x3D;&quot;gallery-name&quot;&gt;                        &lt;%- gallery.name %&gt;                    &lt;&#x2F;p&gt;                &lt;&#x2F;a&gt;            &lt;&#x2F;div&gt;            &lt;% &#125; %&gt;        &lt;&#x2F;div&gt;        &lt;% &#125; %&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;main&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ–°å»ºgallery.ejsï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/css/gallery.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/libs/fancybox/jquery.fancybox.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/libs/justifiedGallery/justifiedGallery.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%-</span><span class="token language-javascript"> <span class="token function">partial</span><span class="token punctuation">(</span><span class="token string">'_partial/post-cover'</span><span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"><span class="token keyword">let</span> galleries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>site<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> site<span class="token punctuation">.</span>data<span class="token punctuation">.</span>galleries<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    galleries <span class="token operator">=</span> site<span class="token punctuation">.</span>data<span class="token punctuation">.</span>galleries<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> pageTitle <span class="token operator">=</span> page<span class="token punctuation">.</span>title<span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">getCurrentGallery</span><span class="token punctuation">(</span><span class="token parameter">galleries<span class="token punctuation">,</span> pageTitle</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> galleries<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>galleries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> pageTitle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> galleries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> currentGallery <span class="token operator">=</span> <span class="token function">getCurrentGallery</span><span class="token punctuation">(</span>galleries<span class="token punctuation">,</span> pageTitle<span class="token punctuation">)</span><span class="token keyword">var</span> photos <span class="token operator">=</span> currentGallery<span class="token punctuation">.</span>photos<span class="token punctuation">;</span><span class="token keyword">let</span> imageStr <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> photos<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> photo <span class="token operator">=</span> photos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    imageStr <span class="token operator">+=</span> <span class="token string">"&lt;a href=\"http://å›¾ç‰‡åœ°å€.com/"</span> <span class="token operator">+</span> photo <span class="token operator">+</span> <span class="token string">"\""</span> <span class="token operator">+</span>            <span class="token string">"     class=\"photo-item\" rel=\"example_group\""</span> <span class="token operator">+</span>            <span class="token string">"     data-fancybox=\"images\">"</span> <span class="token operator">+</span>            <span class="token string">"      &lt;img src=\"http://å›¾ç‰‡åœ°å€.com/"</span> <span class="token operator">+</span> photo <span class="token operator">+</span> <span class="token string">"\""</span> <span class="token operator">+</span>            <span class="token string">"       alt="</span> <span class="token operator">+</span> photo <span class="token operator">+</span> <span class="token string">">\n"</span> <span class="token operator">+</span>            <span class="token string">"    &lt;/a>"</span><span class="token punctuation">&#125;</span></span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>photo-wrapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>waterfall<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mygallery<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%-</span><span class="token language-javascript"> imageStr </span><span class="token delimiter punctuation">%></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/libs/fancybox/fancybox.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/libs/justifiedGallery/justifiedGallery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"a[rel=example_group]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fancybox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#mygallery"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">justifiedGallery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">margins</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token literal-property property">rowHeight</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="æ·»åŠ å›¾ç‰‡"><a href="#æ·»åŠ å›¾ç‰‡" class="headerlink" title="æ·»åŠ å›¾ç‰‡"></a>æ·»åŠ å›¾ç‰‡</h3><ol><li><p>åœ¨ç«™ç‚¹ç›®å½•sources&#x2F;_dataä¸‹æ–°å»ºä¸€ä¸ªgalleries.jsonçš„æ–‡ä»¶ï¼Œæ¨¡æ¿å¦‚ä¸‹ï¼š</p><p>æ¯ä¸ªç›¸å†Œæœ‰ä»¥ä¸‹å­—æ®µï¼š</p><ul><li>nameæ˜¯ç›¸å†Œæ ‡é¢˜</li><li>coveræ˜¯å°é¢å›¾ç‰‡ï¼Œä»ç›¸å†Œé‡Œéšä¾¿é€‰ä¸€ä¸ªå°±è¡Œ</li><li>descriptionæ˜¯ç›¸å†Œä»‹ç»</li><li>photosæ˜¯å›¾ç‰‡åˆ—è¡¨</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ç¾å¥³"</span><span class="token punctuation">,</span>    <span class="token property">"cover"</span><span class="token operator">:</span> <span class="token string">"ç¾å¥³/IMG_20171109_124516.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"2017å¹´è®°å½•"</span><span class="token punctuation">,</span>    <span class="token property">"photos"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"ç¾å¥³/IMG_ç¾å¥³0924_110224.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"ç¾å¥³/IMG_ç¾å¥³0924_113412.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"ç¾å¥³/IMG_ç¾å¥³1109_124516.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"ç¾å¥³/IMG_ç¾å¥³1125_125304.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"ç¾å¥³/IMG_ç¾å¥³1126_181605.jpg"</span>    <span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"åŠ¨æ¼«"</span><span class="token punctuation">,</span>    <span class="token property">"cover"</span><span class="token operator">:</span> <span class="token string">"åŠ¨æ¼«/IMG_20181124_125818.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"2018å¹´è®°å½•"</span><span class="token punctuation">,</span>    <span class="token property">"photos"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"åŠ¨æ¼«/IMG_åŠ¨æ¼«0204_113055.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"åŠ¨æ¼«/IMG_åŠ¨æ¼«0204_113302.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"åŠ¨æ¼«/IMG_åŠ¨æ¼«0204_113442.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"åŠ¨æ¼«/IMG_åŠ¨æ¼«0208_083336.jpg"</span>    <span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"æ¸¸ç©"</span><span class="token punctuation">,</span>    <span class="token property">"cover"</span><span class="token operator">:</span> <span class="token string">"æ¸¸ç©/IMG_æ¸¸ç©0331_165713_1.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"æ¸¸ç©å¹´è®°å½•"</span><span class="token punctuation">,</span>    <span class="token property">"photos"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"æ¸¸ç©/IMG_æ¸¸ç©0118_200104.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"æ¸¸ç©/IMG_æ¸¸ç©0118_200120.jpg"</span><span class="token punctuation">,</span>      <span class="token string">"æ¸¸ç©/IMG_æ¸¸ç©0118_200456.jpg"</span>    <span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨galleriesä¸‹å»ºç«‹å¯¹åº”çš„ç›¸å†Œåç§°çš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚æˆ‘çš„ç›¸å†Œéœ€è¦å»ºï¼šç¾å¥³ã€ åŠ¨æ¼«ã€æ¸¸ç©ã€ä¸ªäººå››ä¸ªç›®å½•ï¼Œç„¶åä¸‹é¢å†åˆ†åˆ«æ–°å»ºindex.mdæ–‡ä»¶ï¼Œæ–‡ä»¶æ ¼å¼ä¸º:</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> ç¾å¥³<span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"gallery"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="é€‰æ‹©å¸ƒå±€"><a href="#é€‰æ‹©å¸ƒå±€" class="headerlink" title="é€‰æ‹©å¸ƒå±€"></a>é€‰æ‹©å¸ƒå±€</h3><p>ä¸Šé¢çš„åšå®¢ç”¨çš„å¸ƒå±€æ¯”è¾ƒç®€å•ç²—æš´ï¼Œéƒ½æ˜¯å›ºå®šçš„å¤§å°å’Œå®½é«˜æ¯”ã€‚ä½†æ˜¯ä¸åŒçš„å›¾ç‰‡æœ‰ä¸åŒçš„å®½é«˜æ¯”ï¼Œç”¨è¿™ç§æ¨¡å¼çš„è¯å›¾ç‰‡æœ‰ä¸¤ç§æ˜¾ç¤ºæ–¹å¼ï¼š</p><ul><li>ä¸€æ˜¯å¼ºåˆ¶ç¼©æ”¾åˆ°å›ºå®šçš„å®½é«˜ï¼Œç¼ºç‚¹æ˜¯å›¾ç‰‡ä¼šå˜å½¢</li><li>äºŒæ˜¯è£åˆ‡åªæ˜¾ç¤ºä¸€éƒ¨åˆ†ï¼Œç¼ºç‚¹æ˜¯å›¾ç‰‡æ˜¾ç¤ºä¸å…¨</li></ul><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸¤å…¨é½ç¾çš„åŠæ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé€‰ç”¨CSS3çš„æ–°ç‰¹æ€§å®ç°çš„ç€‘å¸ƒæµå¸ƒå±€ï¼Œç‰¹ç‚¹æ˜¯ç­‰å®½å¸ƒå±€ï¼Œå›ºå®šåˆ—æ•°ï¼Œå›¾ç‰‡é«˜åº¦è‡ªé€‚åº”ã€‚ç€‘å¸ƒæµå¸ƒå±€è™½ç¾è§‚ä¸”ç°ä»£åŒ–ï¼Œä½†å›¾ç‰‡æŒ‰ç…§åˆ—å‚ç›´é¡ºåºæ’åˆ—ï¼Œä¸ç¬¦åˆé˜…è¯»ä¹ æƒ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202402022020011.png" alt="ç€‘å¸ƒæµ"></p><p>å¦å¤–ä¸€ç§å¸ƒå±€æ˜¯ç­‰é«˜å¸ƒå±€ï¼Œå›¾ç‰‡é«˜åº¦ä¸€è‡´ï¼Œå®½åº¦è‡ªé€‚åº”ï¼Œå›¾ç‰‡æ‰˜ç®¡ç½‘ç«™flickrå°±æ˜¯ç”¨çš„è¿™ç§æ¨¡å¼ï¼Œä½†ç”¨CSSæ–¹æ³•æ˜¯å®ç°ä¸äº†ï¼Œå› ä¸ºæ¯ä¸€è¡Œæœ€åå¼ å›¾ç‰‡ä¸ä¸€å®šèƒ½æ­£å¥½æ’‘æ»¡è¿™ä¸€è¡Œï¼Œéœ€è¦ç”¨jsåŠ¨æ€è®¾ç½®å›¾ç‰‡çš„å®½é«˜æ¥å®ç°ï¼ŒjustifiedGalleryæ’ä»¶å°±æ˜¯æ¥å®Œæˆè¿™ä¸ªçš„ã€‚</p><p>æš‚æ—¶æ²¡æœ‰æ¼”ç¤ºå›¾ç‰‡ğŸ˜‚</p><p>ä¸‹é¢ä»£ç çš„åŠŸèƒ½å°±æ˜¯åˆå§‹åŒ–è¿™ä¸ªæ’ä»¶ï¼Œé—´è·æ˜¯5pxï¼Œæ¯ä¸€è¡Œçš„é«˜åº¦æ˜¯150px</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs">$("#mygallery").justifiedGallery(&#123;margins: 5, rowHeight: 150&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸¤ç§å¸ƒå±€ä¸Šé¢çš„ä»£ç é‡Œéƒ½æ˜¯åŒ…å«äº†çš„ã€‚æ˜¯å¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ï¼Œåªéœ€è¦æŠŠä¸Šé¢é‚£å¥ä»£ç æ³¨é‡Šæ‰å°±ä¼šåˆ‡æ¢åˆ°ç€‘å¸ƒæµå¸ƒå±€ã€‚</p><p>å½“ç„¶ï¼Œä½ è¦æ˜¯å¯¹è¿™ä¸ªæ ·å¼ä¸æ»¡æ„ä¹Ÿå¯ä»¥è‡ªè¡Œè®¾è®¡æ ·å¼ã€‚</p><h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://crazyyuchi.github.io/2022/06/27/xin-jian-xiang-ce/">æ–°å»ºç›¸å†Œ | å…´å¹³ (crazyyuchi.github.io)</a></p><h2 id="æ ·å¼äºŒ"><a href="#æ ·å¼äºŒ" class="headerlink" title="æ ·å¼äºŒ"></a>æ ·å¼äºŒ</h2>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç›¸å†Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>404é¡µé¢</title>
      <link href="/posts/e7a5.html"/>
      <url>/posts/e7a5.html</url>
      
        <content type="html"><![CDATA[<h1 id="404-ä¿®æ”¹å¤±è´¥"><a href="#404-ä¿®æ”¹å¤±è´¥" class="headerlink" title="404(ä¿®æ”¹å¤±è´¥)"></a>404(ä¿®æ”¹å¤±è´¥)</h1><h2 id="æ¼”ç¤ºæ•ˆæœ"><a href="#æ¼”ç¤ºæ•ˆæœ" class="headerlink" title="æ¼”ç¤ºæ•ˆæœ"></a>æ¼”ç¤ºæ•ˆæœ</h2><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202402011322913.gif" alt="404"></p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>æˆ‘çš„æ¨¡ç‰ˆé€‰ç”¨çš„ä½¿ç”¨404 Andrew Lawendyï¼Œ<a href="https://codepen.io/andrew-lawendy/pen/deOpMZ">æ¨¡ç‰ˆä»£ç </a></p><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>not-found parallax<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sky-bg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-7<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-island<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://res.cloudinary.com/andrewhani/image/upload/v1524501929/404/island.svg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Island<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-lost wrp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-boat<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>boat<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://res.cloudinary.com/andrewhani/image/upload/v1524501894/404/boat.svg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Boat<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Your're lost<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Click on the island to return<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'https://fonts.googleapis.com/css?family=Open+Sans|PT+Sans+Narrow'</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span></span>$<span class="token property">in-out-cubic</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.65<span class="token punctuation">,</span> 0.05<span class="token punctuation">,</span> 0.36<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token atrule"><span class="token rule">@mixin</span> <span class="token function">transform</span><span class="token punctuation">(</span>$transform...<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> $transform<span class="token punctuation">;</span>    <span class="token property">-moz-transform</span><span class="token punctuation">:</span> $transform<span class="token punctuation">;</span>    <span class="token property">-ms-transform</span><span class="token punctuation">:</span> $transform<span class="token punctuation">;</span>    <span class="token property">-o-transform</span><span class="token punctuation">:</span> $transform<span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> $transform<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@mixin</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>$transform-origin...<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token property">-webkit-transform-origin</span><span class="token punctuation">:</span> $transform-origin<span class="token punctuation">;</span>    <span class="token property">-moz-transform-origin</span><span class="token punctuation">:</span> $transform-origin<span class="token punctuation">;</span>    <span class="token property">-ms-transform-origin</span><span class="token punctuation">:</span> $transform-origin<span class="token punctuation">;</span>    <span class="token property">-o-transform-origin</span><span class="token punctuation">:</span> $transform-origin<span class="token punctuation">;</span>    <span class="token property">transform-origin</span><span class="token punctuation">:</span> $transform-origin<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@mixin</span> <span class="token function">key-frame</span><span class="token punctuation">(</span>$name<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token atrule"><span class="token rule">@-webkit-keyframes</span> #</span><span class="token punctuation">&#123;</span>$name<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@content</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token atrule"><span class="token rule">@-moz-keyframes</span> #</span><span class="token punctuation">&#123;</span>$name<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@content</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token atrule"><span class="token rule">@-o-keyframes</span> #</span><span class="token punctuation">&#123;</span>$name<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@content</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/* Standard syntax */</span>    <span class="token atrule"><span class="token rule">@keyframes</span> #</span><span class="token punctuation">&#123;</span>$name<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@content</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@mixin</span> <span class="token function">animation</span><span class="token punctuation">(</span>$animation...<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span>    <span class="token property">-moz-animation</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span>    <span class="token property">-o-animation</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@mixin</span> <span class="token function">animation-delay</span><span class="token punctuation">(</span>$animation...<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token property">-webkit-animation-delay</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span>    <span class="token property">-moz-animation-delay</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span>    <span class="token property">-o-animation-delay</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span>    <span class="token property">animation-delay</span><span class="token punctuation">:</span> $animation<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">body</span><span class="token punctuation">&#123;</span>  <span class="token property">overflow</span><span class="token punctuation">:</span>hidden<span class="token punctuation">;</span>  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Open Sans'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>    <span class="token property">margin</span><span class="token punctuation">:</span>0 -20vw<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span>110vh<span class="token punctuation">;</span>    <span class="token selector">[class*="wave"]</span> <span class="token punctuation">&#123;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">div</span> <span class="token punctuation">&#123;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>        <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>        <span class="token atrule"><span class="token rule">@for</span> $i from 1 through 7</span> <span class="token punctuation">&#123;</span>            <span class="token selector">&amp;.wave-#</span><span class="token punctuation">&#123;</span>$i<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span>                <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://res.cloudinary.com/andrewhani/image/upload/v1524501869/404/wave-#&#123;$i&#125;.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>      <span class="token selector">&amp;.sky-bg</span><span class="token punctuation">&#123;</span>        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://res.cloudinary.com/andrewhani/image/upload/v1524821915/404/bg-1_gvybzk.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        <span class="token selector">&amp;[class*="wave"]:not(.wave-4)</span> <span class="token punctuation">&#123;</span>            <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 250px<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">&amp;.wave-4</span> <span class="token punctuation">&#123;</span>            <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 430px<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">.boat</span> <span class="token punctuation">&#123;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>        <span class="token property">right</span><span class="token punctuation">:</span> 15%<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">animation</span><span class="token punctuation">(</span>boat 15s $in-out-cubic infinite<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">.wave-lost</span> <span class="token punctuation">&#123;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> 20%<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> 20rem<span class="token punctuation">;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">animation</span><span class="token punctuation">(</span>surf 2s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token selector">span</span> <span class="token punctuation">&#123;</span>            <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>            <span class="token atrule"><span class="token rule">@include</span> <span class="token function">animation</span><span class="token punctuation">(</span>float 3s ease-in infinite<span class="token punctuation">)</span><span class="token punctuation">;</span></span>            <span class="token selector">&amp;:nth-child(2)</span> <span class="token punctuation">&#123;</span>                <span class="token atrule"><span class="token rule">@include</span> <span class="token function">animation-delay</span><span class="token punctuation">(</span>2.5s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>            <span class="token punctuation">&#125;</span>            <span class="token selector">&amp;:nth-child(3)</span> <span class="token punctuation">&#123;</span>                <span class="token atrule"><span class="token rule">@include</span> <span class="token function">animation-delay</span><span class="token punctuation">(</span>4.5s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">.wave-island</span> <span class="token punctuation">&#123;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> 130px<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 20%<span class="token punctuation">;</span>        <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> 170px<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">.wave-message</span> <span class="token punctuation">&#123;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">bottom</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>        <span class="token property">padding-right</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> auto <span class="token important">!important</span><span class="token punctuation">;</span>        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> 3rem<span class="token punctuation">;</span>        <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">animation</span><span class="token punctuation">(</span>wave-message 1s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@include</span> <span class="token function">key-frame</span><span class="token punctuation">(</span>boat<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>-15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>400px<span class="token punctuation">,</span> 0px<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">20%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-20vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">25%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>-7deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-25vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>5deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-50vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">60%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>-1deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-60vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>2deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-100vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@include</span> <span class="token function">key-frame</span><span class="token punctuation">(</span>float<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%,    100%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>3deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0px<span class="token punctuation">,</span> -10px<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>-3deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0px<span class="token punctuation">,</span> 10px<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@include</span> <span class="token function">key-frame</span><span class="token punctuation">(</span>surf<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 800px<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">30%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 500px<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform-origin</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span></span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">rotate</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@include</span> <span class="token function">key-frame</span><span class="token punctuation">(</span>wave-message<span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>    <span class="token selector">0%</span><span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 120%<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span><span class="token punctuation">&#123;</span>        <span class="token atrule"><span class="token rule">@include</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">parallax</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> windowWidth <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>windowWidth <span class="token operator">&lt;</span> <span class="token number">768</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> halfFieldWidth <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".parallax"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>      halfFieldHeight <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".parallax"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>      fieldPos <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".parallax"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">,</span>      y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY <span class="token operator">-</span> fieldPos<span class="token punctuation">.</span>top<span class="token punctuation">,</span>      newX <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> halfFieldWidth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">30</span><span class="token punctuation">,</span>      newY <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> halfFieldHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.parallax [class*="wave"]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">transition</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token literal-property property">transform</span><span class="token operator">:</span>          <span class="token string">"translate3d("</span> <span class="token operator">+</span> index <span class="token operator">*</span> newX <span class="token operator">+</span> <span class="token string">"px,"</span> <span class="token operator">+</span> index <span class="token operator">*</span> newY <span class="token operator">+</span> <span class="token string">"px,0px)"</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">stopParallax</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.parallax [class*="wave"]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">"translate(0px,0px)"</span><span class="token punctuation">,</span>      <span class="token literal-property property">transition</span><span class="token operator">:</span> <span class="token string">"all .7s"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">$timeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.parallax [class*="wave"]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">"transition"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".not-found"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> parallax<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".not-found"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"mouseleave"</span><span class="token punctuation">,</span> stopParallax<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="äºŒæ¬¡ä¿®æ”¹"><a href="#äºŒæ¬¡ä¿®æ”¹" class="headerlink" title="äºŒæ¬¡ä¿®æ”¹"></a>äºŒæ¬¡ä¿®æ”¹</h3><h4 id="html"><a href="#html" class="headerlink" title="html"></a>html</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/html; charset=UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Parallax 404 page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../themes/matery/source/css/404.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../themes/matery/source/js/404.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>not-found<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>not-found parallax<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sky-bg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-7<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-island<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../themes/matery/source/404/island.svg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Island<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-lost wrp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-boat<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>boat<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../themes/matery/source/404/boat.svg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Boat<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>You seem lost<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Click on the island to return<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="css"><a href="#css" class="headerlink" title="css"></a>css</h4><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Open Sans"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>    <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>    <span class="token property">margin</span><span class="token punctuation">:</span> -1vh -20vw<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 110vh<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found [class*=wave]</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-1</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/wave-1.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-2</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/wave-2.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-3</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/wave-3.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-4</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/wave-4.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-5</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/wave-5.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-6</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/wave-6.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-7</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/wave-7.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.sky-bg</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../404/bg.svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div[class*=wave]</span> <span class="token punctuation">&#123;</span>    <span class="token property">opacity</span><span class="token punctuation">:</span> 0.99<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div[class*=wave]:not(.wave-4)</span> <span class="token punctuation">&#123;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 350px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found div.wave-4</span> <span class="token punctuation">&#123;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 530px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found .boat</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>    <span class="token property">right</span><span class="token punctuation">:</span> 15%<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> boat 15s <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.65<span class="token punctuation">,</span> 0.05<span class="token punctuation">,</span> 0.36<span class="token punctuation">,</span> 1<span class="token punctuation">)</span> infinite<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found .wave-lost</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">top</span><span class="token punctuation">:</span> 20%<span class="token punctuation">;</span>    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> 20rem<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> surf 2s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token selector">.not-found .wave-lost</span> <span class="token punctuation">&#123;</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> 13rem<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 16%<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 992px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token selector">.not-found .wave-lost</span> <span class="token punctuation">&#123;</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> 20rem<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 22%<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found .wave-lost span</span> <span class="token punctuation">&#123;</span>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> float 3s ease-in infinite<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found .wave-lost span:nth-child(2)</span> <span class="token punctuation">&#123;</span>    <span class="token property">animation-delay</span><span class="token punctuation">:</span> 2.5s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found .wave-lost span:nth-child(3)</span> <span class="token punctuation">&#123;</span>    <span class="token property">animation-delay</span><span class="token punctuation">:</span> 4.5s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found .wave-island</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">top</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>    <span class="token property">left</span><span class="token punctuation">:</span> 20%<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 170px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.not-found .wave-message</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">bottom</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>    <span class="token property">padding-right</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> auto <span class="token important">!important</span><span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> 3rem<span class="token punctuation">;</span>    <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> wave-message 1s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token selector">.not-found .wave-message</span> <span class="token punctuation">&#123;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 16%<span class="token punctuation">;</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> 1.8rem<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 992px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>    <span class="token selector">.not-found .wave-message</span> <span class="token punctuation">&#123;</span>        <span class="token property">left</span><span class="token punctuation">:</span> 22%<span class="token punctuation">;</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> 3rem<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> boat</span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>400px<span class="token punctuation">,</span> 0px<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">20%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-20vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">25%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-7deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-25vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>5deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-50vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">60%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-1deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-60vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>2deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-100vw<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> float</span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%,    100%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>3deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0px<span class="token punctuation">,</span> -10px<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-3deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0px<span class="token punctuation">,</span> 10px<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> surf</span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 800px<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">30%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>15deg<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 500px<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform-origin</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> wave-message</span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 120%<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="js"><a href="#js" class="headerlink" title="js"></a>js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">parallax</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> windowWidth <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>windowWidth <span class="token operator">&lt;</span> <span class="token number">768</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> parallax <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.parallax'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> halfFieldWidth <span class="token operator">=</span> parallax<span class="token punctuation">.</span>offsetWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> halfFieldHeight <span class="token operator">=</span> parallax<span class="token punctuation">.</span>offsetHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> fieldPos <span class="token operator">=</span> parallax<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>  <span class="token keyword">var</span> y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY <span class="token operator">-</span> fieldPos<span class="token punctuation">.</span>top<span class="token punctuation">;</span>  <span class="token keyword">var</span> newX <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> halfFieldWidth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">30</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> newY <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> halfFieldHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">30</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> waveElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.parallax [class*="wave"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  waveElements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">"translate3d("</span> <span class="token operator">+</span> index <span class="token operator">*</span> newX <span class="token operator">+</span> <span class="token string">"px,"</span> <span class="token operator">+</span> index <span class="token operator">*</span> newY <span class="token operator">+</span> <span class="token string">"px,0px"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">stopParallax</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> waveElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.parallax [class*="wave"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    waveElements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">"translate(0px, 0px)"</span><span class="token punctuation">;</span>      element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">"all 0.7s"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      waveElements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"not-found"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> parallax<span class="token punctuation">)</span><span class="token punctuation">;</span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"not-found"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseleave"</span><span class="token punctuation">,</span> stopParallax<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¿®æ”¹æ­¥éª¤"><a href="#ä¿®æ”¹æ­¥éª¤" class="headerlink" title="ä¿®æ”¹æ­¥éª¤"></a>ä¿®æ”¹æ­¥éª¤</h2><ol><li><p>å°†åŸæ¥sourceç›®å½•ä¸‹çš„404.mdæ–‡ä»¶åˆ é™¤ï¼Œæ–°å»º404.ejs</p><p>åŸ404.mdä»£ç ï¼š</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml">title: 404date: 2019-07-19 16:41:10type: "404"layout: "404"description: "ä½ ä¼¼ä¹æ¥åˆ°äº†æ²¡æœ‰çŸ¥è¯†çš„è’åŸ~~~"</span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>404.ejsï¼šå°†ä¸Šé¢çš„<code>HTMLä»£ç </code>ç²˜è´´åˆ°<code>404.ejs</code> æ–‡ä»¶ä¸­</p></li><li><p><strong>å°†CSSä»£ç æ·»åŠ åˆ°ä¸»é¢˜ä¸­ï¼š</strong></p><ul><li>åœ¨matery&#x2F;source&#x2F;cssä¸‹ï¼Œæ–°å»º404.cssï¼ŒæŠŠä¸Šé¢çš„<code>cssä»£ç </code>ç²˜è´´åˆ°é‡Œé¢</li><li>å°†404.cssæ·»åŠ åˆ°<code>Matery/_config.yml</code>çš„æ ·å¼è¡¨ä¸­</li></ul></li><li><p><strong>å°†JSä»£ç æ·»åŠ åˆ°ä¸»é¢˜ä¸­ï¼š</strong></p><ul><li>matery&#x2F;source&#x2F;jsä¸‹ï¼Œæ–°å»º404.jsï¼ŒæŠŠä¸Šé¢çš„<code>jsä»£ç </code>ç²˜è´´åˆ°å…¶ä¸­</li><li>å°†404.cssæ·»åŠ åˆ°<code>Matery/_config.yml</code>çš„æ ·å¼è¡¨ä¸­</li></ul></li><li><p><strong>é…ç½®ä¸»é¢˜ä»¥ä½¿ç”¨404é¡µé¢ï¼š</strong></p><ul><li>æ‰“å¼€Hexoåšå®¢æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ã€‚</li><li>åœ¨è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸»é¢˜é…ç½®é¡¹ï¼Œé€šå¸¸æ˜¯ <code>theme: matery</code></li><li>æŸ¥æ‰¾æ˜¯å¦æœ‰é…ç½®é¡¹ç”¨äºæŒ‡å®š404é¡µé¢ï¼Œæˆ–è€…ç±»ä¼¼çš„é…ç½®ã€‚å¦‚æœæœ‰ï¼Œå°†å…¶è®¾ç½®ä¸º <code>404.ejs</code> æˆ–ä½ çš„è‡ªå®šä¹‰404é¡µé¢æ–‡ä»¶åã€‚</li></ul></li><li><p><strong>é‡æ–°ç”Ÿæˆå¹¶éƒ¨ç½²åšå®¢ï¼š</strong></p><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆå¹¶éƒ¨ç½²Hexoåšå®¢ï¼š</p><pre class="line-numbers language-none"><code class="language-none">hexo cleanhexo generatehexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åˆ·æ–°ä½ çš„åšå®¢ï¼Œç°åœ¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°è‡ªå®šä¹‰çš„404é¡µé¢äº†ã€‚</p></li></ol><h2 id="ç†è§£HTTPçŠ¶æ€ç "><a href="#ç†è§£HTTPçŠ¶æ€ç " class="headerlink" title="ç†è§£HTTPçŠ¶æ€ç "></a>ç†è§£HTTPçŠ¶æ€ç </h2><h3 id="ä¿¡æ¯å“åº”ï¼ˆ100â€“199ï¼‰"><a href="#ä¿¡æ¯å“åº”ï¼ˆ100â€“199ï¼‰" class="headerlink" title="ä¿¡æ¯å“åº”ï¼ˆ100â€“199ï¼‰"></a>ä¿¡æ¯å“åº”ï¼ˆ100â€“199ï¼‰</h3><ul><li><p><strong>100 Continueï¼ˆç»§ç»­ï¼‰</strong>ï¼šæœåŠ¡å™¨å·²æ”¶åˆ°è¯·æ±‚å¤´ï¼Œå®¢æˆ·ç«¯åº”ç»§ç»­å‘é€è¯·æ±‚ä½“ã€‚</p></li><li><p><strong>101 Switching Protocolsï¼ˆåˆ‡æ¢åè®®ï¼‰</strong>ï¼šè¯·æ±‚è€…è¦æ±‚æœåŠ¡å™¨åˆ‡æ¢åè®®ã€‚</p></li></ul><h3 id="æˆåŠŸå“åº”ï¼ˆ200â€“299ï¼‰"><a href="#æˆåŠŸå“åº”ï¼ˆ200â€“299ï¼‰" class="headerlink" title="æˆåŠŸå“åº”ï¼ˆ200â€“299ï¼‰"></a>æˆåŠŸå“åº”ï¼ˆ200â€“299ï¼‰</h3><ul><li><p><strong>200 OKï¼ˆæˆåŠŸï¼‰</strong>ï¼šè¯·æ±‚æˆåŠŸã€‚</p></li><li><p><strong>201 Createdï¼ˆå·²åˆ›å»ºï¼‰</strong>ï¼šè¯·æ±‚æˆåŠŸï¼Œå¹¶åˆ›å»ºäº†æ–°çš„èµ„æºã€‚</p></li><li><p><strong>204 No Contentï¼ˆæ— å†…å®¹ï¼‰</strong>ï¼šæœåŠ¡å™¨æˆåŠŸå¤„ç†è¯·æ±‚ï¼Œä½†æ²¡æœ‰é¢å¤–çš„å†…å®¹è¦å‘é€ã€‚</p></li></ul><h3 id="é‡å®šå‘æ¶ˆæ¯ï¼ˆ300â€“399ï¼‰"><a href="#é‡å®šå‘æ¶ˆæ¯ï¼ˆ300â€“399ï¼‰" class="headerlink" title="é‡å®šå‘æ¶ˆæ¯ï¼ˆ300â€“399ï¼‰"></a>é‡å®šå‘æ¶ˆæ¯ï¼ˆ300â€“399ï¼‰</h3><ul><li><p><strong>301 Moved Permanentlyï¼ˆæ°¸ä¹…ç§»åŠ¨ï¼‰</strong>ï¼šæ‰€è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…ç§»åŠ¨ã€‚</p></li><li><p><strong>302 Foundï¼ˆæˆ–307 Temporary Redirectï¼‰</strong>ï¼šæ‰€è¯·æ±‚çš„èµ„æºæš‚æ—¶å­˜æ”¾åœ¨ä¸åŒçš„URIä¸‹ã€‚</p></li><li><p><strong>304 Not Modifiedï¼ˆæœªä¿®æ”¹ï¼‰</strong>ï¼šè‡ªè¯·æ±‚æŒ‡å®šçš„ç‰ˆæœ¬ä»¥æ¥ï¼Œèµ„æºæœªè¢«ä¿®æ”¹ã€‚</p></li></ul><h3 id="å®¢æˆ·ç«¯é”™è¯¯å“åº”ï¼ˆ400â€“499ï¼‰"><a href="#å®¢æˆ·ç«¯é”™è¯¯å“åº”ï¼ˆ400â€“499ï¼‰" class="headerlink" title="å®¢æˆ·ç«¯é”™è¯¯å“åº”ï¼ˆ400â€“499ï¼‰"></a>å®¢æˆ·ç«¯é”™è¯¯å“åº”ï¼ˆ400â€“499ï¼‰</h3><ul><li><p><strong>400 Bad Requestï¼ˆé”™è¯¯è¯·æ±‚ï¼‰</strong>ï¼šæœåŠ¡å™¨æ— æ³•ç†è§£è¯·æ±‚ã€‚</p></li><li><p><strong>401 Unauthorizedï¼ˆæœªæˆæƒï¼‰</strong>ï¼šè¯·æ±‚è¦æ±‚ç”¨æˆ·èº«ä»½éªŒè¯ã€‚</p></li><li><p><strong>403 Forbiddenï¼ˆç¦æ­¢ï¼‰</strong>ï¼šæœåŠ¡å™¨ç†è§£è¯·æ±‚ï¼Œä½†æ‹’ç»æˆæƒã€‚</p></li><li><p><strong>404 Not Foundï¼ˆæœªæ‰¾åˆ°ï¼‰</strong>ï¼šæœåŠ¡å™¨æœªæ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚</p></li><li><p><strong>405 Method Not Allowedï¼ˆæ–¹æ³•ç¦ç”¨ï¼‰</strong>ï¼šè¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ä¸è¢«å…è®¸ã€‚</p></li><li><p><strong>408 Request Timeoutï¼ˆè¯·æ±‚è¶…æ—¶ï¼‰</strong>ï¼šæœåŠ¡å™¨ç­‰å¾…è¯·æ±‚æ—¶å‘ç”Ÿè¶…æ—¶ã€‚</p></li></ul><h3 id="æœåŠ¡å™¨é”™è¯¯å“åº”ï¼ˆ500â€“599ï¼‰"><a href="#æœåŠ¡å™¨é”™è¯¯å“åº”ï¼ˆ500â€“599ï¼‰" class="headerlink" title="æœåŠ¡å™¨é”™è¯¯å“åº”ï¼ˆ500â€“599ï¼‰"></a>æœåŠ¡å™¨é”™è¯¯å“åº”ï¼ˆ500â€“599ï¼‰</h3><ul><li><p><strong>500 Internal Server Errorï¼ˆæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼‰</strong>ï¼šé‡åˆ°æ„å¤–æ¡ä»¶ï¼ŒæœåŠ¡å™¨æ— æ³•å®Œæˆè¯·æ±‚ã€‚</p></li><li><p><strong>502 Bad Gatewayï¼ˆé”™è¯¯ç½‘å…³ï¼‰</strong>ï¼šæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†æ—¶ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆçš„å“åº”ã€‚</p></li><li><p><strong>503 Service Unavailableï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰</strong>ï¼šæœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ã€‚</p></li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.52txr.cn/2022/404html.html">å¥½çœ‹çš„404æ¨¡æ¿</a></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>é€šè¿‡äº†è§£HTTPçŠ¶æ€ç å¹¶åˆ›å»ºè‡ªå®šä¹‰404é”™è¯¯é¡µé¢ï¼Œæ‚¨å¯ä»¥æå‡ç”¨æˆ·ä½“éªŒï¼Œç•™ä½è®¿å®¢ï¼Œå¹¶å‡è½»ç½‘ç«™æ­»é“¾å¯¹ç”¨æˆ·çš„å½±å“ã€‚å®šæœŸç›‘æµ‹ç½‘ç«™é”™è¯¯å¹¶æ ¹æ®éœ€è¦æ›´æ–°404é¡µé¢ã€‚</p><h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><p>å¦‚æœæ˜¯æ–°å»º <code>404.html</code> æ–‡ä»¶çš„è¯ï¼Œæ˜¯å¯ä»¥è¿›è¡Œæœ¬åœ°é¢„è§ˆçš„ã€‚ä½†æ˜¯è¿™ä¸ªé¢„è§ˆä¸èƒ½ä½¿ç”¨ <code>http://localhost:4000/ä»»æ„å­—ç¬¦</code> æ¥æŸ¥çœ‹ï¼Œå¿…é¡»ä½¿ç”¨ <code>http://localhost:4000/404</code> æ¥è¿›è¡Œæœ¬åœ°é¢„è§ˆ</p><h2 id="æ›´å¤šæ¨¡ç‰ˆ"><a href="#æ›´å¤šæ¨¡ç‰ˆ" class="headerlink" title="æ›´å¤šæ¨¡ç‰ˆ"></a>æ›´å¤šæ¨¡ç‰ˆ</h2><p><a href="https://frontendin.com/404-page-templates-on-codepen/?amp=1">404æ¨¡ç‰ˆå±•ç¤ºåŠæºç </a></p><h2 id="ä¿®æ”¹å‰ä»£ç "><a href="#ä¿®æ”¹å‰ä»£ç " class="headerlink" title="ä¿®æ”¹å‰ä»£ç "></a>ä¿®æ”¹å‰ä»£ç </h2><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>404 Andrew Lawendy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- &lt;link rel="stylesheet" href="https://rsupanta-weather.herokuapp.com/css/404.css"> --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../themes/matery/source/css/404.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>not-found parallax<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sky-bg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-7<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-island<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://haiyongcsdn.gitee.io/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://res.cloudinary.com/andrewhani/image/upload/v1524501929/404/island.svg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Island<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-lost wrp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-boat<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>boat<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://res.cloudinary.com/andrewhani/image/upload/v1524501894/404/boat.svg<span class="token punctuation">"</span></span>                <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Boat<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wave-message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Your're lost<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Click on the island to return<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- &lt;script src="https://rsupanta-weather.herokuapp.com/js/404.js">&lt;/script> --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../themes/matery/source/js/404.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 404 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenMP</title>
      <link href="/posts/8905.html"/>
      <url>/posts/8905.html</url>
      
        <content type="html"><![CDATA[<h1 id="OpenMP"><a href="#OpenMP" class="headerlink" title="OpenMP"></a>OpenMP</h1><h2 id="OpenMPä»‹ç»"><a href="#OpenMPä»‹ç»" class="headerlink" title="OpenMPä»‹ç»"></a>OpenMPä»‹ç»</h2><p>åœ¨C&#x2F;C++ä¸­ï¼ŒOpenMPå¯ä»¥é€šè¿‡ä½¿ç”¨é¢„å¤„ç†æŒ‡ä»¤æ¥è®©ç¨‹åºå¹¶è¡ŒåŒ–ã€‚OpenMPæŒ‡ä»¤ä½¿ç”¨çš„æ ¼å¼ä¸º:</p><pre class="line-numbers language-none"><code class="language-none">#pragma omp æŒ‡ä»¤ [å­å¥[å­å¥]â€¦]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„OpenMPç¨‹åºï¼Œå¯ä»¥è¿è¡Œåè§‚å¯Ÿç»“æœä¸æ™®é€šç¨‹åºæœ‰ä»€ä¹ˆä¸åŒã€‚</p><p>è¯·åœ¨é€‚å½“çš„ä½ç½®å¡«ä¸Š<code>#pragma omp parallel for</code> ä½¿ç¨‹åºå¹¶è¡Œæ‰§è¡Œã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> </span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">i &#x3D; 2i &#x3D; 0i &#x3D; 6i &#x3D; 1i &#x3D; 8i &#x3D; 5i &#x3D; 4i &#x3D; 7i &#x3D; 9i &#x3D; 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="fork-joinå¹¶è¡Œæ‰§è¡Œæ¨¡å¼çš„æ¦‚å¿µ"><a href="#fork-joinå¹¶è¡Œæ‰§è¡Œæ¨¡å¼çš„æ¦‚å¿µ" class="headerlink" title="fork&#x2F;joinå¹¶è¡Œæ‰§è¡Œæ¨¡å¼çš„æ¦‚å¿µ"></a>fork&#x2F;joinå¹¶è¡Œæ‰§è¡Œæ¨¡å¼çš„æ¦‚å¿µ</h2><p>OpenMPæ˜¯ä¸€å¥—ç”¨äºå…±äº«å†…å­˜å¹¶è¡Œç³»ç»Ÿçš„å¤šå¤„ç†å™¨ç¨‹åºè®¾è®¡çš„æŒ‡å¯¼æ€§çš„ç¼–è¯‘å¤„ç†æ–¹æ¡ˆï¼Œä»ä¹‹å‰çš„ä»‹ç»æˆ‘ä»¬å¯ä»¥å‘ç°ç¨‹åºè¿˜æ˜¯åœ¨å¾ªç¯ç»“æŸä¹‹åæ‰è¿è¡Œreturn 0è¯­å¥ï¼Œå› æ­¤å¯ä»¥æ¨æ–­OpenMPå¹¶è¡Œæ‰§è¡Œçš„ç¨‹åºè¦å…¨éƒ¨ç»“æŸåæ‰ä¼šè¿è¡Œåé¢éå¹¶è¡Œéƒ¨åˆ†çš„ä»£ç ï¼Œè¿™å°±æ˜¯fork&#x2F;joinå¹¶è¡Œæ¨¡å¼ã€‚ä»¥ä¸Šç»“è®ºå¯ä»¥ä»ç¤ºä¾‹ä»£ç ä¸­ä½“ç°ã€‚</p><p>è¯·åœ¨é€‚å½“çš„ä½ç½®å¡«ä¸Š<code>#pragma omp parallel for </code>ä½¿ç¨‹åºå¹¶è¡Œæ‰§è¡Œã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">Time &#x3D; 159Time &#x3D; 161Total time &#x3D; 162<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">1e8</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">double</span> t1 <span class="token operator">=</span> <span class="token function">omp_get_wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// your code</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span></span></span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">double</span> t2 <span class="token operator">=</span> <span class="token function">omp_get_wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Total time = %f seconds\n"</span><span class="token punctuation">,</span> t2 <span class="token operator">-</span> t1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="parallel-æŒ‡ä»¤"><a href="#parallel-æŒ‡ä»¤" class="headerlink" title="parallel æŒ‡ä»¤"></a>parallel æŒ‡ä»¤</h2><p><code>#pragma omp parallel</code> æ˜¯ OpenMP ä¸­ç”¨äºåˆ›å»ºå¹¶è¡ŒåŒºåŸŸï¼ˆparallel regionï¼‰çš„æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥æ­é… <code>for</code> æˆ– <code>sections</code> ä»¥åŠå…¶ä»–å­å¥æ¥å®ç°ä¸åŒçš„å¹¶è¡Œæ“ä½œã€‚</p><p>è¿™ä¸ªæŒ‡ä»¤çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªå¹¶è¡ŒåŒºåŸŸï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä¸­çš„ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><p>ä¸‹é¢æ˜¯å¯¹ <code>#pragma omp parallel</code> çš„è¯¦ç»†è§£é‡Šå’Œç¤ºä¾‹ç”¨æ³•ï¼š</p><ul><li><p><strong>è§£é‡Š</strong>ï¼š</p><ul><li><code>#pragma omp</code> æ˜¯ OpenMP æŒ‡ä»¤çš„å‰ç¼€ï¼Œç”¨äºæŒ‡ç¤ºç¼–è¯‘å™¨æ‰§è¡Œå¹¶è¡ŒåŒ–æ“ä½œã€‚</li><li><code>parallel</code> æŒ‡ä»¤ç”¨äºåˆ›å»ºä¸€ä¸ªå¹¶è¡ŒåŒºåŸŸï¼Œå…¶ä¸­çš„ä»£ç å¯ä»¥ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚</li><li>åœ¨å¹¶è¡ŒåŒºåŸŸä¸­çš„ä»£ç å°†ä¼šè¢«å¤šä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å°†æ‰§è¡Œç›¸åŒçš„ä»£ç ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½å°†æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå¹¶è¡Œåœ°è¿›è¡Œè®¡ç®—ï¼Œç›´åˆ°å¹¶è¡ŒåŒºåŸŸç»“æŸä¸ºæ­¢ã€‚</li><li>åœ¨å¹¶è¡ŒåŒºåŸŸå†…éƒ¨çš„å˜é‡å…·æœ‰ä¸åŒçš„ä½œç”¨åŸŸã€‚æ¯”å¦‚åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­ï¼Œå˜é‡çš„å€¼æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å®ä¾‹ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ•°é‡ç”±ç³»ç»Ÿå†³å®šï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® <code>OMP_NUM_THREADS</code> ç¯å¢ƒå˜é‡æˆ–è°ƒç”¨ <code>omp_set_num_threads()</code> å‡½æ•°æ¥æŒ‡å®šçº¿ç¨‹æ•°é‡ã€‚</li></ul></li><li><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªå¹¶è¡ŒåŒºåŸŸï¼Œä½¿å…¶ä¸­çš„ä»£ç èƒ½å¤Ÿåœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¹¶è¡Œæ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„æ€§èƒ½ã€‚</li><li>ç”¨äºå¹¶è¡ŒåŒ–ä¸€æ®µä»£ç ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶æ‰§è¡Œï¼ŒåŠ å¿«ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚</li></ul></li><li><p><strong>ç”¨æ³•</strong>ï¼š</p><ul><li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>#pragma omp parallel</code> åªæ˜¯åˆ›å»ºä¸€ä¸ªå¹¶è¡ŒåŒºåŸŸï¼Œä¸ä¼šè‡ªåŠ¨å¯¹ä»£ç è¿›è¡Œå¹¶è¡ŒåŒ–ã€‚åœ¨è¿™ä¸ªå¹¶è¡ŒåŒºåŸŸä¸­çš„ä»£ç å°†è¢«å¤šä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä½†å¦‚æœæ²¡æœ‰è¿›ä¸€æ­¥çš„æŒ‡ç¤ºï¼Œä»£ç ä»ç„¶æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ã€‚å› æ­¤ï¼Œä¸ºäº†å®ç°çœŸæ­£çš„å¹¶è¡ŒåŒ–ï¼Œéœ€è¦ç»“åˆå…¶ä»– OpenMP æŒ‡ä»¤ï¼ˆæ¯”å¦‚ <code>for</code> å¾ªç¯çš„ <code>parallel for</code> æˆ– <code>parallel sections</code>ï¼‰æ¥å¹¶è¡Œæ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ã€‚</p></li><li><p>ä¸ä¸€æ®µä»£ç å—é…åˆä½¿ç”¨ï¼Œå¯ä»¥æ˜¯å¤åˆè¯­å¥ã€å‡½æ•°æˆ–ä¸€ä¸ª <code>for</code> å¾ªç¯ã€‚</p></li><li><p><code>#pragma omp parallel</code> å¯ä»¥ä¸ä¸åŒçš„å­å¥ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>for</code> æˆ– <code>sections</code>ï¼Œå¹¶å¯ä»¥æ·»åŠ å…¶ä»–å­å¥æ¥è°ƒæ•´å¹¶è¡ŒåŒºåŸŸçš„è¡Œä¸ºã€‚</p></li><li><p>ç¤ºä¾‹1ï¼šä¸ <code>for</code> ç»“åˆä½¿ç”¨</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span></span></span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¹¶è¡Œæ‰§è¡Œçš„ for å¾ªç¯ä»£ç </span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§ç”¨æ³•å°†ä¸€ä¸ª <code>for</code> å¾ªç¯ä¸­çš„è¿­ä»£åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚</p></li><li><p>ç¤ºä¾‹2ï¼šä¸ <code>sections</code> ç»“åˆä½¿ç”¨</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel sections</span></span><span class="token punctuation">&#123;</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp section</span></span>    <span class="token punctuation">&#123;</span>        <span class="token comment">// ç¬¬ä¸€ä¸ªéƒ¨åˆ†çš„ä»£ç </span>        <span class="token comment">// ...</span>    <span class="token punctuation">&#125;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp section</span></span>    <span class="token punctuation">&#123;</span>        <span class="token comment">// ç¬¬äºŒä¸ªéƒ¨åˆ†çš„ä»£ç </span>        <span class="token comment">// ...</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§ç”¨æ³•å°†ä¸åŒçš„ä»£ç éƒ¨åˆ†åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œæ¯ä¸ª <code>section</code> å†…çš„ä»£ç å°†åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p></li></ul></li><li><p><strong>å…¶ä»–å­å¥</strong>ï¼š</p><ul><li><p>å¯ä»¥åœ¨ <code>#pragma omp parallel</code> åæ·»åŠ å…¶ä»–å­å¥æ¥è°ƒæ•´å¹¶è¡ŒåŒºåŸŸçš„è¡Œä¸ºã€‚æ¯”å¦‚è®¾ç½®çº¿ç¨‹æ•°é‡ã€ç§æœ‰å˜é‡ç­‰ç­‰ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token function">num_threads</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token function">private</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span><span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>num_threads(4)</code>ï¼šæŒ‡å®šå¹¶è¡ŒåŒºåŸŸä¸­çš„çº¿ç¨‹æ•°é‡ä¸º4ã€‚</li><li><code>private(x)</code>ï¼šæŒ‡å®šå˜é‡ <code>x</code> åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­æ˜¯ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ <code>x</code> å˜é‡å®ä¾‹ã€‚</li></ul></li></ul></li></ul><p><code>#pragma omp parallel</code> åˆ›å»ºçš„å¹¶è¡ŒåŒºåŸŸä¸­çš„ä»£ç å°†ä¼šåœ¨å¤šä¸ªçº¿ç¨‹é—´å¹¶è¡Œæ‰§è¡Œã€‚åœ¨å¹¶è¡ŒåŒºåŸŸä¸­çš„å˜é‡å¯èƒ½å…·æœ‰ä¸åŒçš„ä½œç”¨åŸŸå’Œå…±äº«æ€§è´¨ï¼Œéœ€è¦å°å¿ƒå¤„ç†å…±äº«å˜é‡å¯èƒ½å¼•å‘çš„ç«æ€æ¡ä»¶å’Œæ•°æ®åŒæ­¥é—®é¢˜ã€‚</p><h3 id="è¶…ç®—ä¹ å ‚"><a href="#è¶…ç®—ä¹ å ‚" class="headerlink" title="è¶…ç®—ä¹ å ‚"></a>è¶…ç®—ä¹ å ‚</h3><p>parallel æ˜¯æ„é€ å¹¶è¡Œå—çš„ä¸€ä¸ªæŒ‡ä»¤ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é…åˆå…¶ä»–æŒ‡ä»¤å¦‚for, sectionsç­‰æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªæŒ‡ä»¤åé¢éœ€è¦ä½¿ç”¨ä¸€å¯¹å¤§æ‹¬å·æ¥æŒ‡å®šéœ€è¦å¹¶è¡Œè®¡ç®—çš„ä»£ç ã€‚</p><pre class="line-numbers language-none"><code class="language-none">#pragma omp parallel [for | sections] [å­å¥[å­å¥]â€¦] &#123; &#x2F;&#x2F;å¹¶è¡Œéƒ¨åˆ† &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡å®ä¾‹ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¹¶è¡Œéƒ¨åˆ†åˆ›å»ºå‡ºäº†å¤šä¸ªçº¿ç¨‹æ¥å®Œæˆã€‚</p><p>è¯·åœ¨é€‚å½“çš„ä½ç½®å¡«ä¸Š<code>#pragma omp parallel num_threads(6)</code> ä½¿ç¨‹åºå¹¶è¡Œæ‰§è¡Œã€‚</p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">Thread: 0Thread: 2Thread: 1Thread: 3Thread: 4Thread: 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token function">num_threads</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> </span></span><span class="token comment">// END OF YOUR CODE</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread: %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="for-æŒ‡ä»¤"><a href="#for-æŒ‡ä»¤" class="headerlink" title="for æŒ‡ä»¤"></a>for æŒ‡ä»¤</h2><p>åœ¨ OpenMP ä¸­ï¼Œ<code>for</code> å¾ªç¯é€šå¸¸ä¸ <code>#pragma omp parallel for</code> ç»“åˆä½¿ç”¨ï¼Œå°†ä¸€ä¸ª <code>for</code> å¾ªç¯ä¸­çš„è¿­ä»£ä»»åŠ¡åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚ç”¨äºåœ¨å¾ªç¯ä¸­å®ç°å¹¶è¡ŒåŒ–ï¼Œå…è®¸å°†ä¸€ä¸ªæ™®é€šçš„forå¾ªç¯è½¬æ¢ä¸ºä¸€ä¸ªå¹¶è¡ŒåŒ–çš„forå¾ªç¯ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„æ€§èƒ½ï¼ŒåŠ é€Ÿå¾ªç¯ä¸­çš„è®¡ç®—ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹ <code>#pragma omp parallel for</code> çš„è¯¦ç»†è§£é‡Šå’Œä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li><p><strong>è¯­æ³•</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span></span></span><span class="token keyword">for</span> <span class="token punctuation">(</span>åˆå§‹åŒ–è¯­å¥ï¼› å¾ªç¯æ¡ä»¶ï¼› æ›´æ–°è¯­å¥<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// å¾ªç¯ä½“</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>å°†ä¸€ä¸ª <code>for</code> å¾ªç¯ä¸­çš„è¿­ä»£ä»»åŠ¡åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼ŒåŠ é€Ÿå¾ªç¯çš„è¿è¡Œã€‚</li><li>é€šå¸¸ç”¨äºå¯¹å¤§å‹è¿­ä»£è¿›è¡Œå¹¶è¡ŒåŒ–å¤„ç†ï¼Œä¾‹å¦‚éå†æ•°ç»„ã€çŸ©é˜µè¿ç®—ç­‰ã€‚</li></ul></li><li><p><strong>ç”¨æ³•</strong>ï¼š</p><ul><li><p><code>#pragma omp parallel for</code> ç”¨äºå¹¶è¡ŒåŒ–ä¸€ä¸ª <code>for</code> å¾ªç¯ï¼Œç”¨æ³•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span></span></span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¹¶è¡Œæ‰§è¡Œçš„ for å¾ªç¯ä½“ä»£ç </span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæŒ‡ä»¤å°† <code>for</code> å¾ªç¯ä¸­çš„è¿­ä»£ä»»åŠ¡å¹³å‡åœ°åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€éƒ¨åˆ†è¿­ä»£ã€‚å¾ªç¯è¿­ä»£ä¼šè¢«åˆ†æˆå¤šä¸ªå—ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå…¶ä¸­çš„ä¸€ä¸ªå—ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡ç®—æ•°ç»„å…ƒç´ å¹³æ–¹å’Œçš„ç®€å•ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨<code>#pragma omp parallel for</code>å°†å…¶å¹¶è¡ŒåŒ–ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;#include &lt;omp.h&gt;int main() &#123;const int N &#x3D; 1000;double sum &#x3D; 0.0;double arr[N];&#x2F;&#x2F; åˆå§‹åŒ–æ•°ç»„for (int i &#x3D; 0; i &lt; N; ++i) &#123;  arr[i] &#x3D; static_cast&lt;double&gt;(i);&#125;&#x2F;&#x2F; ä½¿ç”¨#pragma omp parallel forè¿›è¡Œå¹¶è¡ŒåŒ–#pragma omp parallel for reduction(+:sum)for (int i &#x3D; 0; i &lt; N; ++i) &#123;  sum +&#x3D; arr[i] * arr[i];&#125;std::cout &lt;&lt; &quot;Sum of squares: &quot; &lt;&lt; sum &lt;&lt; std::endl;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>reduction(+:sum)</code>å­å¥æ¥æŒ‡å®šå¦‚ä½•åˆå¹¶å¤šä¸ªçº¿ç¨‹çš„ç»“æœã€‚è¿™æ ·ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè®¡ç®—å…¶éƒ¨åˆ†å…ƒç´ çš„å¹³æ–¹å’Œï¼Œå¹¶å°†ç»“æœç´¯åŠ åˆ°å…¨å±€å˜é‡<code>sum</code>ä¸­ã€‚æœ€åï¼Œä¸»çº¿ç¨‹ä¼šè¾“å‡ºæ•´ä¸ªæ•°ç»„å…ƒç´ å¹³æ–¹å’Œçš„ç»“æœã€‚</p></li></ul></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>åœ¨ä½¿ç”¨ <code>#pragma omp parallel for</code> æ—¶ï¼Œå¾ªç¯å˜é‡ï¼ˆå¦‚ä¸Šä¾‹ä¸­çš„ <code>i</code>ï¼‰å¿…é¡»æ˜¯è¿­ä»£å˜é‡ã€‚OpenMP å°†æ ¹æ®è¿­ä»£å˜é‡è‡ªåŠ¨è¿›è¡Œä»»åŠ¡åˆ†é…ã€‚</li><li>å¾ªç¯çš„è¿­ä»£æ¬¡æ•°åº”è¯¥è¶³å¤Ÿå¤§ï¼Œä»¥ä¾¿åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å®ç°æœ‰æ•ˆçš„å¹¶è¡Œæ‰§è¡Œã€‚å¦‚æœå¾ªç¯è¿­ä»£æ¬¡æ•°å¤ªå°ï¼Œåˆ™å¹¶è¡ŒåŒ–çš„å¼€é”€å¯èƒ½è¶…è¿‡äº†å¹¶è¡Œæ‰§è¡Œæ‰€å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚</li></ul></li><li><p><strong>å…¶ä»–å­å¥</strong>ï¼š</p><ul><li><p>å¯ä»¥ä½¿ç”¨å…¶ä»– OpenMP å­å¥æ¥è¿›ä¸€æ­¥æ§åˆ¶å¹¶è¡ŒåŒ–çš„è¡Œä¸ºï¼Œä¾‹å¦‚æŒ‡å®šç§æœ‰å˜é‡ã€æŒ‡å®šçº¿ç¨‹æ•°é‡ã€è®¾ç½®çº¿ç¨‹ç»‘å®šç­‰ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">num_threads</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token function">private</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>num_threads(4)</code>ï¼šæŒ‡å®šå¹¶è¡ŒåŒºåŸŸä¸­çš„çº¿ç¨‹æ•°é‡ä¸º4ã€‚</li><li><code>private(x)</code>ï¼šæŒ‡å®šå˜é‡ <code>x</code> åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­æ˜¯ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ <code>x</code> å˜é‡å®ä¾‹ã€‚</li></ul></li></ul></li></ul><p><code>#pragma omp parallel for</code> çš„ä½¿ç”¨å¯ä»¥æ˜¾è‘—æé«˜å¾ªç¯è¿­ä»£çš„æ•ˆç‡ï¼Œä½†éœ€è¦æ³¨æ„å¹¶è¡ŒåŒ–å¯èƒ½å¼•å…¥çš„æ•°æ®ç«äº‰å’ŒåŒæ­¥é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…±äº«å˜é‡çš„æ“ä½œéœ€è¦è¿›è¡Œåˆé€‚çš„åŒæ­¥æ§åˆ¶ã€‚</p><h3 id="è¶…ç®—ä¹ å ‚-1"><a href="#è¶…ç®—ä¹ å ‚-1" class="headerlink" title="è¶…ç®—ä¹ å ‚"></a>è¶…ç®—ä¹ å ‚</h3><p>foræŒ‡ä»¤çš„ä½œç”¨æ˜¯ä½¿ä¸€ä¸ªforå¾ªç¯åœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸€èˆ¬foræŒ‡ä»¤ä¼šä¸parallelæŒ‡ä»¤åŒæ—¶ä½¿ç”¨ï¼Œå³parallel foræŒ‡ä»¤ã€‚æ­¤å¤–è¿˜å¯ä»¥åœ¨parallelæŒ‡ä»¤çš„å¹¶è¡Œå—ä¸­å•ç‹¬ä½¿ç”¨ï¼Œåœ¨ä¸€ä¸ªå¹¶è¡Œå—ä¸­å¯ä»¥ä½¿ç”¨å¤šä¸ªforæŒ‡ä»¤ã€‚ä½†æ˜¯å•ç‹¬ä½¿ç”¨foræŒ‡ä»¤æ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚</p><p>è¯·åœ¨é€‚å½“çš„ä½ç½®ä½¿ç”¨foræŒ‡ä»¤ä½¿ç¨‹åºå¹¶è¡Œæ‰§è¡Œã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel </span></span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp <span class="token keyword">for</span> <span class="token function">private</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span></span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp <span class="token keyword">for</span> <span class="token function">private</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span></span></span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"j = %d\n"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">i &#x3D; 1i &#x3D; 0i &#x3D; 4i &#x3D; 3i &#x3D; 2j &#x3D; 0j &#x3D; 2j &#x3D; 1j &#x3D; 3j &#x3D; 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sectionså’ŒsectionæŒ‡ä»¤"><a href="#sectionså’ŒsectionæŒ‡ä»¤" class="headerlink" title="sectionså’ŒsectionæŒ‡ä»¤"></a>sectionså’ŒsectionæŒ‡ä»¤</h2><p>åœ¨ OpenMP ä¸­ï¼Œ<code>#pragma omp sections</code> å’Œ <code>#pragma omp section</code> æ˜¯ç”¨äºå¹¶è¡ŒåŒ–ä»£ç çš„æŒ‡ä»¤ï¼Œå…è®¸å°†ä¸åŒçš„ä»£ç éƒ¨åˆ†åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚è¿™ç§å¹¶è¡ŒåŒ–æ¨¡å¼å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå„è‡ªçš„ä»£ç æ®µï¼Œå¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹ <code>#pragma omp sections</code> å’Œ <code>#pragma omp section</code> çš„è¯¦ç»†è§£é‡Šå’Œç”¨æ³•ï¼š</p><ul><li><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li><code>#pragma omp sections</code> ç”¨äºåˆ›å»ºä¸€ä¸ªå¹¶è¡ŒåŒºåŸŸï¼Œå†…éƒ¨åŒ…å«å¤šä¸ª <code>section</code>ï¼Œæ¯ä¸ª <code>section</code> ä¸­çš„ä»£ç å¯ä»¥ç”±ä¸åŒçš„çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚</li><li><code>#pragma omp section</code> ç”¨äºå®šä¹‰ <code>sections</code> åŒºåŸŸä¸­çš„ä¸€ä¸ªå…·ä½“ä»£ç æ®µã€‚</li></ul></li><li><p><strong>ç”¨æ³•</strong>ï¼š</p><ul><li><p><code>#pragma omp sections</code> å¿…é¡»ä¸å¤šä¸ª <code>#pragma omp section</code> ç»“åˆä½¿ç”¨ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel</span></span><span class="token punctuation">&#123;</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp sections</span></span>    <span class="token punctuation">&#123;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp section</span></span>        <span class="token punctuation">&#123;</span>            <span class="token comment">// ç¬¬ä¸€ä¸ª section çš„ä»£ç </span>            <span class="token comment">// ...</span>        <span class="token punctuation">&#125;</span>                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp section</span></span>        <span class="token punctuation">&#123;</span>            <span class="token comment">// ç¬¬äºŒä¸ª section çš„ä»£ç </span>            <span class="token comment">// ...</span>        <span class="token punctuation">&#125;</span>                <span class="token comment">// å¯ä»¥æœ‰æ›´å¤šçš„ sections</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§ç”¨æ³•å°† <code>sections</code> åŒºåŸŸå†…çš„ä»£ç åˆ†æˆå¤šä¸ª <code>section</code>ï¼Œæ¯ä¸ª <code>section</code> ä¸­çš„ä»£ç ä¼šè¢«ä¸åŒçš„çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚</p></li></ul></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ¯ä¸ª <code>section</code> ä¸­çš„ä»£ç éƒ½æ˜¯ç‹¬ç«‹æ‰§è¡Œçš„ï¼Œå„ä¸ª <code>section</code> ä¹‹é—´çš„æ‰§è¡Œé¡ºåºä¸ç¡®å®šï¼Œå–å†³äºç³»ç»Ÿè°ƒåº¦å’Œçº¿ç¨‹å®Œæˆä»»åŠ¡çš„æ—¶é—´ã€‚</li><li><code>sections</code> åŒºåŸŸä¸­çš„çº¿ç¨‹æ•°ç›®ä¸ <code>section</code> çš„æ•°ç›®æ— å…³ï¼ŒOpenMP ä¼šè‡ªåŠ¨å†³å®šçº¿ç¨‹åˆ†é…æƒ…å†µã€‚</li></ul></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>æ¯ä¸ª <code>section</code> éƒ½åº”è¯¥æ˜¯äº’ç›¸ç‹¬ç«‹çš„ä»»åŠ¡å•å…ƒï¼Œä¸åº”è¯¥æœ‰å…±äº«å˜é‡çš„ä¿®æ”¹æˆ–è€…ä¾èµ–å…³ç³»ï¼Œä»¥å…å¼•èµ·ç«æ€æ¡ä»¶æˆ–æ­»é”ç­‰é—®é¢˜ã€‚</li><li><code>sections</code> åŒºåŸŸä¸­çš„æ¯ä¸ª <code>section</code> å¯èƒ½ä¼šè¢«ä¸åŒçš„çº¿ç¨‹æ‰§è¡Œï¼Œå› æ­¤è¦ç¡®ä¿æ¯ä¸ª <code>section</code> çš„æ‰§è¡Œæ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚</li></ul></li></ul><p><code>#pragma omp sections</code> å’Œ <code>#pragma omp section</code> é€‚ç”¨äºå°†ç¨‹åºä¸­çš„ä¸åŒä»»åŠ¡å¹¶è¡ŒåŒ–æ‰§è¡Œï¼Œç‰¹åˆ«é€‚ç”¨äºä»»åŠ¡é—´æ²¡æœ‰æ•°æ®ä¾èµ–æ€§çš„æƒ…å†µã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡å’Œæ€§èƒ½ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿ã€‚</p><p>sectionsè¯­å¥å¯ä»¥å°†ä¸‹é¢çš„ä»£ç åˆ†æˆä¸åŒçš„åˆ†å—ï¼Œé€šè¿‡sectionæŒ‡ä»¤æ¥æŒ‡å®šåˆ†å—ã€‚æ¯ä¸€ä¸ªåˆ†å—éƒ½ä¼šå¹¶è¡Œæ‰§è¡Œï¼Œå…·ä½“æ ¼å¼ï¼š<br>#pragma omp [parallel] sections [å­å¥]<br>{<br>    #pragma omp section<br>    {<br>        &#x2F;&#x2F;ä»£ç <br>    }<br>â€¦<br>}</p><p>è¯·åœ¨é€‚å½“çš„ä½ç½®å¡«ä¸Šä½¿ç”¨sectionsæŒ‡ä»¤ä½¿ç¨‹åºå¹¶è¡Œæ‰§è¡Œ</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel sections</span></span>    <span class="token punctuation">&#123;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp section </span></span>        <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Section 1 ThreadId = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æŸäº›ä»£ç ä»»åŠ¡</span>        <span class="token punctuation">&#125;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp section</span></span>        <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Section 2 ThreadId = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¯èƒ½çš„åˆå¹¶ä»»åŠ¡æˆ–å…¶ä»–å¤„ç†</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">Section 2 ThreadId &#x3D; 1Section 1 ThreadId &#x3D; 0Section 4 ThreadId &#x3D; 3Section 3 ThreadId &#x3D; 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="private-å­å¥"><a href="#private-å­å¥" class="headerlink" title="private å­å¥"></a>private å­å¥</h2><p>åœ¨ OpenMP ä¸­ï¼Œ<code>private</code> å­å¥ç”¨äºæŒ‡å®šå˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­çš„ç§æœ‰æ€§è´¨ã€‚è¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæ‹¥æœ‰è¯¥å˜é‡çš„ä¸€ä¸ªç§æœ‰å‰¯æœ¬ï¼Œè€Œä¸æ˜¯å…±äº«åŒä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªå˜é‡å¼•å‘çš„ç«æ€æ¡ä»¶é—®é¢˜ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹ <code>private</code> å­å¥çš„è¯¦ç»†è§£é‡Šå’Œç”¨æ³•ï¼š</p><ul><li><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>åœ¨å¹¶è¡ŒåŒºåŸŸä¸­ï¼Œå°†å˜é‡æŒ‡å®šä¸ºç§æœ‰çš„ï¼Œä»¥ç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ã€‚</li><li>é¿å…å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œå¹¶å‘è¯»å†™è€Œå¯¼è‡´çš„æ•°æ®æ··ä¹±æˆ–ä¸ç¡®å®šçš„ç»“æœã€‚</li></ul></li><li><p><strong>ç”¨æ³•</strong>ï¼š</p><ul><li><p>åœ¨ OpenMP æŒ‡ä»¤ä¸­ï¼Œé€šè¿‡ <code>private</code> å­å¥æ¥æŒ‡å®šç§æœ‰å˜é‡ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token function">private</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span></span></span><span class="token punctuation">&#123;</span>    <span class="token comment">// i å’Œ j å˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­æ˜¯ç§æœ‰çš„</span>    <span class="token comment">// æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„ i å’Œ j å‰¯æœ¬</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>i</code> å’Œ <code>j</code> å˜é‡è¢«æŒ‡å®šä¸ºç§æœ‰å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„ <code>i</code> å’Œ <code>j</code> çš„å‰¯æœ¬ã€‚ä»»ä½•åœ¨å¹¶è¡ŒåŒºåŸŸå†…å£°æ˜çš„å˜é‡é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯å…±äº«çš„ï¼Œä½¿ç”¨ <code>private</code> å­å¥å¯ä»¥å°†å…¶è®¾ä¸ºç§æœ‰ã€‚</p></li></ul></li><li><p><strong>ä½œç”¨èŒƒå›´</strong>ï¼š</p><ul><li><code>private</code> å­å¥å¯ä»¥åœ¨ä¸åŒçš„ OpenMP æŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>parallel</code>, <code>for</code>, <code>sections</code> ç­‰ï¼Œå¹¶ä¸”å¯ä»¥åœ¨åŒä¸€ä¸ªæŒ‡ä»¤å—ä¸­åŒæ—¶æŒ‡å®šå¤šä¸ªç§æœ‰å˜é‡ã€‚</li><li>å¦‚æœåœ¨å¾ªç¯å¹¶è¡ŒåŒ– <code>for</code> ä¸­ä½¿ç”¨äº† <code>private</code> å­å¥ï¼Œåˆ™å¾ªç¯ç´¢å¼•å˜é‡é€šå¸¸éœ€è¦è¢«æŒ‡å®šä¸ºç§æœ‰å˜é‡ã€‚</li></ul></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>ç§æœ‰å˜é‡ä»…åœ¨å¹¶è¡ŒåŒºåŸŸä¸­æ˜¯ç§æœ‰çš„ï¼Œå‡ºäº†å¹¶è¡ŒåŒºåŸŸåï¼Œå˜é‡ä»ç„¶æ˜¯åŸæ¥çš„å…±äº«çŠ¶æ€ã€‚</li><li>è¢«æŒ‡å®šä¸ºç§æœ‰çš„å˜é‡éœ€è¦åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œå˜é‡å€¼åœ¨ä¸åŒçº¿ç¨‹ä¸­æ˜¯ç‹¬ç«‹çš„ã€‚</li></ul></li></ul><p><code>private</code> å­å¥æ˜¯ç”¨äºæ§åˆ¶å˜é‡ç§æœ‰æ€§çš„é‡è¦å·¥å…·ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶è¡Œç¼–ç¨‹ä¸­ç»å¸¸ç”¨äºé¿å…å…±äº«å˜é‡å¸¦æ¥çš„å¹¶å‘è®¿é—®é—®é¢˜ï¼Œç¡®ä¿ç¨‹åºçš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚</p><p>private å­å¥å¯ä»¥å°†å˜é‡å£°æ˜ä¸ºçº¿ç¨‹ç§æœ‰ï¼Œå£°æ˜ç§°çº¿ç¨‹ç§æœ‰å˜é‡ä»¥åï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè¯¥å˜é‡çš„å‰¯æœ¬ï¼Œçº¿ç¨‹ä¹‹é—´ä¸ä¼šäº’ç›¸å½±å“ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®å…¶ä»–çº¿ç¨‹çš„å‰¯æœ¬ã€‚åŸå˜é‡åœ¨å¹¶è¡Œéƒ¨åˆ†ä¸èµ·ä»»ä½•ä½œç”¨ï¼Œä¹Ÿä¸ä¼šå—åˆ°å¹¶è¡Œéƒ¨åˆ†å†…éƒ¨æ“ä½œçš„å½±å“ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">private</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// æ‰‹åŠ¨æ›´æ–°å¾ªç¯å¤–çš„ i</span>    <span class="token comment">// å¾—åˆ°æœ€åä¸€ä¸ªå¹¶è¡Œå¾ªç¯ä¸­çš„ i å€¼</span>    i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"outside i = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">i &#x3D; 0i &#x3D; 2i &#x3D; 1i &#x3D; 4i &#x3D; 3i &#x3D; 5i &#x3D; 6i &#x3D; 7i &#x3D; 9i &#x3D; 8outside i &#x3D; 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="firstprivateå­å¥"><a href="#firstprivateå­å¥" class="headerlink" title="firstprivateå­å¥"></a>firstprivateå­å¥</h5><p><code>firstprivate</code> å­å¥æ˜¯ OpenMP ä¸­ç”¨äºæŒ‡å®šå¹¶è¡ŒåŒºåŸŸä¸­å˜é‡çš„åˆå§‹ç§æœ‰å€¼çš„ä¸€ç§æŒ‡ä»¤ã€‚å®ƒç”¨äºä¿ç•™å˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸå¤–çš„åˆå§‹å€¼ï¼Œå¹¶å°†å…¶ä½œä¸ºæ¯ä¸ªçº¿ç¨‹ç§æœ‰å˜é‡çš„åˆå§‹å€¼ï¼Œä»¥ä¾¿åœ¨å¹¶è¡Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>firstprivate</code> å­å¥çš„ç”¨æ³•ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token function">firstprivate</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span>    <span class="token punctuation">&#123;</span>        <span class="token comment">// x å˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰å‰¯æœ¬</span>        <span class="token comment">// åˆå§‹å€¼æ˜¯ x åœ¨å¹¶è¡ŒåŒºåŸŸå¤–çš„åˆå§‹å€¼ï¼ˆ5ï¼‰</span>                <span class="token comment">// åœ¨å¹¶è¡ŒåŒºåŸŸå†…ä¿®æ”¹ x çš„å€¼</span>        x <span class="token operator">+=</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: x = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// åœ¨å¹¶è¡ŒåŒºåŸŸå¤–æ‰“å° x çš„å€¼ï¼Œå€¼ä»ç„¶ä¸ºåˆå§‹å€¼ï¼ˆ5ï¼‰</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"After parallel region: x = %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>firstprivate(x)</code> å°†å˜é‡ <code>x</code> æŒ‡å®šä¸ºç§æœ‰å˜é‡ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç§æœ‰å‰¯æœ¬ï¼Œåˆå§‹å€¼ä¸ºå¹¶è¡ŒåŒºåŸŸå¤– <code>x</code> çš„åˆå§‹å€¼ï¼ˆ5ï¼‰ã€‚åœ¨å¹¶è¡ŒåŒºåŸŸå†…ï¼Œæ¯ä¸ªçº¿ç¨‹å°† <code>x</code> çš„å€¼å¢åŠ äº†å½“å‰çº¿ç¨‹ç¼–å· <code>omp_get_thread_num()</code>ï¼Œç„¶åè¾“å‡ºç»“æœã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å¹¶è¡ŒåŒºåŸŸå†…å¯¹ <code>x</code> è¿›è¡Œäº†ä¿®æ”¹ï¼Œä½†åœ¨å¹¶è¡ŒåŒºåŸŸå¤–ï¼Œ<code>x</code> çš„å€¼ä»ç„¶ä¿æŒåˆå§‹å€¼ï¼Œä¸å—å¹¶è¡ŒåŒºåŸŸå†…ä¿®æ”¹çš„å½±å“ã€‚è¿™æ˜¯å› ä¸º <code>firstprivate</code> å­å¥ä¿ç•™äº†å˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸå¤–çš„åˆå§‹å€¼ï¼Œå¹¶åœ¨å¹¶è¡ŒåŒºåŸŸå†…æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„åˆå§‹å€¼å‰¯æœ¬ï¼Œä¸ä¼šå½±å“åˆ°å¤–éƒ¨çš„ <code>x</code>ã€‚</p><p>privateå­å¥ä¸èƒ½ç»§æ‰¿åŸå˜é‡çš„å€¼ï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬éœ€è¦çº¿ç¨‹ç§æœ‰å˜é‡ç»§æ‰¿åŸæ¥å˜é‡çš„å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨firstprivateå­å¥æ¥å®ç°ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> i<span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">firstprivate</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span></span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>t <span class="token operator">+=</span> i<span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"t = %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"outside t = %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">t &#x3D; 20t &#x3D; 21t &#x3D; 23t &#x3D; 24t &#x3D; 22outside t &#x3D; 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="lastprivateå­å¥"><a href="#lastprivateå­å¥" class="headerlink" title="lastprivateå­å¥"></a>lastprivateå­å¥</h5><p><code>lastprivate</code> å­å¥æ˜¯ OpenMP ä¸­ç”¨äºæŒ‡å®šå¹¶è¡Œå¾ªç¯æˆ–åŒºåŸŸç»“æŸåï¼Œä»å¤šä¸ªçº¿ç¨‹ä¸­è·å–æœ€åä¸€ä¸ªè¿­ä»£çš„å˜é‡å€¼ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™æŒ‡å®šå˜é‡çš„ä¸€ç§æŒ‡ä»¤ã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>lastprivate</code> å­å¥çš„ç”¨æ³•ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> last_val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">lastprivate</span><span class="token punctuation">(</span>last_val<span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        last_val <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: i = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// åœ¨å¹¶è¡Œå¾ªç¯ç»“æŸåï¼Œè·å–æœ€åä¸€ä¸ªè¿­ä»£çš„å€¼èµ‹ç»™ last_val</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Last value after parallel region: %d\n"</span><span class="token punctuation">,</span> last_val<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>lastprivate(last_val)</code> å°†å˜é‡ <code>last_val</code> æŒ‡å®šä¸º <code>lastprivate</code> å˜é‡ã€‚åœ¨å¹¶è¡Œå¾ªç¯ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„ <code>last_val</code> å˜é‡ï¼Œä½†æœ€ç»ˆä¼šä»å¤šä¸ªçº¿ç¨‹ä¸­è·å–æœ€åä¸€ä¸ªè¿­ä»£çš„å€¼ï¼Œå¹¶å°†è¯¥å€¼èµ‹ç»™å¤–éƒ¨çš„ <code>last_val</code>ã€‚</p><p>è¯·æ³¨æ„ï¼Œ<code>lastprivate</code> å­å¥åªå¯¹å¾ªç¯ç»“æŸåçš„æœ€åä¸€ä¸ªè¿­ä»£æœ‰æ•ˆã€‚åœ¨å¹¶è¡Œå¾ªç¯æ‰§è¡ŒæœŸé—´ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šåœ¨è‡ªå·±çš„ <code>last_val</code> ä¸­å­˜å‚¨æœ€åä¸€ä¸ªè¿­ä»£çš„å€¼ï¼Œä½†åªæœ‰åœ¨å¹¶è¡ŒåŒºåŸŸç»“æŸåï¼Œä¼šå°†æœ€åä¸€ä¸ªè¿­ä»£çš„å€¼èµ‹ç»™å¤–éƒ¨çš„ <code>last_val</code>ã€‚</p><p>è¿™å¯¹äºéœ€è¦åœ¨å¹¶è¡Œå¾ªç¯ç»“æŸåè·å–æœ€åä¸€ä¸ªè¿­ä»£çš„å€¼å¹¶ç»§ç»­ä½¿ç”¨çš„æƒ…å†µéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚éœ€è¦ä¿ç•™å¹¶åˆ©ç”¨å¹¶è¡Œå¾ªç¯ä¸­æœ€åä¸€ä¸ªè¿­ä»£çš„ç»“æœã€‚</p><p>é™¤äº†åœ¨è¿›å…¥å¹¶è¡Œéƒ¨åˆ†æ—¶éœ€è¦ç»§æ‰¿åŸå˜é‡çš„å€¼å¤–ï¼Œæœ‰æ—¶æˆ‘ä»¬è¿˜éœ€è¦å†é€€å‡ºå¹¶è¡Œéƒ¨åˆ†æ—¶å°†è®¡ç®—ç»“æœèµ‹å€¼å›åŸå˜é‡ï¼Œlastprivateå­å¥å°±å¯ä»¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ¹æ®OpenMPè§„èŒƒï¼Œåœ¨å¾ªç¯è¿­ä»£ä¸­ï¼Œæ˜¯æœ€åä¸€æ¬¡è¿­ä»£çš„å€¼èµ‹å€¼ç»™åŸå˜é‡ï¼›å¦‚æœæ˜¯sectionç»“æ„ï¼Œé‚£ä¹ˆæ˜¯ç¨‹åºè¯­æ³•ä¸Šçš„æœ€åä¸€ä¸ªsectionè¯­å¥èµ‹å€¼ç»™åŸå˜é‡ã€‚<br>å¦‚æœæ˜¯ç±»(class)å˜é‡ä½œä¸ºlastprivateçš„å‚æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¼ºçœæ„é€ å‡½æ•°ï¼Œé™¤éè¯¥å˜é‡ä¹Ÿä½œä¸ºfirstprivateå­å¥çš„å‚æ•°ï¼›æ­¤å¤–è¿˜éœ€è¦ä¸€ä¸ªæ‹·è´èµ‹å€¼æ“ä½œç¬¦ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> i<span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">firstprivate</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lastprivate</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span></span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>t <span class="token operator">+=</span> i<span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"t = %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"outside t = %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">t &#x3D; 20t &#x3D; 22t &#x3D; 24t &#x3D; 21t &#x3D; 23outside t &#x3D; 24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="threadprivateå­å¥"><a href="#threadprivateå­å¥" class="headerlink" title="threadprivateå­å¥"></a>threadprivateå­å¥</h5><p><code>threadprivate</code> æ˜¯ OpenMP ä¸­ç”¨äºæŒ‡å®šå…¨å±€å˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å…·æœ‰è‡ªå·±çš„ç§æœ‰å‰¯æœ¬çš„æŒ‡ä»¤ã€‚é€šå¸¸ï¼Œå…¨å±€å˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½èƒ½è®¿é—®å’Œä¿®æ”¹å®ƒã€‚ä½†æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­æ‹¥æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œä»¥ä¾¿ä¸åŒçº¿ç¨‹ä¹‹é—´çš„ä¿®æ”¹ä¸ä¼šç›¸äº’å½±å“ã€‚</p><p><code>threadprivate</code> çš„ç”¨æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token comment">// å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å°†æ‹¥æœ‰è‡ªå·±çš„ç§æœ‰å‰¯æœ¬</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp <span class="token function">threadprivate</span><span class="token punctuation">(</span>global_var<span class="token punctuation">)</span></span></span><span class="token keyword">int</span> global_var<span class="token punctuation">;</span> <span class="token comment">// å…¨å±€å˜é‡</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    global_var <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// å…¨å±€å˜é‡çš„åˆå§‹å€¼</span>        <span class="token comment">// å¯åŠ¨å¹¶è¡ŒåŒºåŸŸï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—® global_var</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel</span></span>    <span class="token punctuation">&#123;</span>        <span class="token comment">// æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªç§æœ‰çš„ global_var</span>        global_var <span class="token operator">+=</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: global_var = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> global_var<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>global_var</code> æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä½†ä½¿ç”¨äº† <code>#pragma omp threadprivate(global_var)</code> æŒ‡ä»¤ï¼Œå› æ­¤åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ª <code>global_var</code> çš„ç§æœ‰å‰¯æœ¬ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹ <code>global_var</code> è¿›è¡Œæ“ä½œæ—¶éƒ½åœ¨è‡ªå·±çš„ç§æœ‰å‰¯æœ¬ä¸Šè¿›è¡Œï¼Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>threadprivate</code> ç”¨äºæŒ‡å®šå…¨å±€å˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å…·æœ‰è‡ªå·±çš„ç§æœ‰å‰¯æœ¬ã€‚è¿™æ ·çš„è¯ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸å…¶ä»–çº¿ç¨‹ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œå®ƒä»¬äº’ä¸å¹²æ‰°ã€‚</p><p>threadprivateå­å¥å¯ä»¥å°†ä¸€ä¸ªå˜é‡å¤åˆ¶ä¸€ä¸ªç§æœ‰çš„æ‹·è´ç»™å„ä¸ªçº¿ç¨‹ï¼Œå³å„ä¸ªçº¿ç¨‹å…·æœ‰å„è‡ªç§æœ‰çš„å…¨å±€å¯¹è±¡ã€‚<br>æ ¼å¼ï¼š#pragma omp threadprivate(list)</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> g <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp <span class="token function">threadprivate</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> i<span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel</span></span><span class="token comment">// END OF YOUR CODE</span><span class="token punctuation">&#123;</span>g <span class="token operator">=</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel</span></span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread id: %d g: %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">thread id: 1 g: 1thread id: 5 g: 5thread id: 2 g: 2thread id: 3 g: 3thread id: 6 g: 6thread id: 4 g: 4thread id: 0 g: 0thread id: 7 g: 7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sharedå­å¥"><a href="#sharedå­å¥" class="headerlink" title="sharedå­å¥"></a>sharedå­å¥</h2><p>åœ¨ OpenMP ä¸­ï¼Œ<code>shared</code> å­å¥ç”¨äºæŒ‡å®šå˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­çš„å…±äº«æ€§è´¨ã€‚å…±äº«å˜é‡æ˜¯æ‰€æœ‰çº¿ç¨‹å…±åŒè®¿é—®å’Œä¿®æ”¹çš„å˜é‡ã€‚ä½¿ç”¨ <code>shared</code> å­å¥å¯ä»¥å°†å˜é‡æ˜¾å¼åœ°å£°æ˜ä¸ºå…±äº«å˜é‡ï¼Œä»¥ç¡®ä¿æ‰€æœ‰çº¿ç¨‹åœ¨å¹¶è¡ŒåŒºåŸŸä¸­éƒ½ä½¿ç”¨åŒä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹ <code>shared</code> å­å¥çš„è¯¦ç»†è§£é‡Šå’Œç”¨æ³•ï¼š</p><ul><li><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>åœ¨å¹¶è¡ŒåŒºåŸŸä¸­å°†å˜é‡æŒ‡å®šä¸ºå…±äº«å˜é‡ï¼Œä»¥ç¡®ä¿æ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«åŒä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚</li><li>å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹å˜é‡çš„å€¼ï¼Œé€‚ç”¨äºçº¿ç¨‹ä¹‹é—´éœ€è¦å…±äº«ä¿¡æ¯çš„æƒ…å†µã€‚</li></ul></li><li><p><strong>ç”¨æ³•</strong>ï¼š</p><ul><li><p>åœ¨ OpenMP æŒ‡ä»¤ä¸­ï¼Œé€šè¿‡ <code>shared</code> å­å¥å°†å˜é‡æŒ‡å®šä¸ºå…±äº«å˜é‡ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token function">shared</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span></span><span class="token punctuation">&#123;</span>    <span class="token comment">// x å’Œ y å˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­æ˜¯å…±äº«çš„</span>    <span class="token comment">// æ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨åŒä¸€ä¸ª x å’Œ y å˜é‡å‰¯æœ¬</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>x</code> å’Œ <code>y</code> å˜é‡è¢«æŒ‡å®šä¸ºå…±äº«å˜é‡ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šä½¿ç”¨ç›¸åŒçš„ <code>x</code> å’Œ <code>y</code> çš„å‰¯æœ¬ã€‚</p></li></ul></li><li><p><strong>é»˜è®¤å…±äº«æ€§</strong>ï¼š</p><ul><li>åœ¨ OpenMP ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å¹¶è¡ŒåŒºåŸŸå†…å£°æ˜çš„å˜é‡é€šå¸¸æ˜¯å…±äº«çš„ã€‚å› æ­¤ï¼Œå¯¹äºå…¨å±€å˜é‡å’Œåœ¨å¹¶è¡ŒåŒºåŸŸä¹‹å¤–å£°æ˜çš„å˜é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å…±äº«çš„ã€‚</li><li>å±€éƒ¨å˜é‡é»˜è®¤æƒ…å†µä¸‹æ˜¯ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç§æœ‰å‰¯æœ¬ã€‚</li></ul></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>å…±äº«å˜é‡å¯èƒ½å­˜åœ¨å¹¶å‘è®¿é—®çš„é—®é¢˜ï¼Œéœ€è¦æ³¨æ„çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ§åˆ¶ï¼Œé¿å…å‡ºç°æ•°æ®ç«äº‰ã€ä¸ç¡®å®šè¡Œä¸ºç­‰é—®é¢˜ã€‚</li><li>å¦‚æœå˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸå¤–è¢«å£°æ˜ä¸ºå…±äº«çš„ï¼Œéœ€ç¡®ä¿å¯¹å…¶çš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹é€ æˆçš„é—®é¢˜ã€‚</li></ul></li></ul><p><code>shared</code> å­å¥ç”¨äºæ§åˆ¶å˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­çš„å…±äº«æ€§è´¨ï¼Œå¯å¸®åŠ©å¼€å‘è€…æ›´æ¸…æ™°åœ°è¡¨è¾¾å¹¶è¡Œä»£ç ä¸­çš„å…±äº«æ•°æ®ã€‚ä½†éœ€è¦ç‰¹åˆ«æ³¨æ„å…±äº«å˜é‡çš„åŒæ­¥å’Œäº’æ–¥è®¿é—®é—®é¢˜ï¼Œä»¥ç¡®ä¿å¹¶è¡Œç¨‹åºçš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚</p><p><code>shared</code> å­å¥æ˜¯ OpenMP ä¸­çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œç”¨äºæŒ‡å®šå˜é‡åœ¨å¹¶è¡ŒåŒºåŸŸä¸­çš„å…±äº«æ€§è´¨ã€‚åœ¨å¹¶è¡ŒåŒºåŸŸå†…ï¼Œ<code>shared</code> å­å¥ä½¿å¾—å˜é‡åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´å…±äº«åŒä¸€ä¸ªå†…å­˜ä½ç½®ã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>shared</code> å­å¥çš„ç”¨æ³•ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> shared_var <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// ä½¿ç”¨ shared å­å¥å°† shared_var å˜é‡æŒ‡å®šä¸ºå…±äº«å˜é‡</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token function">shared</span><span class="token punctuation">(</span>shared_var<span class="token punctuation">)</span></span></span>    <span class="token punctuation">&#123;</span>        shared_var <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ª shared_var å˜é‡</span>                <span class="token comment">// è·å–å½“å‰çº¿ç¨‹å·å’Œ shared_var çš„å€¼</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: shared_var = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shared_var<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// åœ¨å¹¶è¡ŒåŒºåŸŸç»“æŸåï¼Œè¾“å‡ºæœ€ç»ˆ shared_var çš„å€¼</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Final value of shared_var: %d\n"</span><span class="token punctuation">,</span> shared_var<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>#pragma omp parallel shared(shared_var)</code> å°† <code>shared_var</code> å˜é‡æŒ‡å®šä¸ºå…±äº«å˜é‡ï¼Œè¿™æ„å‘³ç€åœ¨å¹¶è¡ŒåŒºåŸŸä¸­ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å°†å…±äº«åŒä¸€ä¸ª <code>shared_var</code> å˜é‡ã€‚</p><p>åœ¨å¹¶è¡ŒåŒºåŸŸå†…ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹ <code>shared_var</code> çš„å€¼ã€‚å› æ­¤ï¼Œåœ¨ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯¹ <code>shared_var</code> æ‰§è¡Œäº†åŠ ä¸€æ“ä½œï¼Œå¹¶è¾“å‡ºäº†å½“å‰çº¿ç¨‹å·å’Œ <code>shared_var</code> çš„å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºæ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ª <code>shared_var</code>ï¼Œå¯èƒ½ä¼šå‘ç”Ÿç«äº‰æ¡ä»¶ï¼Œéœ€è¦è°¨æ…å¤„ç†å¹¶å‘ä¿®æ”¹ã€‚</p><p>æœ€ç»ˆè¾“å‡ºçš„ <code>Final value of shared_var</code> è¡¨ç¤ºå¹¶è¡ŒåŒºåŸŸç»“æŸåçš„ <code>shared_var</code> çš„å€¼ã€‚ç”±äºå¤šä¸ªçº¿ç¨‹å…±äº«è¯¥å˜é‡ï¼Œå› æ­¤æœ€ç»ˆç»“æœå–å†³äºå¹¶å‘ä¿®æ”¹çš„é¡ºåºå’Œæ“ä½œã€‚</p><p>Shareå­å¥å¯ä»¥å°†ä¸€ä¸ªå˜é‡å£°æ˜æˆå…±äº«å˜é‡ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªçº¿ç¨‹å†…å…±äº«ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¹¶è¡Œéƒ¨åˆ†è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œè¦æ±‚å…±äº«å˜é‡è¿›è¡Œä¿æŠ¤ï¼Œå¦åˆ™ä¸è¦éšä¾¿ä½¿ç”¨å…±äº«å˜é‡ï¼Œå°½é‡å°†å…±äº«å˜é‡è½¬æ¢ä¸ºç§æœ‰å˜é‡ä½¿ç”¨ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> i<span class="token punctuation">;</span>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">shared</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token function">private</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp atomic</span></span>            t<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i = %d, t = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">i &#x3D; 0, t &#x3D; 21i &#x3D; 2, t &#x3D; 22i &#x3D; 9, t &#x3D; 23i &#x3D; 4, t &#x3D; 23i &#x3D; 8, t &#x3D; 25i &#x3D; 5, t &#x3D; 25i &#x3D; 7, t &#x3D; 24i &#x3D; 1, t &#x3D; 24i &#x3D; 3, t &#x3D; 24i &#x3D; 6, t &#x3D; 24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="reductionå­å¥"><a href="#reductionå­å¥" class="headerlink" title="reductionå­å¥"></a>reductionå­å¥</h2><p><code>reduction</code> å­å¥æ˜¯ OpenMP ä¸­ç”¨äºå¯¹å¹¶è¡Œå¾ªç¯ä¸­çš„å˜é‡æ‰§è¡Œå½’çº¦æ“ä½œçš„ä¸€ç§æŒ‡ä»¤ã€‚å½’çº¦æ“ä½œæŒ‡å°†å¹¶è¡Œå¾ªç¯ä¸­å¤šä¸ªçº¿ç¨‹çš„å±€éƒ¨ç»“æœåˆå¹¶ä¸ºä¸€ä¸ªæœ€ç»ˆç»“æœçš„è¿‡ç¨‹ã€‚è¿™ç§æ“ä½œé€šå¸¸ç”¨äºå¯¹å˜é‡è¿›è¡Œç´¯åŠ ã€æ±‚å’Œã€æ±‚ç§¯ç­‰èšåˆè¿ç®—ï¼Œä»¥é¿å…ç«æ€æ¡ä»¶å¹¶æé«˜å¹¶è¡Œç¨‹åºçš„æ€§èƒ½ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹ <code>reduction</code> å­å¥çš„è¯¦ç»†è§£é‡Šå’Œç”¨æ³•ï¼š</p><ul><li><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>åœ¨å¹¶è¡Œå¾ªç¯ä¸­å¯¹æŒ‡å®šçš„å˜é‡æ‰§è¡Œå½’çº¦æ“ä½œï¼Œå°†å¤šä¸ªçº¿ç¨‹çš„å±€éƒ¨ç»“æœåˆå¹¶ä¸ºä¸€ä¸ªæœ€ç»ˆç»“æœã€‚</li><li>å¸¸ç”¨äºæ±‚å’Œã€æ±‚ç§¯ã€æ±‚æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰èšåˆæ“ä½œã€‚</li></ul></li><li><p><strong>ç”¨æ³•</strong>ï¼š</p><ul><li><p>åœ¨ OpenMP ä¸­ï¼Œ<code>reduction</code> å­å¥ç”¨äºå£°æ˜è¿›è¡Œå½’çº¦æ“ä½œçš„å˜é‡ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">reduction</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">:</span>sum<span class="token punctuation">)</span></span></span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    sum <span class="token operator">+=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>reduction(+:sum)</code> è¡¨ç¤ºå¯¹å˜é‡ <code>sum</code> æ‰§è¡Œå½’çº¦æ“ä½œï¼Œä½¿ç”¨ <code>+</code> æ“ä½œç¬¦å¯¹å±€éƒ¨ç»“æœè¿›è¡Œç´¯åŠ ã€‚</p></li></ul></li><li><p><strong>æ”¯æŒçš„æ“ä½œç¬¦</strong>ï¼š</p><ul><li><code>reduction</code> å­å¥æ”¯æŒå¤šç§æ“ä½œç¬¦ï¼Œå¸¸ç”¨çš„åŒ…æ‹¬ <code>+</code>ã€<code>*</code>ã€<code>-</code>ã€<code>&amp;</code>ã€<code>|</code>ã€<code>^</code>ã€<code>&amp;&amp;</code>ã€<code>||</code>ã€<code>max</code>ã€<code>min</code> ç­‰ã€‚å…·ä½“æ”¯æŒçš„æ“ä½œç¬¦å–å†³äºç¼–è¯‘å™¨å’Œ OpenMP çš„å®ç°ã€‚</li></ul></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><code>reduction</code> å­å¥ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹å±€éƒ¨å˜é‡è¿›è¡Œå½’çº¦æ“ä½œï¼Œæœ€åå°†æ‰€æœ‰å±€éƒ¨å˜é‡çš„ç»“æœåˆå¹¶å¾—åˆ°æœ€ç»ˆç»“æœã€‚</li><li>åœ¨å¹¶è¡Œå¾ªç¯ç»“æŸåï¼Œå˜é‡çš„å€¼ä¼šè¢«å­˜å‚¨åœ¨åŸå§‹å˜é‡ä¸­ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li><p>å¯¹æ•°ç»„ä¸­å…ƒç´ æ±‚å’Œçš„ç¤ºä¾‹ä»£ç ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">reduction</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">:</span>sum<span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sum <span class="token operator">+=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Sum = %d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>reduction(+:sum)</code> è¡¨ç¤ºå¯¹å˜é‡ <code>sum</code> æ‰§è¡Œç´¯åŠ æ“ä½œï¼Œå°†å„ä¸ªçº¿ç¨‹çš„å±€éƒ¨ç´¯åŠ ç»“æœæœ€ååˆå¹¶åˆ° <code>sum</code> ä¸­ã€‚</p></li></ul></li></ul><p><code>reduction</code> å­å¥æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œèƒ½å¤Ÿç®€åŒ–å¯¹å¹¶è¡Œå¾ªç¯ä¸­å˜é‡çš„å½’çº¦æ“ä½œï¼Œæé«˜å¹¶è¡Œç¨‹åºçš„æ€§èƒ½ï¼Œå‡å°‘äº†æ‰‹åŠ¨åŒæ­¥å’Œåˆå¹¶çš„å¤æ‚åº¦ã€‚</p><p><code>reduction</code> å­å¥æ˜¯ OpenMP ä¸­ç”¨äºæ‰§è¡Œå¹¶è¡Œå½’çº¦æ“ä½œçš„å…³é”®æŒ‡ä»¤ã€‚å®ƒå…è®¸åœ¨å¹¶è¡Œå¾ªç¯ä¸­å¯¹æŒ‡å®šçš„å˜é‡æ‰§è¡Œå½’çº¦æ“ä½œï¼Œå¹¶å°†å„ä¸ªçº¿ç¨‹çš„å±€éƒ¨ç»“æœåˆå¹¶ä¸ºä¸€ä¸ªæœ€ç»ˆç»“æœã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>reduction</code> å­å¥çš„ç”¨æ³•ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// ä½¿ç”¨ reduction å­å¥å¯¹ sum å˜é‡æ‰§è¡Œå½’çº¦æ“ä½œ</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">reduction</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">:</span>sum<span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: sum = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// åœ¨å¹¶è¡Œå¾ªç¯ç»“æŸåï¼Œè¾“å‡ºæœ€ç»ˆçš„ sum å€¼</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Final sum value after reduction: %d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>#pragma omp parallel for reduction(+:sum)</code> å°† <code>sum</code> å˜é‡æŒ‡å®šä¸º <code>+</code> å½’çº¦è¿ç®—ç¬¦çš„å½’çº¦å˜é‡ã€‚åœ¨å¹¶è¡Œå¾ªç¯ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ <code>sum</code> å˜é‡ï¼Œå¹¶è¡Œåœ°å¯¹å…¶è¿›è¡Œç´¯åŠ æ“ä½œã€‚</p><p>å…³é”®ç‚¹æ˜¯ <code>reduction(+:sum)</code> ä¸­çš„ <code>+</code> è¡¨ç¤ºè¿›è¡Œæ±‚å’Œæ“ä½œï¼Œè¿™æ„å‘³ç€å„ä¸ªçº¿ç¨‹å„è‡ªè®¡ç®—è‡ªå·±çš„å±€éƒ¨å’Œï¼Œå¹¶åœ¨å¾ªç¯ç»“æŸæ—¶å°†æ‰€æœ‰å±€éƒ¨å’Œåˆå¹¶ä¸ºä¸€ä¸ªæœ€ç»ˆçš„æ€»å’Œã€‚è¿™ç§å½’çº¦æ“ä½œç¡®ä¿äº†å¹¶è¡Œè®¡ç®—çš„æ­£ç¡®æ€§ï¼Œæœ€ç»ˆå¾—åˆ°äº†æ­£ç¡®çš„æ€»å’Œç»“æœã€‚</p><p><code>reduction</code> å­å¥å¯ä»¥ç”¨äºå¤šç§å½’çº¦æ“ä½œï¼Œå¦‚æ±‚å’Œã€ä¹˜ç§¯ã€æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€æ´è€Œæœ‰æ•ˆçš„æ–¹æ³•æ¥åœ¨å¹¶è¡Œè®¡ç®—ä¸­æ‰§è¡Œå½’çº¦æ“ä½œï¼Œä»¥æé«˜ç¨‹åºæ€§èƒ½å¹¶ç¡®ä¿è®¡ç®—çš„å‡†ç¡®æ€§ã€‚</p><p>reductionå­å¥å¯ä»¥å¯¹ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªæ“ä½œç¬¦ï¼Œç„¶åæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šåˆ›å»ºè¿™ä¸ªå‚æ•°çš„ç§æœ‰æ‹·è´ï¼Œåœ¨å¹¶è¡ŒåŒºåŸŸç»“æŸåï¼Œè¿­ä»£è¿è¡ŒæŒ‡å®šçš„è¿ç®—ç¬¦ï¼Œå¹¶æ›´æ–°åŸå‚æ•°çš„å€¼ã€‚<br>ç§æœ‰æ‹·è´å˜é‡çš„åˆå§‹å€¼ä¾èµ–äºredtutionçš„è¿ç®—ç±»å‹ã€‚<br>å…·ä½“ç”¨æ³•å¦‚ä¸‹<br>reduction(operator:list)</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">reduction</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">:</span> sum<span class="token punctuation">)</span></span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>sum <span class="token operator">+=</span> i<span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sum = %d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">0215457689sum &#x3D; 55<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="copyinå­å¥"><a href="#copyinå­å¥" class="headerlink" title="copyinå­å¥"></a>copyinå­å¥</h2><p><code>copyin</code> å­å¥æ˜¯ OpenMP ä¸­çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œç”¨äºå°†æ•°æ®ä»ä¸»çº¿ç¨‹å¤åˆ¶åˆ°æ‰€æœ‰çº¿ç¨‹çš„ç§æœ‰å‰¯æœ¬ä¸­ã€‚å®ƒç¡®ä¿äº†å¹¶è¡ŒåŒºåŸŸä¸­æ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨ç›¸åŒçš„åˆå§‹æ•°æ®ã€‚</p><p>ä»¥ä¸‹æ˜¯ <code>copyin</code> å­å¥çš„ç®€å•ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> initial_data <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token comment">// ä½¿ç”¨ copyin å­å¥å°† initial_data æ•°æ®å¤åˆ¶åˆ°å¹¶è¡ŒåŒºåŸŸä¸­çš„æ‰€æœ‰çº¿ç¨‹çš„ç§æœ‰å‰¯æœ¬</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token function">copyin</span><span class="token punctuation">(</span>initial_data<span class="token punctuation">)</span></span></span>    <span class="token punctuation">&#123;</span>        <span class="token comment">// è·å–æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰å‰¯æœ¬çš„åˆå§‹æ•°æ®å€¼</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: initial_data = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> initial_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>#pragma omp parallel copyin(initial_data)</code> å°† <code>initial_data</code> å˜é‡çš„å€¼å¤åˆ¶åˆ°æ‰€æœ‰çº¿ç¨‹çš„ç§æœ‰å‰¯æœ¬ä¸­ï¼Œä»¥ç¡®ä¿åœ¨å¹¶è¡ŒåŒºåŸŸä¸­æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç›¸åŒçš„åˆå§‹æ•°æ®ã€‚</p><p>å¹¶è¡ŒåŒºåŸŸå†…çš„æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®ç§æœ‰å‰¯æœ¬çš„ <code>initial_data</code>ï¼Œå¹¶ä¸”è¿™äº›ç§æœ‰å‰¯æœ¬éƒ½å…·æœ‰ç›¸åŒçš„åˆå§‹å€¼ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰“å°äº†è‡ªå·±çš„çº¿ç¨‹ç¼–å·å’Œ <code>initial_data</code> çš„å€¼ï¼Œè¿™äº›å€¼éƒ½æ˜¯ä»ä¸»çº¿ç¨‹å¤åˆ¶åˆ°å„è‡ªç§æœ‰å‰¯æœ¬çš„ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>copyin</code> å­å¥é€šå¸¸ç”¨äºç¡®ä¿å¹¶è¡ŒåŒºåŸŸä¸­æ‰€æœ‰çº¿ç¨‹æ‹¥æœ‰ç›¸åŒçš„åˆå§‹æ•°æ®ã€‚</p><p>copyinå­å¥å¯ä»¥å°†ä¸»çº¿ç¨‹ä¸­å˜é‡çš„å€¼æ‹·è´åˆ°å„ä¸ªçº¿ç¨‹çš„ç§æœ‰å˜é‡ä¸­ï¼Œè®©å„ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ä¸»çº¿ç¨‹ä¸­çš„å˜é‡ã€‚<br>copyinçš„å‚æ•°å¿…é¡»è¦è¢«å£°æ˜ç§°threadprivateï¼Œå¯¹äºç±»çš„è¯åˆ™å¹¶ä¸”å¸¦æœ‰æ˜ç¡®çš„æ‹·è´èµ‹å€¼æ“ä½œç¬¦ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> g <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp <span class="token function">threadprivate</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span> </span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span>   </span></span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>g <span class="token operator">=</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread %d, g = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"global g: %d\n"</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">copyin</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span></span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread %d, g = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">thread 0, g &#x3D; 0thread 1, g &#x3D; 1thread 2, g &#x3D; 2thread 3, g &#x3D; 3global g: 0thread 1, g &#x3D; 0thread 2, g &#x3D; 0thread 0, g &#x3D; 0thread 3, g &#x3D; 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="staticå­—å¥"><a href="#staticå­—å¥" class="headerlink" title="staticå­—å¥"></a>staticå­—å¥</h2><p>åœ¨ OpenMP ä¸­ï¼Œ<code>static</code> å­—å¥ç”¨äºæŒ‡å®šå¹¶è¡Œå¾ªç¯ä¸­è¿­ä»£å˜é‡çš„å­˜å‚¨æ–¹å¼ã€‚å®ƒå†³å®šäº†è¿­ä»£å˜é‡çš„å­˜å‚¨åˆ†é…æ–¹å¼å’ŒèŒƒå›´ã€‚</p><p>åœ¨ <code>parallel for</code> å¾ªç¯ä¸­ï¼Œè¿­ä»£å˜é‡å¯ä»¥é‡‡ç”¨ä¸åŒçš„å­˜å‚¨æ–¹å¼ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨ <code>static</code> å­—å¥ã€‚<code>static</code> å­—å¥æŒ‡å®šäº†åœ¨å¹¶è¡Œå¾ªç¯ä¸­ï¼Œè¿­ä»£å˜é‡çš„å­˜å‚¨åˆ†é…æ˜¯é™æ€çš„ï¼Œå³åœ¨ç¼–è¯‘æ—¶å°±è¿›è¡Œåˆ†é…ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº† <code>static</code> å­—å¥çš„ç”¨æ³•ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ static å­—å¥æŒ‡å®šè¿­ä»£å˜é‡ i çš„å­˜å‚¨åˆ†é…æ–¹å¼ä¸ºé™æ€</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: i = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>#pragma omp parallel for schedule(static)</code> ä¸­çš„ <code>static</code> å­—å¥æŒ‡å®šäº†è¿­ä»£å˜é‡ <code>i</code> çš„å­˜å‚¨åˆ†é…æ–¹å¼ä¸ºé™æ€ã€‚è¿™æ„å‘³ç€åœ¨ç¼–è¯‘æ—¶ï¼Œè¿­ä»£å˜é‡ <code>i</code> çš„å†…å­˜ç©ºé—´å°†è¢«åˆ†é…ï¼Œå¹¶åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½ä¿æŒç›¸åŒçš„å†…å­˜ä½ç½®ã€‚</p><p><code>static</code> å­—å¥è¿˜å¯ä»¥ä¸ <code>schedule</code> æŒ‡å®šå¾ªç¯è¿­ä»£æ–¹å¼ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>schedule(static, chunk_size)</code>ï¼Œè¿™æ ·å¯ä»¥è¿›ä¸€æ­¥æ§åˆ¶å¾ªç¯è¿­ä»£çš„åˆ†å—å¤§å°ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>static</code> å­—å¥æ˜¯ OpenMP ä¸­å¸¸ç”¨çš„ä¸€ç§è¿­ä»£å˜é‡å­˜å‚¨æ–¹å¼ï¼Œå®ƒé€‚ç”¨äºå¹¶è¡Œå¾ªç¯ä¸­è¿­ä»£å˜é‡è®¿é—®é¢‘ç‡è¾ƒä¸ºå‡åŒ€çš„æƒ…å†µã€‚</p><p>å½“parallel foræ²¡æœ‰å¸¦scheduleæ—¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ç³»ç»Ÿéƒ½ä¼šé»˜è®¤é‡‡ç”¨staticè°ƒåº¦æ–¹å¼ã€‚å‡è®¾æœ‰næ¬¡å¾ªç¯è¿­ä»£ï¼Œtä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹å¤§çº¦åˆ†åˆ°n&#x2F;tæ¬¡è¿­ä»£ã€‚è¿™ç§è°ƒåº¦æ–¹å¼ä¼šå°†å¾ªç¯è¿­ä»£å‡åŒ€çš„åˆ†å¸ƒç»™å„ä¸ªçº¿ç¨‹ï¼Œå„ä¸ªçº¿ç¨‹è¿­ä»£æ¬¡æ•°å¯èƒ½ç›¸å·®1æ¬¡ã€‚ç”¨æ³•ä¸ºschedule(method)ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">)</span></span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i = %d, thread %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">i &#x3D; 0, thread 0i &#x3D; 4, thread 2i &#x3D; 1, thread 0i &#x3D; 7, thread 5i &#x3D; 8, thread 6i &#x3D; 2, thread 1i &#x3D; 9, thread 7i &#x3D; 3, thread 1i &#x3D; 5, thread 3i &#x3D; 6, thread 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="Sizeå‚æ•°çš„ç”¨æ³•"><a href="#Sizeå‚æ•°çš„ç”¨æ³•" class="headerlink" title="Sizeå‚æ•°çš„ç”¨æ³•"></a>Sizeå‚æ•°çš„ç”¨æ³•</h5><p>åœ¨ OpenMP çš„ <code>schedule</code> æŒ‡ä»¤ä¸­ï¼Œ<code>size</code> å‚æ•°ç”¨äºæŒ‡å®šåˆ†å—çš„å¤§å°ï¼ˆchunk sizeï¼‰ï¼Œå®ƒå½±å“äº†å¹¶è¡Œå¾ªç¯ä¸­è¿­ä»£çš„åˆ†é…æ–¹å¼ã€‚</p><p>åœ¨å¾ªç¯å¹¶è¡ŒåŒ–ä¸­ï¼Œé€šå¸¸è¿­ä»£æ˜¯åˆ†é…ç»™ä¸åŒçº¿ç¨‹çš„ã€‚<code>size</code> å‚æ•°æ§åˆ¶äº†æ¯ä¸ªçº¿ç¨‹è·å–çš„è¿­ä»£æ¬¡æ•°ã€‚</p><p>å½“ <code>schedule</code> æŒ‡å®šä¸º <code>static</code> æˆ–è€… <code>dynamic</code> æ—¶ï¼Œ<code>size</code> å‚æ•°å¯ä»¥ç”¨äºæ§åˆ¶åˆ†å—çš„å¤§å°ã€‚å½“ <code>schedule</code> è®¾ç½®ä¸º <code>static</code> æ—¶ï¼Œ<code>size</code> æŒ‡å®šçš„æ˜¯æ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…çš„è¿­ä»£æ¬¡æ•°ã€‚åœ¨ <code>schedule(static, size)</code> ä¸­ï¼Œ<code>size</code> è¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…çš„è¿ç»­è¿­ä»£æ¬¡æ•°ã€‚</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ static åˆ†é…è¿­ä»£</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: i = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>#pragma omp parallel for schedule(static, 3)</code> æŒ‡å®šäº†é™æ€è°ƒåº¦ï¼Œæ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…äº†å¤§å°ä¸º 3 çš„è¿ç»­è¿­ä»£ã€‚è¿™æ ·ï¼Œ10 ä¸ªè¿­ä»£ä¼šè¢«åˆ†ä¸ºä¸‰å—ï¼ˆ3, 3, 3, 1ï¼‰åˆ†é…ç»™çº¿ç¨‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>size</code> å‚æ•°çš„å…·ä½“æ•ˆæœå–å†³äºå®é™…é—®é¢˜çš„ç‰¹å¾å’Œç¡¬ä»¶ç¯å¢ƒã€‚åœ¨é€‰æ‹© <code>size</code> å‚æ•°æ—¶ï¼Œåº”è¯¥æ ¹æ®é—®é¢˜çš„ç‰¹æ€§ã€æ•°æ®å¤§å°å’Œè®¡ç®—èµ„æºç­‰å› ç´ è¿›è¡Œè°ƒæ•´ï¼Œä»¥è·å¾—æœ€ä½³çš„æ€§èƒ½ã€‚</p><p>åœ¨é™æ€è°ƒåº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šsizeå‚æ•°æ¥åˆ†é…ä¸€ä¸ªçº¿ç¨‹çš„æœ€å°è¿­ä»£æ¬¡æ•°ã€‚æŒ‡å®šsizeä¹‹åï¼Œæ¯ä¸ªçº¿ç¨‹æœ€å¤šå¯èƒ½ç›¸å·®sizeæ¬¡è¿­ä»£ã€‚å¯ä»¥æ¨æ–­å‡º[0,size-1]çš„è¿­ä»£æ˜¯åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œï¼Œä¾æ¬¡ç±»æ¨ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i = %d, thread %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">i &#x3D; 6, thread 2i &#x3D; 3, thread 1i &#x3D; 4, thread 1i &#x3D; 0, thread 0i &#x3D; 5, thread 1i &#x3D; 9, thread 3i &#x3D; 1, thread 0i &#x3D; 7, thread 2i &#x3D; 2, thread 0i &#x3D; 8, thread 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="dynamicå­å¥æŒ‡ä»¤"><a href="#dynamicå­å¥æŒ‡ä»¤" class="headerlink" title="dynamicå­å¥æŒ‡ä»¤"></a>dynamicå­å¥æŒ‡ä»¤</h2><p>åœ¨ OpenMP ä¸­ï¼Œ<code>schedule</code> æŒ‡ä»¤å¯ç”¨äºæŒ‡å®šå¹¶è¡Œå¾ªç¯ä¸­è¿­ä»£çš„è°ƒåº¦æ–¹å¼ã€‚<code>schedule(dynamic, chunk_size)</code> æ˜¯å…¶ä¸­ä¸€ç§è°ƒåº¦æ–¹å¼ï¼Œå…¶ä¸­çš„ <code>dynamic</code> å­å¥æŒ‡ç¤ºç¼–è¯‘å™¨ä»¥åŠ¨æ€æ–¹å¼è°ƒåº¦å¾ªç¯çš„è¿­ä»£ï¼Œ<code>chunk_size</code> è¡¨ç¤ºæ¯æ¬¡åˆ†é…ç»™çº¿ç¨‹çš„è¿­ä»£æ•°é‡ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºäº† <code>schedule(dynamic, chunk_size)</code> çš„ç”¨æ³•ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ dynamic å­å¥å’Œ chunk_size ä¸º 2 è¿›è¡Œå¾ªç¯çš„åŠ¨æ€è°ƒåº¦</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">schedule</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span></span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: i = %d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>#pragma omp parallel for schedule(dynamic, 2)</code> æŒ‡å®šäº†åŠ¨æ€è°ƒåº¦ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šæŒ‰éœ€è·å–ä¸¤ä¸ªè¿­ä»£ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆå®ƒæ‰€åˆ†é…çš„ä¸¤ä¸ªè¿­ä»£åï¼Œå®ƒå°†è·å–æ›´å¤šçš„è¿­ä»£ã€‚è¿™ç§æ–¹å¼å¯åœ¨å¹¶è¡Œå¾ªç¯ä¸­å®ç°æ›´çµæ´»çš„è´Ÿè½½å¹³è¡¡ï¼Œå› ä¸ºçº¿ç¨‹ä¼šåŠ¨æ€åœ°è·å–è¿­ä»£ï¼Œé¿å…äº†é™æ€åˆ†é…ä¸­å¯èƒ½å‡ºç°çš„æŸäº›çº¿ç¨‹å¤„ç†çš„å·¥ä½œé‡è¾ƒå°‘è€Œå…¶ä»–çº¿ç¨‹å¤„ç†çš„å·¥ä½œé‡è¾ƒå¤šçš„æƒ…å†µã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>schedule(dynamic, chunk_size)</code> ä¸­çš„ <code>chunk_size</code> å†³å®šäº†æ¯æ¬¡åˆ†é…ç»™çº¿ç¨‹çš„è¿­ä»£æ•°é‡ã€‚è¿‡å°çš„ <code>chunk_size</code> å¯èƒ½ä¼šå¢åŠ è°ƒåº¦å¼€é”€ï¼Œå› æ­¤éœ€è¦æ ¹æ®å®é™…é—®é¢˜çš„ç‰¹æ€§å’Œç¡¬ä»¶ç¯å¢ƒè¿›è¡Œè°ƒæ•´ä»¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚</p><p>åŠ¨æ€åˆ†é…æ˜¯å°†è¿­ä»£åŠ¨æ€åˆ†é…åˆ°å„ä¸ªçº¿ç¨‹ï¼Œä¾èµ–äºè¿è¡Œä½ çŠ¶æ€æ¥ç¡®å®šï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•åƒé™æ€è°ƒåº¦ä¸€æ ·äº‹å…ˆé¢„è®¡è¿›ç¨‹çš„åˆ†é…ã€‚å“ªä¸€ä¸ªçº¿ç¨‹å…ˆå¯åŠ¨ï¼Œå“ªä¸€ä¸ªçº¿ç¨‹è¿­ä»£å¤šä¹…ï¼Œè¿™äº›éƒ½å–å†³äºç³»ç»Ÿçš„èµ„æºå’Œçº¿ç¨‹çš„è°ƒåº¦ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span> <span class="token function">schedule</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span></span></span><span class="token comment">// END OF YOUR CODE</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i = %d, thread %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">i &#x3D; 0, thread 0i &#x3D; 3, thread 3i &#x3D; 8, thread 3i &#x3D; 9, thread 7i &#x3D; 2, thread 1i &#x3D; 4, thread 4i &#x3D; 5, thread 5i &#x3D; 7, thread 0i &#x3D; 1, thread 2i &#x3D; 6, thread 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-get-num-procs"><a href="#omp-get-num-procs" class="headerlink" title="omp_get_num_procs"></a>omp_get_num_procs</h2><p>è¿”å›è°ƒç”¨å‡½æ•°æ—¶å¯ç”¨çš„å¤„ç†å™¨æ•°ç›®ã€‚<br>å‡½æ•°åŸå‹<br>int omp_get_num_procs(void)</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_num_procs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel  </span></span><span class="token punctuation">&#123;</span>    <span class="token comment">// YOUR CODE HERE</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_num_procs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// END OF YOUR CODE</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">888888888<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-get-num-threads"><a href="#omp-get-num-threads" class="headerlink" title="omp_get_num_threads"></a>omp_get_num_threads</h2><p>è¿”å›å½“å‰å¹¶è¡ŒåŒºåŸŸä¸­çš„æ´»åŠ¨çº¿ç¨‹ä¸ªæ•°ï¼Œå¦‚æœåœ¨å¹¶è¡ŒåŒºåŸŸå¤–éƒ¨è°ƒç”¨ï¼Œè¿”å›1<br>int omp_get_num_threads(void)<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">188888888<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;int main(int argc, char* argv[])&#123;printf(&quot;%d\n&quot;, omp_get_num_threads());#pragma omp parallel  &#123;   &#x2F;&#x2F; YOUR CODE HEREprintf(&quot;%d\n&quot;, omp_get_num_threads());&#x2F;&#x2F; YOUR CODE HERE&#125;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-get-thread-num"><a href="#omp-get-thread-num" class="headerlink" title="omp_get_thread_num"></a>omp_get_thread_num</h2><p>è¿”å›å½“å‰çš„çº¿ç¨‹å·ï¼Œæ³¨æ„ä¸è¦å’Œä¹‹å‰çš„omp_get_num_threadsæ··æ·†ã€‚<br>å‡½æ•°åŸå‹<br>int omp_get_thread_num(void)<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">002134567<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;int main(int argc, char* argv[])&#123;printf(&quot;%d\n&quot;, omp_get_thread_num());#pragma omp parallel  &#123;        &#x2F;&#x2F; YOUR CODE HERE    printf(&quot;%d\n&quot;, omp_get_thread_num());    &#x2F;&#x2F; END OF YOUR CODE&#125;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-set-num-threads"><a href="#omp-set-num-threads" class="headerlink" title="omp_set_num_threads"></a>omp_set_num_threads</h2><p>è®¾ç½®è¿›å…¥å¹¶è¡ŒåŒºåŸŸæ—¶ï¼Œå°†è¦åˆ›å»ºçš„çº¿ç¨‹ä¸ªæ•°<br>å‡½æ•°åŸå‹<br>int omp_set_num_threads(void)<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">0 of 4 threads2 of 4 threads1 of 4 threads3 of 4 threads<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;int main(int argc, char* argv[])&#123;    &#x2F;&#x2F; YOUR CODE HERE    omp_set_num_threads(4);    &#x2F;&#x2F; END OF YOUR CODE#pragma omp parallel  &#123;printf(&quot;%d of %d threads\n&quot;, omp_get_thread_num(), omp_get_num_threads());&#125;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-in-parallel"><a href="#omp-in-parallel" class="headerlink" title="omp_in_parallel"></a>omp_in_parallel</h2><p>å¯ä»¥åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºå¹¶è¡ŒçŠ¶æ€<br>å‡½æ•°åŸå‹<br>int omp_in_parallel();<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">01111<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;int main(int argc, char* argv[])&#123;printf(&quot;%d\n&quot;, omp_in_parallel());omp_set_num_threads(4);#pragma omp parallel  &#123;    &#x2F;&#x2F; YOUR CODE HEREprintf(&quot;%d\n&quot;, omp_in_parallel());    &#x2F;&#x2F; END OF YOUR CODE&#125;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-get-max-threads"><a href="#omp-get-max-threads" class="headerlink" title="omp_get_max_threads"></a>omp_get_max_threads</h2><p>è¯¥å‡½æ•°å¯ä»¥ç”¨äºè·å¾—æœ€å¤§çš„çº¿ç¨‹æ•°é‡ï¼Œæ ¹æ®OpenMPæ–‡æ¡£ä¸­çš„è§„å®šï¼Œè¿™ä¸ªæœ€å¤§æ•°é‡æ˜¯æŒ‡åœ¨ä¸ä½¿ç”¨num_threadsçš„æƒ…å†µä¸‹ï¼ŒOpenMPå¯ä»¥åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªå€¼æ˜¯ç¡®å®šçš„ï¼Œä¸å®ƒæ˜¯å¦åœ¨å¹¶è¡ŒåŒºåŸŸè°ƒç”¨æ²¡æœ‰å…³ç³»ã€‚<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">84444<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;int main(int argc, char* argv[])&#123;    &#x2F;&#x2F; YOUR CODE HEREprintf(&quot;%d\n&quot;, omp_get_max_threads());&#x2F;&#x2F; END OF YOUR CODEomp_set_num_threads(4);#pragma omp parallel  &#123;printf(&quot;%d\n&quot;, omp_get_max_threads());&#125;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="OpenMPä¸­äº’æ–¥é”"><a href="#OpenMPä¸­äº’æ–¥é”" class="headerlink" title="OpenMPä¸­äº’æ–¥é”"></a>OpenMPä¸­äº’æ–¥é”</h2><p>Openmpä¸­æœ‰æä¾›ä¸€ç³»åˆ—å‡½æ•°æ¥è¿›è¡Œé”çš„æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´å¸¸ç”¨çš„å‡½æ•°çš„ä¸‹é¢4ä¸ª<br>void omp_init_lock(omp_lock*) åˆå§‹åŒ–äº’æ–¥é”<br>void omp_destroy_lock(omp_lock*) é”€æ¯äº’æ–¥é”<br>void omp_set_lock(omp_lock*) è·å¾—äº’æ–¥é”<br>void omp_unset_lock(omp_lock*) é‡Šæ”¾äº’æ–¥é”<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">0+0-1+1-4+4-2+2-3+3-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;omp.h></span></span><span class="token keyword">static</span> <span class="token class-name">omp_lock_t</span> lock<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token function">omp_init_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">omp parallel <span class="token keyword">for</span>   </span></span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// YOUR CODE HERE</span><span class="token function">omp_set_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// END OF YOUR CODE</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d+\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d-\n"</span><span class="token punctuation">,</span> <span class="token function">omp_get_thread_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// YOUR CODE HERE</span><span class="token function">omp_unset_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// END OF YOUR CODE</span><span class="token punctuation">&#125;</span><span class="token function">omp_destroy_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-test-lock"><a href="#omp-test-lock" class="headerlink" title="omp_test_lock"></a>omp_test_lock</h2><p>é™¤äº†ä¹‹å‰ä»‹ç»çš„4ä¸ªå‡½æ•°ä¹‹å¤–ï¼Œä¸äº’æ–¥é”çš„ç›¸å…³çš„å‡½æ•°è¿˜æœ‰ä¸€ä¸ªï¼Œç”¨æ¥å°è¯•è·å¾—é”ã€‚<br>è¯¥å‡½æ•°å¯ä»¥çœ‹ä½œæ˜¯omp_set_lockçš„éé˜»å¡ç‰ˆæœ¬ã€‚<br>å‡½æ•°åŸå‹<br>bool omp_test_lock(omp_lock*)<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">0+fail to get lockfail to get lockfail to get lock0-2+2-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;static omp_lock_t lock;int main(int argc, char* argv[])&#123;    int i;omp_init_lock(&amp;lock); #pragma omp parallel for   for (i &#x3D; 0; i &lt; 5; ++i)&#123;    &#x2F;&#x2F; YOUR CODE HEREif (omp_test_lock(&amp;lock))&#x2F;&#x2F; END OF YOUR CODE&#123;printf(&quot;%d+\n&quot;, omp_get_thread_num());printf(&quot;%d-\n&quot;, omp_get_thread_num());omp_unset_lock(&amp;lock);&#125;else&#123;printf(&quot;fail to get lock\n&quot;);&#125;&#125;omp_destroy_lock(&amp;lock);return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-set-dynamic"><a href="#omp-set-dynamic" class="headerlink" title="omp_set_dynamic"></a>omp_set_dynamic</h2><p>è¯¥å‡½æ•°å¯ä»¥è®¾ç½®æ˜¯å¦å…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´å¹¶è¡ŒåŒºåŸŸçš„çº¿ç¨‹æ•°ã€‚<br>å‡½æ•°åŸå‹ï¼š<br>void omp_set_dynamic(int)<br>å½“å‚æ•°ä¸º0æ—¶ï¼ŒåŠ¨æ€è°ƒæ•´è¢«ç¦ç”¨ã€‚<br>å½“å‚æ•°ä¸ºé0å€¼æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´çº¿ç¨‹ä»¥æœ€ä½³åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">0123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;int main(int argc, char* argv[])&#123;    int i;    &#x2F;&#x2F; YOUR CODE HEREomp_set_dynamic(1);&#x2F;&#x2F; END OF YOUR CODE#pragma omp parallel forfor (i &#x3D; 0; i &lt; 4; i++)&#123;printf(&quot;%d\n&quot;, omp_get_thread_num());&#125;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="omp-get-dynamic"><a href="#omp-get-dynamic" class="headerlink" title="omp_get_dynamic"></a>omp_get_dynamic</h2><p>è¯¥å‡½æ•°å¯ä»¥è¿”å›å½“å‰ç¨‹åºæ˜¯å¦å…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´å¹¶è¡ŒåŒºåŸŸçš„çº¿ç¨‹æ•°ã€‚<br>å‡½æ•°åŸå‹<br>int omp_get_dynamic()<br>å½“è¿”å›å€¼ä¸ºé0æ—¶è¡¨ç¤ºå…è®¸ç³»ç»ŸåŠ¨æ€è°ƒæ•´çº¿ç¨‹ã€‚<br>å½“è¿”å›å€¼ä¸º0æ—¶è¡¨ç¤ºä¸å…è®¸ã€‚<br><em>æ³¨æ„ï¼šç”±äºç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œæ¯æ¬¡è¾“å‡ºçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</em></p><p><strong>è¿è¡Œç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">01111<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-omp" data-language="omp"><code class="language-omp">#include &lt;stdio.h&gt;#include &lt;omp.h&gt;int main(int argc, char* argv[])&#123;    int i;printf(&quot;%d\n&quot;, omp_get_dynamic());omp_set_dynamic(1);#pragma omp parallel forfor (i &#x3D; 0; i &lt; 4; i++)&#123;    &#x2F;&#x2F; YOUR CODE HEREprintf(&quot;%d\n&quot;, omp_get_dynamic());&#x2F;&#x2F; END OF YOUR CODE&#125;return 0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pthreads</title>
      <link href="/posts/ef25.html"/>
      <url>/posts/ef25.html</url>
      
        <content type="html"><![CDATA[<h1 id="Pthreads"><a href="#Pthreads" class="headerlink" title="Pthreads"></a>Pthreads</h1><h2 id="åˆ›å»ºå’Œç»ˆæ­¢"><a href="#åˆ›å»ºå’Œç»ˆæ­¢" class="headerlink" title="åˆ›å»ºå’Œç»ˆæ­¢"></a>åˆ›å»ºå’Œç»ˆæ­¢</h2><p>æœ¬èŠ‚å±•ç¤ºäº†ä¸¤ä¸ªæœ€åŸºæœ¬çš„çº¿ç¨‹ç®¡ç†å‡½æ•°â€”â€”åˆ›å»ºä¸ç»ˆæ­¢çº¿ç¨‹ã€‚</p><ul><li><code>pthread.h</code>å¤´æ–‡ä»¶çš„å¼•å…¥</li><li><code>pthread_create</code>åˆ›å»ºçº¿ç¨‹</li><li><code>pthread_exit</code>ç»ˆæ­¢çº¿ç¨‹</li></ul><p>æ¬¢è¿æ¥åˆ°Posix Threadsçš„ä¸–ç•Œã€‚</p><p>ä¸ºäº†ç¼–å†™Pthreadsç¨‹åºã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åº”åŒ…å«å¤´æ–‡ä»¶<code>&lt;pthread.h&gt;</code>ã€‚è¿™ä¸ªå¤´æ–‡ä»¶åŒ…å«äº†Pthreadsç¨‹åºçš„å¿…è¦å‡½æ•°ã€‚</p><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¼•å…¥è¿™äº›å‡½æ•°å®ç°çº¿ç¨‹åŒ–çš„åŠŸèƒ½ã€‚</p><h3 id="å‡½æ•°è¯´æ˜"><a href="#å‡½æ•°è¯´æ˜" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>åˆ›å»ºçº¿ç¨‹</p><pre class="line-numbers language-none"><code class="language-none">int pthread_create(pthread_t * thread,    const pthread_attr_t * attr,   void * (*start_routine)(void *),    void *arg);å‚æ•°ï¼šthread - æŒ‡å‘çº¿ç¨‹çš„æŒ‡é’ˆã€‚attr - æŒ‡å‘çº¿ç¨‹å±æ€§çš„æŒ‡é’ˆã€‚å¯è®¾ç½®ä¸ºNULLã€‚start_routine - ç”¨äºçº¿ç¨‹åŒ–çš„å‡½æ•°æŒ‡é’ˆã€‚arg - æŒ‡å‘å‡½æ•°å‚æ•°çš„æŒ‡é’ˆã€‚è¿”å›å€¼ï¼šçº¿ç¨‹æ ‡è¯†id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>pthread_create</code>æ˜¯POSIXçº¿ç¨‹åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚å®ƒæ¥å—å››ä¸ªå‚æ•°ï¼š</p><ol><li><code>pthread_t * thread</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘<code>pthread_t</code>ç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æ–°åˆ›å»ºçš„çº¿ç¨‹çš„æ ‡è¯†ç¬¦ã€‚</li><li><code>const pthread_attr_t * attr</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘<code>pthread_attr_t</code>ç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºè®¾ç½®æ–°çº¿ç¨‹çš„å±æ€§ã€‚å¦‚æœè®¾ç½®ä¸ºNULLï¼Œåˆ™ä½¿ç”¨é»˜è®¤å±æ€§ã€‚</li><li><code>void * (*start_routine)(void *)</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘æ–°çº¿ç¨‹çš„å…¥å£ç‚¹å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li><li><code>void *arg</code>ï¼šè¿™æ˜¯ä¼ é€’ç»™å…¥å£ç‚¹å‡½æ•°çš„å‚æ•°ã€‚</li></ol><p>å‡½æ•°è¿”å›0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå¤±è´¥ã€‚</p><p>é€€å‡ºçº¿ç¨‹</p><pre class="line-numbers language-none"><code class="language-none">void pthread_exit(void *retval);å‚æ•°ï¼šretval - æŒ‡å‘çº¿ç¨‹è¿”å›å€¼çš„æŒ‡é’ˆã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>pthread_exit(void *retval)</code> æ˜¯ä¸€ä¸ªç”¨äºç»ˆæ­¢çº¿ç¨‹çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ª <code>void *</code> ç±»å‹çš„å‚æ•° <code>retval</code>ã€‚å½“çº¿ç¨‹è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå®ƒå°†ç«‹å³è¿”å›ï¼Œå¹¶å°† <code>retval</code> ä½œä¸ºçº¿ç¨‹çš„é€€å‡ºçŠ¶æ€ä¼ é€’ç»™æ“ä½œç³»ç»Ÿã€‚</p><p><code>pthread_exit(void *retval);</code> æ˜¯ä¸€ä¸ªç”¨äºç»ˆæ­¢çº¿ç¨‹çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘è¿”å›å€¼çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ã€‚å½“çº¿ç¨‹è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå®ƒå°†ç«‹å³ç»ˆæ­¢ï¼Œå¹¶å°†æŒ‡å®šçš„è¿”å›å€¼ä¼ é€’ç»™è°ƒç”¨è€…ã€‚</p><p>è¾“å‡ºç»“æœ</p><blockquote><p>In main: creating thread 0<br>In main: creating thread 1<br>Hello World!<br>In main: creating thread 2<br>In main: creating thread 3<br>Hello World!<br>Hello World!<br>Hello World!</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_THREADS</span><span class="token expression"><span class="token number">4</span></span></span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">PrintHello</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>null<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>  <span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> rc<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> t<span class="token operator">&lt;</span>NUM_THREADS<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In main: creating thread %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//your code here</span>rc <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PrintHello<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR; return code from pthread_create() is %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘çº¿ç¨‹ä¼ é€’å‚æ•°-1"><a href="#å‘çº¿ç¨‹ä¼ é€’å‚æ•°-1" class="headerlink" title="å‘çº¿ç¨‹ä¼ é€’å‚æ•°(1)"></a>å‘çº¿ç¨‹ä¼ é€’å‚æ•°(1)</h2><p>æœ¬èŠ‚å±•ç¤ºäº†æœ€åŸºæœ¬çš„çº¿ç¨‹åˆ›å»ºï¼Œä»¥åŠå‘çº¿ç¨‹ä¼ é€’å•ä¸ªå‚æ•°çš„æ–¹æ³•ã€‚</p><ul><li><code>pthread_create</code>åˆ›å»ºçº¿ç¨‹</li><li><code>pthread_exit</code>ç»ˆæ­¢çº¿ç¨‹</li></ul><p>æœ¬ä¾‹ç”¨<code>pthread_create</code>åˆ›å»ºäº†4ä¸ªçº¿ç¨‹ã€‚</p><p>ç”¨äºçº¿ç¨‹åŒ–çš„çº¿ç¨‹æ¥æ”¶å”¯ä¸€ä¸€ä¸ªå‚æ•°ã€‚</p><p>æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šæ‰“å°ä¸€æ¡è¡¨æ˜è‡ªå·±çº¿ç¨‹idçš„æ¶ˆæ¯ï¼Œç„¶åè°ƒç”¨<code>pthread_exit</code>ç»ˆæ­¢çº¿ç¨‹ã€‚</p><p>è¾“å‡ºç»“æœ</p><p>ç”±äºå¹¶è¡Œç¨‹åºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œä½ çš„ç»“æœçš„é¡ºåºå¯èƒ½å’Œè¿™ä¸ªç»“æœä¸ä¸€è‡´ã€‚<br>ä¸ºäº†æ¯”è¾ƒè¾“å‡ºç»“æœï¼Œè¯·å°†ç¯å¢ƒè®¾ç½®ä¸­çš„å¹¶è¡Œæ ¸æ•°è°ƒä¸º1ã€‚<br>æœ¬å®éªŒæš‚ä¸æ”¯æŒæ€§èƒ½è¯„æµ‹ã€‚</p><blockquote><p>In main: creating thread 0<br>In main: creating thread 1<br>Hello World! Itâ€™s me, thread #0!<br>In main: creating thread 2<br>Hello World! Itâ€™s me, thread #1!<br>In main: creating thread 3<br>Hello World! Itâ€™s me, thread #2!<br>Hello World! Itâ€™s me, thread #3!</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_THREADS</span><span class="token expression"><span class="token number">4</span></span></span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">PrintHello</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>threadid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">int</span> tid<span class="token punctuation">;</span> tid <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>threadid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World! It's me, thread #%d!\n"</span><span class="token punctuation">,</span> tid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">free</span><span class="token punctuation">(</span>threadid<span class="token punctuation">)</span><span class="token punctuation">;</span>threadid <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>  <span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> rc<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> t<span class="token operator">&lt;</span>NUM_THREADS<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In main: creating thread %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">int</span><span class="token operator">*</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">*</span>id <span class="token operator">=</span> t<span class="token punctuation">;</span><span class="token comment">//your code here</span>rc <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PrintHello<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR; return code from pthread_create() is %d"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘çº¿ç¨‹ä¼ é€’å‚æ•°-2"><a href="#å‘çº¿ç¨‹ä¼ é€’å‚æ•°-2" class="headerlink" title="å‘çº¿ç¨‹ä¼ é€’å‚æ•°(2)"></a>å‘çº¿ç¨‹ä¼ é€’å‚æ•°(2)</h2><p>æœ¬èŠ‚å±•ç¤ºäº†å‘çº¿ç¨‹ä¼ é€’éç©ºå‚æ•°çš„æ–¹æ³•ã€‚</p><ul><li><code>pthread_create</code>åˆ›å»ºçº¿ç¨‹ï¼Œæ¥æ”¶å¤šå‚æ•°</li></ul><p>å¾ˆå¤šæ—¶å€™ï¼Œç”¨äºçº¿ç¨‹åŒ–çš„å‡½æ•°éœ€è¦æ¥æ”¶ä¸æ­¢ä¸€ä¸ªå‚æ•°ã€‚<br>å½“å¤šä¸ªå‚æ•°éœ€è¦è¢«ä¼ é€’æ—¶ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªç»“æ„ä½“åŒ…å«æ‰€æœ‰è¦ä¼ çš„å‚æ•°ï¼Œç„¶åç”¨<code>pthread_create</code>ä¼ é€’ä¸€ä¸ªæŒ‡å‘æ”¹ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œæ¥æ‰“ç ´ä¼ é€’å‚æ•°çš„ä¸ªæ•°çš„é™åˆ¶ã€‚</p><h3 id="è¾“å‡ºç»“æœ"><a href="#è¾“å‡ºç»“æœ" class="headerlink" title="è¾“å‡ºç»“æœ"></a>è¾“å‡ºç»“æœ</h3><p>ç”±äºå¹¶è¡Œç¨‹åºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œä½ çš„ç»“æœçš„é¡ºåºå¯èƒ½å’Œè¿™ä¸ªç»“æœä¸ä¸€è‡´ã€‚</p><blockquote><p>msg: apple on thread 0<br>msg: cat on thread 2<br>msg: banana on thread 1<br>msg: dog on thread 3</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_THREADS</span>   <span class="token expression"><span class="token number">4</span></span></span><span class="token keyword">struct</span> <span class="token class-name">thread_data</span><span class="token punctuation">&#123;</span> <span class="token keyword">int</span>  thread_id<span class="token punctuation">;</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>message<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>thread_data_array<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>threadarg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">struct</span> <span class="token class-name">thread_data</span> <span class="token operator">*</span>my_data<span class="token punctuation">;</span> my_data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">thread_data</span> <span class="token operator">*</span><span class="token punctuation">)</span> threadarg<span class="token punctuation">;</span> <span class="token keyword">int</span> taskid<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> msg<span class="token punctuation">;</span>taskid <span class="token operator">=</span> my_data<span class="token operator">-></span>thread_id<span class="token punctuation">;</span> msg <span class="token operator">=</span> my_data<span class="token operator">-></span>message<span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"msg: %s on thread %d\n"</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> taskid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> rc<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> messages<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"dog"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> NUM_THREADS<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>thread_data_array<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>thread_id <span class="token operator">=</span> t<span class="token punctuation">;</span> thread_data_array<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>message <span class="token operator">=</span> messages<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//your code here</span>rc <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> Print<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>thread_data_array<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR; return code from pthread_create() is %d"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çº¿ç¨‹å±æ€§-çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»-1"><a href="#çº¿ç¨‹å±æ€§-çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»-1" class="headerlink" title="çº¿ç¨‹å±æ€§ - çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»(1)"></a>çº¿ç¨‹å±æ€§ - çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»(1)</h2><p>æœ¬èŠ‚å±•ç¤ºäº†çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»çš„åŸºæœ¬çŸ¥è¯†ã€‚</p><ul><li><code>pthread_join</code>ä¸»çº¿ç¨‹æŒ‚èµ·ç›´è‡³ç›®æ ‡è¿›ç¨‹è¿”å›</li><li><code>pthread_attr_init</code>åˆå§‹åŒ–å±æ€§å¯¹è±¡</li><li><code>pthread_attr_destroy</code>é”€æ¯å±æ€§å¯¹è±¡</li><li><code>pthread_attr_setdetachstate</code>è®¾ç½®å±æ€§å¯¹è±¡çš„åˆ†ç¦»çŠ¶æ€</li></ul><p>å½“ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºï¼Œå®ƒæœ‰ä¸€ä¸ªå±æ€§å®šä¹‰äº†å®ƒæ˜¯å¯è¿æ¥çš„(joinable)è¿˜æ˜¯åˆ†ç¦»çš„(detached)ã€‚åªæœ‰æ˜¯å¯è¿æ¥çš„çº¿ç¨‹æ‰èƒ½è¢«è¿æ¥(joined)ï¼Œè‹¥æœåˆ›å»ºçš„çº¿ç¨‹æ˜¯åˆ†ç¦»çš„ï¼Œåˆ™ä¸èƒ½è¿æ¥ã€‚<br><code>pthread_join</code>å‡½æ•°é˜»å¡ä¸»çº¿ç¨‹ç›´åˆ°æŒ‡å®šçš„çº¿ç¨‹ç»ˆæ­¢ã€‚â€œè¿æ¥â€æ˜¯ä¸€ç§åœ¨çº¿ç¨‹é—´å®ŒæˆåŒæ­¥çš„æ–¹æ³•ã€‚<br><code>pthread_detach</code>å‡½æ•°å¯ä»¥æ˜¾å¼ç”¨äºåˆ†ç¦»çº¿ç¨‹ã€‚</p><p>ä½¿ç”¨<code>pthread_create</code>çš„attrå‚æ•°å¯ä»¥æ˜¾å¼çš„åˆ›å»ºå¯è¿æ¥æˆ–åˆ†ç¦»çš„çº¿ç¨‹ï¼Œå…¸å‹å››æ­¥å¦‚ä¸‹ï¼š</p><ol><li>å£°æ˜ä¸€ä¸ª<code>pthread_attr_t</code>æ•°æ®ç±»å‹çš„çº¿ç¨‹å±æ€§å˜é‡</li><li>ç”¨<code>pthread_attr_init</code>åˆå§‹åŒ–æ”¹å±æ€§å˜é‡</li><li>ç”¨<code>pthread_attr_setdetachstate</code>è®¾ç½®å¯åˆ†ç¦»çŠ¶æ€å±æ€§</li><li>å®Œäº†åï¼Œç”¨<code>pthread_attr_destroy</code>é‡Šæ”¾å±æ€§æ‰€å ç”¨çš„åº“èµ„æº</li></ol><h3 id="å‡½æ•°è¯´æ˜-1"><a href="#å‡½æ•°è¯´æ˜-1" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>ä¸»çº¿ç¨‹æŒ‚èµ·ç›´è‡³ç›®æ ‡è¿›ç¨‹è¿”å›</p><pre class="line-numbers language-none"><code class="language-none">int pthread_join(pthread_t thread, void **retval);å‚æ•°ï¼šthread - çº¿ç¨‹idï¼Œæ ‡è¯†å”¯ä¸€çº¿ç¨‹ã€‚retval - ç”¨æˆ·å®šä¹‰çš„æŒ‡é’ˆï¼Œç”¨æ¥å­˜å‚¨è¢«ç­‰å¾…çº¿ç¨‹çš„è¿”å›å€¼ã€‚è¿”å›å€¼ï¼š0ä»£è¡¨æˆåŠŸã€‚è‹¥å¤±è´¥ï¼Œè¿”å›çš„åˆ™æ˜¯é”™è¯¯å·ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>pthread_join</code> æ˜¯ä¸€ä¸ªç”¨äºç­‰å¾…çº¿ç¨‹ç»“æŸçš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯è¦ç­‰å¾…çš„çº¿ç¨‹æ ‡è¯†ç¬¦ <code>pthread_t thread</code>ï¼Œå¦ä¸€ä¸ªæ˜¯æŒ‡å‘è¿”å›å€¼çš„æŒ‡é’ˆ <code>void **retval</code>ã€‚å½“çº¿ç¨‹ç»“æŸæ—¶ï¼Œ<code>pthread_join</code> ä¼šå°†çº¿ç¨‹çš„è¿”å›å€¼å­˜å‚¨åœ¨ <code>retval</code> æŒ‡å‘çš„å†…å­˜ä¸­ã€‚</p><p>å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_join</span><span class="token punctuation">(</span><span class="token class-name">pthread_t</span> thread<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>thread</code>ï¼šè¦ç­‰å¾…çš„çº¿ç¨‹æ ‡è¯†ç¬¦ã€‚</li><li><code>retval</code>ï¼šæŒ‡å‘è¿”å›å€¼çš„æŒ‡é’ˆã€‚å¦‚æœçº¿ç¨‹æ­£å¸¸ç»“æŸï¼Œè¯¥æŒ‡é’ˆå°†è¢«è®¾ç½®ä¸ºçº¿ç¨‹çš„è¿”å›å€¼ï¼›å¦‚æœçº¿ç¨‹è¢«å…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œè¯¥æŒ‡é’ˆå°†è¢«è®¾ç½®ä¸ºNULLã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å¦‚æœæˆåŠŸç­‰å¾…çº¿ç¨‹ç»“æŸå¹¶è·å–è¿”å›å€¼ï¼Œè¿”å›0ï¼›</li><li>å¦‚æœçº¿ç¨‹å·²ç»ç»“æŸï¼Œè¿”å›0ï¼›</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¿”å›é0å€¼ã€‚</li></ul></blockquote><p>åˆå§‹åŒ–å±æ€§å¯¹è±¡</p><pre class="line-numbers language-none"><code class="language-none">int pthread_attr_init(pthread_attr_t *attr);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_attr_init(pthread_attr_t *attr);</code> æ˜¯ä¸€ä¸ªç”¨äºåˆå§‹åŒ–çº¿ç¨‹å±æ€§çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ <code>pthread_attr_t</code> ç±»å‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥æŒ‡é’ˆç”¨äºå­˜å‚¨çº¿ç¨‹å±æ€§çš„ç»“æ„ä½“ã€‚å¦‚æœå‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œå®ƒå°†è¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›é0å€¼ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_attr_init</code> å‡½æ•°ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span> <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹å±æ€§åˆå§‹åŒ–æˆåŠŸ\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// åœ¨è¿™é‡Œå¯ä»¥å¯¹çº¿ç¨‹å±æ€§è¿›è¡Œè¿›ä¸€æ­¥çš„é…ç½®å’Œè®¾ç½®</span>     <span class="token comment">// åœ¨å®Œæˆçº¿ç¨‹å±æ€§çš„ä½¿ç”¨åï¼Œè®°å¾—é‡Šæ”¾èµ„æº</span>     <span class="token function">pthread_attr_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹å±æ€§åˆå§‹åŒ–å¤±è´¥\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨å®Œçº¿ç¨‹å±æ€§åï¼Œéœ€è¦è°ƒç”¨ <code>pthread_attr_destroy</code> å‡½æ•°æ¥é‡Šæ”¾ç›¸å…³èµ„æºã€‚</p></blockquote><p>é”€æ¯å±æ€§å¯¹è±¡</p><pre class="line-numbers language-none"><code class="language-none">int pthread_attr_destroy(pthread_attr_t *attr);å‚æ•°ï¼šattr - æŒ‡å‘çº¿ç¨‹å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚è¿”å›å€¼ï¼š0ä»£è¡¨æˆåŠŸã€‚è‹¥å¤±è´¥ï¼Œè¿”å›çš„åˆ™æ˜¯é”™è¯¯å·ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>int pthread_attr_destroy(pthread_attr_t *attr);</code> æ˜¯ä¸€ä¸ªç”¨äºé”€æ¯çº¿ç¨‹å±æ€§çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ <code>pthread_attr_t</code> ç±»å‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¦é”€æ¯çš„çº¿ç¨‹å±æ€§ç»“æ„ä½“ã€‚å¦‚æœå‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œå®ƒå°†è¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›é0å€¼ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_attr_destroy</code> å‡½æ•°ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span> <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token comment">// åœ¨è¿™é‡Œå¯ä»¥å¯¹çº¿ç¨‹å±æ€§è¿›è¡Œè¿›ä¸€æ­¥çš„é…ç½®å’Œè®¾ç½®</span>     <span class="token comment">// åœ¨å®Œæˆçº¿ç¨‹å±æ€§çš„ä½¿ç”¨åï¼Œè®°å¾—é”€æ¯å®ƒ</span>     result <span class="token operator">=</span> <span class="token function">pthread_attr_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹å±æ€§é”€æ¯æˆåŠŸ\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹å±æ€§é”€æ¯å¤±è´¥\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹å±æ€§åˆå§‹åŒ–å¤±è´¥\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><p>è®¾ç½®å±æ€§å¯¹è±¡çš„åˆ†ç¦»çŠ¶æ€</p><pre class="line-numbers language-none"><code class="language-none">int pthread_attr_setdetachstate(const pthread_attr_t *attr,                                int *detachstate);å‚æ•°ï¼šattr - æŒ‡å‘çº¿ç¨‹å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚detachstate - è®¾ç½®å¯åˆ†ç¦»(PTHREAD_CREATE_DETACHEDï¼‰æˆ–å¯è¿æ¥å±æ€§(PTHREAD_CREATE_JOINABLE)ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>pthread_attr_setdetachstate</code> æ˜¯ä¸€ä¸ªç”¨äºè®¾ç½®çº¿ç¨‹å±æ€§çš„å‡½æ•°ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šçº¿ç¨‹åœ¨åˆ›å»ºåæ˜¯å¦åº”è¯¥è‡ªåŠ¨åˆ†ç¦»ã€‚è¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>const pthread_attr_t *attr</code>ï¼šæŒ‡å‘è¦è®¾ç½®çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†çº¿ç¨‹çš„å±æ€§ä¿¡æ¯ï¼Œä¾‹å¦‚å †æ ˆå¤§å°ã€ä¼˜å…ˆçº§ç­‰ã€‚</li><li><code>int *detachstate</code>ï¼šæŒ‡å‘ä¸€ä¸ªæ•´æ•°å˜é‡çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨è®¾ç½®çš„åˆ†ç¦»çŠ¶æ€ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å€¼ä¹‹ä¸€æ¥æŒ‡å®šåˆ†ç¦»çŠ¶æ€ï¼š<ul><li><code>PTHREAD_CREATE_JOINABLE</code>ï¼šçº¿ç¨‹å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­è¢«è¿æ¥ï¼ˆjoinï¼‰ï¼Œå³ä¸»çº¿ç¨‹å¯ä»¥ç­‰å¾…å­çº¿ç¨‹å®Œæˆæ‰§è¡Œã€‚è¿™æ˜¯é»˜è®¤çš„åˆ†ç¦»çŠ¶æ€ã€‚</li><li><code>PTHREAD_CREATE_DETACHED</code>ï¼šçº¿ç¨‹åœ¨åˆ›å»ºåå°†è‡ªåŠ¨åˆ†ç¦»ï¼Œå³ä¸»çº¿ç¨‹æ— æ³•ç­‰å¾…å…¶å®Œæˆæ‰§è¡Œã€‚</li></ul></li></ol><p>å‡½æ•°è¿”å›0è¡¨ç¤ºæˆåŠŸè®¾ç½®äº†åˆ†ç¦»çŠ¶æ€ï¼Œéé›¶å€¼è¡¨ç¤ºå‡ºç°é”™è¯¯ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_attr_setdetachstate</code> å‡½æ•°æ¥è®¾ç½®çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span>    <span class="token keyword">int</span> detachstate <span class="token operator">=</span> PTHREAD_CREATE_JOINABLE<span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®åˆ†ç¦»çŠ¶æ€ä¸ºå¯è¿æ¥</span>    <span class="token comment">// åˆå§‹åŒ–å±æ€§å¯¹è±¡</span>    <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è®¾ç½®åˆ†ç¦»çŠ¶æ€</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_attr_setdetachstate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>detachstate<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¤„ç†é”™è¯¯æƒ…å†µ</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Failed to set detach state\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// åˆ†ç¦»çŠ¶æ€è®¾ç½®æˆåŠŸï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œ</span>        <span class="token comment">// ...</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// é”€æ¯å±æ€§å¯¹è±¡</span>    <span class="token function">pthread_attr_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨ <code>pthread_attr_setdetachstate</code> å‡½æ•°ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆåˆå§‹åŒ–å±æ€§å¯¹è±¡ï¼Œå¹¶åœ¨ä½¿ç”¨å®Œæ¯•åé”€æ¯å®ƒã€‚</p></blockquote><p>è¿è¡Œç»“æœ</p><p>ç”±äºå¹¶è¡Œç¨‹åºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œä½ çš„ç»“æœçš„é¡ºåºå¯èƒ½å’Œè¿™ä¸ªç»“æœä¸ä¸€è‡´ã€‚<br>ä¸ºäº†æ¯”è¾ƒè¾“å‡ºç»“æœï¼Œè¯·å°†ç¯å¢ƒè®¾ç½®ä¸­çš„å¹¶è¡Œæ ¸æ•°è°ƒä¸º1ã€‚<br>æœ¬å®éªŒæš‚ä¸æ”¯æŒæ€§èƒ½è¯„æµ‹ã€‚</p><blockquote><p>Creating thread 0<br>Creating thread 1<br>Creating thread 2<br>Thread 0 is running<br>Creating thread 3<br>Thread 1 is running<br>Thread 2 is running<br>Completed join with thread 0<br>Thread 3 is running<br>Completed join with thread 1<br>Completed join with thread 2<br>Completed join with thread 3</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_THREADS</span> <span class="token expression"><span class="token number">4</span> </span></span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>threadid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d is running\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>threadid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">free</span><span class="token punctuation">(</span>threadid<span class="token punctuation">)</span><span class="token punctuation">;</span>threadid <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>  <span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_t</span> thread<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span> <span class="token keyword">int</span> rc<span class="token punctuation">,</span> t<span class="token punctuation">;</span>  <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//your code here</span><span class="token function">pthread_attr_setdetachstate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> PTHREAD_CREATE_JOINABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token keyword">for</span><span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> t<span class="token operator">&lt;</span>NUM_THREADS<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">int</span><span class="token operator">*</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">*</span>id <span class="token operator">=</span> t<span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Creating thread %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> rc <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> Print<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR; return code from pthread_create() is %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token function">pthread_attr_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> t<span class="token operator">&lt;</span>NUM_THREADS<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//your code here</span>rc <span class="token operator">=</span> <span class="token function">pthread_join</span><span class="token punctuation">(</span>thread<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR; return code from pthread_join() is %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Completed join with thread %d\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>  <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çº¿ç¨‹å±æ€§-æ ˆç®¡ç†"><a href="#çº¿ç¨‹å±æ€§-æ ˆç®¡ç†" class="headerlink" title="çº¿ç¨‹å±æ€§ - æ ˆç®¡ç†"></a>çº¿ç¨‹å±æ€§ - æ ˆç®¡ç†</h2><p>æœ¬èŠ‚å±•ç¤ºäº†è·å–ä¸è®¾ç½®å½“å‰çº¿ç¨‹çš„æ ˆç©ºé—´çš„æ–¹æ³•ã€‚</p><ul><li><code>pthread_attr_getstacksize</code>è·å–å½“å‰çº¿ç¨‹çš„æ ˆç©ºé—´</li><li><code>pthread_attr_setstacksize</code>è®¾ç½®å½“å‰çº¿ç¨‹çš„æ ˆç©ºé—´</li></ul><p>POSIXæ ‡å‡†å¹¶æ²¡æœ‰æŒ‡å®šçº¿ç¨‹æ ˆçš„å¤§å°ï¼Œä¾èµ–äºå®ç°å¹¶éšå®ç°å˜åŒ–ã€‚</p><p>å¾ˆå®¹æ˜“è¶…å‡ºé»˜è®¤çš„æ ˆå¤§å°ï¼Œå¸¸è§ç»“æœï¼šç¨‹åºç»ˆæ­¢æˆ–è€…æ•°æ®æŸåã€‚</p><p>å®‰å…¨å’Œå¯ç§»æ¤çš„ç¨‹åºåº”è¯¥ä¸ä¾èµ–äºé»˜è®¤çš„æ ˆé™åˆ¶ï¼Œä½†æ˜¯å–è€Œä»£ä¹‹çš„æ˜¯ç”¨<code>pthread_attr_setstacksize</code>åˆ†é…è¶³å¤Ÿçš„æ ˆå¤§å°ã€‚</p><p><code>pthread_attr_getstackaddr</code>å’Œ<code>pthread_attr_setstackaddr</code>å‡½æ•°å¯ä»¥è¢«ç¨‹åºç”¨äºå°†æ ˆè®¾ç½®åœ¨æŒ‡å®šçš„å†…å­˜åŒºåŸŸã€‚</p><h3 id="å‡½æ•°è¯´æ˜-2"><a href="#å‡½æ•°è¯´æ˜-2" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>è·å–å½“å‰çº¿ç¨‹çš„æ ˆç©ºé—´</p><pre class="line-numbers language-none"><code class="language-none">int pthread_attr_getstacksize(const pthread_attr_t *restrict attr,                              size_t *restrict stacksize);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p><code>pthread_attr_getstacksize</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–çº¿ç¨‹å±æ€§ä¸­æ ˆå¤§å°çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæŒ‡å‘ <code>pthread_attr_t</code> ç±»å‹çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºè¦æŸ¥è¯¢çš„çº¿ç¨‹å±æ€§ï¼›å¦ä¸€ä¸ªæ˜¯æŒ‡å‘ <code>size_t</code> ç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢åˆ°çš„æ ˆå¤§å°ã€‚</p><p>å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_attr_getstacksize</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">pthread_attr_t</span> <span class="token operator">*</span>restrict attr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> <span class="token operator">*</span>restrict stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æœæˆåŠŸè·å–åˆ°æ ˆå¤§å°ï¼Œåˆ™è¿”å›0ï¼›å¦åˆ™è¿”å›éé›¶å€¼ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_attr_getstacksize</code> å‡½æ•°æ¥è·å–çº¿ç¨‹å±æ€§ä¸­çš„æ ˆå¤§å°ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span> <span class="token class-name">size_t</span> stacksize<span class="token punctuation">;</span> <span class="token comment">// åˆå§‹åŒ–çº¿ç¨‹å±æ€§å¯¹è±¡</span> <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–çº¿ç¨‹å±æ€§ä¸­çš„æ ˆå¤§å°</span> <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_attr_getstacksize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack size: %zu\n"</span><span class="token punctuation">,</span> stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Failed to get stack size\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// é”€æ¯çº¿ç¨‹å±æ€§å¯¹è±¡</span> <span class="token function">pthread_attr_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª <code>pthread_attr_t</code> ç±»å‹çš„å˜é‡ <code>attr</code>ï¼Œç„¶åä½¿ç”¨ <code>pthread_attr_init</code> å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚æ¥ä¸‹æ¥ï¼Œè°ƒç”¨ <code>pthread_attr_getstacksize</code> å‡½æ•°æ¥è·å–çº¿ç¨‹å±æ€§ä¸­çš„æ ˆå¤§å°ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ <code>stacksize</code> å˜é‡ä¸­ã€‚æœ€åï¼Œæ ¹æ®è¿”å›å€¼åˆ¤æ–­æ˜¯å¦æˆåŠŸè·å–åˆ°æ ˆå¤§å°ï¼Œå¹¶æ‰“å°ç›¸åº”çš„ä¿¡æ¯ã€‚æœ€åï¼Œè®°å¾—ä½¿ç”¨ <code>pthread_attr_destroy</code> å‡½æ•°é”€æ¯çº¿ç¨‹å±æ€§å¯¹è±¡ã€‚</p></blockquote><p>è®¾ç½®å½“å‰çº¿ç¨‹çš„æ ˆç©ºé—´</p><pre class="line-numbers language-none"><code class="language-none">int pthread_attr_setstacksize(pthread_attr_t *attr, size_t stacksize);å‚æ•°ï¼šattr - æŒ‡å‘çº¿ç¨‹å±æ€§çš„æŒ‡é’ˆstacksize - æ ˆç©ºé—´å¤§å°è¿”å›å€¼ï¼š0ä»£è¡¨æˆåŠŸã€‚è‹¥å¤±è´¥ï¼Œè¿”å›çš„åˆ™æ˜¯é”™è¯¯å·ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨ï¼šrestrictä¸ºCè¯­è¨€ä¿ç•™å­—ï¼Œç”¨äºç¼–è¯‘å™¨ä¼˜åŒ–ã€‚ååŒã€‚</p><blockquote><p><code>pthread_attr_setstacksize</code> æ˜¯ä¸€ä¸ªç”¨äºè®¾ç½®çº¿ç¨‹å±æ€§ä¸­æ ˆå¤§å°çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæŒ‡å‘ <code>pthread_attr_t</code> ç±»å‹çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºè¦è®¾ç½®çš„çº¿ç¨‹å±æ€§ï¼›å¦ä¸€ä¸ªæ˜¯ <code>size_t</code> ç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºè¦è®¾ç½®çš„æ ˆå¤§å°ã€‚</p><p>å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_attr_setstacksize</span><span class="token punctuation">(</span><span class="token class-name">pthread_attr_t</span> <span class="token operator">*</span>attr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æœæˆåŠŸè®¾ç½®æ ˆå¤§å°ï¼Œåˆ™è¿”å›0ï¼›å¦åˆ™è¿”å›éé›¶å€¼ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_attr_setstacksize</code> å‡½æ•°æ¥è®¾ç½®çº¿ç¨‹å±æ€§ä¸­çš„æ ˆå¤§å°ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span> <span class="token class-name">size_t</span> stacksize <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®æ ˆå¤§å°ä¸º1MB</span> <span class="token comment">// åˆå§‹åŒ–çº¿ç¨‹å±æ€§å¯¹è±¡</span> <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®çº¿ç¨‹å±æ€§ä¸­çš„æ ˆå¤§å°</span> <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_attr_setstacksize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span>"Stack size set successfully"<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span>"Failed to set stack size"<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// é”€æ¯çº¿ç¨‹å±æ€§å¯¹è±¡</span> <span class="token function">pthread_attr_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª <code>pthread_attr_t</code> ç±»å‹çš„å˜é‡ <code>attr</code>ï¼Œç„¶åä½¿ç”¨ <code>pthread_attr_init</code> å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚æ¥ä¸‹æ¥ï¼Œè°ƒç”¨ <code>pthread_attr_setstacksize</code> å‡½æ•°æ¥è®¾ç½®çº¿ç¨‹å±æ€§ä¸­çš„æ ˆå¤§å°ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ <code>stacksize</code> å˜é‡ä¸­ã€‚æœ€åï¼Œæ ¹æ®è¿”å›å€¼åˆ¤æ–­æ˜¯å¦æˆåŠŸè®¾ç½®æ ˆå¤§å°ï¼Œå¹¶æ‰“å°ç›¸åº”çš„ä¿¡æ¯ã€‚æœ€åï¼Œè®°å¾—ä½¿ç”¨ <code>pthread_attr_destroy</code> å‡½æ•°é”€æ¯çº¿ç¨‹å±æ€§å¯¹è±¡ã€‚</p></blockquote><h3 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><p>ç”±äºå¹¶è¡Œç¨‹åºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œä½ çš„ç»“æœçš„é¡ºåºå¯èƒ½å’Œè¿™ä¸ªç»“æœä¸ä¸€è‡´ã€‚<br>ä¸ºäº†æ¯”è¾ƒè¾“å‡ºç»“æœï¼Œè¯·å°†ç¯å¢ƒè®¾ç½®ä¸­çš„å¹¶è¡Œæ ¸æ•°è°ƒä¸º1ã€‚<br>æœ¬å®éªŒæš‚ä¸æ”¯æŒæ€§èƒ½è¯„æµ‹ã€‚</p><blockquote><p>Default stack size &#x3D; 0<br>Amount of stack needed per thread &#x3D; 9000000<br>Creating threads with stack size &#x3D; 9000000 bytes<br>Created 4 threads.<br>Thread 1: stack size &#x3D; 9000000 bytes<br>Thread 2: stack size &#x3D; 9000000 bytes<br>Thread 0: stack size &#x3D; 9000000 bytes<br>Thread 3: stack size &#x3D; 9000000 bytes</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUMTHREADS</span> <span class="token expression"><span class="token number">4</span> </span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">1000</span> </span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MEGEXTRA</span> <span class="token expression"><span class="token number">1000000</span> </span></span><span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">dowork</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>threadid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//The 2-dim array takes up sizeof(double)*N*N bytes.</span><span class="token keyword">double</span> A<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>tid<span class="token punctuation">;</span> <span class="token class-name">size_t</span> mystacksize<span class="token punctuation">;</span>  tid <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>threadid<span class="token punctuation">;</span> <span class="token function">pthread_attr_getstacksize</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mystacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %d: stack size = %li bytes \n"</span><span class="token punctuation">,</span> tid<span class="token punctuation">,</span> mystacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">*</span>j<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3.452</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>N<span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">free</span><span class="token punctuation">(</span>threadid<span class="token punctuation">)</span><span class="token punctuation">;</span>threadid <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>NUMTHREADS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token class-name">size_t</span> stacksize<span class="token punctuation">;</span> <span class="token keyword">int</span> rc<span class="token punctuation">,</span> t<span class="token punctuation">;</span> <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span><span class="token function">pthread_attr_getstacksize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Default stack size = %li\n"</span><span class="token punctuation">,</span> stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> stacksize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token operator">*</span>N<span class="token operator">*</span>N<span class="token operator">+</span>MEGEXTRA<span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Amount of stack needed per thread = %li\n"</span><span class="token punctuation">,</span>stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//your code here</span><span class="token function">pthread_attr_setstacksize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Creating threads with stack size = %li bytes\n"</span><span class="token punctuation">,</span>stacksize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> t<span class="token operator">&lt;</span>NUMTHREADS<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">int</span><span class="token operator">*</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">*</span>id <span class="token operator">=</span> t<span class="token punctuation">;</span>rc <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> dowork<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR; return code from pthread_create() is %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Created %d threads.\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº’æ–¥é”-1"><a href="#äº’æ–¥é”-1" class="headerlink" title="äº’æ–¥é”(1)"></a>äº’æ–¥é”(1)</h2><ul><li>å®šä¹‰ä¸€ä¸ªäº’æ–¥é”</li><li><code>pthread_mutex_init</code>äº’æ–¥é”çš„åˆå§‹åŒ–</li><li><code>pthread_mutex_destroy</code>äº’æ–¥é”çš„é”€æ¯</li><li><code>pthread_mutex_lock</code>åŠ é”</li><li><code>pthread_mutex_unlock</code>è§£é”</li></ul><p>äº’æ–¥é”(Mutex)æ˜¯â€œmutual exclusionâ€çš„ç¼©å†™ã€‚äº’æ–¥é”æ˜¯å®ç°çº¿ç¨‹åŒæ­¥ï¼Œå’Œä¿æŠ¤åŒæ—¶å†™å…±äº«æ•°æ®çš„ä¸»è¦æ–¹æ³•<br>äº’æ–¥é”å¯¹å…±äº«æ•°æ®çš„ä¿æŠ¤å°±åƒä¸€æŠŠé”ã€‚åœ¨Pthreadsä¸­ï¼Œä»»ä½•æ—¶å€™ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥é”å®šäº’æ–¥é”ï¼Œå› æ­¤ï¼Œå½“å¤šä¸ªçº¿ç¨‹å°è¯•å»é”å®šè¯¥äº’æ–¥é”æ—¶ä»…æœ‰ä¸€ä¸ªä¼šæˆåŠŸã€‚ç›´åˆ°é”å®šäº’æ–¥é”çš„çº¿ç¨‹è§£é”äº’æ–¥é”åï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥å»é”å®šäº’æ–¥é”ã€‚çº¿ç¨‹å¿…é¡»è½®ç€è®¿é—®å—ä¿æŠ¤æ•°æ®ã€‚<br>äº’æ–¥é”å¯ä»¥é˜²æ­¢â€œç«äº‰â€æ¡ä»¶ã€‚</p><p>ç”¨äº’æ–¥é”çš„å…¸å‹é¡ºåºå¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºå’Œåˆå§‹ä¸€ä¸ªäº’æ–¥é”</li><li>å¤šä¸ªçº¿ç¨‹å°è¯•å»é”å®šè¯¥äº’æ–¥é”</li><li>ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æˆåŠŸé”å®šæ”¹äº’æ–¥é”</li><li>é”å®šæˆåŠŸçš„çº¿ç¨‹åšä¸€äº›å¤„ç†</li><li>çº¿ç¨‹è§£é”è¯¥äº’æ–¥é”</li><li>å¦å¤–ä¸€ä¸ªçº¿ç¨‹è·å¾—äº’æ–¥é”ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹</li><li>æœ€åé”€æ¯äº’æ–¥é”</li></ol><h3 id="å‡½æ•°è¯´æ˜ï¼š"><a href="#å‡½æ•°è¯´æ˜ï¼š" class="headerlink" title="å‡½æ•°è¯´æ˜ï¼š"></a>å‡½æ•°è¯´æ˜ï¼š</h3><p>å®šä¹‰ä¸€ä¸ªäº’æ–¥é”</p><pre class="line-numbers language-none"><code class="language-none">pthread_mutex_t mutex &#x3D; PTHREAD_MUTEX_INITIALIZER;PTHREAD_MUTEX_INITIALIZERæ˜¯å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­çš„å®ï¼Œèƒ½ç”¨äºåˆå§‹åŒ–é™æ€åˆ†é…ç©ºé—´çš„äº’æ–¥é”ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>è¿™æ˜¯Cè¯­è¨€ä¸­ç”¨äºåˆå§‹åŒ–äº’æ–¥é”çš„ä»£ç ã€‚<code>pthread_mutex_t</code> æ˜¯äº’æ–¥é”çš„ç±»å‹ï¼Œ<code>PTHREAD_MUTEX_INITIALIZER</code> æ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºåˆå§‹åŒ–äº’æ–¥é”ã€‚</p><p>è§£æï¼š</p><ol><li><code>pthread_mutex_t mutex;</code>ï¼šå£°æ˜ä¸€ä¸ªäº’æ–¥é”å˜é‡ <code>mutex</code>ã€‚</li><li><code>= PTHREAD_MUTEX_INITIALIZER;</code>ï¼šä½¿ç”¨ <code>PTHREAD_MUTEX_INITIALIZER</code> å®æ¥åˆå§‹åŒ–äº’æ–¥é”ã€‚</li></ol><p>ä»£ç ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_mutex_t</span> mutex <span class="token operator">=</span> PTHREAD_MUTEX_INITIALIZER<span class="token punctuation">;</span>    <span class="token comment">// å…¶ä»–ä»£ç ...</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><p>äº’æ–¥é”çš„åˆå§‹åŒ–</p><pre class="line-numbers language-none"><code class="language-none">int pthread_mutex_init(pthread_mutex_t *restrict mutex,                       const pthread_mutexattr_t *restrict attr);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p><code>int pthread_mutex_init(pthread_mutex_t *restrict mutex, const pthread_mutexattr_t *restrict attr);</code> æ˜¯ä¸€ä¸ªç”¨äºåˆå§‹åŒ–äº’æ–¥é”çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>pthread_mutex_t *restrict mutex</code>ï¼šæŒ‡å‘è¦åˆå§‹åŒ–çš„äº’æ–¥é”å¯¹è±¡çš„æŒ‡é’ˆã€‚</li><li><code>const pthread_mutexattr_t *restrict attr</code>ï¼šæŒ‡å‘äº’æ–¥é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥å¯¹è±¡å®šä¹‰äº†äº’æ–¥é”çš„è¡Œä¸ºå’Œå±æ€§ã€‚å¦‚æœè®¾ç½®ä¸ºNULLï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„å±æ€§ã€‚</li></ol><p>å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæˆåŠŸï¼Œè¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªéé›¶çš„é”™è¯¯ç ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_mutex_init</code> å‡½æ•°æ¥åˆå§‹åŒ–ä¸€ä¸ªäº’æ–¥é”ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_mutex_t</span> myMutex<span class="token punctuation">;</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// äº’æ–¥é”åˆå§‹åŒ–æˆåŠŸ</span>        <span class="token comment">// åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨äº’æ–¥é”è¿›è¡Œçº¿ç¨‹åŒæ­¥æ“ä½œ</span>        <span class="token comment">// ...</span>        <span class="token comment">// é‡Šæ”¾äº’æ–¥é”èµ„æº</span>        <span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// äº’æ–¥é”åˆå§‹åŒ–å¤±è´¥ï¼Œå¤„ç†é”™è¯¯æƒ…å†µ</span>        <span class="token comment">// ...</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨å®Œäº’æ–¥é”åï¼Œéœ€è¦è°ƒç”¨ <code>pthread_mutex_destroy</code> å‡½æ•°æ¥é‡Šæ”¾äº’æ–¥é”èµ„æºï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚</p></blockquote><p>äº’æ–¥é”çš„é”€æ¯</p><pre class="line-numbers language-none"><code class="language-none">int pthread_mutex_destroy(pthread_mutex_t *mutex);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_mutex_destroy(pthread_mutex_t *mutex);</code> æ˜¯ä¸€ä¸ªç”¨äºé”€æ¯äº’æ–¥é”çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ <code>pthread_mutex_t</code> ç±»å‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¦é”€æ¯çš„äº’æ–¥é”å¯¹è±¡ã€‚</p><p>å½“è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå®ƒå°†é‡Šæ”¾äº’æ–¥é”æ‰€å ç”¨çš„ç³»ç»Ÿèµ„æºï¼Œå¹¶ä½¿äº’æ–¥é”å¤„äºæœªé”å®šçŠ¶æ€ã€‚åœ¨é”€æ¯äº’æ–¥é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆç¡®ä¿æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ­£åœ¨ä½¿ç”¨è¯¥äº’æ–¥é”è¿›è¡ŒåŒæ­¥æ“ä½œã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_mutex_destroy</code> å‡½æ•°æ¥é”€æ¯äº’æ–¥é”ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token comment">// åˆ›å»ºäº’æ–¥é”</span><span class="token class-name">pthread_mutex_t</span> myMutex<span class="token punctuation">;</span><span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰§è¡Œä¸€äº›éœ€è¦åŒæ­¥çš„æ“ä½œ...</span><span class="token comment">// é”€æ¯äº’æ–¥é”</span><span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨ <code>pthread_mutex_destroy</code> å‡½æ•°ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿äº’æ–¥é”å·²ç»è¢«æ­£ç¡®åœ°åˆå§‹åŒ–ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ä½¿ç”¨å®ƒè¿›è¡ŒåŒæ­¥æ“ä½œã€‚</p></blockquote><p>åŠ é”</p><pre class="line-numbers language-none"><code class="language-none">int pthread_mutex_lock(pthread_mutex_t *mutex);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_mutex_lock(pthread_mutex_t *mutex);</code> æ˜¯ä¸€ä¸ªç”¨äºé”å®šäº’æ–¥é”çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ <code>pthread_mutex_t</code> ç±»å‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¦é”å®šçš„äº’æ–¥é”å¯¹è±¡ã€‚</p><p>å½“è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå®ƒå°†å°è¯•è·å–äº’æ–¥é”çš„æ‰€æœ‰æƒã€‚å¦‚æœäº’æ–¥é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹é”å®šï¼Œåˆ™å½“å‰çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é”è¢«é‡Šæ”¾ã€‚å¦‚æœæˆåŠŸè·å–åˆ°äº’æ–¥é”çš„æ‰€æœ‰æƒï¼Œå‡½æ•°å°†è¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›éé›¶é”™è¯¯ç ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_mutex_lock</code> å‡½æ•°æ¥é”å®šäº’æ–¥é”ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token comment">// åˆ›å»ºäº’æ–¥é”</span><span class="token class-name">pthread_mutex_t</span> myMutex<span class="token punctuation">;</span><span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰§è¡Œä¸€äº›éœ€è¦åŒæ­¥çš„æ“ä½œ...</span><span class="token comment">// é”å®šäº’æ–¥é”</span><span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// äº’æ–¥é”å·²æˆåŠŸé”å®šï¼Œå¯ä»¥æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </span> <span class="token comment">// ...</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// äº’æ–¥é”é”å®šå¤±è´¥ï¼Œå¤„ç†é”™è¯¯æƒ…å†µ</span> <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span class="token comment">// è§£é”äº’æ–¥é”</span><span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é”€æ¯äº’æ–¥é”</span><span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨ <code>pthread_mutex_lock</code> å‡½æ•°ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿äº’æ–¥é”å·²ç»è¢«æ­£ç¡®åœ°åˆå§‹åŒ–ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ä½¿ç”¨å®ƒè¿›è¡ŒåŒæ­¥æ“ä½œã€‚åœ¨å®Œæˆå¯¹äº’æ–¥é”çš„ä½¿ç”¨åï¼Œåº”è¯¥ä½¿ç”¨ <code>pthread_mutex_unlock</code> å‡½æ•°æ¥é‡Šæ”¾äº’æ–¥é”çš„æ‰€æœ‰æƒï¼Œå¹¶æœ€ç»ˆä½¿ç”¨ <code>pthread_mutex_destroy</code> å‡½æ•°æ¥é”€æ¯äº’æ–¥é”å¯¹è±¡ã€‚</p></blockquote><p>è§£é”</p><pre class="line-numbers language-none"><code class="language-none">int pthread_mutex_unlock(pthread_mutex_t *mutex);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_mutex_unlock(pthread_mutex_t *mutex);</code> æ˜¯ä¸€ä¸ªç”¨äºè§£é”äº’æ–¥é”çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ <code>pthread_mutex_t</code> ç±»å‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¦è§£é”çš„äº’æ–¥é”å¯¹è±¡ã€‚</p><p>å½“è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå®ƒå°†é‡Šæ”¾äº’æ–¥é”çš„æ‰€æœ‰æƒï¼Œå¹¶å…è®¸å…¶ä»–çº¿ç¨‹è·å–äº’æ–¥é”è¿›è¡ŒåŒæ­¥æ“ä½œã€‚å¦‚æœæˆåŠŸè§£é”äº’æ–¥é”ï¼Œå‡½æ•°å°†è¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›éé›¶é”™è¯¯ç ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_mutex_unlock</code> å‡½æ•°æ¥è§£é”äº’æ–¥é”ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token comment">// åˆ›å»ºäº’æ–¥é”</span><span class="token class-name">pthread_mutex_t</span> myMutex<span class="token punctuation">;</span><span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰§è¡Œä¸€äº›éœ€è¦åŒæ­¥çš„æ“ä½œ...</span><span class="token comment">// é”å®šäº’æ–¥é”</span><span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </span><span class="token comment">// ...</span><span class="token comment">// è§£é”äº’æ–¥é”</span><span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é”€æ¯äº’æ–¥é”</span><span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myMutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨ <code>pthread_mutex_unlock</code> å‡½æ•°ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿äº’æ–¥é”å·²ç»è¢«æ­£ç¡®åœ°åˆå§‹åŒ–ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹å·²ç»è·å¾—äº†äº’æ–¥é”çš„æ‰€æœ‰æƒã€‚åœ¨å®Œæˆå¯¹äº’æ–¥é”çš„ä½¿ç”¨åï¼Œåº”è¯¥ä½¿ç”¨ <code>pthread_mutex_destroy</code> å‡½æ•°æ¥é”€æ¯äº’æ–¥é”å¯¹è±¡ã€‚</p></blockquote><h3 id="è¿è¡Œç»“æœï¼š"><a href="#è¿è¡Œç»“æœï¼š" class="headerlink" title="è¿è¡Œç»“æœï¼š"></a>è¿è¡Œç»“æœï¼š</h3><blockquote><p>0<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>  <span class="token keyword">int</span> i<span class="token punctuation">;</span>  <span class="token class-name">pthread_mutex_t</span> mutex1<span class="token punctuation">;</span>    <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">readfunction</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">writefunction</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>  <span class="token class-name">pthread_t</span> thread1<span class="token punctuation">,</span>thread2<span class="token punctuation">;</span>    i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//your code here</span><span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//end of your code</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>readfunction<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>writefunction<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">pthread_join</span><span class="token punctuation">(</span>thread1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">pthread_join</span><span class="token punctuation">(</span>thread2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span><span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">readfunction</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>  <span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">writefunction</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>  <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>  <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span>  i<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº’æ–¥é”-2"><a href="#äº’æ–¥é”-2" class="headerlink" title="äº’æ–¥é”(2)"></a>äº’æ–¥é”(2)</h2><ul><li><code>pthread_mutex_trylock</code>æ˜¯<code>pthread_mutex_lock</code>çš„éé˜»å¡ç‰ˆæœ¬ï¼Œè°ƒç”¨åç«‹å³è¿”å›ã€‚</li></ul><h3 id="å‡½æ•°åŸå‹"><a href="#å‡½æ•°åŸå‹" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h3><pre class="line-numbers language-none"><code class="language-none">int pthread_mutex_trylock(pthread_mutex_t *mutex); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>int pthread_mutex_trylock(pthread_mutex_t *mutex);</code> æ˜¯ä¸€ä¸ªç”¨äºå°è¯•è·å–äº’æ–¥é”çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ <code>pthread_mutex_t</code> ç±»å‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¦é”å®šçš„äº’æ–¥é”å¯¹è±¡ã€‚</p><p>å¦‚æœæˆåŠŸè·å–åˆ°äº’æ–¥é”çš„æ‰€æœ‰æƒï¼Œå‡½æ•°å°†è¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›éé›¶é”™è¯¯ç ã€‚è¿™ä¸ªå‡½æ•°ä¸ <code>pthread_mutex_lock</code> å‡½æ•°ç±»ä¼¼ï¼Œä½†ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ç»“æœã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ›´æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„çº¿ç¨‹é˜»å¡ã€‚</p><h3 id="è¿è¡Œç»“æœ-1"><a href="#è¿è¡Œç»“æœ-1" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><blockquote><p>pthread b trylock<br>the main close</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token class-name">pthread_mutex_t</span> mutex<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">thread_a</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">thread_b</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token comment">/*your code here*/</span><span class="token function">pthread_mutex_trylock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"pthread b trylock\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_t</span> tid_a<span class="token punctuation">,</span>tid_b<span class="token punctuation">;</span>    <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid_a<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>thread_a<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid_b<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>thread_b<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid_a<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid_b<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"the main close\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¡ä»¶å˜é‡-1"><a href="#æ¡ä»¶å˜é‡-1" class="headerlink" title="æ¡ä»¶å˜é‡(1)"></a>æ¡ä»¶å˜é‡(1)</h2><ul><li>æ¡ä»¶å˜é‡çš„åˆå§‹åŒ–</li><li><code>pthread_cond_init</code>åˆ›å»ºæ¡ä»¶å˜é‡</li><li><code>pthread_cond_destroy</code>åˆ é™¤æ¡ä»¶å˜é‡</li><li><code>pthread_cond_wait</code>ç­‰å¾…æ¡ä»¶å˜é‡ä¸ºçœŸ</li><li><code>pthread_cond_signal</code>è§£é”é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„è¿›ç¨‹</li></ul><h3 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h3><p>æ¡ä»¶å˜é‡æ˜¯ç”¨æ¥é€šçŸ¥å…±äº«æ•°æ®çŠ¶æ€ä¿¡æ¯çš„ã€‚<br>æ¡ä»¶å˜é‡æœºåˆ¶å…è®¸è¿›ç¨‹åœæ­¢å½“å‰çš„æ‰§è¡Œï¼Œè®©å‡ºCPUæ—¶é—´ï¼Œç›´åˆ°æ¡ä»¶ä¸ºçœŸã€‚<br>æ¯ä¸ªæ¡ä»¶å˜é‡å¿…é¡»ä¸ä¸€ä¸ªç‰¹å®šçš„äº’æ–¥é‡ç›¸å…³è”ä»¥é¿å…æ­»é”ã€‚</p><p><code>pthread_cond_wait</code>æ€»å’Œä¸€ä¸ªäº’æ–¥é”ç»“åˆä½¿ç”¨ã€‚<br>åœ¨è°ƒç”¨<code>pthread_cond_wait</code>å‰è¦å…ˆè·å–é”ã€‚<br><code>pthread_cond_wait</code>å‡½æ•°æ‰§è¡Œæ—¶å…ˆè‡ªåŠ¨é‡Šæ”¾æŒ‡å®šçš„é”ï¼Œç„¶åç­‰å¾…æ¡ä»¶å˜é‡çš„å˜åŒ–ã€‚åœ¨å‡½æ•°è°ƒç”¨è¿”å›ä¹‹å‰ï¼Œè‡ªåŠ¨å°†æŒ‡å®šçš„äº’æ–¥é‡é‡æ–°é”ä½ã€‚<br>è°ƒç”¨<code>pthread_cond_signal</code>åè¦ç«‹åˆ»é‡Šæ”¾äº’æ–¥é”ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-3"><a href="#å‡½æ•°è¯´æ˜-3" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>åˆå§‹åŒ–</p><pre class="line-numbers language-none"><code class="language-none">pthread_cond_t cod &#x3D; PTHREAD_COND_INITIALIZER;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>pthread_cond_t cod = PTHREAD_COND_INITIALIZER;</code> è¿™è¡Œä»£ç æ˜¯ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæ¡ä»¶å˜é‡ <code>cod</code>ã€‚æ¡ä»¶å˜é‡æ˜¯ä¸€ç§åŒæ­¥åŸè¯­ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®ç°çº¿ç¨‹é—´çš„åŒæ­¥å’Œé€šä¿¡ã€‚</p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>PTHREAD_COND_INITIALIZER</code> æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå·²ç»åˆå§‹åŒ–çš„æ¡ä»¶å˜é‡å¯¹è±¡ã€‚é€šè¿‡å°†å…¶èµ‹å€¼ç»™ <code>cod</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæ¡ä»¶å˜é‡å¯¹è±¡ä¸ <code>cod</code> å…³è”èµ·æ¥ã€‚</p><p>ä½¿ç”¨æ¡ä»¶å˜é‡å¯ä»¥ä½¿å¾—å¤šä¸ªçº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æˆç«‹æ—¶æ‰ç»§ç»­æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å®ŒæˆæŸä¸ªä»»åŠ¡åæ‰èƒ½ç»§ç»­æ‰§è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¡ä»¶å˜é‡æ¥å®ç°è¿™ç§åŒæ­¥æœºåˆ¶ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ç‰‡æ®µï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æ¡ä»¶å˜é‡è¿›è¡Œçº¿ç¨‹åŒæ­¥ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token comment">// å…¨å±€å˜é‡ä½œä¸ºæ¡ä»¶å˜é‡çš„æ ‡è¯†ç¬¦</span><span class="token class-name">pthread_cond_t</span> cond <span class="token operator">=</span> PTHREAD_COND_INITIALIZER<span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// çº¿ç¨‹1ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³</span> <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cond<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread 1: Condition satisfied!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// çº¿ç¨‹2ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³</span> <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cond<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread 2: Condition satisfied!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_t</span> t1<span class="token punctuation">,</span> t2<span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸»çº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæ¨¡æ‹Ÿå…¶ä»–æ“ä½œ</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‘é€ä¿¡å·é€šçŸ¥æ¡ä»¶å˜é‡å·²æ»¡è¶³</span> <span class="token function">pthread_cond_signal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pthread_cond_signal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…çº¿ç¨‹ç»“æŸ</span> <span class="token function">pthread_join</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pthread_join</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ <code>thread1</code> å’Œ <code>thread2</code>ï¼Œå®ƒä»¬éƒ½ç­‰å¾…æ¡ä»¶å˜é‡ <code>cond</code> è¢«æ»¡è¶³ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>pthread_cond_signal</code> å‡½æ•°æ¥å‘é€ä¿¡å·ï¼Œé€šçŸ¥æ¡ä»¶å˜é‡å·²æ»¡è¶³ã€‚è¿™æ ·ï¼Œç­‰å¾…çš„çº¿ç¨‹å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚</p></blockquote><p>åˆ›å»ºæ¡ä»¶å˜é‡</p><pre class="line-numbers language-none"><code class="language-none">int pthread_cond_init(pthread_cond_t *cond, pthread_condattr_t *condattr);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_cond_init(pthread_cond_t *cond, pthread_condattr_t *condattr);</code> æ˜¯ä¸€ä¸ªç”¨äºåˆå§‹åŒ–æ¡ä»¶å˜é‡çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>pthread_cond_t *cond</code>ï¼šæŒ‡å‘è¦åˆå§‹åŒ–çš„æ¡ä»¶å˜é‡çš„æŒ‡é’ˆã€‚</li><li><code>pthread_condattr_t *condattr</code>ï¼šæŒ‡å‘æ¡ä»¶å˜é‡å±æ€§çš„æŒ‡é’ˆï¼Œå¯ä»¥ä¸º NULLã€‚å¦‚æœä¸º NULLï¼Œåˆ™ä½¿ç”¨é»˜è®¤å±æ€§ã€‚</li></ol><p>å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæˆåŠŸï¼Œè¿”å› 0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç ã€‚</p></blockquote><p>åˆ é™¤æ¡ä»¶å˜é‡</p><pre class="line-numbers language-none"><code class="language-none">int pthread_cond_destroy(pthread_cond_t *cond);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_cond_destroy(pthread_cond_t *cond);</code> æ˜¯ä¸€ä¸ªç”¨äºé”€æ¯æ¡ä»¶å˜é‡çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘è¦é”€æ¯çš„æ¡ä»¶å˜é‡çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ã€‚</p><p>å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæˆåŠŸï¼Œè¿”å› 0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç ã€‚</p></blockquote><p>ç­‰å¾…æ¡ä»¶å˜é‡ä¸ºçœŸ</p><pre class="line-numbers language-none"><code class="language-none">int pthread_cond_wait(pthread_cond_t *restrict cond, pthread_mutex_t *restrict mutex);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_cond_wait(pthread_cond_t *restrict cond, pthread_mutex_t *restrict mutex);</code> æ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹ç­‰å¾…æ¡ä»¶çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>pthread_cond_t *restrict cond</code>ï¼šæŒ‡å‘è¦ç­‰å¾…çš„æ¡ä»¶å˜é‡çš„æŒ‡é’ˆã€‚</li><li><code>pthread_mutex_t *restrict mutex</code>ï¼šæŒ‡å‘äº’æ–¥é”çš„æŒ‡é’ˆï¼Œç”¨äºä¿æŠ¤æ¡ä»¶å˜é‡ã€‚</li></ol><p>å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæˆåŠŸï¼Œè¿”å› 0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç ã€‚</p></blockquote><p>è§£é”é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„è¿›ç¨‹</p><pre class="line-numbers language-none"><code class="language-none">int pthread_cond_signal(pthread_cond_t *cond);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>int pthread_cond_signal(pthread_cond_t *cond);</code> æ˜¯ä¸€ä¸ªç”¨äºå”¤é†’ç­‰å¾…æ¡ä»¶å˜é‡çš„çº¿ç¨‹çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘æ¡ä»¶å˜é‡çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ã€‚</p><p>å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæˆåŠŸï¼Œè¿”å› 0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç ã€‚</p></blockquote><h3 id="è¿è¡Œç»“æœ-2"><a href="#è¿è¡Œç»“æœ-2" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><blockquote><p>Counter value functionCount1: 1<br>Counter value functionCount2: 2<br>Counter value functionCount1: 3<br>Counter value functionCount2: 4<br>Counter value functionCount2: 5<br>Counter value functionCount2: 6<br>Counter value functionCount2: 7<br>Counter value functionCount2: 8<br>Counter value functionCount1: 9<br>Counter value functionCount2: 10<br>Counter value functionCount1: 11</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token class-name">pthread_mutex_t</span> count_mutex     <span class="token operator">=</span> PTHREAD_MUTEX_INITIALIZER<span class="token punctuation">;</span><span class="token class-name">pthread_mutex_t</span> condition_mutex <span class="token operator">=</span> PTHREAD_MUTEX_INITIALIZER<span class="token punctuation">;</span><span class="token class-name">pthread_cond_t</span>  condition_cond  <span class="token operator">=</span> PTHREAD_COND_INITIALIZER<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">functionCount1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">functionCount2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span>  count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COUNT_DONE</span>  <span class="token expression"><span class="token number">10</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COUNT_HALT1</span>  <span class="token expression"><span class="token number">3</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COUNT_HALT2</span>  <span class="token expression"><span class="token number">6</span></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token class-name">pthread_t</span> thread1<span class="token punctuation">,</span> thread2<span class="token punctuation">;</span>   <span class="token function">pthread_create</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>thread1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>functionCount1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">pthread_create</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>thread2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>functionCount2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">pthread_join</span><span class="token punctuation">(</span> thread1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">pthread_join</span><span class="token punctuation">(</span> thread2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">functionCount1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>      <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>condition_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">while</span><span class="token punctuation">(</span> count <span class="token operator">>=</span> COUNT_HALT1 <span class="token operator">&amp;&amp;</span> count <span class="token operator">&lt;=</span> COUNT_HALT2 <span class="token punctuation">)</span>      <span class="token punctuation">&#123;</span><span class="token comment">//your code here</span>        <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>condition_cond<span class="token punctuation">,</span> <span class="token operator">&amp;</span>condition_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span>      <span class="token punctuation">&#125;</span>      <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>condition_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>count_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>      count<span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Counter value functionCount1: %d\n"</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>count_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">>=</span> COUNT_DONE<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">functionCount2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>       <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>condition_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span> count <span class="token operator">&lt;</span> COUNT_HALT1 <span class="token operator">||</span> count <span class="token operator">></span> COUNT_HALT2 <span class="token punctuation">)</span>       <span class="token punctuation">&#123;</span>        <span class="token comment">//your code here</span>        <span class="token function">pthread_cond_signal</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>condition_cond <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span>       <span class="token punctuation">&#125;</span>       <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>condition_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>count_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>       count<span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Counter value functionCount2: %d\n"</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>count_mutex <span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">>=</span> COUNT_DONE<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¡ä»¶å˜é‡-2"><a href="#æ¡ä»¶å˜é‡-2" class="headerlink" title="æ¡ä»¶å˜é‡(2)"></a>æ¡ä»¶å˜é‡(2)</h2><p>æœ¬èŠ‚ç»§ç»­å±•ç¤ºæ¡ä»¶å˜é‡çš„ç›¸å…³æ–¹æ³•</p><ul><li><code>pthread_cond_broadcast</code>è§£é™¤æ‰€æœ‰è¢«æŸä¸ªæ¡ä»¶å˜é‡é˜»å¡çš„è¿›ç¨‹</li></ul><p><code>pthread_cond_broadcast</code>å¯ç”¨äºè§£é™¤æ‰€æœ‰è¢«æŸä¸ªæ¡ä»¶å˜é‡é˜»å¡çš„è¿›ç¨‹<br>ä¸<code>pthread_cond_signal</code>å‡½æ•°ç›¸ä¼¼ï¼Œ<code>pthread_cond_broadcast</code>å‡½æ•°æ‰§è¡Œæ—¶å…ˆè‡ªåŠ¨é‡Šæ”¾æŒ‡å®šçš„é”ï¼Œç„¶åç­‰å¾…æ¡ä»¶å˜é‡çš„å˜åŒ–ã€‚åœ¨å‡½æ•°è°ƒç”¨è¿”å›ä¹‹å‰ï¼Œè‡ªåŠ¨å°†æŒ‡å®šçš„äº’æ–¥é‡é‡æ–°é”ä½</p><h3 id="å‡½æ•°è¯´æ˜-4"><a href="#å‡½æ•°è¯´æ˜-4" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_cond_broadcast</span><span class="token punctuation">(</span><span class="token class-name">pthread_cond_t</span> <span class="token operator">*</span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>pthread_cond_broadcast</code>æ˜¯ä¸€ä¸ªPOSIXçº¿ç¨‹åº“å‡½æ•°ï¼Œç”¨äºå”¤é†’æ‰€æœ‰ç­‰å¾…æŸä¸ªæ¡ä»¶å˜é‡çš„çº¿ç¨‹ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p><p>å‚æ•°ï¼š</p><ul><li><code>cond</code>ï¼šæŒ‡å‘è¦å¹¿æ’­çš„æ¡ä»¶å˜é‡çš„æŒ‡é’ˆ</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>æˆåŠŸæ—¶è¿”å›0ï¼›å¤±è´¥æ—¶è¿”å›é”™è¯¯ç </li></ul><h3 id="è¿è¡Œç»“æœ-3"><a href="#è¿è¡Œç»“æœ-3" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><blockquote><p>thread 1 waiting for signal<br>thread 2 waiting for signal<br>main thread broadcasts signal<br>thread 2 receives signal<br>thread 1 receives signal</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>   <span class="token keyword">static</span> <span class="token class-name">pthread_mutex_t</span> mtx<span class="token operator">=</span>PTHREAD_MUTEX_INITIALIZER<span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token class-name">pthread_cond_t</span> cond<span class="token operator">=</span>PTHREAD_COND_INITIALIZER<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">func_1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>      <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 1 waiting for signal\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cond<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 1 receives signal\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">func_2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 2 waiting for signal\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cond<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 2 receives signal\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>      <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>      <span class="token class-name">pthread_t</span> tid1<span class="token punctuation">,</span> tid2<span class="token punctuation">;</span>        <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> func_1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> func_2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"main thread broadcasts signal\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span>    <span class="token function">pthread_cond_broadcast</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//end of your code</span>      <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="éšœç¢åŒæ­¥"><a href="#éšœç¢åŒæ­¥" class="headerlink" title="éšœç¢åŒæ­¥"></a>éšœç¢åŒæ­¥</h2><p>æœ¬èŠ‚å±•ç¤ºäº†éšœç¢åŒæ­¥çš„ç›¸å…³æ–¹æ³•ã€‚</p><ul><li><code>pthread_barrier_init</code>éšœç¢åˆå§‹åŒ–</li><li><code>pthread_barrier_wait</code>éšœç¢ç­‰å¾…</li><li><code>pthread_barrier_destroy</code>éšœç¢é”€æ¯</li></ul><p>éšœç¢åŒæ­¥(Barrier Synchronization)æ˜¯Pthreadä¸­å¦å¤–ä¸€ç§åŒæ­¥æœºåˆ¶ã€‚<br>barrieræ„ä¸ºæ æ†ï¼Œå½¢è±¡çš„è¯´å°±æ˜¯æŠŠå…ˆååˆ°è¾¾çš„å¤šä¸ªçº¿ç¨‹æŒ¡åœ¨åŒä¸€æ æ†å‰ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹åˆ°é½ï¼Œç„¶åæ’¤ä¸‹æ æ†åŒæ—¶æ”¾è¡Œã€‚</p><h3 id="å‡½æ•°åŸå‹-1"><a href="#å‡½æ•°åŸå‹-1" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h3><pre class="line-numbers language-none"><code class="language-none">int pthread_barrier_init(pthread_barrier_t *restrict barrier, const pthread_barrierattr_t *restrict attr, unsigned count);int pthread_barrier_wait(pthread_barrier_t *barrier);int pthread_barrier_destroy(pthread_barrier_t *barrier);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><code>pthread_barrier_init</code>å‡½æ•°ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªå±éšœå¯¹è±¡ã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š</p><ol><li><code>barrier</code>ï¼šæŒ‡å‘è¦åˆå§‹åŒ–çš„å±éšœå¯¹è±¡çš„æŒ‡é’ˆã€‚</li><li><code>attr</code>ï¼šæŒ‡å‘å±éšœå±æ€§å¯¹è±¡çš„æŒ‡é’ˆï¼Œå¯ä»¥ä¸ºNULLã€‚å¦‚æœä¸ºNULLï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„å±æ€§ã€‚</li><li><code>count</code>ï¼šéœ€è¦ç­‰å¾…çš„çº¿ç¨‹æ•°é‡ã€‚å½“æ‰€æœ‰çº¿ç¨‹éƒ½è°ƒç”¨äº†<code>pthread_barrier_wait</code>å‡½æ•°åï¼Œå±éšœå°†è¢«è§£é™¤ã€‚</li></ol><p>å‡½æ•°è¿”å›0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå¤±è´¥ã€‚</p></blockquote><blockquote><p><code>pthread_barrier_wait</code>å‡½æ•°ç”¨äºè®©å½“å‰çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹åˆ°è¾¾å±éšœã€‚å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘<code>pthread_barrier_t</code>ç±»å‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¦ç­‰å¾…çš„å±éšœå¯¹è±¡ã€‚</p><p>å½“è°ƒç”¨<code>pthread_barrier_wait</code>æ—¶ï¼Œå½“å‰çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰å…¶ä»–çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœã€‚ä¸€æ—¦æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœï¼Œå®ƒä»¬å°†ç»§ç»­æ‰§è¡Œå¹¶è§£é™¤é˜»å¡ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>pthread_barrier_wait</code>å‡½æ•°ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token comment">// å®šä¹‰çº¿ç¨‹æ•°é‡å’Œå±éšœå¯¹è±¡</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_THREADS</span> <span class="token expression"><span class="token number">5</span></span></span><span class="token class-name">pthread_barrier_t</span> barrier<span class="token punctuation">;</span><span class="token comment">// çº¿ç¨‹å‡½æ•°</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">threadFunction</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %ld is waiting on barrier\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pthread_barrier_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç­‰å¾…å…¶ä»–çº¿ç¨‹åˆ°è¾¾å±éšœ</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %ld has crossed the barrier\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹åŒ–å±éšœå¯¹è±¡</span> <span class="token function">pthread_barrier_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> NUM_THREADS<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_THREADS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> threadFunction<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_THREADS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">pthread_join</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// é”€æ¯å±éšœå¯¹è±¡</span> <span class="token function">pthread_barrier_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«5ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå¹¶ä½¿ç”¨<code>pthread_barrier_wait</code>å‡½æ•°æ¥åŒæ­¥è¿™äº›çº¿ç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹åœ¨åˆ°è¾¾å±éšœä¹‹å‰éƒ½ä¼šæ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨ç¤ºæ­£åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹ã€‚ä¸€æ—¦æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœï¼Œå®ƒä»¬å°†æ‰“å°å¦ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨ç¤ºå·²ç»è·¨è¶Šäº†å±éšœã€‚æœ€åï¼Œä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹å®Œæˆï¼Œç„¶åé”€æ¯å±éšœå¯¹è±¡ã€‚</p></blockquote><blockquote><p><code>int pthread_barrier_destroy(pthread_barrier_t *barrier);</code> æ˜¯ä¸€ä¸ªç”¨äºé”€æ¯çº¿ç¨‹å±éšœçš„å‡½æ•°ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å±éšœä¸å†éœ€è¦æ—¶ï¼Œå¯ä»¥è°ƒç”¨æ­¤å‡½æ•°æ¥é‡Šæ”¾èµ„æºã€‚</p><p>è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªæŒ‡å‘ <code>pthread_barrier_t</code> ç»“æ„çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¯¥ç»“æ„è¡¨ç¤ºè¦é”€æ¯çš„çº¿ç¨‹å±éšœã€‚å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæˆåŠŸé”€æ¯äº†çº¿ç¨‹å±éšœï¼Œåˆ™è¿”å›0ï¼›å¦åˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>pthread_barrier_destroy</code> å‡½æ•°ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token comment">// å®šä¹‰çº¿ç¨‹æ•°é‡å’Œå±éšœå¯¹è±¡</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_THREADS</span> <span class="token expression"><span class="token number">5</span></span></span><span class="token class-name">pthread_barrier_t</span> barrier<span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">threadFunction</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %ld is waiting on barrier\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">pthread_barrier_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç­‰å¾…å…¶ä»–çº¿ç¨‹åˆ°è¾¾å±éšœ</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread %ld has crossed the barrier\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>NUM_THREADS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹åŒ–çº¿ç¨‹å¹¶å¯åŠ¨å®ƒä»¬</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_THREADS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> threadFunction<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM_THREADS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">pthread_join</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// é”€æ¯çº¿ç¨‹å±éšœ</span> <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">pthread_barrier_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Barrier destroyed successfully\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Failed to destroy barrier\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«5ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œ <code>threadFunction</code> å‡½æ•°ã€‚åœ¨å‡½æ•°ä¸­ï¼Œçº¿ç¨‹ä½¿ç”¨ <code>pthread_barrier_wait</code> å‡½æ•°ç­‰å¾…å…¶ä»–çº¿ç¨‹åˆ°è¾¾å±éšœã€‚ä¸€æ—¦æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœï¼Œå®ƒä»¬å°†æ‰“å°æ¶ˆæ¯å¹¶ç»§ç»­æ‰§è¡Œã€‚</p><p>åœ¨ä¸»å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯åŠ¨æ‰€æœ‰çº¿ç¨‹ï¼Œç„¶åç­‰å¾…å®ƒä»¬å®Œæˆã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>pthread_barrier_destroy</code> å‡½æ•°æ¥é”€æ¯çº¿ç¨‹å±éšœï¼Œå¹¶æ ¹æ®è¿”å›å€¼åˆ¤æ–­æ˜¯å¦æˆåŠŸé”€æ¯ã€‚</p></blockquote><h3 id="è¿è¡Œç»“æœ-4"><a href="#è¿è¡Œç»“æœ-4" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><blockquote><p>Task1 will be blocked.<br>main process will sleep 1s.<br>Task2 will be blocked.<br>Task1 is running.<br>Task2 is running.</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM_THREADS</span> <span class="token expression"><span class="token number">2</span></span></span><span class="token class-name">pthread_barrier_t</span> barrier<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">Task1</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">Task2</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> policy<span class="token punctuation">,</span> inher<span class="token punctuation">;</span>    <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span>    <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token class-name">sched_param</span> param<span class="token punctuation">;</span>    <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_barrier_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> NUM_THREADS <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> Task1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> Task2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"main process will sleep 1s.\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_barrier_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_barrier_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">Task1</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Task1 will be blocked.\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// your code here</span>    <span class="token function">pthread_barrier_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// end of your code</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Task1 is running.\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">Task2</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Task2 will be blocked.\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// your code here</span>    <span class="token function">pthread_barrier_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// end of your code</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Task2 is running.\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–è°ƒç”¨çº¿ç¨‹æ ‡è¯†å·"><a href="#è·å–è°ƒç”¨çº¿ç¨‹æ ‡è¯†å·" class="headerlink" title="è·å–è°ƒç”¨çº¿ç¨‹æ ‡è¯†å·"></a>è·å–è°ƒç”¨çº¿ç¨‹æ ‡è¯†å·</h2><p>æœ¬èŠ‚å±•ç¤ºäº†è·å–è°ƒç”¨çº¿ç¨‹æ ‡è¯†å·çš„æ–¹æ³•ã€‚</p><ul><li><code>pthread_self</code>è·å–è°ƒç”¨çº¿ç¨‹æ ‡è¯†å·</li></ul><h3 id="å‡½æ•°è¯´æ˜-5"><a href="#å‡½æ•°è¯´æ˜-5" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-none"><code class="language-none">pthread_t pthread_self(void);è¿”å›è°ƒç”¨çº¿ç¨‹æ ‡è¯†å·ï¼Œè¿”å›ç±»å‹ä¸ºpthread_t<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>pthread_t pthread_self(void);</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–å½“å‰çº¿ç¨‹æ ‡è¯†ç¬¦çš„å‡½æ•°ã€‚åœ¨Cè¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨POSIXçº¿ç¨‹åº“ï¼ˆpthreadï¼‰æ¥å®ç°å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª <code>pthread_t</code> ç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p><h3 id="è¿è¡Œç»“æœ-5"><a href="#è¿è¡Œç»“æœ-5" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><blockquote><p>main thread:  pid 1588 tid 2 (0x2)<br>new thread:  pid 1588 tid 1 (0x1)</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">printids</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>arg<span class="token punctuation">;</span>    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>    <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span>      pid <span class="token operator">=</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span>    tid <span class="token operator">=</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s pid %u tid %u (0x%x)\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>pid<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// æ·»åŠ è¿”å›è¯­å¥</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span>    <span class="token keyword">int</span> err<span class="token punctuation">;</span>        err <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> printids<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"new thread: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"can't create thread: %s\n"</span><span class="token punctuation">,</span> <span class="token function">strerror</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">printids</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"main thread: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çº¿ç¨‹å–æ¶ˆ"><a href="#çº¿ç¨‹å–æ¶ˆ" class="headerlink" title="çº¿ç¨‹å–æ¶ˆ"></a>çº¿ç¨‹å–æ¶ˆ</h2><p>pthread_cancelè°ƒç”¨å¹¶ä¸ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢ï¼Œå®ƒåªæå‡ºè¯·æ±‚ã€‚çº¿ç¨‹åœ¨å–æ¶ˆè¯·æ±‚(pthread_cancel)å‘å‡ºåä¼šç»§ç»­è¿è¡Œã€‚</p><h3 id="å‡½æ•°è¯´æ˜-6"><a href="#å‡½æ•°è¯´æ˜-6" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_cancel</span><span class="token punctuation">(</span><span class="token class-name">pthread_t</span> thread<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>int pthread_cancel(pthread_t thread);</code> ç”¨äºè¯·æ±‚å–æ¶ˆæŒ‡å®šçº¿ç¨‹ã€‚å®ƒæ¥å—ä¸€ä¸ª <code>pthread_t</code> ç±»å‹çš„å‚æ•°ï¼Œè¡¨ç¤ºè¦å–æ¶ˆçš„çº¿ç¨‹æ ‡è¯†ç¬¦ã€‚å¦‚æœæˆåŠŸå–æ¶ˆçº¿ç¨‹ï¼Œå‡½æ•°è¿”å›0ï¼›å¦åˆ™è¿”å›é”™è¯¯ç ã€‚è¿™ä¸ªå‡½æ•°å…è®¸ä¸»çº¿ç¨‹æˆ–è€…å…¶ä»–çº¿ç¨‹å‘èµ·å¯¹ç›®æ ‡çº¿ç¨‹çš„å–æ¶ˆè¯·æ±‚ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>pthread_t thread</code>ï¼šè¦å–æ¶ˆçš„çº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œå³ä½ æƒ³ç»“æŸçš„é‚£ä¸ªçº¿ç¨‹çš„å¥æŸ„ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å¦‚æœæˆåŠŸå‘é€äº†å–æ¶ˆè¯·æ±‚ï¼Œåˆ™è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œæ— æ•ˆçš„çº¿ç¨‹IDï¼‰ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><p>æ³¨æ„ï¼š</p><ol><li><p>å–æ¶ˆä¸€ä¸ªçº¿ç¨‹å¹¶ä¸æ„å‘³ç€å®ƒä¼šç«‹å³åœæ­¢æ‰§è¡Œã€‚ç›®æ ‡çº¿ç¨‹å¿…é¡»æ£€æŸ¥å¹¶å¤„ç†å–æ¶ˆè¯·æ±‚æ‰èƒ½çœŸæ­£ç»ˆæ­¢ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œçº¿ç¨‹éœ€è¦åœ¨å®‰å…¨ç‚¹æ£€æŸ¥<code>pthread_cancel</code>çŠ¶æ€ï¼Œå¹¶è°ƒç”¨<code>pthread_testcancel</code>æ¥å“åº”å–æ¶ˆè¯·æ±‚ã€‚</p></li><li><p>çº¿ç¨‹å¯ä»¥é€šè¿‡è®¾ç½®å–æ¶ˆç±»å‹ä¸º<code>PTHREAD_CANCEL_DISABLE</code>æ¥æš‚æ—¶ç¦ç”¨å–æ¶ˆï¼Œæˆ–è€…é€šè¿‡è°ƒç”¨<code>pthread_setcancelstate</code>å‡½æ•°æ”¹å˜å…¶å–æ¶ˆçŠ¶æ€ã€‚</p></li><li><p>ä¸ºäº†æ­£ç¡®åœ°æ¸…ç†èµ„æºï¼Œçº¿ç¨‹å¯ä»¥æ³¨å†Œä¸€ä¸ªå–æ¶ˆå¤„ç†å‡½æ•°(<code>pthread_cleanup_push</code>å’Œ<code>pthread_cleanup_pop</code>)ï¼Œå½“çº¿ç¨‹è¢«å–æ¶ˆæ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹çš„å–æ¶ˆç±»å‹æ˜¯<code>PTHREAD_CANCEL_DEFERRED</code>ï¼Œè¿™æ„å‘³ç€åªæœ‰åœ¨çº¿ç¨‹è¿›å…¥å–æ¶ˆç‚¹æ—¶æ‰ä¼šçœŸæ­£å–æ¶ˆã€‚è‹¥è¦ä½¿å–æ¶ˆç«‹å³ç”Ÿæ•ˆï¼Œå¯ä»¥å°†çº¿ç¨‹çš„å–æ¶ˆç±»å‹è®¾ç½®ä¸º<code>PTHREAD_CANCEL_ASYNCHRONOUS</code>ã€‚</p></li></ol><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread_function</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åœ¨è¿™é‡Œè¿›è¡Œçº¿ç¨‹ä»»åŠ¡...</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å®šæœŸæ£€æŸ¥å–æ¶ˆçŠ¶æ€</span>        <span class="token function">pthread_testcancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¿™é‡Œåšä¸€äº›å·¥ä½œ...</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_t</span> thread_id<span class="token punctuation">;</span>    <span class="token keyword">int</span> rc<span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºçº¿ç¨‹</span>    rc <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread_id<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread_function<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error: Unable to create thread, %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åœ¨æŸä¸ªæ—¶åˆ»å†³å®šå–æ¶ˆçº¿ç¨‹</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‡è®¾ç­‰å¾…ä¸€æ®µæ—¶é—´åå†³å®šå–æ¶ˆçº¿ç¨‹</span>    rc <span class="token operator">=</span> <span class="token function">pthread_cancel</span><span class="token punctuation">(</span>thread_id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>rc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error: Unable to cancel thread, %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread cancellation requested.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ç­‰å¾…è¢«å–æ¶ˆçš„çº¿ç¨‹ç»ˆæ­¢</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>thread_id<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿è¡Œç»“æœ-6"><a href="#è¿è¡Œç»“æœ-6" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><p>ä¸ºäº†æ¯”è¾ƒè¾“å‡ºç»“æœï¼Œè¯·å°†ç¯å¢ƒè®¾ç½®ä¸­çš„å¹¶è¡Œæ ¸æ•°è°ƒä¸º1ã€‚æœ¬å®éªŒæš‚ä¸æ”¯æŒæ€§èƒ½è¯„æµ‹ã€‚</p><blockquote><p>thread 1 returning<br>thread 1 exit code 1<br>thread 2 exiting<br>thread 2 exit code 2<br>thread 3 writing<br>thread 3 writing<br>thread 3 writing<br>thread 3 exit code -1</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">thr_fn1</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 1 returning\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">thr_fn2</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 2 exiting\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">thr_fn3</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        time<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 3 writing\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>time <span class="token operator">>=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token operator">*</span>retval<span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thr_fn1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 1 exit code %d\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">intptr_t</span><span class="token punctuation">)</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿®å¤ç±»å‹è½¬æ¢</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thr_fn2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 2 exit code %d\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">intptr_t</span><span class="token punctuation">)</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿®å¤ç±»å‹è½¬æ¢</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thr_fn3<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//your code here</span>    <span class="token function">pthread_cancel</span><span class="token punctuation">(</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//end of your code</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éœ€è¦å¤„ç†å–æ¶ˆåçš„çº¿ç¨‹å¯èƒ½æ²¡æœ‰æœ‰æ•ˆé€€å‡ºçŠ¶æ€çš„æƒ…å†µ</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>retval <span class="token operator">==</span> PTHREAD_CANCELED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 3 was canceled\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread 3 exit code %d\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">intptr_t</span><span class="token punctuation">)</span>retval<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œä»éœ€è¿›è¡Œæ­£ç¡®çš„ç±»å‹è½¬æ¢</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çº¿ç¨‹å±æ€§-çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»-2"><a href="#çº¿ç¨‹å±æ€§-çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»-2" class="headerlink" title="çº¿ç¨‹å±æ€§ - çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»(2)"></a>çº¿ç¨‹å±æ€§ - çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»(2)</h2><p>æœ¬èŠ‚å±•ç¤ºäº†çº¿ç¨‹è¿æ¥å’Œåˆ†ç¦»çš„åŸºæœ¬çŸ¥è¯†ã€‚</p><h3 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h3><ul><li><code>pthread_detach</code>å°†æŸä¸ªçº¿ç¨‹è®¾æˆåˆ†ç¦»æ€</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹,çº¿ç¨‹ç»ˆæ­¢å,å…¶ç»ˆæ­¢çŠ¶æ€ä¸€ç›´ä¿ç•™åˆ°å…¶å®ƒçº¿ç¨‹è°ƒç”¨pthread_joinè·å–å®ƒçš„çŠ¶æ€ä¸ºæ­¢ã€‚ä½†æ˜¯çº¿ç¨‹ä¹Ÿå¯ä»¥è¢«ç½®ä¸ºdetachçŠ¶æ€,è¿™æ ·çš„çº¿ç¨‹ä¸€æ—¦ç»ˆæ­¢å°±ç«‹åˆ»å›æ”¶å®ƒå ç”¨çš„æ‰€æœ‰èµ„æº,è€Œä¸ä¿ç•™ç»ˆæ­¢çŠ¶æ€ã€‚ä¸èƒ½å¯¹ä¸€ä¸ªå·²ç»å¤„äºdetachçŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨pthread_join,è¿™æ ·çš„è°ƒç”¨å°†è¿”å›EINVALã€‚å¦‚æœå·²ç»å¯¹ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†pthread_detachå°±ä¸èƒ½å†è°ƒç”¨pthread_joinäº†ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè‹¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä¸å…³å¿ƒå®ƒçš„è¿”å›å€¼,ä¹Ÿä¸æƒ³ä½¿ç”¨pthread_joinæ¥å›æ”¶èµ„æº(è°ƒç”¨pthread_joinçš„è¿›ç¨‹ä¼šé˜»å¡)ï¼Œå°±å¯ä»¥ä½¿ç”¨pthread_detach,å°†è¯¥çº¿ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºåˆ†ç¦»æ€,ä½¿çº¿ç¨‹ç»“æŸå,ç«‹å³è¢«ç³»ç»Ÿå›æ”¶ã€‚<br>ä¸»çº¿ç¨‹é€€å‡ºäº†ï¼Œâ€œåˆ†ç¦»çº¿ç¨‹â€è¿˜æ˜¯ä¸€æ ·é€€å‡ºã€‚åªæ˜¯â€œåˆ†ç¦»çº¿ç¨‹â€çš„èµ„æºæ˜¯æœ‰ç³»ç»Ÿå›æ”¶çš„ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-7"><a href="#å‡½æ•°è¯´æ˜-7" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>å°†æŸä¸ªçº¿ç¨‹è®¾æˆåˆ†ç¦»æ€</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_detach</span><span class="token punctuation">(</span><span class="token class-name">pthread_t</span> tid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">pthread_t</span> tid<span class="token operator">:</span>ã€€ã€€åˆ†ç¦»çº¿ç¨‹çš„tidè¿”å›å€¼<span class="token operator">:</span>æˆåŠŸè¿”å›<span class="token number">0</span><span class="token punctuation">,</span>å¤±è´¥è¿”å›é”™è¯¯å·ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>pthread_detach</code>æ˜¯POSIXçº¿ç¨‹åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ªå·²åˆ›å»ºçš„çº¿ç¨‹ä»å…¶åˆ›å»ºè€…åˆ†ç¦»ï¼ˆdetachï¼‰ã€‚</p><p>å‡½æ•°åŸå‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_detach</span><span class="token punctuation">(</span><span class="token class-name">pthread_t</span> tid<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>pthread_t tid</code>ï¼šè¿™æ˜¯è¦åˆ†ç¦»çš„çº¿ç¨‹çš„æ ‡è¯†ç¬¦ã€‚åœ¨åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œpthread_createå‡½æ•°ä¼šè¿”å›è¿™ä¸ªtidï¼Œä»£è¡¨æ–°åˆ›å»ºçš„çº¿ç¨‹ã€‚</li></ul><p>å‡½æ•°åŠŸèƒ½ï¼š<br>å½“ä¸€ä¸ªçº¿ç¨‹è¢«åˆ†ç¦»åï¼Œå…¶èµ„æºï¼ˆå¦‚æ ˆç©ºé—´ç­‰ï¼‰å°†åœ¨è¯¥çº¿ç¨‹ç»ˆæ­¢æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œæ— éœ€è°ƒç”¨pthread_joinå‡½æ•°ç­‰å¾…å…¶å®Œæˆã€‚è¿™æ„å‘³ç€åˆ†ç¦»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œä¸ä¼šä¿ç•™joinableçŠ¶æ€ï¼Œå› æ­¤ä¸»çº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹æ— æ³•é€šè¿‡pthread_joinæ¥è·å–å…¶è¿”å›å€¼æˆ–ç¡®ä¿å®ƒå·²ç»ç»“æŸã€‚</p><p>è¿”å›å€¼ï¼š</p><ul><li>è‹¥æˆåŠŸåˆ†ç¦»çº¿ç¨‹ï¼Œåˆ™è¿”å›0ã€‚</li><li>è‹¥å‡ºé”™ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ç¼–å·ï¼Œå…·ä½“é”™è¯¯ä¿¡æ¯å¯é€šè¿‡errnoè·å–ã€‚</li></ul><p>åˆ†ç¦»çº¿ç¨‹çš„ä¸»è¦ç”¨é€”æ˜¯åœ¨ä¸å…³å¿ƒçº¿ç¨‹é€€å‡ºçŠ¶æ€å’Œè¿”å›å€¼çš„æƒ…å†µä¸‹ï¼Œå‡è½»ä¸»çº¿ç¨‹å¯¹å­çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„è´Ÿæ‹…ã€‚</p><h3 id="è¾“å‡ºç»“æœ-1"><a href="#è¾“å‡ºç»“æœ-1" class="headerlink" title="è¾“å‡ºç»“æœ"></a>è¾“å‡ºç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">thread1 running...!thread1 running...!thread1 running...!thread1 running...!thread1 running...!thread1 running...!thread1 running...!thread1 running...!thread1 running...!Leave main thread!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h3><p>ç”±äºå¹¶è¡Œç¨‹åºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œä½ çš„ç»“æœå¯èƒ½å’Œè¿™ä¸ªç»“æœä¸ä¸€è‡´ã€‚</p><p>åœ¨ç»™å‡ºçš„ä»£ç ä¸­ï¼Œ<code>thread1</code>å‡½æ•°æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„çº¿ç¨‹ï¼Œå› æ­¤å®é™…ä¸Šè°ƒç”¨<code>pthread_detach</code>ä¹‹åä¸»çº¿ç¨‹æ— æ³•å¾—çŸ¥<code>thread1</code>ä½•æ—¶ç»“æŸã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†ç¦»çº¿ç¨‹çš„æ„ä¹‰åœ¨äºä¸»çº¿ç¨‹ç»“æŸåï¼Œå³ä½¿æœªè°ƒç”¨<code>pthread_join</code>ï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾<code>thread1</code>æ‰€å ç”¨çš„èµ„æºã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token comment">// å®šä¹‰çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread1</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// è¿™æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„çº¿ç¨‹</span>    <span class="token punctuation">&#123;</span>        <span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æš‚åœ100æ¯«ç§’</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread1 running...!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å®é™…ä¸Šç”±äºæ˜¯æ— é™å¾ªç¯ï¼Œä¸‹é¢è¿™è¡Œä»£ç å¯èƒ½æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Leave thread1!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºçº¿ç¨‹æ ‡è¯†ç¬¦</span>    <span class="token comment">// åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pthread_create failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åˆ†ç¦»çº¿ç¨‹ï¼Œä½¿å…¶åœ¨å®Œæˆåè‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œæ— éœ€ç­‰å¾…ä¸»çº¿ç¨‹è°ƒç”¨pthread_join</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_detach</span><span class="token punctuation">(</span>tid<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pthread_detach failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸»çº¿ç¨‹æš‚åœ1ç§’</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Leave main thread! (The detached thread 'thread1' will continue to run in the background.)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ®µä»£ç ä¸­ï¼Œå¢åŠ äº†å¯¹<code>pthread_create</code>å’Œ<code>pthread_detach</code>é”™è¯¯å¤„ç†çš„éƒ¨åˆ†ï¼Œä½¿å¾—ç¨‹åºåœ¨åˆ›å»ºæˆ–åˆ†ç¦»çº¿ç¨‹å¤±è´¥æ—¶èƒ½å¤Ÿæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºã€‚åŒæ—¶ï¼Œä¸»çº¿ç¨‹è¾“å‡ºä¿¡æ¯ä¹Ÿè¯´æ˜äº†detachçº¿ç¨‹åçš„æƒ…å†µã€‚</p><h2 id="æ¯”è¾ƒçº¿ç¨‹æ ‡è¯†å·"><a href="#æ¯”è¾ƒçº¿ç¨‹æ ‡è¯†å·" class="headerlink" title="æ¯”è¾ƒçº¿ç¨‹æ ‡è¯†å·"></a>æ¯”è¾ƒçº¿ç¨‹æ ‡è¯†å·</h2><p>æœ¬èŠ‚ä»‹ç»äº†æ¯”è¾ƒä¸¤ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ ‡è¯†ç¬¦æ˜¯å¦ç›¸åŒçš„æ–¹æ³•ã€‚</p><p>çº¿ç¨‹æ ‡è¯†å·çš„ç±»å‹ä¸ºpthread_tï¼Œæ˜¯ä¸é€æ˜ç±»å‹ã€‚ä¸ºäº†ä½¿ç¨‹åºæ›´å®¹æ˜“ç§»æ¤ï¼ŒPthreadsæä¾›äº†å¯¹ä¸¤ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ ‡è¯†å·è¿›è¡Œæ¯”è¾ƒçš„å‡½æ•°ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-8"><a href="#å‡½æ•°è¯´æ˜-8" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>æ¯”è¾ƒä¸¤ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ ‡è¯†ç¬¦æ˜¯å¦ç›¸åŒ</p><p><code>pthread_equal</code>ç”¨äºæ¯”è¾ƒä¸¤ä¸ªçº¿ç¨‹çš„æ ‡è¯†ç¬¦æ˜¯å¦ç›¸åŒ</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_equal</span><span class="token punctuation">(</span><span class="token class-name">pthread_t</span> t1<span class="token punctuation">,</span> <span class="token class-name">pthread_t</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>pthread_t t1</code>ï¼šç¬¬ä¸€ä¸ªçº¿ç¨‹æ ‡è¯†ç¬¦ã€‚</li><li><code>pthread_t t2</code>ï¼šç¬¬äºŒä¸ªçº¿ç¨‹æ ‡è¯†ç¬¦ã€‚</li></ul><p>è¯¥å‡½æ•°æ¯”è¾ƒ<code>t1</code>å’Œ<code>t2</code>ä¸¤ä¸ªçº¿ç¨‹æ ‡è¯†ç¬¦æ˜¯å¦æŒ‡å‘åŒä¸€çº¿ç¨‹ã€‚å¦‚æœä¸¤è€…æŒ‡å‘åŒä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™è¿”å›éé›¶å€¼ï¼ˆé€šå¸¸ä¸º1ï¼‰ï¼Œå¦åˆ™è¿”å›0ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š<br>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæœ‰æ—¶éœ€è¦ç¡®å®šä¸¤ä¸ªçº¿ç¨‹æ ‡è¯†ç¬¦æ˜¯å¦å¯¹åº”äºåŒä¸€ä¸ªçº¿ç¨‹å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œåœ¨åŒæ­¥æˆ–é€šä¿¡æ“ä½œä¸­ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ä¸æŸä¸ªç‰¹å®šçš„å·²çŸ¥çº¿ç¨‹ç›¸åŒ¹é…ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">pthread_t</span> tid1<span class="token punctuation">,</span> tid2<span class="token punctuation">;</span><span class="token comment">// å‡è®¾tid1å’Œtid2æ˜¯ä»pthread_createå¾—åˆ°çš„ä¸åŒçº¿ç¨‹çš„æ ‡è¯†ç¬¦</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread_function1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ›å»ºçº¿ç¨‹æˆåŠŸ</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread_function2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ›å»ºçº¿ç¨‹æˆåŠŸ</span><span class="token punctuation">&#125;</span><span class="token comment">// æ£€æŸ¥tid1å’Œtid2æ˜¯å¦ä»£è¡¨åŒä¸€ä¸ªçº¿ç¨‹</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_equal</span><span class="token punctuation">(</span>tid1<span class="token punctuation">,</span> tid2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"tid1 and tid2 represent the same thread.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"tid1 and tid2 represent different threads.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>pthread_equal(tid1, tid2)</code>å°†è¿”å›0ï¼Œå› ä¸ºå®ƒä»¬åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªä¸åŒçº¿ç¨‹ã€‚</p><h3 id="è¿è¡Œç»“æœ-7"><a href="#è¿è¡Œç»“æœ-7" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">Thread ID: 1.Equal!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_t</span> thread_id<span class="token punctuation">;</span>    <span class="token comment">// è·å–å½“å‰çº¿ç¨‹ID</span>    thread_id <span class="token operator">=</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread ID: %lu.\n"</span><span class="token punctuation">,</span> thread_id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ£€æŸ¥ä¸¤æ¬¡è·å–çš„çº¿ç¨‹IDæ˜¯å¦ç›¸åŒï¼ˆç†è®ºä¸Šå®ƒä»¬åº”è¯¥æ€»æ˜¯ç›¸åŒçš„ï¼‰</span>    <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token function">pthread_equal</span><span class="token punctuation">(</span>thread_id<span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span>      <span class="token punctuation">&#123;</span>          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The Thread IDs are equal, as expected!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unexpected: The Thread IDs are not equal!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="çº¿ç¨‹ç§æœ‰æ•°æ®"><a href="#çº¿ç¨‹ç§æœ‰æ•°æ®" class="headerlink" title="çº¿ç¨‹ç§æœ‰æ•°æ®"></a>çº¿ç¨‹ç§æœ‰æ•°æ®</h2><p>æœ¬èŠ‚å±•ç¤ºäº†çº¿ç¨‹ç§æœ‰æ•°æ®çš„ç›¸å…³æ–¹æ³•ã€‚</p><p><code>pthread_key_create</code>ã€<code>pthread_setspecific</code>ã€<code>pthread_getspecific</code>å’Œ<code>pthread_key_delete</code>è¿™ä¸€ç³»åˆ—å‡½æ•°ä¸»è¦ç”¨äºç®¡ç†çº¿ç¨‹ç‰¹å®šçš„æ•°æ®ï¼ˆThread-Specific Data, TSDï¼‰ï¼Œä¹Ÿç§°ä¸ºçº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread-Local Storage, TLSï¼‰</p><ul><li><code>pthread_key_create</code>åˆ›å»ºä¸€ä¸ªé”®</li><li><code>pthread_setspecific</code>ä¸ºä¸€ä¸ªé”®è®¾ç½®çº¿ç¨‹ç§æœ‰æ•°æ®</li><li><code>pthread_getspecific</code>ä»ä¸€ä¸ªé”®è¯»å–çº¿ç¨‹ç§æœ‰æ•°æ®</li><li><code>pthread_key_delete</code>åˆ é™¤ä¸€ä¸ªé”®</li></ul><p>åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œè¿›ç¨‹å†…çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è¿›ç¨‹çš„æ•°æ®ç©ºé—´ã€‚å› æ­¤å…¨å±€å˜é‡ä¸ºæ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­æœ‰æ—¶éœ€è¦ä¿å­˜çº¿ç¨‹è‡ªå·±çš„å…¨å±€å˜é‡ï¼Œè¿™ç§ç‰¹æ®Šçš„å˜é‡ä»…åœ¨çº¿ç¨‹å†…éƒ¨æœ‰æ•ˆã€‚<br>çº¿ç¨‹ç§æœ‰æ•°æ®é‡‡ç”¨äº†ä¸€é”®å¤šå€¼çš„æŠ€æœ¯ï¼Œå³ä¸€ä¸ªé”®å¯¹åº”å¤šä¸ªå€¼ã€‚è®¿é—®æ•°æ®æ—¶éƒ½æ˜¯é€šè¿‡é”®å€¼æ¥è®¿é—®ï¼Œå¥½åƒæ˜¯å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œè®¿é—®ï¼Œå…¶å®æ˜¯åœ¨è®¿é—®ä¸åŒçš„æ•°æ®ã€‚</p><h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h3><p>1ã€åˆ›å»ºä¸€ä¸ªé”®<br>2ã€ä¸ºä¸€ä¸ªé”®è®¾ç½®çº¿ç¨‹ç§æœ‰æ•°æ®<br>3ã€ä»ä¸€ä¸ªé”®è¯»å–çº¿ç¨‹ç§æœ‰æ•°æ®void *pthread_getspecific(pthread_key_t key);<br>4ã€çº¿ç¨‹é€€å‡ºï¼ˆé€€å‡ºæ—¶ï¼Œä¼šè°ƒç”¨destructoré‡Šæ”¾åˆ†é…çš„ç¼“å­˜ï¼Œå‚æ•°æ˜¯keyæ‰€å…³è”çš„æ•°æ®ï¼‰<br>5ã€åˆ é™¤ä¸€ä¸ªé”®</p><h3 id="å‡½æ•°è¯´æ˜-9"><a href="#å‡½æ•°è¯´æ˜-9" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>åˆ›å»ºä¸€ä¸ªé”®</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_key_create</span><span class="token punctuation">(</span><span class="token class-name">pthread_key_t</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>destructor<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>pthread_key_create(pthread_key_t *key, void (*destructor)(void*))c</code></p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŒ‡å‘ä¸€ä¸ªé”®å€¼çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡æ˜äº†ä¸€ä¸ªdestructorå‡½æ•°ï¼Œ<br>å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå½“æ¯ä¸ªçº¿ç¨‹ç»“æŸæ—¶ï¼Œç³»ç»Ÿå°†è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥é‡Šæ”¾ç»‘å®šåœ¨è¿™ä¸ªé”®ä¸Šçš„å†…å­˜å—ã€‚<br>keyä¸€æ—¦è¢«åˆ›å»ºï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å®ƒï¼Œä½†å„çº¿ç¨‹å¯æ ¹æ®è‡ªå·±çš„éœ€è¦å¾€keyä¸­å¡«å…¥ä¸åŒçš„å€¼ï¼Œè¿™å°±ç›¸å½“äºæä¾›äº†ä¸€ä¸ªåŒåè€Œä¸åŒå€¼çš„å…¨å±€å˜é‡ï¼Œä¸€é”®å¤šå€¼ã€‚</li><li>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç§æœ‰æ•°æ®é”®ã€‚å‚æ•°<code>key</code>æ˜¯ä¸€ä¸ªæŒ‡å‘pthread_key_tç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨åˆ›å»ºçš„é”®å€¼ï¼›<code>destructor</code>æ˜¯ä¸€ä¸ªå¯é€‰çš„æ¸…ç†å‡½æ•°ï¼Œå½“å…³è”æ­¤é”®çš„çº¿ç¨‹ç»ˆæ­¢æ—¶ï¼Œè¯¥å‡½æ•°ä¼šè¢«è°ƒç”¨æ¥é‡Šæ”¾åˆ†é…ç»™è¿™ä¸ªé”®çš„ç§æœ‰æ•°æ®ã€‚</li></ul><p>ä¸ºä¸€ä¸ªé”®è®¾ç½®çº¿ç¨‹ç§æœ‰æ•°æ®</p><pre class="line-numbers language-none"><code class="language-none">int pthread_setspecific(pthread_key_t key,const void *pointer));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>pthread_setspecific(pthread_key_t key, const void *value)</code></p><ul><li>ä¸ºæŒ‡å®šçš„é”®è®¾ç½®çº¿ç¨‹ç§æœ‰æ•°æ®ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ä¸ºåŒä¸€ä¸ªé”®è®¾ç½®ä¸åŒçš„å€¼ï¼Œäº’ä¸å½±å“ã€‚å‚æ•°<code>key</code>æ˜¯é€šè¿‡<code>pthread_key_create</code>åˆ›å»ºçš„é”®ï¼Œ<code>value</code>æ˜¯è¦å…³è”åˆ°æ­¤é”®çš„ç§æœ‰æ•°æ®æŒ‡é’ˆã€‚</li></ul><p>ä»ä¸€ä¸ªé”®è¯»å–çº¿ç¨‹ç§æœ‰æ•°æ®</p><pre class="line-numbers language-none"><code class="language-none">void *pthread_getspecific(pthread_key_t key);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>void* pthread_getspecific(pthread_key_t key)</code></p><ul><li>æ ¹æ®æŒ‡å®šçš„é”®è·å–å½“å‰çº¿ç¨‹å…³è”çš„ç§æœ‰æ•°æ®ã€‚è¿”å›ä¸é”®å…³è”çš„çº¿ç¨‹ç‰¹å®šæ•°æ®çš„æŒ‡é’ˆã€‚</li></ul><p>åˆ é™¤ä¸€ä¸ªé”®</p><pre class="line-numbers language-none"><code class="language-none">int pthread_key_delete(pthread_key_t key);åˆ é™¤åï¼Œé”®æ‰€å ç”¨çš„å†…å­˜å°†è¢«é‡Šæ”¾ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>int pthread_key_delete(pthread_key_t key)</code></p><ul><li>åˆ é™¤å·²åˆ›å»ºçš„çº¿ç¨‹ç§æœ‰æ•°æ®é”®ã€‚ä¸€æ—¦é”®è¢«åˆ é™¤ï¼Œæ‰€æœ‰çº¿ç¨‹ä¸è¯¥é”®å…³è”çš„ç§æœ‰æ•°æ®éƒ½å°†å¤±æ•ˆï¼Œå¦‚æœä¹‹å‰è®¾ç½®äº†æ¸…ç†å‡½æ•°ï¼Œä¼šåœ¨æœ€åä¸€ä¸ªä¸è¯¥é”®å…³è”çš„çº¿ç¨‹ç»“æŸæ—¶æ‰§è¡Œã€‚</li></ul><h3 id="ä¸¾ä¾‹è¯´æ˜ï¼š"><a href="#ä¸¾ä¾‹è¯´æ˜ï¼š" class="headerlink" title="ä¸¾ä¾‹è¯´æ˜ï¼š"></a>ä¸¾ä¾‹è¯´æ˜ï¼š</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">static</span> <span class="token class-name">pthread_key_t</span> thread_data_key<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">cleanup_thread_data</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread_function</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span><span class="token operator">*</span> data <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹åŒ–ç§æœ‰æ•°æ®</span>    <span class="token function">pthread_setspecific</span><span class="token punctuation">(</span>thread_data_key<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åœ¨çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥éšæ—¶é€šè¿‡é”®è®¿é—®è‡ªå·±çš„ç§æœ‰æ•°æ®</span>    <span class="token keyword">int</span><span class="token operator">*</span> my_data <span class="token operator">=</span> <span class="token function">pthread_getspecific</span><span class="token punctuation">(</span>thread_data_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread private data: %d\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>my_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_key_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread_data_key<span class="token punctuation">,</span> cleanup_thread_data<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pthread_key_create"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread_function<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç­‰å¾…å­çº¿ç¨‹ç»“æŸ</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼Œä¸å­çº¿ç¨‹äº’ä¸å½±å“</span>    <span class="token comment">// ...</span>    <span class="token comment">// æœ€ååˆ é™¤é”®</span>    <span class="token function">pthread_key_delete</span><span class="token punctuation">(</span>thread_data_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºã€è®¾ç½®ã€è·å–ä»¥åŠåˆ é™¤çº¿ç¨‹ç§æœ‰æ•°æ®ã€‚æ¯ä¸ªçº¿ç¨‹é€šè¿‡<code>pthread_setspecific</code>ä¿å­˜è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»»ä½•æ—¶å€™é€šè¿‡<code>pthread_getspecific</code>æ¥è®¿é—®è¿™äº›æ•°æ®ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ã€‚å½“çº¿ç¨‹ç»“æŸæ—¶ï¼Œè‹¥å®šä¹‰äº†æ¸…ç†å‡½æ•°ï¼Œä¼šè‡ªåŠ¨æ¸…ç†å…¶ç§æœ‰æ•°æ®ã€‚</p><h3 id="è¿è¡Œç»“æœ-8"><a href="#è¿è¡Œç»“æœ-8" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">main thread:1 is runningthread:2 is runningthread:2 return 1thread:3 is runningthread:3 return 2thread:1 return 0main thread exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token class-name">pthread_key_t</span> key1<span class="token punctuation">;</span><span class="token class-name">pthread_key_t</span> key2<span class="token punctuation">;</span><span class="token class-name">pthread_t</span> thid1<span class="token punctuation">;</span><span class="token class-name">pthread_t</span> thid2<span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread:%lu is running\n"</span><span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> key_va <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token function">pthread_setspecific</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>key_va<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thid2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>thid2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ·»åŠ äº†å¯¹çº¿ç¨‹2çš„ç­‰å¾…ï¼Œç¡®ä¿å…¶æ‰§è¡Œå®Œæ¯•åå†è¿”å›</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread:%lu return %d\n"</span><span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">pthread_getspecific</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread:%lu is running\n"</span><span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> key_va <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token function">pthread_setspecific</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>key_va<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread:%lu return %d\n"</span><span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">pthread_getspecific</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// æ·»åŠ äº†è¿”å›è¯­å¥ä»¥æ¶ˆé™¤ç¼–è¯‘è­¦å‘Š</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"main thread:%lu is running\n"</span><span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_key_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>key1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_key_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>key2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thid1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">pthread_join</span><span class="token punctuation">(</span>thid1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_key_delete</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_key_delete</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"main thread exit\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h2><p>æœ¬èŠ‚å±•ç¤ºäº†è¯»å†™é”çš„ç›¸å…³æ–¹æ³•ã€‚</p><h3 id="åŸºæœ¬çŸ¥è¯†-1"><a href="#åŸºæœ¬çŸ¥è¯†-1" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h3><p>è¯»å†™é”ä¸äº’æ–¥é‡ç±»ä¼¼ï¼Œä¸è¿‡è¯»å†™é”å…è®¸æ›´é«˜çš„å¹¶è¡Œæ€§ã€‚äº’æ–¥é‡è¦ä¹ˆæ˜¯é”ä½çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯ä¸åŠ é”çŠ¶æ€ï¼Œè€Œä¸”ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶åŠ é”ã€‚<br>è¯»å†™é”å¯ä»¥æœ‰ä¸‰ç§çŠ¶æ€ï¼šè¯»æ¨¡å¼ä¸‹åŠ é”çŠ¶æ€ï¼Œå†™æ¨¡å¼ä¸‹åŠ é”çŠ¶æ€ï¼Œä¸åŠ é”çŠ¶æ€ã€‚ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™æ¨¡å¼çš„è¯»å†™é”ï¼Œä½†æ˜¯å¤šä¸ªçº¿ç¨‹å¯ç”¨åŒæ—¶å æœ‰è¯»æ¨¡å¼çš„è¯»å†™é”ã€‚<br>è¯»å†™é”ä¹Ÿå«åšå…±äº«-ç‹¬å é”ï¼Œå½“è¯»å†™é”ä»¥è¯»æ¨¡å¼é”ä½æ—¶ï¼Œå®ƒæ˜¯ä»¥å…±äº«æ¨¡å¼é”ä½çš„ï¼Œå½“å®ƒä»¥å†™æ¨¡å¼é”ä½æ—¶ï¼Œå®ƒæ˜¯ä»¥ç‹¬å æ¨¡å¼é”ä½çš„ã€‚</p><ol><li>å½“è¯»å†™é”æ˜¯å†™åŠ é”çŠ¶æ€æ—¶ï¼Œåœ¨è¿™ä¸ªé”è¢«è§£é”ä¹‹å‰ï¼Œæ‰€æœ‰è¯•å›¾å¯¹è¿™ä¸ªé”åŠ é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼›</li><li>å½“è¯»å†™é”åœ¨è¯»åŠ é”çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰è¯•å›¾ä»¥è¯»æ¨¡å¼å¯¹å®ƒè¿›è¡ŒåŠ é”çš„çº¿ç¨‹éƒ½å¯ä»¥å¾—åˆ°è®¿é—®æƒï¼Œä½†æ˜¯ä»¥å†™æ¨¡å¼å¯¹å®ƒè¿›è¡Œæ·é”çš„çº¿ç¨‹å°†é˜»å¡ï¼›</li><li>å½“è¯»å†™é”åœ¨è¯»æ¨¡å¼é”çŠ¶æ€æ—¶ï¼Œå¦‚æœæœ‰å¦å¤–çº¿ç¨‹è¯•å›¾ä»¥å†™æ¨¡å¼åŠ é”ï¼Œè¯»å†™é”é€šå¸¸ä¼šé˜»å¡éšåçš„è¯»æ¨¡å¼é”è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥é¿å…è¯»æ¨¡å¼é”é•¿æœŸå ç”¨ï¼Œè€Œç­‰å¾…çš„å†™æ¨¡å¼é”è¯·æ±‚é•¿æœŸé˜»å¡ï¼›</li></ol><ul><li><p><code>pthread_rwlock_init</code>åˆ›å»ºé”</p></li><li><p><code>pthread_rwlock_destroy</code>é”€æ¯é”</p></li><li><p><code>pthread_rwlock_rdlock</code>è·å–ä¸€ä¸ªè¯»å‡ºé”</p></li><li><p><code>pthread_rwlock_wrlock</code>è·å–ä¸€ä¸ªå†™å…¥é”</p></li><li><p><code>pthread_rwlock_unlock</code>é‡Šæ”¾ä¸€ä¸ªå†™å…¥é”æˆ–è€…è¯»å‡ºé”</p></li><li><p><code>pthread_rwlock_tryrdlock</code>éé˜»å¡è·å¾—è¯»é”</p></li><li><p><code>pthread_rwlock_trywrlock</code>éé˜»å¡è·å¾—å†™é”</p></li></ul><p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œè¯»å†™é”ï¼ˆä¹Ÿç§°ä¸ºè¯»-å†™é”æˆ–å…±äº«-ç‹¬å é”ï¼‰æ˜¯ä¸€ç§èƒ½å¤Ÿæä¾›æ›´ç»†ç²’åº¦æ§åˆ¶çš„åŒæ­¥æœºåˆ¶ã€‚å®ƒå…è®¸ä¸€ä¸ªèµ„æºåœ¨åŒä¸€æ—¶é—´è¢«å¤šä¸ªè¯»è€…çº¿ç¨‹åŒæ—¶è¯»å–ï¼Œä½†åœ¨ä»»ä½•æ—¶å€™åªå…è®¸ä¸€ä¸ªå†™è€…çº¿ç¨‹è¿›è¡Œå†™å…¥æ“ä½œã€‚è¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿå¹¶å‘æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨è¯»å¤šå†™å°‘çš„æƒ…å†µä¸‹ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨è¯»å†™é”çš„åŸºæœ¬æ“ä½œç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token class-name">pthread_rwlock_t</span> rwlock<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">initialize_rwlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_rwlock_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">read_lock_and_operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_rwlock_rdlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åœ¨è¿™é‡Œæ‰§è¡Œè¯»å–æ“ä½œ</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Reading from a shared resource by thread %lu.\n"</span><span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">write_lock_and_operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åœ¨è¿™é‡Œæ‰§è¡Œå†™å…¥æ“ä½œ</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Writing to the shared resource by thread %lu.\n"</span><span class="token punctuation">,</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ›´æ–°å…±äº«èµ„æº...</span>    <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">destroy_rwlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_rwlock_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">initialize_rwlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºå¹¶å¯åŠ¨å¤šä¸ªè¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹</span>    <span class="token comment">// ä¾‹å¦‚ï¼š</span>    <span class="token class-name">pthread_t</span> reader_thread<span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>reader_thread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>read_lock_and_operation<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">pthread_t</span> writer_thread<span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>writer_thread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>write_lock_and_operation<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>reader_thread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>writer_thread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">destroy_rwlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦å¤–ï¼Œ<code>pthread_rwlock_tryrdlock</code> å’Œ <code>pthread_rwlock_trywrlock</code> å‡½æ•°æä¾›äº†éé˜»å¡ç‰ˆæœ¬çš„è¯»å†™é”è·å–æ“ä½œï¼Œå¦‚æœæ— æ³•ç«‹å³è·å–é”ï¼Œåˆ™è¿”å›é”™è¯¯è€Œéé˜»å¡ç­‰å¾…ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_rwlock_tryrdlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æˆåŠŸè·å–è¯»é”ï¼Œæ‰§è¡Œè¯»å–æ“ä½œ</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// é”ä¸å¯ç”¨ï¼Œé‡‡å–ç›¸åº”ç­–ç•¥ï¼ˆå¦‚ï¼šç¨åé‡è¯•ã€åˆ‡æ¢è‡³å…¶ä»–ä»»åŠ¡ç­‰ï¼‰</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_rwlock_trywrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æˆåŠŸè·å–å†™é”ï¼Œæ‰§è¡Œå†™å…¥æ“ä½œ</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// é”ä¸å¯ç”¨ï¼Œé‡‡å–ç›¸åº”ç­–ç•¥</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡åˆç†åˆ©ç”¨è¯»å†™é”ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…ä¸å¿…è¦çš„çº¿ç¨‹é˜»å¡ï¼Œä»è€Œæå‡ç¨‹åºçš„å¹¶å‘æ€§å’Œæ•´ä½“æ€§èƒ½ã€‚</p><h4 id="åˆ›å»ºä¸é”€æ¯é”"><a href="#åˆ›å»ºä¸é”€æ¯é”" class="headerlink" title="åˆ›å»ºä¸é”€æ¯é”"></a>åˆ›å»ºä¸é”€æ¯é”</h4><p><code>pthread_rwlock_init</code>å’Œ<code>pthread_rwlock_destroy</code>æ˜¯POSIXçº¿ç¨‹åº“ä¸­çš„è¯»å†™é”åˆå§‹åŒ–å’Œé”€æ¯å‡½æ•°ã€‚</p><ol><li><p><strong>pthread_rwlock_init</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_rwlock_init</span><span class="token punctuation">(</span><span class="token class-name">pthread_rwlock_t</span> <span class="token operator">*</span>rwlock<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">pthread_rwlockattr_t</span> <span class="token operator">*</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åŠŸèƒ½ï¼šåˆå§‹åŒ–ä¸€ä¸ªè¯»å†™é”å˜é‡ã€‚è¿™ä¸ªå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„è¯»å†™é”ï¼Œä½¿å®ƒå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹ç”¨æ¥åŒæ­¥å¯¹å…±äº«èµ„æºçš„è¯»å†™è®¿é—®ã€‚</li><li>å‚æ•°ï¼š<ul><li><code>pthread_rwlock_t *rwlock</code>ï¼šæŒ‡å‘è¯»å†™é”å¯¹è±¡çš„æŒ‡é’ˆï¼Œéœ€è¦å…ˆå£°æ˜å¹¶åˆå§‹åŒ–ä¸ºNULLã€‚</li><li><code>const pthread_rwlockattr_t *attr</code>ï¼šæŒ‡å‘è¯»å†™é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆï¼Œå¯ä»¥è®¾ç½®é”çš„ä¸€äº›é«˜çº§ç‰¹æ€§ï¼ˆå¦‚è¿›ç¨‹é—´å…±äº«ç­‰ï¼‰ã€‚å¦‚æœä¸éœ€è¦ç‰¹æ®Šå±æ€§ï¼Œé€šå¸¸ä¼ å…¥NULLå³å¯ä½¿ç”¨é»˜è®¤å±æ€§ã€‚</li></ul></li></ul></li><li><p><strong>pthread_rwlock_destroy</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_rwlock_destroy</span><span class="token punctuation">(</span><span class="token class-name">pthread_rwlock_t</span> <span class="token operator">*</span>rwptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åŠŸèƒ½ï¼šé”€æ¯å·²ç»åˆå§‹åŒ–è¿‡çš„è¯»å†™é”ã€‚åœ¨ä¸å†éœ€è¦ä½¿ç”¨è¯»å†™é”ï¼Œå¹¶ä¸”æ‰€æœ‰çº¿ç¨‹éƒ½å·²è§£é”çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ­¤å‡½æ•°æ¥é‡Šæ”¾ä¸è¯¥é”å…³è”çš„ç³»ç»Ÿèµ„æºã€‚</li><li>å‚æ•°ï¼š<ul><li><code>pthread_rwlock_t *rwptr</code>ï¼šæŒ‡å‘ä¹‹å‰é€šè¿‡<code>pthread_rwlock_init</code>æˆåŠŸåˆå§‹åŒ–è¿‡çš„è¯»å†™é”å¯¹è±¡çš„æŒ‡é’ˆã€‚</li></ul></li></ul></li></ol><p>æ­£ç¡®ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">pthread_rwlock_t</span> my_rwlock<span class="token punctuation">;</span><span class="token comment">// åˆå§‹åŒ–è¯»å†™é”</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_rwlock_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>my_rwlock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pthread_rwlock_init failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä½¿ç”¨è¯»å†™é”è¿›è¡ŒåŒæ­¥...</span><span class="token comment">// ...</span><span class="token comment">// åœ¨ä¸å†éœ€è¦è¯»å†™é”æ—¶é”€æ¯å®ƒ</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_rwlock_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>my_rwlock<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pthread_rwlock_destroy failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å¤„ç†é”™è¯¯æˆ–é€‰æ‹©å¿½ç•¥ï¼ˆå–å†³äºç¨‹åºé€»è¾‘ï¼‰</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼šåœ¨é”€æ¯è¯»å†™é”å‰ï¼Œå¿…é¡»ç¡®ä¿æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ­£æŒæœ‰è¯¥é”ï¼ˆæ— è®ºæ˜¯è¯»é”è¿˜æ˜¯å†™é”ï¼‰ï¼Œå¦åˆ™<code>pthread_rwlock_destroy</code>ä¼šå¤±è´¥å¹¶è¿”å›é”™è¯¯ã€‚</p><h4 id="è·å–å’Œé‡Šæ”¾é”"><a href="#è·å–å’Œé‡Šæ”¾é”" class="headerlink" title="è·å–å’Œé‡Šæ”¾é”"></a>è·å–å’Œé‡Šæ”¾é”</h4><ol><li><p><strong>pthread_rwlock_rdlock</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_rwlock_rdlock</span><span class="token punctuation">(</span><span class="token class-name">pthread_rwlock_t</span> <span class="token operator">*</span>rwptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åŠŸèƒ½ï¼šå¯¹ç»™å®šçš„è¯»å†™é”ï¼ˆ<code>rwptr</code>ï¼‰è¿›è¡Œè¯»å–é”å®šã€‚å½“è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰å†™å…¥é”ï¼Œå¹¶ä¸”æ²¡æœ‰æ­£åœ¨ç­‰å¾…è·å–å†™å…¥é”çš„çº¿ç¨‹ï¼Œåˆ™å½“å‰çº¿ç¨‹å¯ä»¥è·å¾—è¯»å–é”å¹¶å¼€å§‹è¯»å–å…±äº«èµ„æºã€‚å¦‚æœæœ‰å†™å…¥é”è¢«æŒæœ‰æˆ–æœ‰çº¿ç¨‹åœ¨ç­‰å¾…å†™å…¥é”ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°ä¼šé˜»å¡ç›´åˆ°å¯ä»¥è·å–è¯»å–é”ã€‚</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå‡ºé”™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul></li><li><p><strong>pthread_rwlock_wrlock</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token class-name">pthread_rwlock_t</span> <span class="token operator">*</span>rwptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åŠŸèƒ½ï¼šå¯¹ç»™å®šçš„è¯»å†™é”ï¼ˆ<code>rwptr</code>ï¼‰è¿›è¡Œå†™å…¥é”å®šã€‚å½“è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œæ— è®ºæ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰è¯»å–é”æˆ–è€…å†™å…¥é”ï¼Œéƒ½ä¼šé˜»å¡ç›´åˆ°å½“å‰çº¿ç¨‹èƒ½å¤Ÿè·å¾—å†™å…¥é”ã€‚åªæœ‰åœ¨æ²¡æœ‰ä»»ä½•çº¿ç¨‹æŒæœ‰è¯»å–é”æˆ–å†™å…¥é”çš„æƒ…å†µä¸‹ï¼Œå½“å‰çº¿ç¨‹æ‰èƒ½è·å–å†™å…¥é”å¹¶å¼€å§‹ä¿®æ”¹å…±äº«èµ„æºã€‚</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå‡ºé”™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul></li><li><p><strong>pthread_rwlock_unlock</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token class-name">pthread_rwlock_t</span> <span class="token operator">*</span>rwptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åŠŸèƒ½ï¼šé‡Šæ”¾ä¸€ä¸ªä¹‹å‰é€šè¿‡<code>pthread_rwlock_rdlock</code>æˆ–<code>pthread_rwlock_wrlock</code>è·å–çš„è¯»å‡ºé”æˆ–å†™å…¥é”ã€‚è°ƒç”¨æ­¤å‡½æ•°åï¼Œå…¶ä»–ç­‰å¾…ç›¸åŒé”çš„çº¿ç¨‹ï¼ˆæ— è®ºæ˜¯è¯»å–è¿˜æ˜¯å†™å…¥è¯·æ±‚ï¼‰å¯èƒ½ä¼šè¢«å”¤é†’å¹¶æœ‰æœºä¼šè·å–é”ã€‚</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå‡ºé”™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul></li></ol><p>ç¤ºä¾‹ä½¿ç”¨ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">pthread_rwlock_t</span> rwlock<span class="token punctuation">;</span><span class="token keyword">int</span> shared_data<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_rwlock_rdlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¯»å–shared_data</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Reader: Data is %d\n"</span><span class="token punctuation">,</span> shared_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token keyword">int</span> new_value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä¿®æ”¹shared_data</span>    shared_data <span class="token operator">=</span> new_value<span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Writer: Updated data to %d\n"</span><span class="token punctuation">,</span> shared_data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_rwlock_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºå’Œå¯åŠ¨å¤šä¸ªè¯»çº¿ç¨‹ä¸å†™çº¿ç¨‹</span>    <span class="token comment">// é”€æ¯è¯»å†™é”</span>    <span class="token function">pthread_rwlock_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="éé˜»å¡è·å¾—è¯»é”å’Œå†™é”"><a href="#éé˜»å¡è·å¾—è¯»é”å’Œå†™é”" class="headerlink" title="éé˜»å¡è·å¾—è¯»é”å’Œå†™é”"></a>éé˜»å¡è·å¾—è¯»é”å’Œå†™é”</h4><ol><li><p><strong>pthread_rwlock_tryrdlock</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_rwlock_tryrdlock</span><span class="token punctuation">(</span><span class="token class-name">pthread_rwlock_t</span> <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åŠŸèƒ½ï¼šå°è¯•è·å–ç»™å®šçš„è¯»å†™é”ï¼ˆ<code>rwlock</code>ï¼‰çš„è¯»å–é”ï¼Œä½†ä¸é˜»å¡ã€‚å¦‚æœå½“å‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰å†™å…¥é”ï¼Œå¹¶ä¸”æ²¡æœ‰æ­£åœ¨ç­‰å¾…è·å–å†™å…¥é”çš„çº¿ç¨‹ï¼Œåˆ™ç«‹å³è¿”å›å¹¶æˆåŠŸè·å–è¯»å–é”ã€‚å¦åˆ™ï¼Œå¦‚æœæ— æ³•ç«‹å³è·å–è¯»å–é”ï¼Œåˆ™è¯¥å‡½æ•°ä¼šç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯å€¼ã€‚</li><li>è¿”å›å€¼ï¼šè‹¥æˆåŠŸè·å–è¯»å–é”åˆ™è¿”å›0ï¼Œè‹¥æ— æ³•ç«‹å³è·å–é”åˆ™è¿”å›ä¸€ä¸ªéé›¶é”™è¯¯ä»£ç ï¼ˆå¦‚EBUSYï¼‰ï¼Œè¡¨ç¤ºèµ„æºå·²ç»è¢«é”å®šã€‚</li></ul></li><li><p><strong>pthread_rwlock_trywrlock</strong>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_rwlock_trywrlock</span><span class="token punctuation">(</span><span class="token class-name">pthread_rwlock_t</span> <span class="token operator">*</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åŠŸèƒ½ï¼šå°è¯•è·å–ç»™å®šçš„è¯»å†™é”ï¼ˆ<code>rwlock</code>ï¼‰çš„å†™å…¥é”ï¼ŒåŒæ ·ä¸ä¼šé˜»å¡ã€‚åªæœ‰åœ¨æ²¡æœ‰ä»»ä½•çº¿ç¨‹æŒæœ‰è¯»å–é”æˆ–å†™å…¥é”çš„æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°æ‰èƒ½ç«‹å³è¿”å›å¹¶æˆåŠŸè·å–å†™å…¥é”ã€‚å¦åˆ™ï¼Œå¦‚æœæ— æ³•ç«‹å³è·å–å†™å…¥é”ï¼Œåˆ™è¯¥å‡½æ•°ä¼šç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯å€¼ã€‚</li><li>è¿”å›å€¼ï¼šè‹¥æˆåŠŸè·å–å†™å…¥é”åˆ™è¿”å›0ï¼Œè‹¥æ— æ³•ç«‹å³è·å–é”åˆ™è¿”å›ä¸€ä¸ªéé›¶é”™è¯¯ä»£ç ï¼ˆå¦‚EBUSYï¼‰ï¼Œè¡¨ç¤ºèµ„æºå·²ç»è¢«é”å®šã€‚</li></ul></li></ol><p>ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥åœ¨éœ€è¦é¿å…é˜»å¡æ—¶å°è¯•è·å–é”ï¼Œä¾‹å¦‚åœ¨å®æ—¶ç³»ç»Ÿæˆ–è€…ä¸èƒ½æ— é™æœŸç­‰å¾…é”çš„åœ°æ–¹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">pthread_rwlock_t</span> rwlock<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">non_blocking_reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_rwlock_tryrdlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æˆåŠŸè·å–è¯»é”ï¼Œæ‰§è¡Œè¯»å–æ“ä½œ</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Reader: Data is %d\n"</span><span class="token punctuation">,</span> shared_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Reader: Could not acquire read lock, data not read.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œå…¶ä»–æ“ä½œæˆ–ç¨åé‡è¯•</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">non_blocking_writer</span><span class="token punctuation">(</span><span class="token keyword">int</span> new_value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pthread_rwlock_trywrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æˆåŠŸè·å–å†™é”ï¼Œæ‰§è¡Œå†™å…¥æ“ä½œ</span>        shared_data <span class="token operator">=</span> new_value<span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Writer: Updated data to %d\n"</span><span class="token punctuation">,</span> shared_data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Writer: Could not acquire write lock, data not updated.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ‰§è¡Œå…¶ä»–æ“ä½œæˆ–ç¨åé‡è¯•</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿è¡Œç»“æœ-9"><a href="#è¿è¡Œç»“æœ-9" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">reader 1 is reading data.reader 2 is reading data.reader 3 is reading data.writer 5 is writing data.writer 4 is writing data.reader 1 reads data over.reader 2 reads data over.reader 3 reads data over.writer 5 writes data over.writer 4 writes data over.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>        <span class="token macro-name">READER_MAX</span>    <span class="token expression"><span class="token number">3</span>        </span><span class="token comment">/*æœ€å¤šå…è®¸å¤šå°‘äººä¸€èµ·è¯»å–æ•°æ®*/</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>        <span class="token macro-name">WRITER_MAX</span>    <span class="token expression"><span class="token number">2</span>        </span><span class="token comment">/*æœ€å¤šå…è®¸å¤šå°‘äººå†™æ•°æ®*/</span></span><span class="token class-name">pthread_rwlock_t</span>    rw_lock<span class="token punctuation">;</span>        <span class="token comment">/*è¯»å†™é”*/</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">reader_thread</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> t<span class="token punctuation">;</span><span class="token comment">//your code here</span>t <span class="token operator">=</span> <span class="token function">pthread_rwlock_tryrdlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rw_lock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"reader %u can't read data.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"reader %u is reading data.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"reader %u reads data over.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rw_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">writer_thread</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> t<span class="token punctuation">;</span><span class="token comment">//your code here</span>t <span class="token operator">=</span> <span class="token function">pthread_rwlock_tryrdlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rw_lock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"writer %u can't write data.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"writer %u is writing data.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"writer %u writes data over.\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rw_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_t</span> reader<span class="token punctuation">,</span> writer<span class="token punctuation">;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token function">pthread_rwlock_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rw_lock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> READER_MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>reader<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> reader_thread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> WRITER_MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>writer<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> writer_thread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸€æ¬¡åˆå§‹åŒ–"><a href="#ä¸€æ¬¡åˆå§‹åŒ–" class="headerlink" title="ä¸€æ¬¡åˆå§‹åŒ–"></a>ä¸€æ¬¡åˆå§‹åŒ–</h2><ul><li><code>pthread_once</code>ä¸€æ¬¡åˆå§‹åŒ–</li></ul><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæœ‰äº›äº‹ä»…éœ€è¦æ‰§è¡Œä¸€æ¬¡ã€‚é€šå¸¸å½“åˆå§‹åŒ–åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°å°†å…¶æ”¾åœ¨mainå‡½æ•°ä¸­ã€‚ä½†å½“ä½ å†™ä¸€ä¸ªåº“æ—¶ï¼Œå°±ä¸èƒ½åœ¨mainé‡Œé¢åˆå§‹åŒ–äº†ï¼Œä½ å¯ä»¥ç”¨é™æ€åˆå§‹åŒ–ï¼Œä½†ä½¿ç”¨ä¸€æ¬¡åˆå§‹åŒ–ï¼ˆpthread_onceï¼‰ä¼šæ¯”è¾ƒå®¹æ˜“äº›ã€‚</p><p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ç¯å¢ƒä¸‹ï¼Œå°½ç®¡pthread_once()è°ƒç”¨ä¼šå‡ºç°åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œinit_routine()å‡½æ•°ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œç©¶ç«Ÿåœ¨å“ªä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ˜¯ä¸å®šçš„ï¼Œæ˜¯ç”±å†…æ ¸è°ƒåº¦æ¥å†³å®šã€‚</p><p><code>pthread_once</code>æ˜¯POSIXçº¿ç¨‹åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºç¡®ä¿æŸä¸ªåˆå§‹åŒ–å‡½æ•°åœ¨æ•´ä¸ªç¨‹åºç”Ÿå‘½å‘¨æœŸå†…åªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚è¿™å¯¹äºé‚£äº›éœ€è¦å•æ¬¡åˆå§‹åŒ–ä¸”åˆå§‹åŒ–è¿‡ç¨‹å¿…é¡»åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨æ‰§è¡Œçš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚</p><p>å‡½æ•°åŸå‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_once</span><span class="token punctuation">(</span><span class="token class-name">pthread_once_t</span> <span class="token operator">*</span>once_control<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>init_routine<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚æ•°è§£æï¼š</p><ul><li><code>pthread_once_t *once_control</code>ï¼šæŒ‡å‘ä¸€ä¸ªpthread_once_tç±»å‹çš„å˜é‡çš„æŒ‡é’ˆã€‚è¿™ä¸ªå˜é‡æ˜¯ç”¨æ¥è·Ÿè¸ªåˆå§‹åŒ–æ˜¯å¦å·²ç»å®Œæˆçš„çŠ¶æ€æ ‡å¿—ã€‚</li><li><code>void (*init_routine)(void)</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘æ— å‚æ•°ã€æ— è¿”å›å€¼å‡½æ•°çš„æŒ‡é’ˆï¼Œå³åˆå§‹åŒ–å‡½æ•°ã€‚å½“<code>pthread_once</code>æ£€æµ‹åˆ°åˆå§‹åŒ–å°šæœªæ‰§è¡Œæ—¶ï¼Œå®ƒå°†è°ƒç”¨è¿™ä¸ªå‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ul><p>åŠŸèƒ½æè¿°ï¼š<br><code>pthread_once</code>å‡½æ•°ä¼šæ£€æŸ¥<code>once_control</code>æŒ‡å‘çš„æ§åˆ¶å˜é‡çŠ¶æ€ï¼Œå¦‚æœåˆå§‹åŒ–å°šæœªæ‰§è¡Œï¼Œåˆ™è°ƒç”¨<code>init_routine</code>å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶è®¾ç½®æ§åˆ¶å˜é‡ä¸ºå·²åˆå§‹åŒ–çŠ¶æ€ã€‚æ­¤å‡½æ•°ä¿è¯äº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å³ä½¿å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨<code>pthread_once</code>ï¼Œåˆå§‹åŒ–å‡½æ•°ä¹Ÿåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</p><p>ç¤ºä¾‹ä½¿ç”¨ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token keyword">static</span> <span class="token class-name">pthread_once_t</span> once_control <span class="token operator">=</span> PTHREAD_ONCE_INIT<span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">int</span> shared_resource<span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initialize_shared_resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿™é‡Œè¿›è¡Œä¸€æ¬¡æ€§åˆå§‹åŒ–æ“ä½œ</span>    shared_resource <span class="token operator">=</span> <span class="token function">calculate_initial_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">access_shared_resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pthread_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>once_control<span class="token punctuation">,</span> initialize_shared_resource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç°åœ¨å¯ä»¥å®‰å…¨åœ°è®¿é—®shared_resourceäº†</span>    <span class="token function">use_shared_resource</span><span class="token punctuation">(</span>shared_resource<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>initialize_shared_resource</code>å‡½æ•°åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨<code>access_shared_resource</code>å‡½æ•°å¹¶ä¼ é€’ç»™<code>pthread_once</code>æ—¶æ‰ä¼šè¢«æ‰§è¡Œã€‚åç»­å¯¹<code>access_shared_resource</code>çš„è°ƒç”¨å°†ç›´æ¥è·³è¿‡åˆå§‹åŒ–é˜¶æ®µï¼Œå› ä¸º<code>once_control</code>å·²ç»è¢«æ ‡è®°ä¸ºå·²åˆå§‹åŒ–çŠ¶æ€ã€‚</p><h3 id="è¿è¡Œç»“æœ-10"><a href="#è¿è¡Œç»“æœ-10" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">thread 1 entersthread 2 entersonce_run in thread 1thread 1 returnsthread 2 returns<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span>  </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token class-name">pthread_once_t</span> once <span class="token operator">=</span> PTHREAD_ONCE_INIT<span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token function">once_run</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"once_run in thread %u\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">void</span> <span class="token operator">*</span> <span class="token function">child1</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> arg<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>      <span class="token class-name">pthread_t</span> tid <span class="token operator">=</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread %u enters\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span>    <span class="token function">pthread_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>once<span class="token punctuation">,</span>once_run<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//end of your code</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread %u returns\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">void</span> <span class="token operator">*</span> <span class="token function">child2</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> arg<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>      <span class="token class-name">pthread_t</span> tid <span class="token operator">=</span> <span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread %u enters\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span>    <span class="token function">pthread_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>once<span class="token punctuation">,</span>once_run<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//end of your code</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"thread %u returns\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>      <span class="token class-name">pthread_t</span> tid1<span class="token punctuation">,</span>tid2<span class="token punctuation">;</span>      <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>child1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>child2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘é€sigä¿¡å·"><a href="#å‘é€sigä¿¡å·" class="headerlink" title="å‘é€sigä¿¡å·"></a>å‘é€sigä¿¡å·</h2><p>æœ¬èŠ‚å±•ç¤ºäº†å‘é€sigä¿¡å·çš„æ–¹æ³•ã€‚</p><h3 id="åŸºæœ¬çŸ¥è¯†-2"><a href="#åŸºæœ¬çŸ¥è¯†-2" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h3><ul><li><code>pthread_kill</code>å‘é€sigä¿¡å·</li></ul><p><code>pthread_kill</code>å¹¶ä¸æ˜¯ç»“æŸè¿›ç¨‹çš„æ„æ€ï¼Œè€Œæ˜¯å‘æŒ‡å®šIDçš„çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œåªæ˜¯å¤§éƒ¨åˆ†ä¿¡å·çš„é»˜è®¤åŠ¨ä½œæ˜¯ç»ˆæ­¢è¿›ç¨‹çš„è¿è¡Œã€‚<br>å¦‚æœçº¿ç¨‹ä¸å¤„ç†è¯¥ä¿¡å·ï¼Œåˆ™æŒ‰ç…§ä¿¡å·é»˜è®¤çš„è¡Œä¸ºä½œç”¨äºæ•´ä¸ªè¿›ç¨‹ã€‚ä¿¡å·å€¼0ä¸ºä¿ç•™ä¿¡å·ï¼Œä½œç”¨æ˜¯æ ¹æ®å‡½æ•°çš„è¿”å›å€¼åˆ¤æ–­çº¿ç¨‹æ˜¯ä¸æ˜¯è¿˜æ´»ç€ã€‚<br><code>pthread_kill</code>çš„è¿”å›å€¼ï¼šæˆåŠŸï¼ˆ0ï¼‰ çº¿ç¨‹ä¸å­˜åœ¨ï¼ˆESRCHï¼‰ ä¿¡å·ä¸åˆæ³•ï¼ˆEINVALï¼‰</p><h3 id="å‡½æ•°è¯´æ˜-10"><a href="#å‡½æ•°è¯´æ˜-10" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p><code>pthread_kill</code>ï¼Œç”¨äºå‘æŒ‡å®šçš„çº¿ç¨‹å‘é€ä¿¡å·ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">pthread_kill</span><span class="token punctuation">(</span><span class="token class-name">pthread_t</span> thread<span class="token punctuation">,</span> <span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚æ•°è§£æï¼š</p><ul><li><code>pthread_t thread</code>ï¼šè¿™æ˜¯ç›®æ ‡çº¿ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨<code>pthread_create</code>å‡½æ•°åˆ›å»ºçº¿ç¨‹æ—¶è¿”å›çš„å€¼è·å–ã€‚</li><li><code>int sig</code>ï¼šè¦å‘é€ç»™çº¿ç¨‹çš„ä¿¡å·ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯POSIXå®šä¹‰çš„ä»»ä½•æœ‰æ•ˆä¿¡å·ï¼ˆä¾‹å¦‚SIGTERMã€SIGINTç­‰ï¼‰ï¼Œæˆ–è€…è‡ªå®šä¹‰ä¿¡å·ï¼ˆå¦‚1~31ä¹‹é—´çš„æ•°å­—ï¼‰ã€‚</li></ul><p>åŠŸèƒ½æè¿°ï¼š<br><code>pthread_kill</code>å‡½æ•°å…è®¸ä¸»çº¿ç¨‹æˆ–è€…å…¶ä»–çº¿ç¨‹å‘æŒ‡å®šçš„çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ã€‚å½“ç›®æ ‡çº¿ç¨‹æ¥æ”¶åˆ°è¯¥ä¿¡å·åï¼Œå®ƒä¼šæ ¹æ®é¢„å…ˆæ³¨å†Œçš„ä¿¡å·å¤„ç†å‡½æ•°ï¼ˆé€šè¿‡<code>signal</code>æˆ–<code>sigaction</code>è®¾ç½®ï¼‰æ¥å¤„ç†è¿™ä¸ªä¿¡å·ï¼Œæˆ–è€…æ˜¯é»˜è®¤çš„è¡Œä¸ºï¼ˆæ¯”å¦‚å¯¹äºSIGTERMï¼Œé€šå¸¸ä¼šå¯¼è‡´è¿›ç¨‹&#x2F;çº¿ç¨‹ç»ˆæ­¢ï¼‰ã€‚</p><p>ç¤ºä¾‹ä½¿ç”¨ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">signal_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Signal %d received in the thread\n"</span><span class="token punctuation">,</span> signum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">thread_function</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">signal</span><span class="token punctuation">(</span>SIGUSR1<span class="token punctuation">,</span> signal_handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ³¨å†Œä¿¡å·å¤„ç†å™¨</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">pthread_t</span> tid<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread_function<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pthread_create"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…çº¿ç¨‹å¼€å§‹è¿è¡Œ</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_kill</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> SIGUSR1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å‘çº¿ç¨‹å‘é€SIGUSR1ä¿¡å·</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pthread_kill"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">pthread_join</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…çº¿ç¨‹ç»“æŸ</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶åœ¨å…¶ä¸­æ³¨å†Œäº†SIGUSR1ä¿¡å·çš„å¤„ç†å‡½æ•°ã€‚ç„¶åï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨<code>pthread_kill</code>å‘å­çº¿ç¨‹å‘é€SIGUSR1ä¿¡å·ï¼Œè§¦å‘å…¶å†…éƒ¨çš„ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œã€‚</p><h3 id="è¿è¡Œç»“æœ-11"><a href="#è¿è¡Œç»“æœ-11" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">ID 0x1 thread exits.ID 0x1 thread exits.ID 0x2 thread stays alive now.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ID 0x%x thread exits.\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">func2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ID 0x%x thread exitsã€‚\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">pthread_self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_exit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">test_pthread</span><span class="token punctuation">(</span><span class="token class-name">pthread_t</span> tid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> pthread_kill_err<span class="token punctuation">;</span><span class="token comment">//your code here</span>    pthread_kill_err <span class="token operator">=</span> <span class="token function">pthread_kill</span><span class="token punctuation">(</span>tid<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>pthread_kill_err <span class="token operator">==</span> ESRCH<span class="token punctuation">)</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ID 0x%x thread exits.\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pthread_kill_err <span class="token operator">==</span> EINVAL<span class="token punctuation">)</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"invalid signal\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ID 0x%x thread stays alive now.\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> ret<span class="token punctuation">;</span>    <span class="token class-name">pthread_t</span> tid1<span class="token punctuation">,</span>tid2<span class="token punctuation">;</span>        <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>func1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>func2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">test_pthread</span><span class="token punctuation">(</span>tid1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_pthread</span><span class="token punctuation">(</span>tid2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MPI</title>
      <link href="/posts/e16d.html"/>
      <url>/posts/e16d.html</url>
      
        <content type="html"><![CDATA[<h1 id="MPI"><a href="#MPI" class="headerlink" title="MPI"></a>MPI</h1><p>MPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰</p><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><ul><li>MPI_INTï¼šæ•´æ•°ç±»å‹ï¼Œå¯¹åº”Cè¯­è¨€ä¸­çš„intç±»å‹ã€‚</li><li>MPI_FLOATï¼šå•ç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼Œå¯¹åº”Cè¯­è¨€ä¸­çš„floatç±»å‹ã€‚</li><li>MPI_DOUBLEï¼šåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼Œå¯¹åº”Cè¯­è¨€ä¸­çš„doubleç±»å‹ã€‚</li><li>MPI_CHARï¼šå­—ç¬¦ç±»å‹ï¼Œå¯¹åº”Cè¯­è¨€ä¸­çš„charç±»å‹ã€‚</li><li>MPI_LOGICï¼šé€»è¾‘ç±»å‹ï¼Œå¯¹åº”Cè¯­è¨€ä¸­çš„_Boolç±»å‹ï¼ˆåœ¨stdbool.hå¤´æ–‡ä»¶ä¸­å®šä¹‰ï¼‰</li></ul><h2 id="MPI-Op"><a href="#MPI-Op" class="headerlink" title="MPI_Op"></a>MPI_Op</h2><p>MPI_Opæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®ƒå®šä¹‰äº†å„ç§æ“ä½œç¬¦ï¼Œè¿™äº›æ“ä½œç¬¦å¯ä»¥ç”¨äºæ‰§è¡Œå…ƒç´ çº§åˆ«çš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š</p><ul><li>MPI_OP_NULLï¼šç”¨äºåˆå§‹åŒ–æ“ä½œå¯¹è±¡ã€‚</li><li>MPI_MAXï¼šç”¨äºæ‰¾å‡ºæ•°ç»„ä¸­çš„æœ€å¤§å€¼ã€‚</li><li>MPI_MINï¼šç”¨äºæ‰¾å‡ºæ•°ç»„ä¸­çš„æœ€å°å€¼ã€‚</li><li>MPI_SUMï¼šç”¨äºè®¡ç®—æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚</li><li>MPI_PRODï¼šç”¨äºè®¡ç®—æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ã€‚</li><li>MPI_LANDï¼šç”¨äºæ‰§è¡Œå…ƒç´ çº§åˆ«çš„â€œä¸â€æ“ä½œã€‚</li><li>MPI_BANDï¼šç”¨äºæ‰§è¡Œå…ƒç´ çº§åˆ«çš„â€œæˆ–éâ€æ“ä½œã€‚</li></ul><h2 id="ç¬¬ä¸€ä¸ªMPIç¨‹åº"><a href="#ç¬¬ä¸€ä¸ªMPIç¨‹åº" class="headerlink" title="ç¬¬ä¸€ä¸ªMPIç¨‹åº"></a>ç¬¬ä¸€ä¸ªMPIç¨‹åº</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬åº”è¯¥å…ˆåŒ…å«è¿›ä¸€ä¸ªå¤´æ–‡ä»¶<code>&lt;mpi.h&gt;</code></p><p>MPIç¨‹åºå’Œæ™®é€šçš„Cç¨‹åºçš„åŒºåˆ«åœ¨äºæœ‰ä¸€ä¸ªå¼€å§‹çš„å‡½æ•°å’Œç»“æŸçš„å‡½æ•°æ¥æ ‡è¯†MPIéƒ¨åˆ†ï¼Œå†åœ¨è¿™ä¸ªéƒ¨åˆ†è¿›è¡Œä½ æƒ³è¦è¿›è¡Œçš„æ“ä½œ</p><h3 id="å‡½æ•°è¯´æ˜"><a href="#å‡½æ•°è¯´æ˜" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><h4 id="MPI-Init"><a href="#MPI-Init" class="headerlink" title="MPI_Init( )"></a>MPI_Init( )</h4><p>MPI_Init( )ï¼šè¿›å…¥MPIç¯å¢ƒå¹¶å®Œæˆæ‰€æœ‰çš„åˆå§‹åŒ–å·¥ä½œï¼Œæ ‡å¿—å¹¶è¡Œä»£ç çš„å¼€å§‹</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>int MPI_Init(int *argc, char **argv)</code> ï¼Œç”¨äºåˆå§‹åŒ–MPIç¯å¢ƒ</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>argc</code>ï¼šæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºå‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡ã€‚</li><li><code>argv</code>ï¼šæŒ‡å‘å­—ç¬¦æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œè¡¨ç¤ºå‘½ä»¤è¡Œå‚æ•°çš„å€¼ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h4 id="MPI-Finalize"><a href="#MPI-Finalize" class="headerlink" title="MPI_Finalize( )"></a>MPI_Finalize( )</h4><p>MPI_Finalize( )ï¼šä»MPIç¯å¢ƒä¸­é€€å‡ºï¼Œæ ‡å¿—å¹¶è¡Œä»£ç çš„ç»“æŸ</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>int MPI_Finalize(void)</code> ï¼Œç”¨äºç»“æŸMPIç¯å¢ƒã€‚</p><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token comment">//your code here</span>    <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//end of your code </span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–è¿›ç¨‹æ•°é‡"><a href="#è·å–è¿›ç¨‹æ•°é‡" class="headerlink" title="è·å–è¿›ç¨‹æ•°é‡"></a>è·å–è¿›ç¨‹æ•°é‡</h2><p>åœ¨MPIç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦è·å–æŒ‡å®šé€šä¿¡åŸŸçš„è¿›ç¨‹ä¸ªæ•°ï¼Œä»¥ç¡®å®šç¨‹åºçš„è§„æ¨¡ã€‚</p><p>ä¸€ç»„å¯ä»¥ç›¸äº’å‘é€æ¶ˆæ¯çš„è¿›ç¨‹é›†åˆå«åšé€šä¿¡å­ï¼Œé€šå¸¸ç”±<code>MPI_Init()</code>åœ¨ç”¨æˆ·å¯åŠ¨ç¨‹åºæ—¶ï¼Œå®šä¹‰ç”±ç”¨æˆ·å¯åŠ¨çš„æ‰€æœ‰è¿›ç¨‹æ‰€ç»„æˆçš„é€šä¿¡å­ï¼Œç¼ºçœå€¼ä¸º <em>MPI_COMM_WORLD</em> ã€‚è¿™ä¸ªå‚æ•°æ˜¯MPIé€šä¿¡æ“ä½œå‡½æ•°ä¸­å¿…ä¸å¯å°‘çš„å‚æ•°ï¼Œç”¨äºé™å®šå‚åŠ é€šä¿¡çš„è¿›ç¨‹çš„èŒƒå›´ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-1"><a href="#å‡½æ•°è¯´æ˜-1" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_Comm comm<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>rank<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>int MPI_Comm_size(MPI_Comm comm, int *rank)</code> ï¼Œè·å–æŒ‡å®šé€šä¿¡åŸŸçš„è¿›ç¨‹ä¸ªæ•°ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>comm</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ç»„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚</li><li><code>rank</code>ï¼šæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨è¿›ç¨‹æ•°é‡ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h3 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> world_size<span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>world_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–MPI_COMM_WORLDé€šä¿¡å™¨ä¸­çš„è¿›ç¨‹æ•°é‡</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Number of processes: %d\n"</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size)</code> å°†è·å–é»˜è®¤é€šä¿¡å™¨ï¼ˆ<code>MPI_COMM_WORLD</code>ï¼Œé€šå¸¸åŒ…å«æ‰€æœ‰å‚ä¸æ‰§è¡Œçš„åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼‰ä¸­çš„è¿›ç¨‹æ•°é‡ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ <code>world_size</code> å˜é‡ä¸­ã€‚</p><h3 id="å®éªŒè¯´æ˜"><a href="#å®éªŒè¯´æ˜" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>ä½¿ç”¨å‡½æ•°MPI_Comm_sizeè·å–é€šä¿¡åŸŸä¸­çš„è¿›ç¨‹ä¸ªæ•°å¹¶æ‰“å°å‡ºæ¥ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span><span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!I'm rank %d of %d\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–è¿›ç¨‹id"><a href="#è·å–è¿›ç¨‹id" class="headerlink" title="è·å–è¿›ç¨‹id"></a>è·å–è¿›ç¨‹id</h2><p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¸¸å¸¸éœ€è¦è¾“å‡ºå½“å‰è¿›ç¨‹çš„idï¼Œä»¥æ­¤æ¥åˆ¤æ–­å…·ä½“å“ªä¸ªè¿›ç¨‹å®Œæˆäº†å¯¹åº”çš„ä»»åŠ¡ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-2"><a href="#å‡½æ•°è¯´æ˜-2" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_Comm comm<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>rank<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>int MPI_Comm_rank(MPI_Comm comm, int *rank)</code> ï¼Œç”¨äºè·å–å½“å‰è¿›ç¨‹åœ¨æŒ‡å®šé€šä¿¡å™¨ä¸­çš„ç¼–å·ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>comm</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ç»„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚</li><li><code>rank</code>ï¼šæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨å½“å‰è¿›ç¨‹çš„ç¼–å·ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> world_rank<span class="token punctuation">;</span>    <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>world_rank<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello from rank %d\n"</span><span class="token punctuation">,</span> world_rank<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®éªŒè¯´æ˜-1"><a href="#å®éªŒè¯´æ˜-1" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­ï¼Œä½¿ç”¨å‡½æ•°MPI_Comm_rankæ¥è·å–å½“å‰è¿›ç¨‹çš„idå¹¶æ‰“å°å‡ºæ¥ã€‚</p><p>è¾“å‡ºç»“æœï¼šç”±äºå¹¶è¡Œç¨‹åºæ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œä½ çš„ç»“æœçš„é¡ºåºå¯èƒ½å’Œè¿™ä¸ªç»“æœä¸ä¸€è‡´ã€‚</p><p>0</p><p>1</p><p>3</p><p>2</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!I'm rank %d of %d\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¶ˆæ¯ä¼ é€’"><a href="#æ¶ˆæ¯ä¼ é€’" class="headerlink" title="æ¶ˆæ¯ä¼ é€’"></a>æ¶ˆæ¯ä¼ é€’</h2><p>åœ¨å¹¶è¡Œç¼–ç¨‹ä¸­ï¼Œæ¶ˆæ¯ä¼ é€’å äº†å¾ˆå¤§çš„æ¯”é‡ã€‚è‰¯å¥½çš„æ¶ˆæ¯ä¼ é€’æ˜¯æ­£å¸¸å®Œæˆè¿›ç¨‹&#x2F;èŠ‚ç‚¹ä¹‹é—´æ“ä½œçš„åŸºæœ¬æ¡ä»¶</p><p>åœ¨è¿™é‡Œå…ˆä»‹ç»çš„æœ€åŸºæœ¬å‘é€&#x2F;æ¥æ”¶å‡½æ•°</p><p>æœ€åŸºæœ¬çš„å‘é€ &#x2F; æ¥æ”¶å‡½æ•°éƒ½æ˜¯ä»¥ç¼“å†²åŒºä½œä¸ºç«¯ç‚¹ï¼Œé€šè¿‡å‚æ•°é…ç½®æ¥å®ŒæˆæŒ‡å®šæ“ä½œ</p><h3 id="å‡½æ•°è¯´æ˜-3"><a href="#å‡½æ•°è¯´æ˜-3" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><h4 id="å‘é€æ•°æ®"><a href="#å‘é€æ•°æ®" class="headerlink" title="å‘é€æ•°æ®"></a>å‘é€æ•°æ®</h4><p>å‘é€ç¼“å†²åŒºä¸­çš„ä¿¡æ¯åˆ°ç›®æ ‡è¿›ç¨‹</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Send</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> msg_buf_p<span class="token punctuation">,</span>  <span class="token keyword">int</span> msg_size<span class="token punctuation">,</span>  MPI_Datatype msg_type<span class="token punctuation">,</span> <span class="token keyword">int</span> dest<span class="token punctuation">,</span>  <span class="token keyword">int</span> tag<span class="token punctuation">,</span>   MPI_Comm communicator<span class="token punctuation">)</span>   ç¼“å†²åŒºçš„èµ·å§‹åœ°å€    ç¼“å†²åŒºå¤§å°  å‘é€ä¿¡æ¯çš„æ•°æ®ç±»å‹   ç›®æ ‡è¿›ç¨‹çš„id æ¶ˆæ¯æ ‡ç­¾  é€šä¿¡å­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>MPI_Send(void* msg_buf_p, int msg_size, MPI_Datatype msg_type, int dest, int tag, MPI_Comm communicator)</code> ï¼Œç”¨äºå°†æ•°æ®ä»æºè¿›ç¨‹å‘é€åˆ°ç›®æ ‡è¿›ç¨‹ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>msg_buf_p</code>ï¼šæŒ‡å‘è¦å‘é€æ•°æ®çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚</li><li><code>msg_size</code>ï¼šè¦å‘é€çš„æ•°æ®çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</li><li><code>msg_type</code>ï¼šæ•°æ®çš„ç±»å‹ã€‚</li><li><code>dest</code>ï¼šç›®æ ‡è¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚</li><li><code>tag</code>ï¼šä¸€ä¸ªæ•´æ•°æ ‡ç­¾ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æ¶ˆæ¯ã€‚</li><li><code>communicator</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ç»„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h4 id="æ¥æ”¶æ•°æ®"><a href="#æ¥æ”¶æ•°æ®" class="headerlink" title="æ¥æ”¶æ•°æ®"></a>æ¥æ”¶æ•°æ®</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Recv</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> msg_buf_p<span class="token punctuation">,</span> <span class="token keyword">int</span> buf_size<span class="token punctuation">,</span> MPI_Datatype msg_type<span class="token punctuation">,</span> <span class="token keyword">int</span> source<span class="token punctuation">,</span> <span class="token keyword">int</span> tag<span class="token punctuation">,</span> MPI_Comm communicatorï¼Œ MPI_Status <span class="token operator">*</span>status_p<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”¨äºåœ¨å¹¶è¡Œè®¡ç®—ç¯å¢ƒä¸­æ¥æ”¶æ¥è‡ªç‰¹å®šæºè¿›ç¨‹çš„æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æŒ‡å®šçš„æ¥æ”¶ç¼“å†²åŒºä¸­ã€‚</p><ul><li><code>void* msg_buf_p</code>: è¿™æ˜¯æŒ‡å‘æ¥æ”¶ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚è¯¥ç¼“å†²åŒºå°†å­˜å‚¨ä»æºè¿›ç¨‹æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</li><li><code>int buf_size</code>: è¿™æ˜¯æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚å®ƒåº”è¯¥ä¸å‘é€ç¼“å†²åŒºçš„å¤§å°ç›¸åŒ¹é…ã€‚</li><li><code>MPI_Datatype msg_type</code>: è¿™æ˜¯æŒ‡å®šæ¥æ”¶ç¼“å†²åŒºä¸­æ•°æ®ç±»å‹çš„MPIæ•°æ®ç±»å‹å¯¹è±¡ã€‚</li><li><code>int source</code>: è¿™æ˜¯å‘é€æ•°æ®çš„æºè¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚MPIåº“å°†åªä»è¿™ä¸ªè¿›ç¨‹æ¥æ”¶æ•°æ®ã€‚</li><li><code>int tag</code>: è¿™æ˜¯ç”¨äºåŒºåˆ†ä¸åŒæ¶ˆæ¯çš„æ•´æ•°æ ‡ç­¾ã€‚å¦‚æœä¸¤ä¸ªè¿›ç¨‹åŒæ—¶å‘é€æ•°æ®ï¼Œå®ƒä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ ‡ç­¾æ¥åŒºåˆ†å®ƒä»¬çš„æ¶ˆæ¯ã€‚</li><li><code>MPI_Comm communicator</code>: è¿™æ˜¯é€šä¿¡å™¨å¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†è¿›ç¨‹ç»„å’Œé€šä¿¡æ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šä¿¡å™¨å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªå¹¶è¡Œè®¡ç®—ç¯å¢ƒã€‚</li><li><code>MPI_Status *status_p</code>: è¿™æ˜¯æŒ‡å‘MPIçŠ¶æ€å¯¹è±¡çš„æŒ‡é’ˆã€‚MPIçŠ¶æ€å¯¹è±¡åŒ…å«äº†å…³äºæ¥æ”¶æ“ä½œçš„ä¿¡æ¯ï¼Œå¦‚æ˜¯å¦æˆåŠŸæ¥æ”¶åˆ°æ•°æ®ã€æ¥æ”¶æ—¶é—´ç­‰ã€‚</li></ul><h3 id="å®éªŒè¯´æ˜-2"><a href="#å®éªŒè¯´æ˜-2" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>æŠŠidä¸º0çš„è¿›ç¨‹å½“ä½œæ ¹è¿›ç¨‹ï¼Œç„¶ååœ¨é™¤æ­¤ä¹‹å¤–çš„è¿›ç¨‹ä¸­ä½¿ç”¨å‡½æ•°MPI_Sendå‘é€ä¸€å¥â€hello world!â€åˆ°æ ¹è¿›ç¨‹ä¸­ï¼Œç„¶ååœ¨æ ¹è¿›ç¨‹ä¸­æŠŠè¿™äº›ä¿¡æ¯æ‰“å°å‡ºæ¥ã€‚</p><p>è¾“å‡ºç»“æœï¼šä¸€ç³»åˆ—çš„â€hello world!â€</p><blockquote><p>å­—ç¬¦ä¸²çš„åå­—å°±æ˜¯å­—ç¬¦ä¸²çš„é¦–åœ°å€ã€‚åœ¨Cè¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯ç”±å­—ç¬¦æ•°ç»„è¡¨ç¤ºçš„ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ã€‚æ‰€ä»¥ï¼Œå­—ç¬¦ä¸²çš„åå­—å®é™…ä¸Šå°±æ˜¯æŒ‡å‘å­—ç¬¦ä¸²é¦–å­—ç¬¦çš„æŒ‡é’ˆã€‚</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> source<span class="token punctuation">;</span>MPI_Status status<span class="token punctuation">;</span><span class="token keyword">char</span> message<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//your code here</span>    <span class="token function">MPI_Send</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> MPI_CHAR<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//end of your code</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>         <span class="token comment">//myid == 0</span><span class="token keyword">for</span><span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> source<span class="token operator">&lt;</span>numprocs<span class="token punctuation">;</span> source<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//your code here</span><span class="token function">MPI_Recv</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> MPI_CHAR<span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§„çº¦ï¼ˆreduceï¼‰"><a href="#è§„çº¦ï¼ˆreduceï¼‰" class="headerlink" title="è§„çº¦ï¼ˆreduceï¼‰"></a>è§„çº¦ï¼ˆreduceï¼‰</h2><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¯¹äºæ•°æ®åšåŒä¸€ç§æ“ä½œï¼Œå¹¶å°†ç»“æœè¿”å›åˆ°æŒ‡å®šçš„è¿›ç¨‹ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé›†åˆé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œå°†æ•°æ®åˆ†æ•£åˆ°å„ä¸ªè¿›ç¨‹ä¸­ï¼Œå…ˆåœ¨å„ä¸ªè¿›ç¨‹å†…è¿›è¡Œæ±‚å’Œï¼Œå†åœ¨å…¨å±€å®Œæˆæ±‚å’Œ-å¹³å‡è¿™ä¸ªæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€ä¸ªè§„çº¦çš„è¿‡ç¨‹ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œé›†åˆé€šä¿¡åŒ…æ‹¬é€šä¿¡ã€åŒæ­¥å’Œè®¡ç®—ä¸‰ä¸ªåŠŸèƒ½ã€‚ä¸è¿‡ï¼Œç›®å‰æˆ‘ä»¬æš‚æ—¶ä¸éœ€è¦å…³æ³¨æ•´ä¸ªè¿‡ç¨‹ï¼Œè€Œæ˜¯å…ˆä½¿ç”¨ä¸€ä¸ªè§„çº¦å‡½æ•°å»ä½“éªŒä¸€ä¸‹é›†åˆé€šä¿¡ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-4"><a href="#å‡½æ•°è¯´æ˜-4" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><blockquote><p>è§„çº¦å‡½æ•°ï¼Œæ‰€æœ‰è¿›ç¨‹å°†å¾…å¤„ç†æ•°æ®é€šè¿‡è¾“å…¥çš„æ“ä½œå­operatorè®¡ç®—ä¸ºæœ€ç»ˆç»“æœå¹¶å°†å®ƒå­˜å…¥ç›®æ ‡è¿›ç¨‹ä¸­ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Reduce</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> input_data_p<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span> output_data_p<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> MPI_Datatype datatype<span class="token punctuation">,</span> MPI_Op operator<span class="token punctuation">,</span> <span class="token keyword">int</span> dest_process<span class="token punctuation">,</span> MPI_Comm comm<span class="token punctuation">)</span>è¿›ç¨‹çš„å¾…å¤„ç†æ•°æ®å­˜æ”¾çš„åœ°å€ï¼› å­˜æ”¾æœ€ç»ˆç»“æœçš„ç›®æ ‡è¿›ç¨‹çš„åœ°å€ï¼›ç¼“å†²åŒºä¸­çš„æ•°æ®ä¸ªæ•°ï¼›æ•°æ®ç±»å‹ï¼›æ“ä½œå­ï¼ˆåŠ å‡ï¼‰ï¼›ç›®æ ‡è¿›ç¨‹çš„ç¼–å·ï¼›<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>int MPI_Reduce(void * input_data_p, void * output_data_p, int count, MPI_Datatype datatype, MPI_Op operator, int dest_process, MPI_Comm comm)</code> ï¼Œç”¨äºå°†æ•°æ®ä»æºè¿›ç¨‹æ”¶é›†åˆ°ç›®æ ‡è¿›ç¨‹ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>input_data_p</code>ï¼šæŒ‡å‘è¾“å…¥æ•°æ®çš„æŒ‡é’ˆã€‚</li><li><code>output_data_p</code>ï¼šæŒ‡å‘è¾“å‡ºæ•°æ®çš„æŒ‡é’ˆã€‚</li><li><code>count</code>ï¼šè¦å¤„ç†çš„å…ƒç´ æ•°é‡ã€‚</li><li><code>datatype</code>ï¼šæ•°æ®ç±»å‹ã€‚</li><li><code>operator</code>ï¼šMPIæ“ä½œç¬¦ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•ç»„åˆè¾“å…¥æ•°æ®ä»¥ç”Ÿæˆè¾“å‡ºæ•°æ®ã€‚</li><li><code>dest_process</code>ï¼šç›®æ ‡è¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚</li><li><code>comm</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ç»„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul></blockquote><blockquote><p><code>MPI_Reduce()</code>å‡½æ•°æ˜¯Message Passing Interface (MPI) åº“ä¸­ç”¨äºå¹¶è¡Œè®¡ç®—çš„ä¸€ä¸ªé‡è¦å‡½æ•°ï¼Œä¸»è¦ç”¨äºåœ¨ä¸€ç»„è¿›ç¨‹é—´å¯¹æ•°æ®è¿›è¡Œè§„çº¦æ“ä½œï¼ˆå¦‚æ±‚å’Œã€æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯è¯¥å‡½æ•°çš„è¯¦ç»†è§£æï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">MPI_Reduce</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>input_data_p<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>output_data_p<span class="token punctuation">,</span>             <span class="token keyword">int</span> count<span class="token punctuation">,</span> MPI_Datatype datatype<span class="token punctuation">,</span>             MPI_Op op<span class="token punctuation">,</span> <span class="token keyword">int</span> dest_process<span class="token punctuation">,</span>             MPI_Comm comm<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>å‚æ•°è§£é‡Šï¼š</strong></p><ul><li><p><code>void *input_data_p</code>: æŒ‡å‘å‚ä¸è§„çº¦æ“ä½œçš„è¾“å…¥ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚æ¯ä¸ªè¿›ç¨‹æä¾›ä¸€å—ç›¸åŒå¤§å°çš„æ•°æ®åŒºåŸŸï¼Œè¿™äº›æ•°æ®å°†æŒ‰ç…§æŒ‡å®šçš„æ“ä½œç¬¦è¢«è§„çº¦ã€‚</p></li><li><p><code>void *output_data_p</code>: æŒ‡å‘è§„çº¦ç»“æœå­˜å‚¨ä½ç½®çš„æŒ‡é’ˆã€‚åªæœ‰æŒ‡å®šçš„ç›®æ ‡è¿›ç¨‹ï¼ˆdest_processï¼‰ä¼šæ¥æ”¶åˆ°æœ€ç»ˆçš„è§„çº¦ç»“æœã€‚</p></li><li><p><code>int count</code>: è¡¨ç¤ºè¦å¤„ç†çš„æ•°æ®å…ƒç´ ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœdatatypeæ˜¯MPI_INTä¸”countä¸º10ï¼Œåˆ™è¡¨ç¤ºæœ‰10ä¸ªæ•´æ•°å‚ä¸è§„çº¦ã€‚</p></li><li><p><code>MPI_Datatype datatype</code>: æŒ‡å®šå‚ä¸è§„çº¦çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ˜¯MPIé¢„å®šä¹‰çš„ç±»å‹ï¼Œå¦‚MPI_INTã€MPI_FLOATã€MPI_DOUBLEç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„å¤åˆæ•°æ®ç±»å‹ã€‚</p></li><li><p><code>MPI_Op op</code>: æŒ‡å®šè¦æ‰§è¡Œçš„è§„çº¦æ“ä½œï¼Œä¾‹å¦‚MPI_SUMï¼ˆæ±‚å’Œï¼‰ã€MPI_MAXï¼ˆæ±‚æœ€å¤§å€¼ï¼‰ã€MPI_MINï¼ˆæ±‚æœ€å°å€¼ï¼‰ç­‰ã€‚ä¹Ÿå¯ä»¥é€šè¿‡MPI_Op_createè‡ªå®šä¹‰è§„çº¦æ“ä½œã€‚</p></li><li><p><code>int dest_process</code>: è§„çº¦ç»“æœå­˜æ”¾çš„ç›®æ ‡è¿›ç¨‹çš„ rankï¼ˆæ ‡è¯†ç¬¦ï¼‰ã€‚æ‰€æœ‰è¿›ç¨‹éƒ½å°†å®ƒä»¬çš„å±€éƒ¨ç»“æœå‘é€åˆ°è¿™ä¸ªç›®æ ‡è¿›ç¨‹ï¼Œç„¶åç”±ç›®æ ‡è¿›ç¨‹æ‰§è¡Œæœ€åçš„è§„çº¦æ“ä½œå¾—åˆ°å…¨å±€ç»“æœã€‚</p></li><li><p><code>MPI_Comm comm</code>: æŒ‡å®šé€šä¿¡å™¨ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªè¿›ç¨‹ç»„ï¼ˆcommunicatorï¼‰ï¼Œå¦‚MPI_COMM_WORLDï¼Œå®ƒåŒ…å«äº†å‚ä¸è§„çº¦çš„æ‰€æœ‰è¿›ç¨‹ã€‚</p></li></ul></li></ul><p>å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°å€¼ï¼Œè‹¥æˆåŠŸåˆ™è¿”å›MPI_SUCCESSï¼Œå¦åˆ™è¿”å›é”™è¯¯ä»£ç ã€‚</p><p>ç¤ºä¾‹ç”¨æ³•ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> my_rank<span class="token punctuation">,</span> size<span class="token punctuation">;</span>    <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>my_rank<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> local_sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token comment">// å‡è®¾æˆ‘ä»¬å·²ç»å¡«å……äº†æœ¬åœ°æ•°æ®</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        local_sum <span class="token operator">+=</span> some_local_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">double</span> global_sum<span class="token punctuation">;</span>    <span class="token function">MPI_Reduce</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>local_sum<span class="token punctuation">,</span> <span class="token operator">&amp;</span>global_sum<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_DOUBLE<span class="token punctuation">,</span> MPI_SUM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>my_rank <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The global sum is: %f\n"</span><span class="token punctuation">,</span> global_sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½ä¼šè®¡ç®—å…¶æœ¬åœ°æ•°æ®ä¹‹å’Œï¼Œç„¶åé€šè¿‡<code>MPI_Reduce</code>å‡½æ•°å°†å„è‡ªçš„å±€éƒ¨å’Œè§„çº¦æˆä¸€ä¸ªå…¨å±€æ€»å’Œï¼Œç»“æœå­˜å‚¨åœ¨rankä¸º0çš„è¿›ç¨‹ä¸­ã€‚</p></blockquote><blockquote><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>count</code>è®¾ç½®ä¸º1è¡¨ç¤ºæ¯ä¸ªè¿›ç¨‹ä¸­å‚ä¸è§„çº¦æ“ä½œçš„æ•°æ®å…ƒç´ ä¸ªæ•°ä¸º1ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ­£åœ¨å¯¹å•ä¸ªdoubleç±»å‹çš„æ•°å€¼è¿›è¡Œè§„çº¦ã€‚</p><p>ç„¶è€Œï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<code>count</code>å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®æˆä»»æ„å¤§äº0çš„æ•´æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€æ®µåŒ…å«å¤šä¸ªç›¸åŒç±»å‹æ•°æ®ï¼ˆå¦‚ä¸€ä¸ªdoubleæ•°ç»„ï¼‰çš„ç¼“å†²åŒºï¼Œå¹¶å¸Œæœ›å¯¹è¿™äº›æ•°æ®è¿›è¡Œè§„çº¦ï¼Œé‚£ä¹ˆ<code>count</code>åº”è®¾ä¸ºè¯¥æ•°ç»„çš„å…ƒç´ ä¸ªæ•°ã€‚</p><p>å‡è®¾æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé•¿åº¦ä¸º100çš„doubleæ•°ç»„ï¼Œæƒ³è¦æ±‚å’Œï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">double</span> local_data<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹åŒ–local_data...</span><span class="token keyword">double</span> global_sum<span class="token punctuation">;</span><span class="token function">MPI_Reduce</span><span class="token punctuation">(</span>local_data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>global_sum<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> MPI_DOUBLE<span class="token punctuation">,</span> MPI_SUM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>count</code>è¢«è®¾ç½®ä¸º100ï¼Œè¡¨ç¤ºæ¯ä¸ªè¿›ç¨‹å°†å®ƒæ‰€æ‹¥æœ‰çš„100ä¸ªdoubleå…ƒç´ è¿›è¡Œè§„çº¦ã€‚æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªå…¨å±€çš„æ€»å’Œï¼Œå­˜å‚¨åœ¨rankä¸º0çš„è¿›ç¨‹ä¸­çš„<code>global_sum</code>å˜é‡ä¸­ã€‚</p></blockquote><h3 id="å®éªŒè¯´æ˜-3"><a href="#å®éªŒè¯´æ˜-3" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>ä½¿ç”¨å‡½æ•°MPI_Reduceæ¥å®ŒæˆåŠ æ³•è§„çº¦åˆ°æ ¹è¿›ç¨‹çš„æ“ä½œï¼Œå¹¶åœ¨æ ¹è¿›ç¨‹æ‰“å°å‡ºæ€»å’Œå’Œå¹³å‡å€¼ã€‚</p><p>è¾“å‡ºç»“æœï¼šç”±äºè¿™é‡Œæ˜¯æµ‹è¯•ç”¨ä¾‹ï¼Œæ‰€ä»¥æ¯ä¸ªè¿›ç¨‹çš„æ•°å€¼éƒ½æ˜¯å–3.0ã€‚æ‰€ä»¥ï¼Œè¾“å‡ºçš„å¹³å‡å€¼åº”è¯¥æ˜¯3ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token keyword">double</span> local_num <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span> <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">double</span> global_num<span class="token punctuation">;</span>        <span class="token comment">//your code here</span>    <span class="token function">MPI_Reduce</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>local_num<span class="token punctuation">,</span> <span class="token operator">&amp;</span>global_num<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_DOUBLE<span class="token punctuation">,</span> MPI_SUM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//end of your code</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Total sum = %f, avg = %f\n"</span><span class="token punctuation">,</span> global_num<span class="token punctuation">,</span> global_num <span class="token operator">/</span> numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¹¿æ’­ï¼ˆBcastï¼‰"><a href="#å¹¿æ’­ï¼ˆBcastï¼‰" class="headerlink" title="å¹¿æ’­ï¼ˆBcastï¼‰"></a>å¹¿æ’­ï¼ˆBcastï¼‰</h2><p>åœ¨ä¸€ä¸ªé›†åˆé€šä¿¡ä¸­ï¼Œå¦‚æœå±äºä¸€ä¸ªè¿›ç¨‹çš„æ•°æ®è¢«å‘é€åˆ°é€šä¿¡å­ä¸­çš„æ‰€æœ‰è¿›ç¨‹ï¼Œè¿™æ ·çš„é›†åˆé€šä¿¡å«åšå¹¿æ’­ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-5"><a href="#å‡½æ•°è¯´æ˜-5" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>å¹¿æ’­å‡½æ•°ï¼Œä»ä¸€ä¸ªidå€¼ä¸ºsourceçš„è¿›ç¨‹å°†ä¸€æ¡æ¶ˆæ¯å¹¿æ’­å‘é€åˆ°é€šä¿¡å­å†…çš„æ‰€æœ‰è¿›ç¨‹,åŒ…æ‹¬å®ƒæœ¬èº«åœ¨å†…ã€‚</p><pre class="line-numbers language-none"><code class="language-none">int MPI_Bcast(void* buffer, int count, MPI_Datatype datatype, int source, MPI_Comm comm)ç¼“å†²åŒºèµ·å§‹åœ°å€ï¼› ç¼“å†²åŒºæ•°æ®ä¸ªæ•°ï¼› æ•°æ®ç±»å‹ï¼› å‘é€ä¿¡æ¯çš„è¿›ç¨‹idï¼› é€šä¿¡å­ï¼› <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>int MPI_Bcast(void* buffer, int count, MPI_Datatype datatype, int source, MPI_Comm comm)</code> ï¼Œç”¨äºåœ¨å¹¶è¡Œè®¡ç®—ä¸­å¹¿æ’­æ•°æ®ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>buffer</code>ï¼šæŒ‡å‘è¦å¹¿æ’­çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚</li><li><code>count</code>ï¼šè¦å¹¿æ’­çš„å…ƒç´ æ•°é‡ã€‚</li><li><code>datatype</code>ï¼šç¼“å†²åŒºä¸­å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚</li><li><code>source</code>ï¼šå¹¿æ’­æ•°æ®çš„æºè¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚å¦‚æœä¸º0ï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„æºè¿›ç¨‹ã€‚</li><li><code>comm</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ç»„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><blockquote><p><code>MPI_Bcast</code>ï¼Œç”¨äºåœ¨å¹¶è¡Œè®¡ç®—ç¯å¢ƒä¸­çš„æ‰€æœ‰è¿›ç¨‹é—´è¿›è¡Œå¹¿æ’­æ“ä½œã€‚è¯¥å‡½æ•°å°†æºè¿›ç¨‹ï¼ˆç”±å‚æ•°<code>source</code>æŒ‡å®šï¼‰çš„æ•°æ®å¹¿æ’­åˆ° communicator (<code>comm</code>) ä¸­çš„å…¶ä»–æ‰€æœ‰è¿›ç¨‹ä¸­ã€‚</p><p>å‡½æ•°åŸå‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Bcast</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> MPI_Datatype datatype<span class="token punctuation">,</span> <span class="token keyword">int</span> source<span class="token punctuation">,</span> MPI_Comm comm<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚æ•°è§£æï¼š</p><ul><li><p><code>void* buffer</code>: æŒ‡å‘è¦å‘é€æˆ–æ¥æ”¶æ•°æ®çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚åœ¨éæºè¿›ç¨‹ä¸­ï¼Œè¿™ä¸ªç¼“å†²åŒºä¼šè¢«æ¥è‡ª<code>source</code>è¿›ç¨‹çš„æ•°æ®è¦†ç›–ï¼›åœ¨æºè¿›ç¨‹ä¸­ï¼Œå®ƒåŒ…å«è¦å¹¿æ’­çš„æ•°æ®ã€‚</p></li><li><p><code>int count</code>: è¦å‘é€æˆ–æ¥æ”¶çš„æ•°æ®å…ƒç´ ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ•°æ®ç±»å‹ä¸º<code>MPI_INT</code>ï¼Œåˆ™<code>count</code>è¡¨ç¤ºæ•´æ•°çš„æ•°é‡ã€‚</p></li><li><p><code>MPI_Datatype datatype</code>: æ•°æ®ç±»å‹çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥æ˜¯é¢„å®šä¹‰çš„åŸºæœ¬ç±»å‹å¦‚<code>MPI_INT</code>ã€<code>MPI_DOUBLE</code>ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„å¤åˆç±»å‹ã€‚</p></li><li><p><code>int source</code>: å¹¿æ’­æºè¿›ç¨‹çš„rankï¼ˆç¼–å·ï¼‰ã€‚åªæœ‰è¿™ä¸ªè¿›ç¨‹æä¾›æ•°æ®ï¼Œå…¶ä½™æ‰€æœ‰è¿›ç¨‹éƒ½ä¼šæ¥æ”¶åˆ°åŒæ ·çš„æ•°æ®ã€‚</p></li><li><p><code>MPI_Comm comm</code>: é€šä¿¡å™¨ï¼Œå®ƒå®šä¹‰äº†å‚ä¸æ­¤æ¬¡å¹¿æ’­çš„æ‰€æœ‰è¿›ç¨‹é›†åˆã€‚é€šå¸¸ä½¿ç”¨<code>MPI_COMM_WORLD</code>ï¼Œå³åŒ…å«äº†æ‰€æœ‰å‚ä¸è®¡ç®—çš„è¿›ç¨‹ã€‚</p></li></ul><p>å‡½æ•°è¿”å›å€¼ï¼š<br><code>MPI_Bcast</code>å‡½æ•°è¿”å›ä¸€ä¸ª<code>int</code>å‹æ•°å€¼ï¼Œå¦‚æœæˆåŠŸå®Œæˆï¼Œåˆ™è¿”å›<code>MPI_SUCCESS</code>ï¼Œå¦åˆ™è¿”å›é”™è¯¯ä»£ç ã€‚</p><p>åŠŸèƒ½æè¿°ï¼š<br><code>MPI_Bcast</code>å‡½æ•°ä½¿å¾—æ‰€æœ‰è¿›ç¨‹ä¸­çš„<code>buffer</code>åŒºåŸŸå†…å®¹ç›¸åŒï¼Œå…¶å†…å®¹æ¥æºäº<code>source</code>è¿›ç¨‹çš„ç›¸åº”å†…å­˜åŒºåŸŸã€‚è¿™æ ·ï¼Œåœ¨å¹¶è¡Œç¨‹åºä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡å¹¿æ’­çš„æ–¹å¼å¿«é€Ÿåœ°å°†å…¶æ•°æ®åŒæ­¥ç»™å…¶ä»–æ‰€æœ‰è¿›ç¨‹ã€‚</p></blockquote><h3 id="å®éªŒè¯´æ˜-4"><a href="#å®éªŒè¯´æ˜-4" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>ä½¿ç”¨å‡½æ•°MPI_Bcaståœ¨æ ¹è¿›ç¨‹ä¸­å‘é€ä¸€ä¸ªæ•°ç»„åˆ°å…¶ä»–è¿›ç¨‹ï¼Œå¹¶åœ¨å…¶ä»–è¿›ç¨‹ä¸­æ‰“å°å‡ºæ¥ã€‚</p><p>è¾“å‡ºç»“æœï¼š<br>In process 1, arr[0]&#x3D;1 arr[1]&#x3D;2 arr[2]&#x3D;3 arr[3]&#x3D;4 arr[4]&#x3D;5<br>In process 3, arr[0]&#x3D;1 arr[1]&#x3D;2 arr[2]&#x3D;3 arr[3]&#x3D;4 arr[4]&#x3D;5<br>â€¦<br>In process n, arr[0]&#x3D;1 arr[1]&#x3D;2 arr[2]&#x3D;3 arr[3]&#x3D;4 arr[4]&#x3D;5<br>â€¦</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token keyword">int</span> source <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>            array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">//your code here</span>    <span class="token function">MPI_Bcast</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> source<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//end of your code</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">!=</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In process %d, "</span><span class="token punctuation">,</span> myid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"arr[%d]=%d\t"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ”¶é›†ï¼ˆgatherï¼‰"><a href="#æ”¶é›†ï¼ˆgatherï¼‰" class="headerlink" title="æ”¶é›†ï¼ˆgatherï¼‰"></a>æ”¶é›†ï¼ˆgatherï¼‰</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ä»æ‰€æœ‰è¿›ç¨‹è·å–ä¿¡æ¯ï¼Œä¾‹å¦‚å°†æ‰€æœ‰è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ•°ç»„éƒ½æ”¶é›†åˆ°æ ¹è¿›ç¨‹ä¸­ä½œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œè¿™æ ·çš„é›†åˆé€šä¿¡æˆ‘ä»¬å«åšæ”¶é›†ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-6"><a href="#å‡½æ•°è¯´æ˜-6" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>æ”¶é›†å‡½æ•°ï¼Œæ ¹è¿›ç¨‹ï¼ˆç›®æ ‡è¿›ç¨‹ï¼‰ä»æ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰æ”¶é›†å‘é€ç¼“å†²åŒºçš„æ•°æ®ï¼Œå†æ ¹æ®å‘é€è¿™äº›æ•°æ®çš„è¿›ç¨‹idå°†å®ƒä»¬ä¾æ¬¡å­˜æ”¾åˆ°è‡ªå·²çš„ç¼“å†²åŒºä¸­</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Gather</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sendbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> sendcount<span class="token punctuation">,</span> MPI_Datatype sendtype<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> recvbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> recvcount<span class="token punctuation">,</span> MPI_Datatype recvtype<span class="token punctuation">,</span> <span class="token keyword">int</span> root<span class="token punctuation">,</span> MPI_Comm comm<span class="token punctuation">)</span> å‘é€ç¼“å†²åŒºçš„èµ·å§‹åœ°å€ï¼›å‘é€çš„æ•°æ®ä¸ªæ•°ï¼›æ•°æ®ç±»å‹ï¼›æ¥æ”¶ç¼“å†²åŒºçš„èµ·å§‹åœ°å€ï¼›å¾…æ¥æ”¶çš„å…ƒç´ ä¸ªæ•°ï¼›æ¥æ”¶çš„æ•°æ®ç±»å‹ï¼›æ¥æ”¶è¿›ç¨‹id ï¼›é€šä¿¡å­ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>int MPI_Gather(void* sendbuf, int sendcount, MPI_Datatype sendtype, void* recvbuf, int recvcount, MPI_Datatype recvtype, int root, MPI_Comm comm)</code> ï¼Œç”¨äºå°†ä¸€ä¸ªè¿›ç¨‹çš„å±€éƒ¨æ•°æ®æ”¶é›†åˆ°æ ¹è¿›ç¨‹ä¸­ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>sendbuf</code>ï¼šæŒ‡å‘å‘é€ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè¯¥ç¼“å†²åŒºåŒ…å«è¦å‘é€çš„æ•°æ®ã€‚</li><li><code>sendcount</code>ï¼šè¦å‘é€çš„å…ƒç´ æ•°é‡ã€‚</li><li><code>sendtype</code>ï¼šå‘é€ç¼“å†²åŒºä¸­å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚</li><li><code>recvbuf</code>ï¼šæŒ‡å‘æ¥æ”¶ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè¯¥ç¼“å†²åŒºå°†å­˜å‚¨æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</li><li><code>recvcount</code>ï¼šæ¯ä¸ªè¿›ç¨‹åº”æ¥æ”¶çš„å…ƒç´ æ•°é‡ã€‚</li><li><code>recvtype</code>ï¼šæ¥æ”¶ç¼“å†²åŒºä¸­å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚</li><li><code>root</code>ï¼šæ ¹è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œå³æ•°æ®åˆ†å‘çš„èµ·ç‚¹ã€‚</li><li><code>comm</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ç»„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h3 id="å®éªŒè¯´æ˜ï¼š"><a href="#å®éªŒè¯´æ˜ï¼š" class="headerlink" title="å®éªŒè¯´æ˜ï¼š"></a>å®éªŒè¯´æ˜ï¼š</h3><p>ä½¿ç”¨å‡½æ•°MPI_Gatheråœ¨æ ¹è¿›ç¨‹ä¸­ä»æ‰€æœ‰è¿›ç¨‹æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶åœ¨æ ¹è¿›ç¨‹ä¸­æ‰“å°å‡ºæ¥ã€‚</p><p>è¾“å‡ºç»“æœï¼š<br>Now is process 1â€™s data: arr[0]&#x3D;1 arr[1]&#x3D;2 arr[2]&#x3D;3 arr[3]&#x3D;4 arr[4]&#x3D;5<br>Now is process 4â€™s data: arr[0]&#x3D;1 arr[1]&#x3D;2 arr[2]&#x3D;3 arr[3]&#x3D;4 arr[4]&#x3D;5<br>Now is process 2â€™s data: arr[0]&#x3D;1 arr[1]&#x3D;2 arr[2]&#x3D;3 arr[3]&#x3D;4 arr[4]&#x3D;5<br>â€¦<br>Now is process nâ€™s data: arr[0]&#x3D;1 arr[1]&#x3D;2 arr[2]&#x3D;3 arr[3]&#x3D;4 arr[4]&#x3D;5</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token keyword">int</span> dest <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token operator">*</span>rbuf<span class="token punctuation">;</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> dest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    rbuf<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>numprocs<span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//your code here</span><span class="token function">MPI_Gather</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> rbuf<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span><span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> dest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>dest<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>numprocs<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now is process %d's data: "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"array[%d]=%d\t"</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> rbuf<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">5</span><span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•£å‘ï¼ˆscatterï¼‰"><a href="#æ•£å‘ï¼ˆscatterï¼‰" class="headerlink" title="æ•£å‘ï¼ˆscatterï¼‰"></a>æ•£å‘ï¼ˆscatterï¼‰</h2><p>åœ¨å‰é¢æˆ‘ä»¬å­¦ä¹ äº†æ”¶é›†ï¼ˆgatherï¼‰æ“ä½œï¼Œé‚£ä¹ˆä¸ä¹‹ç›¸å¯¹åº”ä¹Ÿæœ‰ä¸€ä¸ªç›¸åçš„é›†åˆé€šä¿¡æ“ä½œï¼Œå³æ ¹è¿›ç¨‹å‘æ‰€æœ‰è¿›ç¨‹å‘é€ç¼“å†²åŒºçš„æ•°æ®ï¼Œç§°ä¸ºæ•£å‘ã€‚</p><p>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œæ•£å‘æ“ä½œå’Œå¹¿æ’­æ“ä½œçš„åŒºåˆ«åœ¨äºå‘é€åˆ°å„ä¸ªè¿›ç¨‹çš„ä¿¡æ¯å¯ä»¥æ˜¯ä¸åŒçš„ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-7"><a href="#å‡½æ•°è¯´æ˜-7" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><blockquote><p>MPI_SCATTERæ˜¯MPI_GATHERçš„é€†æ“ä½œï¼Œå¦å¤–ä¸€ç§è§£é‡Šæ˜¯æ ¹è¿›ç¨‹é€šè¿‡MPI_Sendå‘é€ä¸€æ¡æ¶ˆæ¯,è¿™æ¡æ¶ˆæ¯è¢«åˆ†æˆnç­‰ä»½,ç¬¬iä»½å‘é€ç»™ç»„ä¸­çš„ç¬¬iä¸ªå¤„ç†å™¨, ç„¶åæ¯ä¸ªå¤„ç†å™¨å¦‚ä¸Šæ‰€è¿°æ¥æ”¶ç›¸åº”çš„æ¶ˆæ¯ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Scatter</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sendbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> sendcount<span class="token punctuation">,</span> MPI_Datatype sendtype<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> recvbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> recvcount<span class="token punctuation">,</span> MPI_Datatype recvtype<span class="token punctuation">,</span><span class="token keyword">int</span> root<span class="token punctuation">,</span> MPI_Comm comm<span class="token punctuation">)</span> å‘é€ç¼“å†²åŒºçš„èµ·å§‹åœ°å€ï¼›å‘é€çš„æ•°æ®ä¸ªæ•°ï¼›æ•°æ®ç±»å‹ï¼›æ¥æ”¶ç¼“å†²åŒºçš„èµ·å§‹åœ°å€ï¼›å¾…æ¥æ”¶çš„å…ƒç´ ä¸ªæ•°ï¼›æ•°æ®ç±»å‹ï¼›å‘é€è¿›ç¨‹idï¼›é€šä¿¡å­ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>int MPI_Scatter(void* sendbuf, int sendcount, MPI_Datatype sendtype, void* recvbuf, int recvcount, MPI_Datatype recvtype,int root, MPI_Comm comm)</code> ï¼Œç”¨äºåœ¨å¹¶è¡Œè®¡ç®—ä¸­å°†æ•°æ®ä»æ ¹è¿›ç¨‹åˆ†æ•£åˆ°å…¶ä»–æ‰€æœ‰è¿›ç¨‹ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>sendbuf</code>ï¼šæŒ‡å‘å‘é€ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè¯¥ç¼“å†²åŒºåŒ…å«è¦å‘é€çš„æ•°æ®ã€‚</li><li><code>sendcount</code>ï¼šè¦å‘é€çš„å…ƒç´ æ•°é‡ã€‚</li><li><code>sendtype</code>ï¼šå‘é€ç¼“å†²åŒºä¸­å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚</li><li><code>recvbuf</code>ï¼šæŒ‡å‘æ¥æ”¶ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè¯¥ç¼“å†²åŒºå°†å­˜å‚¨æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</li><li><code>recvcount</code>ï¼šæ¯ä¸ªè¿›ç¨‹åº”æ¥æ”¶çš„å…ƒç´ æ•°é‡ã€‚</li><li><code>recvtype</code>ï¼šæ¥æ”¶ç¼“å†²åŒºä¸­å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚</li><li><code>root</code>ï¼šæ ¹è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œå³æ•°æ®åˆ†å‘çš„èµ·ç‚¹ã€‚</li><li><code>comm</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ç»„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> rank<span class="token punctuation">,</span> size<span class="token punctuation">;</span>    <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rank<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> sendbuf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> recvbuf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>rank <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ ¹è¿›ç¨‹åˆå§‹åŒ–å‘é€ç¼“å†²åŒº</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sendbuf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ä½¿ç”¨MPI_Scatterè¿›è¡Œæ•°æ®åˆ†å‘</span>    <span class="token function">MPI_Scatter</span><span class="token punctuation">(</span>sendbuf<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> recvbuf<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Process %d received data: "</span><span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> recvbuf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>MPI_Scatter</code>å‡½æ•°å°†æ•°æ®ä»æ ¹è¿›ç¨‹åˆ†æ•£åˆ°å…¶ä»–æ‰€æœ‰è¿›ç¨‹ã€‚æ ¹è¿›ç¨‹åˆå§‹åŒ–å‘é€ç¼“å†²åŒºï¼Œç„¶åè°ƒç”¨<code>MPI_Scatter</code>å‡½æ•°è¿›è¡Œæ•°æ®åˆ†å‘ã€‚å…¶ä»–è¿›ç¨‹æ¥æ”¶åˆ°æ•°æ®åï¼Œå°†å…¶æ‰“å°å‡ºæ¥ã€‚</p></blockquote><h3 id="å®éªŒè¯´æ˜ï¼š-1"><a href="#å®éªŒè¯´æ˜ï¼š-1" class="headerlink" title="å®éªŒè¯´æ˜ï¼š"></a>å®éªŒè¯´æ˜ï¼š</h3><p>ä½¿ç”¨å‡½æ•°MPI_Scatteråœ¨æ ¹è¿›ç¨‹ä¸­å‘æ‰€æœ‰è¿›ç¨‹å‘é€å¯¹åº”æ•°ç»„ï¼Œå¹¶åœ¨å¯¹åº”è¿›ç¨‹ä¸­æ‰“å°å‡ºæ¥ã€‚</p><p>è¾“å‡ºç»“æœï¼š<br>Now is process 1: arr[0]&#x3D;5 arr[1]&#x3D;6 arr[2]&#x3D;7 arr[3]&#x3D;8 arr[4]&#x3D;9<br>Now is process 4: arr[0]&#x3D;20 arr[1]&#x3D;21 arr[2]&#x3D;22 arr[3]&#x3D;23 arr[4]&#x3D;24<br>Now is process 2: arr[0]&#x3D;10 arr[1]&#x3D;11 arr[2]&#x3D;12 arr[3]&#x3D;13 arr[4]&#x3D;14<br>â€¦<br>Now is process n: arr[0]&#x3D;5<em>n arr[1]&#x3D;5</em>n+1 arr[2]&#x3D;5<em>n+2 arr[3]&#x3D;5</em>n+3 arr[4]&#x3D;5*n+4<br>â€¦</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token keyword">int</span> source <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token operator">*</span>sbuf<span class="token punctuation">;</span><span class="token keyword">int</span> rbuf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    sbuf<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>numprocs<span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>numprocs<span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    sbuf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token comment">// your code here</span>    <span class="token function">MPI_Scatter</span><span class="token punctuation">(</span>sbuf<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> rbuf<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> source<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now is process %d: "</span><span class="token punctuation">,</span> myid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"array[%d]=%d\t"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> rbuf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Reduceå’ŒGatherrçš„åŒºåˆ«"><a href="#Reduceå’ŒGatherrçš„åŒºåˆ«" class="headerlink" title="Reduceå’ŒGatherrçš„åŒºåˆ«"></a>Reduceå’ŒGatherrçš„åŒºåˆ«</h2><p><code>MPI_Reduce</code> å’Œ <code>MPI_Gather</code> æ˜¯ MPIï¼ˆMessage Passing Interfaceï¼‰ä¸­ç”¨äºå¹¶è¡Œè®¡ç®—ä¸­çš„ä¸¤ç§ä¸åŒçš„é›†åˆé€šä¿¡æ“ä½œã€‚å®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºæ•°æ®çš„å¤„ç†æ–¹å¼å’Œç›®çš„ï¼š</p><ol><li><p><strong>MPI_Reduce</strong>ï¼š</p><ul><li>åŠŸèƒ½ï¼š<code>MPI_Reduce</code>å‡½æ•°æ˜¯ç”¨æ¥æ‰§è¡Œä¸€ä¸ªå…¨å±€çš„è§„çº¦æ“ä½œï¼Œä¾‹å¦‚æ±‚å’Œã€æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰ï¼Œå°†æ‰€æœ‰è¿›ç¨‹ä¸­çš„ç‹¬ç«‹æ•°æ®é›†åˆåˆ°ä¸€ä¸ªè¿›ç¨‹ä¸­å»ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åº”ç”¨äº†ä¸€ä¸ªæŒ‡å®šçš„æ“ä½œç¬¦å¯¹è¿™äº›æ•°æ®è¿›è¡Œå½’çº¦ã€‚</li><li>ç”¨æ³•ï¼šæ¯ä¸ªè¿›ç¨‹æä¾›ä¸€å—æœ¬åœ°æ•°æ®ï¼Œç„¶åé€šè¿‡è°ƒç”¨<code>MPI_Reduce</code>å‡½æ•°ï¼Œç³»ç»Ÿä¼šæ ¹æ®æä¾›çš„æ“ä½œç¬¦ï¼ˆå¦‚<code>MPI_SUM</code>ã€<code>MPI_MAX</code>ç­‰ï¼‰åœ¨æ‰€æœ‰è¿›ç¨‹ä¸­å¯¹è¯¥ç±»å‹çš„æ•°æ®è¿›è¡Œå½’çº¦è¿ç®—ï¼Œæœ€ç»ˆç»“æœåªå­˜åœ¨äºè°ƒç”¨è€…æŒ‡å®šçš„ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼ˆé€šå¸¸ç§°ä¸ºæ ¹è¿›ç¨‹ï¼Œç”±å‚æ•°å†³å®šï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼šå¦‚æœæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œä½¿ç”¨<code>MPI_Reduce</code>å¯ä»¥å°†æ‰€æœ‰è¿›ç¨‹çš„æ•´æ•°åŠ èµ·æ¥å¾—åˆ°æ€»çš„å’Œã€‚</li></ul></li><li><p><strong>MPI_Gather</strong>ï¼š</p><ul><li>åŠŸèƒ½ï¼š<code>MPI_Gather</code>å‡½æ•°åˆ™æ˜¯ç”¨æ¥ä»æ‰€æœ‰å‚ä¸é€šä¿¡çš„è¿›ç¨‹ä¸­æ”¶é›†ç›¸åŒæ•°é‡çš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®æŒ‰ç…§è¿›ç¨‹çš„ç§©é¡ºåºæ’åˆ—åï¼Œåˆå¹¶åˆ°æ ¹è¿›ç¨‹çš„ä¸€ä¸ªè¿ç»­å†…å­˜åŒºåŸŸä¸­ã€‚</li><li>ç”¨æ³•ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæœ¬åœ°æ•°æ®ç¼“å†²åŒºï¼Œè°ƒç”¨<code>MPI_Gather</code>åï¼Œæ‰€æœ‰è¿›ç¨‹çš„æ•°æ®éƒ½ä¼šè¢«æ”¶é›†åˆ°æ ¹è¿›ç¨‹çš„ä¸€ä¸ªå¤§ç¼“å†²åŒºä¸­ï¼Œå½¢æˆä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„çš„ç¬¬iä¸ªå…ƒç´ æ¥è‡ªäºç§©ä¸ºiçš„è¿›ç¨‹çš„æœ¬åœ°æ•°æ®ã€‚</li><li>ç¤ºä¾‹ï¼šå¦‚æœæœ‰10ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªé•¿åº¦ä¸º10çš„æµ®ç‚¹æ•°æ•°ç»„ï¼Œä½¿ç”¨<code>MPI_Gather</code>å¯ä»¥åœ¨æ ¹è¿›ç¨‹å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„å¤§å°ä¸º10x10çš„äºŒç»´æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€åˆ—æ¥è‡ªä¸€ä¸ªè¿›ç¨‹çš„åŸå§‹æ•°ç»„ã€‚</li></ul></li></ol><p>æ€»ç»“æ¥è¯´ï¼Œ<code>MPI_Reduce</code>æ˜¯åšæ•°æ®çš„èšåˆå’Œæ“ä½œï¼Œç›®æ ‡æ˜¯å¾—åˆ°å•ä¸ªè¿›ç¨‹ä¸Šçš„å”¯ä¸€ç»“æœï¼›è€Œ<code>MPI_Gather</code>åˆ™æ›´åƒæ˜¯æ•°æ®çš„æ±‡æ€»ï¼Œä¸æ¶‰åŠæ•°æ®ä¹‹é—´çš„æ“ä½œï¼Œç›®æ ‡æ˜¯å°†å„ä¸ªè¿›ç¨‹çš„æ•°æ®æ‹¼æ¥åˆ°ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„é›†åˆã€‚</p><h2 id="Bcastå’ŒScatterçš„åŒºåˆ«"><a href="#Bcastå’ŒScatterçš„åŒºåˆ«" class="headerlink" title="Bcastå’ŒScatterçš„åŒºåˆ«"></a>Bcastå’ŒScatterçš„åŒºåˆ«</h2><p><code>MPI_Bcast</code>ï¼ˆBroadcastï¼‰å’Œ<code>MPI_Scatter</code>ï¼ˆScatterï¼‰æ˜¯Message Passing Interface (MPI) ä¸­ç”¨äºå¹¶è¡Œè®¡ç®—çš„ä¸¤ç§é›†åˆé€šä¿¡æ“ä½œï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºæ•°æ®åˆ†å‘çš„æ–¹å¼å’Œç›®çš„ï¼š</p><ol><li><p><strong>MPI_Bcast</strong>ï¼š</p><ul><li>åŠŸèƒ½ï¼š<code>MPI_Bcast</code>å‡½æ•°æ‰§è¡Œçš„æ˜¯å¹¿æ’­æ“ä½œï¼Œå³ä»ä¸€ä¸ªæŒ‡å®šçš„è¿›ç¨‹ï¼ˆç§°ä¸ºâ€œæ ¹è¿›ç¨‹â€ï¼‰å°†ç›¸åŒçš„æ•°æ®å‘é€ç»™ communicator å†…çš„æ‰€æœ‰å…¶ä»–è¿›ç¨‹ã€‚</li><li>ç”¨æ³•ï¼šåœ¨è°ƒç”¨<code>MPI_Bcast</code>æ—¶ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½ä¼šæä¾›ä¸€ä¸ªç¼“å†²åŒºï¼Œä½†åªæœ‰æ ¹è¿›ç¨‹çš„ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼šè¢«å¹¿æ’­ã€‚æ‰§è¡Œåï¼Œæ‰€æœ‰å‚ä¸é€šä¿¡çš„è¿›ç¨‹ä¸­ç¼“å†²åŒºçš„å†…å®¹éƒ½ä¼šè¢«æ›´æ–°ä¸ºæ ¹è¿›ç¨‹ç¼“å†²åŒºä¸­å¹¿æ’­å‡ºå»çš„æ•°æ®ã€‚</li><li>ç¤ºä¾‹åœºæ™¯ï¼šä¾‹å¦‚ï¼Œå¦‚æœæ ¹è¿›ç¨‹æœ‰ä¸€ä¸ªå…¨å±€å‚æ•°éœ€è¦æ‰€æœ‰çš„å…¶ä»–è¿›ç¨‹çŸ¥é“ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨<code>MPI_Bcast</code>æ¥å¿«é€Ÿåœ°è®©æ‰€æœ‰è¿›ç¨‹è·å–åˆ°ç›¸åŒçš„å‚æ•°å€¼ã€‚</li></ul></li><li><p><strong>MPI_Scatter</strong>ï¼š</p><ul><li>åŠŸèƒ½ï¼š<code>MPI_Scatter</code>å‡½æ•°åˆ™è´Ÿè´£å°†æ ¹è¿›ç¨‹çš„ä¸€ä¸ªå¤§æ•°ç»„åˆ†å‰²æˆå¤šä¸ªå­å—ï¼Œå¹¶å°†è¿™äº›å­å—åˆ†åˆ«å‘é€ç»™ communicator å†…çš„ä¸åŒè¿›ç¨‹ã€‚</li><li>ç”¨æ³•ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æä¾›ä¸€ä¸ªæ¥æ”¶ç¼“å†²åŒºï¼Œä½†å†…å®¹å¤§å°é€šå¸¸å°äºæˆ–ç­‰äºæ ¹è¿›ç¨‹çš„å‘é€ç¼“å†²åŒºã€‚æ‰§è¡Œåï¼Œå„ä¸ªè¿›ç¨‹æ¥æ”¶åˆ°çš„æ•°æ®æ¥è‡ªåŸå§‹å¤§æ•°ç»„çš„ä¸åŒéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å®Œå…¨ç›¸åŒçš„æ•°æ®ã€‚</li><li>ç¤ºä¾‹åœºæ™¯ï¼šæ¯”å¦‚ï¼Œåœ¨åˆ†å¸ƒå¼çŸ©é˜µä¹˜æ³•ä¸­ï¼Œæ ¹è¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå¤§çš„çŸ©é˜µAï¼Œå®ƒå¯èƒ½éœ€è¦å°†çŸ©é˜µAçš„å„è¡Œåˆ†æ•£ç»™ä¸åŒçš„è¿›ç¨‹è¿›è¡Œå±€éƒ¨è®¡ç®—ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨<code>MPI_Scatter</code>å°†çŸ©é˜µAæ‹†åˆ†æˆå¤šä»½å¹¶åˆ†å‘ç»™å„ä¸ªè¿›ç¨‹ã€‚</li></ul></li></ol><p>æ€»ç»“æ¥è¯´ï¼Œ<code>MPI_Bcast</code>ç”¨äºå‘æ‰€æœ‰è¿›ç¨‹å‘é€ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œè€Œ<code>MPI_Scatter</code>åˆ™æ˜¯å°†æ•°æ®åˆ†è§£ååˆ†é…ç»™å„ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹å¾—åˆ°çš„æ•°æ®ä¸åŒï¼Œé€šå¸¸æ˜¯åŸå§‹æ•°æ®çš„ä¸€ä¸ªå­é›†ã€‚</p><h2 id="è®¡ç®—è¿è¡Œæ—¶é—´"><a href="#è®¡ç®—è¿è¡Œæ—¶é—´" class="headerlink" title="è®¡ç®—è¿è¡Œæ—¶é—´"></a>è®¡ç®—è¿è¡Œæ—¶é—´</h2><p>å¯ä»¥ä½¿ç”¨MPI_Wtimeå‡½æ•°åœ¨å¹¶è¡Œä»£ç ä¸­è®¡ç®—è¿è¡Œæ—¶é—´ï¼Œç”¨MPI_Wtickæ¥æŸ¥çœ‹ç²¾åº¦ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-8"><a href="#å‡½æ•°è¯´æ˜-8" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><p>MPI_WTIMEï¼š<code>è¿”å›</code>ä¸€ä¸ªç”¨æµ®ç‚¹æ•°è¡¨ç¤ºçš„ç§’æ•°, å®ƒè¡¨ç¤ºä»è¿‡å»æŸä¸€æ—¶åˆ»åˆ°è°ƒç”¨æ—¶åˆ»æ‰€ç»å†çš„æ—¶é—´</p><p>MPI_WTICKï¼š<code>è¿”å›</code>MPI_WTIMEçš„ç²¾åº¦ï¼Œå•ä½æ˜¯ç§’ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæ—¶é’Ÿæ»´ç­”æ‰€å ç”¨çš„æ—¶é—´</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">MPI_Wtime</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token keyword">double</span> <span class="token function">MPI_Wtick</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>double MPI_Wtime(void)</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–å½“å‰è¿›ç¨‹çš„å¢™é’Ÿæ—¶é—´çš„å‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºä»æŸä¸ªå›ºå®šæ—¶é—´ç‚¹ï¼ˆé€šå¸¸æ˜¯ç¨‹åºå¯åŠ¨æ—¶ï¼‰åˆ°ç°åœ¨æ‰€ç»è¿‡çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºæ€§èƒ½åˆ†æå’Œè°ƒè¯•ã€‚</p><p><code>double MPI_Wtick(void)</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–å½“å‰è¿›ç¨‹çš„å¢™é’Ÿæ—¶é—´é—´éš”çš„å‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºä»ä¸Šä¸€æ¬¡è°ƒç”¨ <code>MPI_Wtime()</code> å‡½æ•°åˆ°ç°åœ¨æ‰€ç»è¿‡çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºæ€§èƒ½åˆ†æå’Œè°ƒè¯•ã€‚</p><h3 id="å®éªŒè¯´æ˜-5"><a href="#å®éªŒè¯´æ˜-5" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>ä½¿ç”¨å‡½æ•°MPI_Wtimeè®¡ç®—å¹¶è¡Œä»£ç çš„è¿è¡Œæ—¶é—´ï¼Œå¹¶ä¸”åœ¨ä¸¤æ¬¡è®¡ç®—æ—¶é—´çš„å‡½æ•°ä¹‹é—´ç”¨å‡½æ•°MPI_WTICKæ‰“å°å‡ºç²¾åº¦</p><p>è¾“å‡ºç»“æœï¼š</p><p>The precision is: 1e-06<br>Hello World!Iâ€™m rank â€¦ of â€¦, running â€¦ seconds</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token keyword">double</span> start<span class="token punctuation">,</span> finish<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span>start <span class="token operator">=</span> <span class="token function">MPI_Wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The precision is: %f\n"</span><span class="token punctuation">,</span> <span class="token function">MPI_Wtick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>finish <span class="token operator">=</span> <span class="token function">MPI_Wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!I'm rank %d of %d, running %f seconds.\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> finish<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h2><p>ä¾‹å¦‚ï¼Œå¸Œæœ›ä¿è¯æ‰€æœ‰è¿›ç¨‹ä¸­å¹¶è¡Œä»£ç åœ¨æŸä¸ªåœ°æ–¹åŒæ—¶å¼€å§‹è¿è¡Œï¼Œæˆ–è€…åœ¨æŸä¸ªå‡½æ•°è°ƒç”¨ç»“æŸä¹‹å‰ä¸èƒ½è¿”å›ã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ°MPI_Barrierå‡½æ•°ã€‚</p><h3 id="å‡½æ•°è¯´æ˜ï¼š"><a href="#å‡½æ•°è¯´æ˜ï¼š" class="headerlink" title="å‡½æ•°è¯´æ˜ï¼š"></a>å‡½æ•°è¯´æ˜ï¼š</h3><p>é˜»æ­¢è°ƒç”¨ç›´åˆ°communicatorä¸­æ‰€æœ‰è¿›ç¨‹å·²ç»å®Œæˆè°ƒç”¨ï¼Œå°±æ˜¯è¯´ï¼Œä»»æ„ä¸€æ¬¡è¿›ç¨‹çš„è°ƒç”¨åªèƒ½åœ¨æ‰€æœ‰communicatorä¸­çš„æˆå‘˜å·²ç»å¼€å§‹è°ƒç”¨ä¹‹åè¿›è¡Œã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Barrier</span><span class="token punctuation">(</span>MPI_Comm comm<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>MPI_Barrier(MPI_Comm comm)</code> æ˜¯ä¸€ä¸ªç”¨äºåŒæ­¥è¿›ç¨‹çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼š</p><ol><li><code>MPI_Comm comm</code>ï¼šä¸€ä¸ªé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºè¦åŒæ­¥çš„è¿›ç¨‹ç»„ã€‚</li></ol><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œè¿”å›å€¼ä¸º <code>MPI_SUCCESS</code>ï¼›å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªéé›¶çš„é”™è¯¯ä»£ç ã€‚</p><h3 id="å®éªŒè¯´æ˜ï¼š-2"><a href="#å®éªŒè¯´æ˜ï¼š-2" class="headerlink" title="å®éªŒè¯´æ˜ï¼š"></a>å®éªŒè¯´æ˜ï¼š</h3><p>åœ¨è®¡ç®—è¿è¡Œæ—¶é—´çš„ä¿¡æ¯ä¹‹å‰è°ƒç”¨MPI_Barrierå‡½æ•°å®ŒæˆåŒæ­¥ã€‚</p><p>è¾“å‡ºç»“æœï¼š</p><p>The precision is: 1e-06<br>Hello World!Iâ€™m rank â€¦ of â€¦, running â€¦ seconds.</p><p>åœ¨æ­¤ç¤ºä¾‹ç¨‹åºä¸­ï¼Œå¯èƒ½æ˜¯å¦è°ƒç”¨å‡½æ•°ä¸å½±å“æœ€ç»ˆè¾“å‡ºï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ•ˆæœç›¸åŒã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span><span class="token keyword">double</span> start<span class="token punctuation">,</span> finish<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span><span class="token function">MPI_Barrier</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span>start <span class="token operator">=</span> <span class="token function">MPI_Wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The precision is: %f\n"</span><span class="token punctuation">,</span> <span class="token function">MPI_Wtick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>finish <span class="token operator">=</span> <span class="token function">MPI_Wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!I'm rank %d of %d, running %f seconds.\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> finish<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»„çš„ç®¡ç†"><a href="#ç»„çš„ç®¡ç†" class="headerlink" title="ç»„çš„ç®¡ç†"></a>ç»„çš„ç®¡ç†</h2><h3 id="åˆ›å»ºï¼ˆ1ï¼‰"><a href="#åˆ›å»ºï¼ˆ1ï¼‰" class="headerlink" title="åˆ›å»ºï¼ˆ1ï¼‰"></a>åˆ›å»ºï¼ˆ1ï¼‰</h3><p>ç»„æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„æœ‰åºé›†åˆï¼Œåœ¨å®ç°ä¸­å¯ä»¥çœ‹ä½œæ˜¯è¿›ç¨‹æ ‡è¯†ç¬¦çš„ä¸€ä¸ªæœ‰åºé›†ã€‚ç»„å†…çš„æ¯ä¸ªè¿›ç¨‹ä¸ä¸€ä¸ªæ•´æ•°rankç›¸è”ç³»ï¼Œåºåˆ—å·ä»0å¼€å§‹å¹¶ä¸”æ˜¯è¿ç»­çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é€šä¿¡ç»„ä¸­ä½¿ç”¨ç»„ï¼Œæ¥æè¿°é€šä¿¡ç©ºé—´ä¸­çš„å‚ä¸è€…å¹¶å¯¹è¿™äº›å‚ä¸è€…è¿›è¡Œåˆ†çº§ï¼ˆè¿™æ ·åœ¨é€šä¿¡ç©ºé—´ä¸­ä¸ºå®ƒä»¬èµ‹äºˆäº†å”¯ä¸€çš„åå­—ï¼‰</p><p>ç”±æ­¤å¯è§ï¼Œç»„æ˜¯æˆ‘ä»¬å¯¹è¿›ç¨‹é›†åˆæ›´é«˜ä¸€çº§çš„æŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„çš„åŸºç¡€ä¸Šå¯¹å„ä¸ªè¿›ç¨‹è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œï¼Œä¾‹å¦‚é€šè¿‡è™šæ‹Ÿæ‹“æ‰‘æ¥è¾…åŠ©å¹¶è¡Œæ“ä½œçš„å®ç°ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆä»‹ç»ä¸¤ä¸ªç‰¹æ®Šçš„é¢„å®šä¹‰ç»„ï¼ŒMPI_GROUP_EMPTYå’ŒMPI_GROUP_NULLã€‚<br>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œå‰è€…æ˜¯ä¸€ä¸ªç©ºç»„çš„æœ‰æ•ˆå¥æŸ„ï¼Œå¯ä»¥åœ¨ç»„æ“ä½œä¸­ä½œä¸ºä¸€ä¸ªå‚æ•°ä½¿ç”¨ï¼›è€Œåè€…æ˜¯ä¸€ä¸ªæ— æ•ˆå¥æŸ„ï¼Œåœ¨ç»„é‡Šæ”¾æ—¶ä¼šè¢«è¿”å›ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-9"><a href="#å‡½æ•°è¯´æ˜-9" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><blockquote><p>MPI_Comm_groupç”¨æ¥å»ºç«‹ä¸€ä¸ªé€šä¿¡ç»„å¯¹åº”çš„æ–°è¿›ç¨‹ç»„</p><p>MPI_Group_rankæŸ¥è¯¢è°ƒç”¨è¿›ç¨‹åœ¨è¿›ç¨‹ç»„é‡Œçš„rank</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_Comm comm<span class="token punctuation">,</span> MPI_Group <span class="token operator">*</span>group<span class="token punctuation">)</span><span class="token keyword">int</span> <span class="token function">MPI_Group_rank</span><span class="token punctuation">(</span>MPI_Group group<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>rank<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>MPI_Comm_group(MPI_Comm comm, MPI_Group *group)</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–è¿›ç¨‹ç»„çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>MPI_Comm comm</code>ï¼šä¸€ä¸ªé€šä¿¡å™¨å¯¹è±¡ï¼Œè¡¨ç¤ºè¦æŸ¥è¯¢çš„è¿›ç¨‹ç»„æ‰€å±çš„é€šä¿¡å™¨ã€‚</li><li><code>MPI_Group *group</code>ï¼šä¸€ä¸ªæŒ‡å‘ <code>MPI_Group</code> ç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢åˆ°çš„è¿›ç¨‹ç»„ã€‚</li></ol><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œè¿”å›å€¼ä¸º <code>MPI_SUCCESS</code>ï¼›å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªéé›¶çš„é”™è¯¯ä»£ç ã€‚</p><p><code>MPI_Group_rank(MPI_Group group, int *rank)</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–è¿›ç¨‹ç»„ä¸­æŸä¸ªè¿›ç¨‹çš„æ’åçš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><code>MPI_Group group</code>ï¼šä¸€ä¸ªè¿›ç¨‹ç»„å¯¹è±¡ï¼Œè¡¨ç¤ºè¦æŸ¥è¯¢çš„è¿›ç¨‹ç»„ã€‚</li><li><code>int *rank</code>ï¼šä¸€ä¸ªæŒ‡å‘æ•´æ•°ç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢åˆ°çš„è¿›ç¨‹æ’åã€‚</li></ol><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œè¿”å›å€¼ä¸º <code>MPI_SUCCESS</code>ï¼›å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªéé›¶çš„é”™è¯¯ä»£ç ã€‚</p></blockquote><h4 id="å®éªŒè¯´æ˜-6"><a href="#å®éªŒè¯´æ˜-6" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>å»ºç«‹ä¸€ä¸ªä¸åˆå§‹é€šä¿¡å­MPI_COMM_WORLDç›¸è”ç³»çš„ç»„ï¼Œæ‰“å°å‡ºå½“å‰è¿›ç¨‹åœ¨è¿›ç¨‹ç»„çš„rankã€‚</p><p>è¾“å‡ºç»“æœ:<br>rankï¼š 1<br>rankï¼š 0<br>â€¦<br>rankï¼š n</p><p>é¡ºåºä¸å”¯ä¸€</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">;</span><span class="token keyword">int</span> rank_of_group<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Group_rank</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rank_of_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"rank: %d\n"</span><span class="token punctuation">,</span> rank_of_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ›å»ºï¼ˆ2ï¼‰"><a href="#åˆ›å»ºï¼ˆ2ï¼‰" class="headerlink" title="åˆ›å»ºï¼ˆ2ï¼‰"></a>åˆ›å»ºï¼ˆ2ï¼‰</h3><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬çŸ¥é“ï¼Œå¯ä»¥ç”¨MPI_Comm_groupå‡½æ•°æ¥è·å¾—ä¸é€šä¿¡ç»„MPI_COMM_WORLDç›¸å…³è”çš„ç»„å¥æŸ„ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªç»„å¥æŸ„åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæœ€åŸå§‹çš„ç»„å¥æŸ„æ¥åˆ›å»ºæ›´å¤šçš„ã€æ»¡è¶³æˆ‘ä»¬éœ€è¦çš„ç»„ã€‚</p><p>åœ¨è¿™é‡Œéœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼ŒMPIæ²¡æä¾›å‡­ç©ºæ„é€ ä¸€ä¸ªç»„çš„çš„æœºåˆ¶ï¼Œè€Œåªèƒ½ä»å…¶å®ƒä»¥å‰å®šä¹‰çš„ç»„ä¸­æ„é€ ã€‚æœ€åŸºæœ¬çš„ç»„æ˜¯ä¸åˆå§‹é€šä¿¡å­MPI_COMM_WORLDç›¸è”ç³»çš„ç»„ï¼ˆå¯é€šè¿‡å‡½æ•°MPI_COMM_GROUPè·å¾—ã€•ï¼Œå…¶å®ƒçš„ç»„åœ¨è¯¥ç»„åŸºç¡€ä¸Šå®šä¹‰ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-10"><a href="#å‡½æ•°è¯´æ˜-10" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><blockquote><p>åŸºäºå·²ç»å­˜åœ¨çš„è¿›ç¨‹ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ï¼Œå¹¶æŒ‡æ˜è¢«åŒ…å«(included)å…¶ä¸­çš„æˆå‘˜è¿›ç¨‹ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Group_incl</span><span class="token punctuation">(</span>MPI_Group old_group<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>members<span class="token punctuation">,</span> MPI_Group <span class="token operator">*</span>new_group<span class="token punctuation">)</span>æ—§è¿›ç¨‹ç»„è¦åŒ…å«åœ¨æ–°è¿›ç¨‹ç»„çš„è¿›ç¨‹æ•°é‡  è¦æ”¾å…¥æ–°è¿›ç¨‹ç»„çš„è¿›ç¨‹çš„ç¼–å·æ•°ç»„ æŒ‡é’ˆæŒ‡å‘æ–°è¿›ç¨‹ç»„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ä¸ªå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»„ï¼Œè¯¥ç»„åŒ…å«æ—§è¿›ç¨‹ç»„ä¸­æŒ‡å®šçš„æˆå‘˜ã€‚</p><p>å‚æ•°è§£æï¼š</p><ul><li><code>old_group</code>ï¼šä¸€ä¸ªMPI_Groupç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºè¦å¤åˆ¶çš„æ—§è¿›ç¨‹ç»„ã€‚</li><li><code>count</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦åŒ…å«åœ¨æ–°çš„è¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹æ•°é‡ã€‚</li><li><code>members</code>ï¼šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼ŒåŒ…å«äº†è¦åŒ…å«åœ¨æ–°è¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚</li><li><code>new_group</code>ï¼šä¸€ä¸ªMPI_Groupç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘æ–°åˆ›å»ºçš„è¿›ç¨‹ç»„ã€‚</li></ul><p>å‡½æ•°æ‰§è¡Œåï¼Œ<code>new_group</code>å°†æŒ‡å‘ä¸€ä¸ªæ–°åˆ›å»ºçš„è¿›ç¨‹ç»„ï¼Œè¯¥è¿›ç¨‹ç»„åŒ…å«äº†<code>old_group</code>ä¸­æŒ‡å®šçš„æˆå‘˜ã€‚</p></blockquote><h4 id="å®éªŒè¯´æ˜-7"><a href="#å®éªŒè¯´æ˜-7" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>åŸºäºä¸åˆå§‹é€šä¿¡å­MPI_COMM_WORLDç›¸è”ç³»çš„ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ï¼Œè¿™ä¸ªæ–°çš„ç»„çš„æˆå‘˜æ˜¯é€šä¿¡è€…MPI_COMM_WORLDçš„å¥‡æ•°ç¼–å·çš„è¿›ç¨‹ã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>In process n: odd rank is x<br>â€¦</p><p>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœåœ¨å¶æ•°ç¼–å·çš„è¿›ç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸å±äºè¿™ä¸ªç»„çš„è¿›ç¨‹ä¸­è¾“å‡ºè¿™ä¸ªå€¼ï¼ŒMPI_Group_rankä¼šè¿”å›MPI_UNDEFINEDä½œä¸ºgroup_rankçš„å€¼ï¼Œè¡¨ç¤ºå®ƒä¸æ˜¯ worker_groupçš„æˆå‘˜ï¼Œåœ¨MPICHé‡Œæ˜¯-32766ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> odd_rank<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">,</span> odd_group<span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">int</span> members<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>members<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// your code here</span><span class="token function">MPI_Group_incl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> members<span class="token punctuation">,</span> <span class="token operator">&amp;</span>odd_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token function">MPI_Group_rank</span><span class="token punctuation">(</span>odd_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span>odd_rank<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In process %d: odd rank is %d\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> odd_rank<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ›å»ºï¼ˆ3ï¼‰"><a href="#åˆ›å»ºï¼ˆ3ï¼‰" class="headerlink" title="åˆ›å»ºï¼ˆ3ï¼‰"></a>åˆ›å»ºï¼ˆ3ï¼‰</h3><p>åŒæ ·ï¼Œæˆ‘ä»¬åœ¨åŸºäºæ—§è¿›ç¨‹ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„çš„æ—¶å€™ï¼Œå¯èƒ½å¸Œæœ›æ’é™¤ä¸€äº›æˆå‘˜è¿›ç¨‹ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰æ‹©å‡ºå‰©ä¸‹çš„æˆå‘˜è¿›ç¨‹çš„æ–¹æ³•æ¥è¾¾æˆæˆ‘ä»¬çš„ç›®çš„ï¼Œä½†æ˜¯MPIæä¾›äº†æ›´å¥½çš„åŠæ³•å»å®ç°å®ƒã€‚</p><h4 id="å‡½æ•°è¯´æ˜-11"><a href="#å‡½æ•°è¯´æ˜-11" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><blockquote><p>åŸºäºå·²ç»å­˜åœ¨çš„è¿›ç¨‹ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ï¼Œå¹¶æŒ‡æ˜ä¸è¢«åŒ…å«(excluded)å…¶ä¸­çš„æˆå‘˜è¿›ç¨‹ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Group_excl</span><span class="token punctuation">(</span>MPI_Group old_group<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>nonmembers<span class="token punctuation">,</span> MPI_Group <span class="token operator">*</span>new_group<span class="token punctuation">)</span>æ—§è¿›ç¨‹ç»„ï¼›è¦åŒ…å«åœ¨æ–°çš„è¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹æ•°é‡ï¼›ä¸éœ€è¦æ”¾å…¥æ–°è¿›ç¨‹ç»„çš„è¿›ç¨‹çš„ç¼–å·ï¼›æ–°è¿›ç¨‹ç»„çš„æŒ‡é’ˆï¼›<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ä¸ªå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»„ï¼Œè¯¥ç»„åŒ…å«æ—§è¿›ç¨‹ç»„ä¸­æŒ‡å®šçš„æˆå‘˜ï¼Œä½†ä¸åŒ…å«éæˆå‘˜åˆ—è¡¨ä¸­çš„è¿›ç¨‹ã€‚</p><p>å‚æ•°è§£æï¼š</p><ul><li><code>old_group</code>ï¼šä¸€ä¸ªMPI_Groupç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºè¦å¤åˆ¶çš„æ—§è¿›ç¨‹ç»„ã€‚</li><li><code>count</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦åŒ…å«åœ¨æ–°çš„è¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹æ•°é‡ã€‚</li><li><code>nonmembers</code>ï¼šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼ŒåŒ…å«äº†ä¸åŒ…å«åœ¨æ–°è¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚</li><li><code>new_group</code>ï¼šä¸€ä¸ªMPI_Groupç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘æ–°åˆ›å»ºçš„è¿›ç¨‹ç»„ã€‚</li></ul><p>å‡½æ•°æ‰§è¡Œåï¼Œ<code>new_group</code>å°†æŒ‡å‘ä¸€ä¸ªæ–°åˆ›å»ºçš„è¿›ç¨‹ç»„ï¼Œè¯¥è¿›ç¨‹ç»„åŒ…å«äº†<code>old_group</code>ä¸­æŒ‡å®šçš„æˆå‘˜ï¼Œä½†ä¸åŒ…å«<code>nonmembers</code>åˆ—è¡¨ä¸­çš„è¿›ç¨‹ã€‚</p></blockquote><h4 id="å®éªŒè¯´æ˜-8"><a href="#å®éªŒè¯´æ˜-8" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>åŸºäºä¸åˆå§‹é€šä¿¡å­MPI_COMM_WORLDç›¸è”ç³»çš„ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ï¼Œè¿™ä¸ªæ–°çš„ç»„çš„æˆå‘˜æ˜¯é€šä¿¡è€…MPI_COMM_WORLDçš„å¶æ•°ç¼–å·çš„è¿›ç¨‹ã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>In process n: even rank is x<br>â€¦</p><p>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœåœ¨å¥‡æ•°ç¼–å·çš„è¿›ç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸å±äºè¿™ä¸ªç»„çš„è¿›ç¨‹ä¸­è¾“å‡ºè¿™ä¸ªå€¼ï¼ŒMPI_Group_rankä¼šè¿”å›MPI_UNDEFINEDä½œä¸ºgroup_rankçš„å€¼ï¼Œè¡¨ç¤ºå®ƒä¸æ˜¯ worker_groupçš„æˆå‘˜ï¼Œåœ¨MPICHé‡Œè¿™ä¸ªå€¼æ˜¯-32766ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> even_rank<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">,</span> even_group<span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">int</span> nonmembers<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>nonmembers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// your code here</span><span class="token function">MPI_Group_excl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> nonmembers<span class="token punctuation">,</span> <span class="token operator">&amp;</span>even_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token function">MPI_Group_rank</span><span class="token punctuation">(</span>even_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span>even_rank<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In process %d: even rank is %d\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> even_rank<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç›¸å¯¹ç¼–å·"><a href="#ç›¸å¯¹ç¼–å·" class="headerlink" title="ç›¸å¯¹ç¼–å·"></a>ç›¸å¯¹ç¼–å·</h3><p>åœ¨åˆ›å»ºç»„ä¹‹åï¼Œå¯èƒ½ä¼šæœ‰è¿™ä¸ªç–‘æƒ‘ï¼šå¦‚æœçŸ¥é“äº†åœ¨ç»„MPI_COMM_WORLDä¸­æŸäº›è¿›ç¨‹çš„ç¼–å·ï¼Œå¦‚ä½•æ ¹æ®è¿™äº›ç¼–å·æ¥æ“ä½œåœ¨ä¸åŒç»„çš„åŒä¸€è¿›ç¨‹æ¥å®Œæˆä¸åŒçš„ä»»åŠ¡å‘¢ï¼Ÿ</p><p>MPIæä¾›äº†è¿™æ ·çš„å‡½æ•°ä»¥åº”ä»˜è¿™ç§å¸¸è§çš„æƒ…æ™¯ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-12"><a href="#å‡½æ•°è¯´æ˜-12" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><p>æ£€æµ‹ä¸¤ä¸ªä¸åŒç»„ä¸­ç›¸åŒè¿›ç¨‹çš„ç›¸å¯¹ç¼–å·ã€‚å¦‚æœå±äºè¿›ç¨‹ç»„1çš„æŸä¸ªè¿›ç¨‹å¯ä»¥åœ¨ranks1ä¸­æ‰¾åˆ°ï¼Œè€Œè¿™ä¸ªè¿›ç¨‹ä¸å±äºè¿›ç¨‹ç»„2ï¼Œåˆ™åœ¨ranks2ä¸­å¯¹åº”ranks1çš„ä½ç½®è¿”å›å€¼ä¸ºMPI_UNDEFINEDã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Group_translate_ranks</span><span class="token punctuation">(</span>MPI_Group group1<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>ranks1<span class="token punctuation">,</span> MPI_Group group2<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>ranks2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>MPI_Group_translate_ranks</code>å‡½æ•°ç”¨äºå°†ä¸€ä¸ªè¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹æ’åæ˜ å°„åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹æ’åã€‚å®ƒæ¥å—ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><code>group1</code>ï¼šç¬¬ä¸€ä¸ªè¿›ç¨‹ç»„ï¼Œç±»å‹ä¸º<code>MPI_Group</code>ã€‚</li><li><code>count</code>ï¼šè¦è½¬æ¢çš„è¿›ç¨‹æ•°é‡ï¼Œç±»å‹ä¸ºæ•´æ•°ã€‚</li><li><code>ranks1</code>ï¼šæŒ‡å‘åŒ…å«è¦è½¬æ¢çš„è¿›ç¨‹æ’åçš„æ•°ç»„çš„æŒ‡é’ˆï¼Œç±»å‹ä¸ºæ•´æ•°æŒ‡é’ˆã€‚</li><li><code>group2</code>ï¼šç¬¬äºŒä¸ªè¿›ç¨‹ç»„ï¼Œç±»å‹ä¸º<code>MPI_Group</code>ã€‚</li><li><code>ranks2</code>ï¼šæŒ‡å‘å­˜å‚¨è½¬æ¢åçš„è¿›ç¨‹æ’åçš„æ•°ç»„çš„æŒ‡é’ˆï¼Œç±»å‹ä¸ºæ•´æ•°æŒ‡é’ˆã€‚</li></ul><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ª<code>int</code>ç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œè¿”å›å€¼ä¸º<code>MPI_SUCCESS</code>ï¼›å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªéé›¶çš„é”™è¯¯ä»£ç ã€‚</p><h4 id="å®éªŒè¯´æ˜-9"><a href="#å®éªŒè¯´æ˜-9" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>å»ºç«‹ä¸¤ä¸ªè¿›ç¨‹ç»„ï¼Œæ‰“å°å‡ºè¿›ç¨‹ç»„2ä¸­å¯¹åº”è¿›ç¨‹ç»„1çš„è¿›ç¨‹çš„ç¼–å·ã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼ï¼š<br>The rank in group2 is: -32766<br>The rank in group2 is: 0<br>â€¦</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">,</span> group1<span class="token punctuation">,</span> group2<span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">int</span> ranks1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> ranks2<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> ranks_output<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numprocs<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>ranks1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token punctuation">;</span>ranks2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Group_incl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> numprocs<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> ranks1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Group_incl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> numprocs<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> ranks2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Group_translate_ranks</span><span class="token punctuation">(</span>group1<span class="token punctuation">,</span> numprocs<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> ranks1<span class="token punctuation">,</span> group2<span class="token punctuation">,</span> ranks_output<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numprocs<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The rank in group2 is: %d\n"</span><span class="token punctuation">,</span> ranks_output<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é‡Šæ”¾"><a href="#é‡Šæ”¾" class="headerlink" title="é‡Šæ”¾"></a>é‡Šæ”¾</h3><p>æ—¢ç„¶æœ‰äº†ç»„çš„æ„é€ ï¼Œé‚£ä¹ˆä¸ä¹‹å¯¹åº”ä¹Ÿå­˜åœ¨ç»„çš„ææ„ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-13"><a href="#å‡½æ•°è¯´æ˜-13" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><blockquote><p>è°ƒç”¨å‡½æ•°ä¼šæ ‡è®°ä¸€ä¸ªè¢«é‡Šæ”¾çš„ç»„å¯¹è±¡ï¼Œç»„å¥æŸ„è¢«è°ƒç”¨ç½®ä¸ºMPI_GROUP_NULLã€‚ä»»ä½•æ­£åœ¨ä½¿ç”¨æ­¤ç»„çš„æ“ä½œå°†æ­£å¸¸å®Œæˆã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Group_free</span><span class="token punctuation">(</span>MPI_Group <span class="token operator">*</span>group<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>int MPI_Group_free(MPI_Group *group)</code> æ˜¯ä¸€ä¸ªMPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰å‡½æ•°ï¼Œç”¨äºé‡Šæ”¾ä¸€ä¸ªå·²ç»åˆ›å»ºçš„è¿›ç¨‹ç»„ã€‚</p><p>å‚æ•°ï¼š</p><ul><li><code>group</code>ï¼šæŒ‡å‘è¦é‡Šæ”¾çš„è¿›ç¨‹ç»„çš„æŒ‡é’ˆã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul></blockquote><h4 id="å®éªŒè¯´æ˜-10"><a href="#å®éªŒè¯´æ˜-10" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>å»ºç«‹ä¸€ä¸ªè¿›ç¨‹ç»„ï¼Œæ‰“å°å‡ºå®ƒçš„sizeï¼Œç„¶åé‡Šæ”¾å®ƒã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>Now the size is n<br>Now the group is freed.</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">;</span><span class="token keyword">int</span> size0<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Group_size</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the size is %d\n"</span><span class="token punctuation">,</span> size0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// your code here</span><span class="token function">MPI_Group_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>group_world <span class="token operator">==</span> MPI_GROUP_NULL<span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the group is freed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦å¯¹ä¸¤ä¸ªè¿›ç¨‹ç»„åšæœ€åŸºæœ¬çš„åˆ¤æ–­ï¼Œä¾‹å¦‚æˆå‘˜æ˜¯å¦ç›¸åŒï¼Œæ¬¡åºæ˜¯å¦ä¸€è‡´ç­‰ç­‰ã€‚</p><p>MPIåŒæ ·æä¾›äº†è¿™æ ·çš„å‡½æ•°æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-14"><a href="#å‡½æ•°è¯´æ˜-14" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><p>å¦‚æœåœ¨ä¸¤ä¸ªç»„ä¸­æˆå‘˜å’Œæ¬¡åºå®Œå…¨ç›¸ç­‰ï¼Œè¿”å›MPI_IDENTã€‚ä¾‹å¦‚åœ¨group1å’Œgroup2æ˜¯åŒä¸€å¥æŸ„æ—¶å°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœç»„æˆå‘˜ç›¸åŒè€Œæ¬¡åºä¸åŒåˆ™è¿”å›MPI_SIMILARï¼Œå¦åˆ™è¿”å›MPI_UNEQUAL</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Group_compare</span><span class="token punctuation">(</span>MPI_Group group1<span class="token punctuation">,</span> MPI_Group group2<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>result<span class="token punctuation">)</span>MPI_Group group1ï¼š è¦æ¯”è¾ƒçš„ç»„<span class="token number">1</span>ï¼›MPI_Group group2ï¼š è¦æ¯”è¾ƒçš„ç»„<span class="token number">2</span>ï¼›<span class="token keyword">int</span> <span class="token operator">*</span>resultï¼šç»“æœï¼›<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>int MPI_Group_compare(MPI_Group group1, MPI_Group group2, int *result)</code> æ˜¯ä¸€ä¸ªMPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰å‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¿›ç¨‹ç»„æ˜¯å¦ç›¸ç­‰ã€‚</p><p>å‚æ•°ï¼š</p><ul><li><code>group1</code>ï¼šæŒ‡å‘ç¬¬ä¸€ä¸ªè¦æ¯”è¾ƒçš„è¿›ç¨‹ç»„çš„æŒ‡é’ˆã€‚</li><li><code>group2</code>ï¼šæŒ‡å‘ç¬¬äºŒä¸ªè¦æ¯”è¾ƒçš„è¿›ç¨‹ç»„çš„æŒ‡é’ˆã€‚</li><li><code>result</code>ï¼šæŒ‡å‘ä¸€ä¸ªæ•´æ•°çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æ¯”è¾ƒç»“æœã€‚å¦‚æœ <code>group1</code> å’Œ <code>group2</code> ç›¸ç­‰ï¼Œåˆ™ <code>*result</code> çš„å€¼ä¸º0ï¼›å¦‚æœ <code>group1</code> åŒ…å« <code>group2</code> çš„æ‰€æœ‰è¿›ç¨‹ï¼Œåˆ™ <code>*result</code> çš„å€¼ä¸ºæ­£æ•°ï¼›å¦‚æœ <code>group2</code> åŒ…å« <code>group1</code> çš„æ‰€æœ‰è¿›ç¨‹ï¼Œåˆ™ <code>*result</code> çš„å€¼ä¸ºè´Ÿæ•°ï¼›å¦‚æœ <code>group1</code> å’Œ <code>group2</code> æ²¡æœ‰å…±åŒçš„è¿›ç¨‹ï¼Œåˆ™ <code>*result</code> çš„å€¼ä¸ºæ­£æ•°ä¸”å¤§äºç­‰äº <code>group1</code> çš„å¤§å°ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h4 id="å®éªŒè¯´æ˜-11"><a href="#å®éªŒè¯´æ˜-11" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ï¼Œé€šè¿‡è°ƒæ•´è¾“å‡ºä¸¤ä¸ªä¸åŒçš„ç»“æœã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>Now the groups are identical.<br>Now the groups are unequal.<br>â€¦</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">,</span> new_group_world<span class="token punctuation">;</span><span class="token keyword">int</span> members<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> result<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span><span class="token function">MPI_Group_incl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> members<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// your code here</span><span class="token function">MPI_Group_compare</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> group_world<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> MPI_IDENT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the groups are identical.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> MPI_SIMILAR<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the groups are similar.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the groups are unequal.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// your code here</span><span class="token function">MPI_Group_compare</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> new_group_world<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> MPI_IDENT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the groups are identical.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> MPI_SIMILAR<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the groups are similar.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the groups are unequal.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€šä¿¡å­çš„ç®¡ç†"><a href="#é€šä¿¡å­çš„ç®¡ç†" class="headerlink" title="é€šä¿¡å­çš„ç®¡ç†"></a>é€šä¿¡å­çš„ç®¡ç†</h2><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¾ˆå¤šä¸åŒçš„é€šä¿¡å­æ¥æ»¡è¶³éœ€æ±‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦åˆ›å»ºæ–°çš„é€šä¿¡å­ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-15"><a href="#å‡½æ•°è¯´æ˜-15" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><p>ç”¨ç”±groupæ‰€å®šä¹‰çš„é€šä¿¡ç»„åŠä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é€šä¿¡å­newcommã€‚å¯¹äºä¸åœ¨groupä¸­çš„è¿›ç¨‹ï¼Œå‡½æ•°è¿”å›MPI_COMM_NULLã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Comm_create</span><span class="token punctuation">(</span>MPI_Comm comm<span class="token punctuation">,</span> MPI_Group group<span class="token punctuation">,</span> MPI_Comm <span class="token operator">*</span>newcomm<span class="token punctuation">)</span>MPI_Comm comm ï¼š æ—§çš„é€šä¿¡å­ï¼›MPI_Group group ï¼š ä¸commç›¸å…³è”çš„ç»„æˆ–å…¶å­é›†ï¼›MPI_Comm <span class="token operator">*</span>newcomm ï¼š æ–°çš„é€šä¿¡å­ï¼›<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>int MPI_Comm_create(MPI_Comm comm, MPI_Group group, MPI_Comm *newcomm)</code> æ˜¯ä¸€ä¸ªMPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„é€šä¿¡å™¨ã€‚</p><p>å‚æ•°ï¼š</p><ul><li><code>comm</code>ï¼šæŒ‡å‘ç°æœ‰é€šä¿¡å™¨çš„æŒ‡é’ˆ</li><li><code>group</code>ï¼šæŒ‡å‘è¦åŒ…å«åœ¨æ–°é€šä¿¡å™¨ä¸­çš„è¿›ç¨‹ç»„çš„æŒ‡é’ˆ</li><li><code>newcomm</code>ï¼šæŒ‡å‘æ–°åˆ›å»ºçš„é€šä¿¡å™¨çš„æŒ‡é’ˆ</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç </li></ul><h4 id="å®éªŒè¯´æ˜-12"><a href="#å®éªŒè¯´æ˜-12" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>å¤åˆ¶ä¸€ä¸ªæ–°çš„é€šä¿¡å­ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€åˆ›å»ºä¸€ä¸ªæ–°çš„é€šä¿¡å­ã€‚ç”±äºç¤ºä¾‹æ˜¯ç”¨å¥‡æ•°ç¼–å·çš„è¿›ç¨‹æ¥åˆ›å»ºé€šä¿¡å­çš„ï¼Œæ‰€ä»¥åªåœ¨å¥‡æ•°è¿›ç¨‹ä¸­è¾“å‡ºç»“æœã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>The new commâ€™s size is 2.<br>The new commâ€™s size is 2.<br>â€¦</p><p>æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰æ·»åŠ åˆ›å»ºå‡½æ•°çš„ä»£ç ï¼Œå¤©æ²³å¯èƒ½ä¼šç”±äºè¶…æ—¶è¿”å›é•¿æ—¶é—´æ²¡æœ‰å“åº”çš„æç¤ºä¿¡æ¯ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> new_numprocs<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">,</span> odd_group<span class="token punctuation">;</span>MPI_Comm new_comm<span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">int</span> members<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>members<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Group_incl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> members<span class="token punctuation">,</span> <span class="token operator">&amp;</span>odd_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Comm_create</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> odd_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_comm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token keyword">if</span> <span class="token punctuation">(</span>myid <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>new_comm<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The new comm's size is %d.\n"</span><span class="token punctuation">,</span> new_numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h3><p>åœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ç³»ç»Ÿå¸®åŠ©æˆ‘ä»¬åˆ›å»ºçš„åˆå§‹ç»„å†…é€šä¿¡å­MPI_COMM_WORLDä½œä¸ºé€šä¿¡å­çš„è¾“å…¥ã€‚</p><p>å…¶å®ï¼Œè¿˜æœ‰ä¸¤ä¸ªç³»ç»Ÿé»˜è®¤åˆ›å»ºçš„é€šä¿¡å­ï¼Œä¸€ä¸ªæ˜¯COMM_SELFï¼Œå¦ä¸€ä¸ªæ˜¯COMM_NULLã€‚<br>COMM_SELFä»…ä»…åŒ…å«äº†å½“å‰è¿›ç¨‹ï¼Œè€ŒCOMM_NULLåˆ™ä»€ä¹ˆè¿›ç¨‹éƒ½æ²¡æœ‰åŒ…å«ã€‚</p><p>åœ¨é€šä¿¡å­çš„åˆ›å»ºä¸­ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯MPIä¸­æœ‰ä¸€ä¸ªâ€é¸¡ç”Ÿè›‹, è›‹ç”Ÿé¸¡â€çš„ç‰¹ç‚¹ï¼Œå³æ‰€æœ‰MPIé€šä¿¡å­çš„åˆ›å»ºéƒ½æ˜¯ç”±åŸºç¡€é€šä¿¡å­ï¼Œå³MPI_COMM_WORLDï¼ˆæ˜¯åœ¨MPIçš„å¤–éƒ¨è¢«å®šä¹‰çš„ï¼‰ï¼Œåˆ›å»ºçš„ã€‚è€Œè¿™äº›è¢«åˆ›å»ºçš„é€šä¿¡å­åˆå¯ä»¥ä½œä¸ºæ–°çš„é€šä¿¡å­åˆ›å»ºçš„åŸºç¡€ã€‚</p><p>è¿™ä¸ªæ¨¡å‹æ˜¯ç»è¿‡è®¨è®ºåç¡®å®šçš„ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜ç”¨MPIå†™ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-16"><a href="#å‡½æ•°è¯´æ˜-16" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><p>å¤åˆ¶å·²å­˜åœ¨çš„é€šä¿¡å­commã€‚</p><pre class="line-numbers language-none"><code class="language-none">int MPI_Comm_dup(MPI_Comm comm,MPI_Comm *newcomm)MPI_Comm comm ï¼š æ—§çš„é€šä¿¡å­ï¼›MPI_Comm *newcomm ï¼š æ–°çš„é€šä¿¡å­ï¼›<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>int MPI_Comm_dup(MPI_Comm comm, MPI</code>int MPI_Comm_dup(MPI_Comm comm, MPI_Comm *newcomm)&#96; æ˜¯ä¸€ä¸ªMPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰å‡½æ•°ï¼Œç”¨äºå¤åˆ¶ä¸€ä¸ªç°æœ‰çš„é€šä¿¡å™¨ã€‚</p><p>å‚æ•°ï¼š</p><ul><li><code>comm</code>ï¼šæŒ‡å‘è¦å¤åˆ¶çš„ç°æœ‰é€šä¿¡å™¨çš„æŒ‡é’ˆã€‚</li><li><code>newcomm</code>ï¼šæŒ‡å‘æ–°åˆ›å»ºçš„é€šä¿¡å™¨çš„æŒ‡é’ˆã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h4 id="å®éªŒè¯´æ˜-13"><a href="#å®éªŒè¯´æ˜-13" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>å¤åˆ¶ä¸€ä¸ªæ–°çš„é€šä¿¡å­ï¼Œéœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œç»“æœæ˜¾ç¤ºMPI_IDENTè¡¨ç¤ºä¸Šä¸‹æ–‡(context)å’Œç»„(group)éƒ½ç›¸åŒï¼ŒMPI_CONGRUENTè¡¨ç¤ºä¸Šä¸‹æ–‡ä¸åŒ(different)ä½†ç»„å®Œå…¨ç›¸åŒ(identical)ï¼ŒMPI_SIMILARè¡¨ç¤ºä¸Šä¸‹æ–‡ä¸åŒï¼Œç»„çš„æˆå‘˜ç›¸åŒä½†æ¬¡åºä¸åŒ(similar)ï¼Œå¦åˆ™å°±æ˜¯MPI_UNEQUALã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>The comms are congruent.<br>â€¦</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Comm new_comm<span class="token punctuation">;</span> <span class="token keyword">int</span> result<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// your code here</span><span class="token function">MPI_Comm_dup</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_comm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token function">MPI_Comm_compare</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> new_comm<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token operator">==</span> MPI_IDENT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The comms are identical.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token operator">==</span> MPI_CONGRUENT <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The comms are congruent.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token operator">==</span> MPI_SIMILAR <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The comms are similar.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token operator">==</span> MPI_UNEQUAL <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The comms are unequal.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é‡Šæ”¾-1"><a href="#é‡Šæ”¾-1" class="headerlink" title="é‡Šæ”¾"></a>é‡Šæ”¾</h3><p>åŒæ ·ï¼Œé€šä¿¡å­ä¹Ÿå­˜åœ¨ææ„çš„æ“ä½œã€‚</p><h4 id="å‡½æ•°è¯´æ˜ï¼š-1"><a href="#å‡½æ•°è¯´æ˜ï¼š-1" class="headerlink" title="å‡½æ•°è¯´æ˜ï¼š"></a>å‡½æ•°è¯´æ˜ï¼š</h4><pre class="line-numbers language-none"><code class="language-none">int MPI_Comm_free(MPI_Comm *comm)MPI_Comm *comm ï¼š é€šä¿¡å­ï¼›<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç”¨ç”±groupæ‰€å®šä¹‰çš„é€šä¿¡ç»„åŠä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é€šä¿¡å­newcommã€‚å¯¹äºä¸åœ¨groupä¸­çš„è¿›ç¨‹ï¼Œå‡½æ•°è¿”å›MPI_COMM_NULLã€‚</p><p><code>int MPI_Comm_free(MPI_Comm *comm)</code> <code>int MPI_Comm_free(MPI_Comm *comm)</code> æ˜¯ä¸€ä¸ªMPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰å‡½æ•°ï¼Œç”¨äºé‡Šæ”¾ä¸€ä¸ªå·²ç»åˆ›å»ºçš„é€šä¿¡å™¨ã€‚</p><p>å‚æ•°ï¼š</p><ul><li><code>comm</code>ï¼šæŒ‡å‘è¦é‡Šæ”¾çš„é€šä¿¡å™¨çš„æŒ‡é’ˆã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h4 id="å®éªŒè¯´æ˜-14"><a href="#å®éªŒè¯´æ˜-14" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>è¿™æ˜¯ä¸€ä¸ªæ ‡å¿—é€šä¿¡å¯¹è±¡æ’¤æ¶ˆçš„é›†åˆæ“ä½œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°æ“ä½œåªæ˜¯å°†å¥æŸ„ç½®ä¸ºMPI_COMM_NULLï¼Œä»»ä½•ä½¿ç”¨æ­¤é€šä¿¡å­çš„æŒ‚èµ·æ“ä½œéƒ½ä¼šæ­£å¸¸å®Œæˆï¼›ä»…å½“æ²¡æœ‰å¯¹æ­¤å¯¹è±¡çš„æ´»åŠ¨å¼•ç”¨æ—¶ï¼Œå®ƒæ‰ä¼šè¢«å®é™…æ’¤æ¶ˆã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>The comm is freed.<br>â€¦</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Comm new_comm<span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_dup</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_comm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Comm_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>new_comm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>new_comm <span class="token operator">==</span> MPI_COMM_NULL<span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Now the comm is freed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ’åˆ†"><a href="#åˆ’åˆ†" class="headerlink" title="åˆ’åˆ†"></a>åˆ’åˆ†</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æ ¹æ®æ‹“æ‰‘æ¥åˆ›å»ºä¸åŒçš„åŸŸï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ˜¾ç„¶ä¸€ä¸ªä¸ªåˆ›å»ºæ˜¯å¾ˆä¸æ–¹ä¾¿çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥è¿›è¡Œåˆ’åˆ†ã€‚</p><h4 id="å‡½æ•°è¯´æ˜-17"><a href="#å‡½æ•°è¯´æ˜-17" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Comm_split</span><span class="token punctuation">(</span>MPI_Comm comm<span class="token punctuation">,</span> <span class="token keyword">int</span> color<span class="token punctuation">,</span> <span class="token keyword">int</span> key<span class="token punctuation">,</span> MPI_Comm <span class="token operator">*</span>newcomm<span class="token punctuation">)</span>MPI_Comm comm ï¼š æ—§çš„é€šä¿¡å­ï¼Œä¹Ÿå°±æ˜¯è¢«åˆ’åˆ†çš„åŸŸï¼›<span class="token keyword">int</span> color ï¼š å­åŸŸçš„æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯è¢«åˆ’åˆ†å‡ºæ¥çš„æ¯ä¸ªå­åŸŸéƒ½å¯¹åº”ä¸€ä¸ªcolorï¼Œæ¯ä¸€ä¸ªå­åŸŸåŒ…å«å…·æœ‰åŒæ ·colorçš„æ‰€æœ‰è¿›ç¨‹ï¼›<span class="token keyword">int</span> key ï¼š åœ¨æ¯ä¸€ä¸ªå­åŸŸå†…<span class="token punctuation">,</span> è¿›ç¨‹æŒ‰ç…§keyæ‰€å®šä¹‰çš„å€¼çš„æ¬¡åºè¿›è¡Œæ’åˆ—ã€‚MPI_Comm <span class="token operator">*</span>newcomm ï¼š æ–°çš„é€šä¿¡å­ï¼›<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‡½æ•°å°†ä¸commç›¸å…³çš„åŸŸåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ç›¸è¿çš„å­åŸŸï¼Œæ ¹æ®colorå’Œkeyå‚æ•°å†³å®šæ¯ä¸ªè¿›ç¨‹æ‰€å¤„çš„ä½ç½®ã€‚</p><p><code>int MPI_Comm_split(MPI_Comm comm, int color, int key, MPI_Comm *newcomm)</code> ï¼Œç”¨äºå°†ä¸€ä¸ªé€šä¿¡å™¨åˆ†å‰²æˆä¸¤ä¸ªå­é€šä¿¡å™¨ã€‚</p><p>å‚æ•°ï¼š</p><ul><li><code>comm</code>ï¼šæŒ‡å‘è¦åˆ†å‰²çš„é€šä¿¡å™¨çš„æŒ‡é’ˆã€‚</li><li><code>color</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå½“å‰è¿›ç¨‹æ‰€å±çš„å­é€šä¿¡å™¨ã€‚å¦‚æœå½“å‰è¿›ç¨‹å±äºç¬¬ä¸€ä¸ªå­é€šä¿¡å™¨ï¼Œåˆ™<code>color</code>ä¸º0ï¼›å¦‚æœå½“å‰è¿›ç¨‹å±äºç¬¬äºŒä¸ªå­é€šä¿¡å™¨ï¼Œåˆ™<code>color</code>ä¸º1ã€‚</li><li><code>key</code>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œç”¨äºç¡®å®šå¦‚ä½•å°†è¿›ç¨‹åˆ†é…åˆ°å­é€šä¿¡å™¨ä¸­ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå€¼åº”è¯¥æ˜¯ä¸€ä¸ªå…¨å±€å¸¸é‡ï¼Œä»¥ç¡®ä¿æ‰€æœ‰è¿›ç¨‹éƒ½ä½¿ç”¨ç›¸åŒçš„é”®å€¼è¿›è¡Œåˆ†å‰²ã€‚</li><li><code>newcomm</code>ï¼šæŒ‡å‘æ–°åˆ›å»ºçš„å­é€šä¿¡å™¨çš„æŒ‡é’ˆã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ã€‚</li><li>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›éé›¶é”™è¯¯ä»£ç ã€‚</li></ul><h4 id="å®éªŒè¯´æ˜-15"><a href="#å®éªŒè¯´æ˜-15" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ ¹æ®è¡Œä¸åˆ—è¿›è¡Œæ±‚å’Œï¼Œåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­è¾“å‡ºåæ ‡å’Œæ±‚å‡ºçš„å’Œã€‚</p><p>è¾“å‡ºç»“æœæ ¼å¼åº”å¦‚ä¸‹ï¼š<br>Iâ€™m process n, my coordinates are (x, y), row sum is p, column sum is q.<br>â€¦</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Comm row_comm<span class="token punctuation">,</span> column_comm<span class="token punctuation">;</span><span class="token keyword">int</span> myrow<span class="token punctuation">,</span> mycolumn<span class="token punctuation">;</span><span class="token keyword">int</span> color <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>myrow <span class="token operator">=</span> myid <span class="token operator">/</span> color <span class="token punctuation">;</span>mycolumn <span class="token operator">=</span> myid <span class="token operator">%</span> color <span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Comm_split</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> myrow<span class="token punctuation">,</span> mycolumn<span class="token punctuation">,</span> <span class="token operator">&amp;</span>row_comm<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">MPI_Comm_split</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> mycolumn<span class="token punctuation">,</span> myrow<span class="token punctuation">,</span> <span class="token operator">&amp;</span>column_comm<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// end of your code</span><span class="token keyword">int</span> rowsum<span class="token punctuation">,</span> columnsum<span class="token punctuation">;</span>rowsum <span class="token operator">=</span> myid<span class="token punctuation">;</span>columnsum <span class="token operator">=</span> myid<span class="token punctuation">;</span><span class="token function">MPI_Allreduce</span><span class="token punctuation">(</span>MPI_IN_PLACE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rowsum<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> MPI_SUM<span class="token punctuation">,</span> row_comm<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">MPI_Allreduce</span><span class="token punctuation">(</span>MPI_IN_PLACE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>columnsum<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> MPI_SUM<span class="token punctuation">,</span> column_comm<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"I'm process %d, my coordinates are (%d, %d), row sum is %d, column sum is %d\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> myrow<span class="token punctuation">,</span> mycolumn<span class="token punctuation">,</span>  rowsum<span class="token punctuation">,</span> columnsum<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–å¤„ç†å™¨å"><a href="#è·å–å¤„ç†å™¨å" class="headerlink" title="è·å–å¤„ç†å™¨å"></a>è·å–å¤„ç†å™¨å</h2><p>æœ‰æ—¶å€™åœ¨å®é™…å¤„ç†ä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦å°†è¿›ç¨‹è¿ç§»è‡³ä¸åŒçš„å¤„ç†å™¨ï¼Œè€ŒMPIæä¾›äº†è·å–å¤„ç†å™¨åçš„å‡½æ•°ä»¥ç®€å•åœ°å…è®¸è¿™ç§è¡Œä¸ºã€‚</p><p>æ³¨æ„åœ¨MPIä¸­ä¸éœ€è¦å®šä¹‰è¿™ç§è¿ç§»ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-18"><a href="#å‡½æ•°è¯´æ˜-18" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-none"><code class="language-none">int MPI_Get_processor_name ( char *name, int *resultlen)char *name : å®é™…èŠ‚ç‚¹çš„å”¯ä¸€è¯´æ˜å­—;int *resultlenï¼šåœ¨nameä¸­è¿”å›ç»“æœçš„é•¿åº¦;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿”å›è°ƒç”¨æ—¶è°ƒç”¨æ‰€åœ¨çš„å¤„ç†å™¨åã€‚</p><blockquote><p><code>MPI_Get_processor_name</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–å½“å‰è¿›ç¨‹åç§°çš„ MPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆ <code>name</code>ï¼Œç”¨äºå­˜å‚¨è¿›ç¨‹åç§°ï¼›ä¸€ä¸ªæ•´æ•°æŒ‡é’ˆ <code>resultlen</code>ï¼Œç”¨äºå­˜å‚¨å®é™…å­˜å‚¨åœ¨ <code>name</code> ä¸­çš„è¿›ç¨‹åç§°é•¿åº¦ã€‚</p><p>å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Get_processor_name</span> <span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>resultlen <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¤ºä¾‹ä»£ç ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">char</span> processor_name<span class="token punctuation">[</span>MPI_MAX_PROCESSOR_NAME<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> name_length<span class="token punctuation">;</span> <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">MPI_Get_processor_name</span><span class="token punctuation">(</span>processor_name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>name_length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span>"Processor name<span class="token operator">:</span> <span class="token operator">%</span>s"<span class="token punctuation">,</span> processor_name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span>"Name length<span class="token operator">:</span> <span class="token operator">%</span>d"<span class="token punctuation">,</span> name_length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><h3 id="å®éªŒè¯´æ˜-16"><a href="#å®éªŒè¯´æ˜-16" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­ï¼Œä½¿ç”¨å‡½æ•°MPI_Get_processor_nameæ¥è·å–å½“å‰è¿›ç¨‹çš„å¤„ç†å™¨åå¹¶æ‰“å°å‡ºæ¥ã€‚</p><p>Hello, world. I am PROCESS_NAME.</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> len<span class="token punctuation">;</span><span class="token keyword">char</span> name<span class="token punctuation">[</span>MPI_MAX_PROCESSOR_NAME<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//your code here</span>    <span class="token function">MPI_Get_processor_name</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello, world. I am %s.\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åœ°å€åç§»é‡"><a href="#åœ°å€åç§»é‡" class="headerlink" title="åœ°å€åç§»é‡"></a>åœ°å€åç§»é‡</h2><p>åœ¨é€šä¿¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¯¹åœ°å€è¿›è¡Œä¼ é€’æˆ–æ“ä½œï¼Œä¾‹å¦‚ä¼ é€&#x2F;æ¥æ”¶ç¼“å†²åŒºã€‚</p><p>è€Œä¸€ä¸ªä½ç½®åœ¨å†…å­˜ä¸­çš„åœ°å€å¯ä»¥é€šè¿‡MPI_ADDRESSå‡½æ•°è·å¾—ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-19"><a href="#å‡½æ•°è¯´æ˜-19" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Address</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> location<span class="token punctuation">,</span> MPI_Aint <span class="token operator">*</span>address<span class="token punctuation">)</span><span class="token keyword">void</span><span class="token operator">*</span> location ï¼š è°ƒç”¨è€…çš„å†…å­˜ä½ç½®<span class="token punctuation">;</span>MPI_Aint <span class="token operator">*</span>addressï¼šä½ç½®çš„å¯¹åº”åœ°å€<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>MPI_Address</code> æ˜¯ä¸€ä¸ªç”¨äºè·å–å†…å­˜åœ°å€çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæŒ‡å‘å†…å­˜ä½ç½®çš„æŒ‡é’ˆ <code>location</code> å’Œä¸€ä¸ªæŒ‡å‘ <code>MPI_Aint</code> ç±»å‹çš„æŒ‡é’ˆ <code>address</code>ã€‚<code>MPI_Aint</code> æ˜¯ä¸€ä¸ªæ•´æ•°ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºä»»æ„å¤§å°çš„åœ°å€ã€‚</p><p>å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Address</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> location<span class="token punctuation">,</span> MPI_Aint <span class="token operator">*</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">int</span> rank<span class="token punctuation">;</span> <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rank<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">int</span> local_variable <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> MPI_Aint local_address<span class="token punctuation">;</span> <span class="token function">MPI_Address</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>local_variable<span class="token punctuation">,</span> <span class="token operator">&amp;</span>local_address<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Rank %d: Local variable address is %p"</span><span class="token punctuation">,</span> rank<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>local_address<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆå§‹åŒ– MPI ç¯å¢ƒï¼Œç„¶åè·å–å½“å‰è¿›ç¨‹çš„ç­‰çº§ï¼ˆ<code>rank</code>ï¼‰ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ <code>local_variable</code>ï¼Œå¹¶ä½¿ç”¨ <code>MPI_Address</code> å‡½æ•°è·å–å…¶å†…å­˜åœ°å€ã€‚æœ€åï¼Œæˆ‘ä»¬å°†ç»“æœæ‰“å°å‡ºæ¥ã€‚</p></blockquote><p>###å®éªŒè¯´æ˜</p><p>ç»™å‡ºä¸‰ä¸ªä¸´æ—¶å˜é‡a, b, c, åˆ†åˆ«æ±‚å‡ºaä¸bã€aä¸cä¹‹é—´çš„åœ°å€åç§»é‡ã€‚</p><p>è¾“å‡ºç»“æœ:</p><p>ç”±äºè¿™é‡Œé‡‡ç”¨çš„å˜é‡ç±»å‹ä¸ºintï¼Œæ‰€ä»¥å¦‚æœå˜é‡åœ°å€æ˜¯è¿ç»­çš„è¯åº”è¯¥æ˜¯ï¼š<br>The distance between a and b is 4<br>The distance between a and c is 8</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">;</span>MPI_Aint address1<span class="token punctuation">,</span> address2<span class="token punctuation">,</span> address3<span class="token punctuation">;</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> dist1<span class="token punctuation">,</span> dist2<span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Address</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>address1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Address</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>address2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Address</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span> <span class="token operator">&amp;</span>address3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span>dist1 <span class="token operator">=</span> address2 <span class="token operator">-</span> address1 <span class="token punctuation">;</span>dist2 <span class="token operator">=</span> address3 <span class="token operator">-</span> address1 <span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The distance between a and b is %d\n"</span><span class="token punctuation">,</span> dist1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The distance between a and c is %d\n"</span><span class="token punctuation">,</span> dist2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°æ®çš„æ‰“åŒ…-pack"><a href="#æ•°æ®çš„æ‰“åŒ…-pack" class="headerlink" title="æ•°æ®çš„æ‰“åŒ…(pack)"></a>æ•°æ®çš„æ‰“åŒ…(pack)</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å°†ä¸è¿ç»­çš„æ•°æ®æˆ–æ˜¯ä¸ç›¸åŒçš„æ•°æ®ç±»å‹çš„æ•°æ®ä¸€èµ·å‘é€åˆ°å…¶ä»–è¿›ç¨‹ï¼Œè€Œä¸æ˜¯æ•ˆç‡å¾ˆä½åœ°é€ä¸ªå‘é€ã€‚</p><p>ä¸€ä¸ªè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆæ˜¯å°†æ•°æ®å°è£…æˆåŒ…ï¼Œå†å°†æ•°æ®åŒ…æ”¾åˆ°ä¸€ä¸ªè¿ç»­çš„ç¼“å†²åŒºï¼Œå‘é€åˆ°æ¥æ”¶ç¼“å†²åŒºåå†æå–å‡ºæ¥å°½å¿ƒè§£åŒ…ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ‰“åŒ…&#x2F;è§£åŒ…å‡½æ•°æœ‰æ—¶å€™è¿˜ä¼šç”¨æ¥ä»£æ›¿ç³»ç»Ÿç¼“å­˜ç­–ç•¥ã€‚æ­¤å¤–ï¼Œå¯¹äºåœ¨MPIé¡¶å±‚è¿›ä¸€æ­¥å¼€å‘é™„åŠ çš„é€šä¿¡åº“ä¼šèµ·åˆ°è¾…åŠ©çš„ä½œç”¨ã€‚</p><h3 id="å‡½æ•°è¯´æ˜ï¼š-2"><a href="#å‡½æ•°è¯´æ˜ï¼š-2" class="headerlink" title="å‡½æ•°è¯´æ˜ï¼š"></a>å‡½æ•°è¯´æ˜ï¼š</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Pack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> inbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> incount<span class="token punctuation">,</span> MPI_datatype datatype<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>outbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> outcount<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>position<span class="token punctuation">,</span> MPI_Comm comm<span class="token punctuation">)</span> <span class="token keyword">void</span><span class="token operator">*</span> inbuf ï¼š è¾“å…¥ç¼“å†²åŒºåœ°å€<span class="token punctuation">;</span><span class="token keyword">int</span> incount ï¼šè¾“å…¥æ•°æ®é¡¹æ•°ç›®<span class="token punctuation">;</span>MPI_datatype datatype ï¼šæ•°æ®é¡¹çš„ç±»å‹<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span>outbuf ï¼šè¾“å‡ºç¼“å†²åŒºåœ°å€<span class="token punctuation">;</span><span class="token keyword">int</span> outcount ï¼šè¾“å‡ºç¼“å†²åŒºå¤§å°<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token operator">*</span>position ï¼šç¼“å†²åŒºå½“å‰ä½ç½®<span class="token punctuation">;</span>MPI_Comm comm ï¼šé€šä¿¡å­<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯ä¸€ä¸ªMPIï¼ˆMessage Passing Interfaceï¼Œæ¶ˆæ¯ä¼ é€’æ¥å£ï¼‰å‡½æ•°ï¼Œç”¨äºå°†æ•°æ®æ‰“åŒ…åˆ°è¾“å‡ºç¼“å†²åŒºä¸­ã€‚ä¸‹é¢æ˜¯å¯¹ä»£ç çš„è§£æï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Pack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> inbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> incount<span class="token punctuation">,</span> MPI_datatype datatype<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>outbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> outcount<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>position<span class="token punctuation">,</span> MPI_Comm comm<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>inbuf</code>: è¾“å…¥ç¼“å†²åŒºçš„æŒ‡é’ˆï¼ŒæŒ‡å‘è¦æ‰“åŒ…çš„æ•°æ®ã€‚</li><li><code>incount</code>: è¾“å…¥ç¼“å†²åŒºä¸­è¦æ‰“åŒ…çš„å…ƒç´ æ•°é‡ã€‚</li><li><code>datatype</code>: æ•°æ®ç±»å‹çš„å¯¹è±¡ï¼ŒæŒ‡å®šäº†è¾“å…¥ç¼“å†²åŒºä¸­å…ƒç´ çš„ç±»å‹ã€‚</li><li><code>outbuf</code>: è¾“å‡ºç¼“å†²åŒºçš„æŒ‡é’ˆï¼ŒæŒ‡å‘æ‰“åŒ…åçš„æ•°æ®å­˜å‚¨ä½ç½®ã€‚</li><li><code>outcount</code>: è¾“å‡ºç¼“å†²åŒºä¸­å¯ç”¨çš„ç©ºé—´å¤§å°ã€‚</li><li><code>position</code>: ä¸€ä¸ªæ•´æ•°æŒ‡é’ˆï¼Œç”¨äºè¿”å›å½“å‰åœ¨è¾“å‡ºç¼“å†²åŒºä¸­çš„ä½ç½®ã€‚</li><li><code>comm</code>: é€šä¿¡å™¨å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li></ul><p>è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯å°†è¾“å…¥ç¼“å†²åŒºä¸­çš„æ•°æ®æŒ‰ç…§æŒ‡å®šçš„æ•°æ®ç±»å‹è¿›è¡Œæ‰“åŒ…ï¼Œå¹¶å°†æ‰“åŒ…åçš„æ•°æ®å­˜å‚¨åˆ°è¾“å‡ºç¼“å†²åŒºä¸­ã€‚æ‰“åŒ…åçš„æ•°æ®å¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´ä¼ è¾“æˆ–å­˜å‚¨ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜ï¼Œå…·ä½“çš„å®ç°ç»†èŠ‚å’Œç”¨æ³•å¯èƒ½å› ä½¿ç”¨çš„MPIåº“è€Œæœ‰æ‰€ä¸åŒã€‚</p><h3 id="å®éªŒè¯´æ˜-17"><a href="#å®éªŒè¯´æ˜-17" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>åœ¨æºè¿›ç¨‹ä¸­æ‰“åŒ…å‘é€ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¿›ç¨‹1ï¼Œè¿›ç¨‹1è§£åŒ…å¹¶æ‰“å°å‡ºæ•°æ®ã€‚</p><p>è¾“å‡ºç»“æœ</p><p>The number is 1 and 2</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> source<span class="token punctuation">;</span>MPI_Status status<span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> position<span class="token punctuation">;</span><span class="token keyword">int</span> k<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> buf<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    j <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                position <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>            <span class="token comment">// your code here</span>    <span class="token function">MPI_Pack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// end of your code</span>        <span class="token function">MPI_Send</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> position<span class="token punctuation">,</span> MPI_PACKED<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">MPI_Recv</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>position <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span><span class="token function">MPI_Unpack</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">,</span> <span class="token operator">&amp;</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Unpack</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">,</span> <span class="token operator">&amp;</span>j<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The number is %d and %d"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•°æ®çš„è§£åŒ…-unpack"><a href="#æ•°æ®çš„è§£åŒ…-unpack" class="headerlink" title="æ•°æ®çš„è§£åŒ…(unpack)"></a>æ•°æ®çš„è§£åŒ…(unpack)</h2><p>è§£åŒ…æ˜¯å¯¹åº”äºæ‰“åŒ…çš„MPIæ“ä½œã€‚</p><p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šMPI_RECVå’ŒMPI_UNPACKçš„åŒºåˆ«: åœ¨MPI_RECVä¸­, countå‚æ•°æŒ‡æ˜çš„æ˜¯å¯ä»¥æ¥æ”¶çš„æœ€å¤§é¡¹æ•°. å®é™…æ¥æ”¶çš„é¡¹æ•°æ˜¯ç”±æ¥æ”¶çš„æ¶ˆæ¯çš„é•¿åº¦æ¥å†³å®šçš„. åœ¨MPI_UNPACKä¸­, countå‚æ•°æŒ‡æ˜å®é™…æ‰“åŒ…çš„é¡¹æ•°; ç›¸åº”æ¶ˆæ¯çš„â€sizeâ€æ˜¯positionçš„å¢åŠ å€¼. è¿™ç§æ”¹åŠ¨çš„åŸå› æ˜¯â€è¾“å…¥æ¶ˆæ¯çš„å¤§å°â€ ç›´åˆ°ç”¨æˆ·å†³å®šå¦‚ä½•è§£åŒ…ä¹‹å‰æ˜¯ä¸èƒ½é¢„å…ˆç¡®å®šçš„;ä»è§£åŒ…çš„é¡¹æ•°æ¥ç¡®å®šâ€æ¶ˆæ¯å¤§å°â€ä¹Ÿæ˜¯å¾ˆå›°éš¾çš„ã€‚</p><h3 id="å‡½æ•°è¯´æ˜-20"><a href="#å‡½æ•°è¯´æ˜-20" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">MPI_Unpack</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> inbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> insize<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>position<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>outbuf<span class="token punctuation">,</span> <span class="token keyword">int</span> outcount<span class="token punctuation">,</span> MPI_Datatype datatype<span class="token punctuation">,</span> MPI_Comm comm<span class="token punctuation">)</span> <span class="token keyword">void</span><span class="token operator">*</span> inbuf ï¼š è¾“å…¥ç¼“å†²åŒºåœ°å€<span class="token punctuation">;</span><span class="token keyword">int</span> insize ï¼šè¾“å…¥æ•°æ®é¡¹æ•°ç›®<span class="token punctuation">;</span>MPI_datatype datatype ï¼šæ•°æ®é¡¹çš„ç±»å‹<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span>outbuf ï¼šè¾“å‡ºç¼“å†²åŒºåœ°å€<span class="token punctuation">;</span><span class="token keyword">int</span> outcount ï¼šè¾“å‡ºç¼“å†²åŒºå¤§å°<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token operator">*</span>position ï¼šç¼“å†²åŒºå½“å‰ä½ç½®<span class="token punctuation">;</span>MPI_Comm comm ï¼šé€šä¿¡å­<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>MPI_Unpack</code>å‡½æ•°ç”¨äºå°†æ‰“åŒ…çš„æ•°æ®ä»è¾“å…¥ç¼“å†²åŒºè§£åŒ…åˆ°è¾“å‡ºç¼“å†²åŒºã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>inbuf</code>ï¼šæŒ‡å‘è¾“å…¥ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œå…¶ä¸­åŒ…å«è¦è§£åŒ…çš„æ•°æ®ã€‚</li><li><code>insize</code>ï¼šè¾“å…¥ç¼“å†²åŒºçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</li><li><code>position</code>ï¼šä¸€ä¸ªæ•´æ•°æŒ‡é’ˆï¼Œç”¨äºè¿”å›å½“å‰åœ¨è¾“å…¥ç¼“å†²åŒºä¸­çš„ä½ç½®ã€‚</li><li><code>outbuf</code>ï¼šæŒ‡å‘è¾“å‡ºç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨è§£åŒ…åçš„æ•°æ®ã€‚</li><li><code>outcount</code>ï¼šè¾“å‡ºç¼“å†²åŒºçš„å¤§å°ï¼ˆä»¥å…ƒç´ ä¸ºå•ä½ï¼‰ã€‚</li><li><code>datatype</code>ï¼šæ•°æ®ç±»å‹çš„å¯¹è±¡ï¼ŒæŒ‡å®šäº†è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºä¸­å…ƒç´ çš„ç±»å‹ã€‚</li><li><code>comm</code>ï¼šé€šä¿¡å™¨å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li></ul><p>è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯å°†æ‰“åŒ…çš„æ•°æ®ä»è¾“å…¥ç¼“å†²åŒºè§£åŒ…åˆ°è¾“å‡ºç¼“å†²åŒºï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´ä¼ è¾“æˆ–å­˜å‚¨ã€‚è§£åŒ…åçš„æ•°æ®å¯ä»¥æŒ‰ç…§æŒ‡å®šçš„æ•°æ®ç±»å‹è¿›è¡Œè§£æå’Œä½¿ç”¨ã€‚</p><h3 id="å®éªŒè¯´æ˜-18"><a href="#å®éªŒè¯´æ˜-18" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>åœ¨æºè¿›ç¨‹ä¸­æ‰“åŒ…å‘é€ä¸€ä¸ªæ•°æ®åŒ…åˆ°ç¼–å·ä¸º1çš„è¿›ç¨‹ï¼Œç¼–å·ä¸º1çš„è¿›ç¨‹è§£åŒ…å¹¶æ‰“å°å‡ºæ•°æ®ã€‚</p><p>è¾“å‡ºç»“æœ</p><p>The number is 1 and 2</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> source<span class="token punctuation">;</span>MPI_Status status<span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> position<span class="token punctuation">;</span><span class="token keyword">int</span> k<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> buf<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    j <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                position <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>            <span class="token function">MPI_Pack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token function">MPI_Pack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>j<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token function">MPI_Send</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> position<span class="token punctuation">,</span> MPI_PACKED<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>myid <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">MPI_Recv</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>position <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>i <span class="token operator">=</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Unpack</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">,</span> <span class="token operator">&amp;</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Unpack</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">,</span> <span class="token operator">&amp;</span>j<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The number is %d and %d"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»„çš„ç®¡ç†-é›†åˆç±»æ“ä½œ"><a href="#ç»„çš„ç®¡ç†-é›†åˆç±»æ“ä½œ" class="headerlink" title="ç»„çš„ç®¡ç†-é›†åˆç±»æ“ä½œ"></a>ç»„çš„ç®¡ç†-é›†åˆç±»æ“ä½œ</h2><p>å¯¹äºä¸¤ä¸ªé›†åˆï¼Œæˆ‘ä»¬ç»å¸¸å¯¹å…¶è¿›è¡Œå„ç§å„æ ·çš„é›†åˆæ“ä½œï¼Œä¾‹å¦‚äº¤&#x2F;å¹¶ã€‚</p><p>MPIåŒæ ·æä¾›äº†å¯¹ç»„çš„é›†åˆç±»æ“ä½œã€‚</p><h3 id="å‡½æ•°è¯´æ˜-21"><a href="#å‡½æ•°è¯´æ˜-21" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h3><pre class="line-numbers language-none"><code class="language-none">int MPI_Group_union(MPI_Group group1, MPI_Group group2, MPI_Group *newgroup)int MPI_Group_intersection(MPI_Group group1,MPI_Group group2,MPI_Group *newgroup) int MPI_Group_difference(MPI_Group group1,MPI_Group group2,MPI_Group *newgroup)MPI_Group group1 ï¼š è¦æ“ä½œçš„ç»„1ï¼›MPI_Group group2 ï¼š è¦æ“ä½œçš„ç»„2ï¼›MPI_Group *newgroupï¼šæ–°çš„ç»„;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>MPI_Group_union</code>å‡½æ•°ç”¨äºè®¡ç®—ä¸¤ä¸ªè¿›ç¨‹ç»„çš„å¹¶é›†ã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li><code>group1</code>ï¼šç¬¬ä¸€ä¸ªè¿›ç¨‹ç»„ã€‚</li><li><code>group2</code>ï¼šç¬¬äºŒä¸ªè¿›ç¨‹ç»„ã€‚</li><li><code>newgroup</code>ï¼šæŒ‡å‘æ–°è¿›ç¨‹ç»„çš„æŒ‡é’ˆï¼Œè¯¥è¿›ç¨‹ç»„å°†åŒ…å«<code>group1</code>å’Œ<code>group2</code>çš„å¹¶é›†ã€‚</li></ul><p>è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œçš„ç»“æœã€‚å¦‚æœæˆåŠŸï¼Œè¿”å›å€¼ä¸º<code>MPI_SUCCESS</code>ï¼›å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªéé›¶çš„é”™è¯¯ä»£ç ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ç‰‡æ®µï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨<code>MPI_Group_union</code>å‡½æ•°ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºä¸¤ä¸ªè¿›ç¨‹ç»„</span>    MPI_Group group1<span class="token punctuation">,</span> group2<span class="token punctuation">;</span>    <span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è®¡ç®—è¿›ç¨‹ç»„çš„å¹¶é›†</span>    MPI_Group newgroup<span class="token punctuation">;</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">MPI_Group_union</span><span class="token punctuation">(</span>group1<span class="token punctuation">,</span> group2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>newgroup<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> MPI_SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error: MPI_Group_union failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// æ‰“å°ç»“æœ</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Process groups union successful.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// é‡Šæ”¾èµ„æº</span>    <span class="token function">MPI_Group_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>group1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Group_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>group2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Group_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newgroup<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä»…ä¸ºç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œé€‚å½“çš„ä¿®æ”¹å’Œé”™è¯¯å¤„ç†ã€‚</p></blockquote><h3 id="å®éªŒè¯´æ˜-19"><a href="#å®éªŒè¯´æ˜-19" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h3><p>å°†ç»„æŒ‰ç…§ç¼–å·çš„å¥‡å¶åˆ†ä¸ºä¸¤ä¸ªæ–°çš„ç»„ï¼Œå†ç”¨å¹¶æ“ä½œå°†å®ƒä»¬åˆèµ·æ¥ï¼Œè¾“å‡ºå„ä¸ªè¿›ç¨‹åœ¨æ–°çš„ç»„çš„ç¼–å·ã€‚</p><p>è¾“å‡ºç»“æœ</p><p>In process 0: union rank is 2<br>In process 1: union rank is 0<br>In process 2: union rank is 3<br>In process 3: union rank is 1</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mpi.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> myid<span class="token punctuation">,</span> numprocs<span class="token punctuation">,</span> union_rank<span class="token punctuation">;</span>MPI_Group group_world<span class="token punctuation">,</span> odd_group<span class="token punctuation">,</span> even_group<span class="token punctuation">,</span> union_group<span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">int</span> members<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numprocs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Comm_group</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>group_world<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>members<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">MPI_Group_incl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> members<span class="token punctuation">,</span> <span class="token operator">&amp;</span>odd_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Group_excl</span><span class="token punctuation">(</span>group_world<span class="token punctuation">,</span> numprocs<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> members<span class="token punctuation">,</span> <span class="token operator">&amp;</span>even_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// your code here</span><span class="token function">MPI_Group_union</span><span class="token punctuation">(</span>odd_group<span class="token punctuation">,</span> even_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span>union_group<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// end of your code</span><span class="token function">MPI_Group_rank</span><span class="token punctuation">(</span>union_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span>union_rank<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In process %d: union rank is %d\n"</span><span class="token punctuation">,</span> myid<span class="token punctuation">,</span> union_rank<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>live2Dçœ‹æ¿å¨˜è®¾ç½®</title>
      <link href="/posts/f571.html"/>
      <url>/posts/f571.html</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºç¡€è®¾ç½®"><a href="#åŸºç¡€è®¾ç½®" class="headerlink" title="åŸºç¡€è®¾ç½®"></a>åŸºç¡€è®¾ç½®</h1><h2 id="1-æ¨¡å‹æ’ä»¶"><a href="#1-æ¨¡å‹æ’ä»¶" class="headerlink" title="1.æ¨¡å‹æ’ä»¶"></a>1.æ¨¡å‹æ’ä»¶</h2><p>åœ¨hexoæ ¹ç›®å½•è¿›å…¥git bashï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…æ¨¡å‹æ’ä»¶</p><pre class="line-numbers language-Text" data-language="Text"><code class="language-Text"># npm install --save hexo-helper-live2d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¸è½½æ¨¡å‹</p><pre class="line-numbers language-Text" data-language="Text"><code class="language-Text"># npm uninstall --save hexo-helper-live2d <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-æŒ‘é€‰æ¨¡å‹"><a href="#2-æŒ‘é€‰æ¨¡å‹" class="headerlink" title="2.æŒ‘é€‰æ¨¡å‹"></a>2.æŒ‘é€‰æ¨¡å‹</h2><p><a href="https://github.com/xiazeyu/live2d-widget-models">live2dæ¨¡å‹ä»“åº“ç›´è¾¾</a></p><h3 id="éƒ¨åˆ†æ¨¡å‹å±•ç¤º"><a href="#éƒ¨åˆ†æ¨¡å‹å±•ç¤º" class="headerlink" title="éƒ¨åˆ†æ¨¡å‹å±•ç¤º"></a>éƒ¨åˆ†æ¨¡å‹å±•ç¤º</h3><table>    <tr>        <td><center><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202401272109891.png"></center>        </td>        <td><center><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202401272122120.png"></center>        </td>    </tr></table>â†“ å„ä¸ªæ¨¡å‹åº“ä½¿ç”¨ npm install {packagename}`å®‰è£…æ¨¡å‹<ul><li><code>live2d-widget-model-chitose</code></li><li><code>live2d-widget-model-epsilon2_1</code></li><li><code>live2d-widget-model-gf</code></li><li><code>live2d-widget-model-haru/01</code> (use <code>npm install --save live2d-widget-model-haru</code>)</li><li><code>live2d-widget-model-haru/02</code> (use <code>npm install --save live2d-widget-model-haru</code>)</li><li><code>live2d-widget-model-haruto</code></li><li><code>live2d-widget-model-hibiki</code></li><li><code>live2d-widget-model-hijiki</code></li><li><code>live2d-widget-model-izumi</code></li><li><code>live2d-widget-model-koharu</code></li><li><code>live2d-widget-model-miku</code></li><li><code>live2d-widget-model-ni-j</code></li><li><code>live2d-widget-model-nico</code></li><li><code>live2d-widget-model-nietzsche</code></li><li><code>live2d-widget-model-nipsilon</code></li><li><code>live2d-widget-model-nito</code></li><li><code>live2d-widget-model-shizuku</code></li><li><code>live2d-widget-model-tororo</code></li><li><code>live2d-widget-model-tsumiki</code></li><li><code>live2d-widget-model-unitychan</code></li><li><code>live2d-widget-model-wanko</code></li><li><code>live2d-widget-model-z16</code></li></ul><p>æˆ‘ç”¨çš„æ˜¯ <code>npm install live2d-widget-model-hibiki</code></p><h3 id="htmlå®ç°å¤šå¼ å›¾ç‰‡åŒè¡Œ"><a href="#htmlå®ç°å¤šå¼ å›¾ç‰‡åŒè¡Œ" class="headerlink" title="htmlå®ç°å¤šå¼ å›¾ç‰‡åŒè¡Œ"></a>htmlå®ç°å¤šå¼ å›¾ç‰‡åŒè¡Œ</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>center</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202401272109891.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å›¾1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>center</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>center</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202401272122120.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å›¾2 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>center</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_33826564/article/details/81303230">https://blog.csdn.net/qq_33826564/article/details/81303230</a></p><h3 id="3-è¯¦ç»†é…ç½®"><a href="#3-è¯¦ç»†é…ç½®" class="headerlink" title="3.è¯¦ç»†é…ç½®"></a>3.è¯¦ç»†é…ç½®</h3><p>1.æå‰åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º <code>live2d_models</code> ç›®å½•</p><p><img src="https://diy-sprint.top/img/cjml.png" alt="img"></p><p>2.ä¸‹è½½å¥½çš„æ¨¡å‹åº“ä¼šåœ¨æ ¹ç›®å½•node_modulesæ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸­æœç´¢æ¨¡å‹åº“åç§°<code>live2d-widget-model-hibiki</code>å°†é‡Œé¢çš„å†…å®¹å¤åˆ¶åˆ°æå‰åˆ›å»ºå¥½çš„ç›®å½•ä¸‹<code>live2d_models</code></p><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202401272129897.png" alt="img"></p><p>3.å¼€å§‹é…ç½®æ ¹ç›®å½•ä¸‹çš„<code>_config.yml</code> æ–‡ä»¶åœ¨åº•éƒ¨æ·»åŠ å¦‚ä¸‹æ“ä½œ</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># çœ‹æ¿å¨˜</span><span class="token key atrule">live2d</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#enable: false</span>  <span class="token key atrule">scriptFrom</span><span class="token punctuation">:</span> local <span class="token comment"># é»˜è®¤</span>  <span class="token key atrule">pluginRootPath</span><span class="token punctuation">:</span> live2dw/ <span class="token comment"># æ’ä»¶åœ¨ç«™ç‚¹ä¸Šçš„æ ¹ç›®å½•(ç›¸å¯¹è·¯å¾„)</span>  <span class="token key atrule">pluginJsPath</span><span class="token punctuation">:</span> lib/ <span class="token comment"># è„šæœ¬æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„</span>  <span class="token key atrule">pluginModelPath</span><span class="token punctuation">:</span> assets/ <span class="token comment"># æ¨¡å‹æ–‡ä»¶ç›¸å¯¹ä¸æ’ä»¶æ ¹ç›®å½•è·¯å¾„</span>  <span class="token comment"># scriptFrom: jsdelivr # jsdelivr CDN</span>  <span class="token comment"># scriptFrom: unpkg # unpkg CDN</span>  <span class="token comment"># scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # ä½ çš„è‡ªå®šä¹‰ url</span>  <span class="token key atrule">tagMode</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># æ ‡ç­¾æ¨¡å¼, æ˜¯å¦ä»…æ›¿æ¢ live2d tagæ ‡ç­¾è€Œéæ’å…¥åˆ°æ‰€æœ‰é¡µé¢ä¸­</span>  <span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># è°ƒè¯•, æ˜¯å¦åœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿—</span>  <span class="token key atrule">model</span><span class="token punctuation">:</span>    <span class="token key atrule">use</span><span class="token punctuation">:</span> live2d<span class="token punctuation">-</span>widget<span class="token punctuation">-</span>model<span class="token punctuation">-</span>hibiki    <span class="token comment"># use: live2d-widget-model-wanko # npm-module package name</span>    <span class="token comment"># use: wanko # åšå®¢æ ¹ç›®å½•/live2d_models/ ä¸‹çš„ç›®å½•å</span>    <span class="token comment"># use: ./wives/wanko # ç›¸å¯¹äºåšå®¢æ ¹ç›®å½•çš„è·¯å¾„</span>    <span class="token comment"># use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # ä½ çš„è‡ªå®šä¹‰ url</span>  <span class="token key atrule">display</span><span class="token punctuation">:</span>    <span class="token key atrule">position</span><span class="token punctuation">:</span> right    <span class="token key atrule">width</span><span class="token punctuation">:</span> <span class="token number">145</span>    <span class="token key atrule">height</span><span class="token punctuation">:</span> <span class="token number">315</span>    <span class="token key atrule">hOffset</span><span class="token punctuation">:</span> <span class="token number">60</span> <span class="token comment"># æ°´å¹³åç§» </span>    <span class="token key atrule">vOffset</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># å‚ç›´åç§»</span>  <span class="token key atrule">mobile</span><span class="token punctuation">:</span>    <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤º</span>    <span class="token key atrule">scale</span><span class="token punctuation">:</span> <span class="token number">0.5</span> <span class="token comment"># ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç¼©æ”¾       </span>  <span class="token key atrule">react</span><span class="token punctuation">:</span>    <span class="token key atrule">opacityDefault</span><span class="token punctuation">:</span> <span class="token number">0.7</span>    <span class="token key atrule">opacityOnHover</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>model:  use: live2d-widget-model-hibikiuse <code># è¿™é‡Œå¡«ä½ å–œæ¬¢çš„æ¨¡å‹</code></p></blockquote><h1 id="å¢å¼ºç‰ˆè®¾ç½®"><a href="#å¢å¼ºç‰ˆè®¾ç½®" class="headerlink" title="å¢å¼ºç‰ˆè®¾ç½®"></a>å¢å¼ºç‰ˆè®¾ç½®</h1><h3 id="1-å…ˆå¸è½½helper-live2d"><a href="#1-å…ˆå¸è½½helper-live2d" class="headerlink" title="1.å…ˆå¸è½½helper-live2d"></a>1.å…ˆå¸è½½helper-live2d</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">npm uninstall hexo<span class="token punctuation">-</span>helper<span class="token punctuation">-</span>live2d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-ä¸‹è½½å¤§ç¥çš„é…ç½®"><a href="#2-ä¸‹è½½å¤§ç¥çš„é…ç½®" class="headerlink" title="2.ä¸‹è½½å¤§ç¥çš„é…ç½®"></a>2.<a href="https://github.com/stevenjoezhang/live2d-widget">ä¸‹è½½å¤§ç¥çš„é…ç½®</a></h3><h3 id="3-è§£å‹é…ç½®"><a href="#3-è§£å‹é…ç½®" class="headerlink" title="3.è§£å‹é…ç½®"></a>3.è§£å‹é…ç½®</h3><p>è§£å‹åˆ°<code>\themes\ä¸»é¢˜\source</code>ç›®å½•å¹¶æ”¹åä¸º<code>live2d-widget</code></p><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202401272138049.png" alt="img"></p><h3 id="4-ä¿®æ”¹è·¯å¾„"><a href="#4-ä¿®æ”¹è·¯å¾„" class="headerlink" title="4.ä¿®æ”¹è·¯å¾„"></a>4.ä¿®æ”¹è·¯å¾„</h3><p>ä¿®æ”¹<code>autoload.js</code>æ–‡ä»¶ï¼Œå°†å¤§ç¥è·¯å¾„æ”¹ä¸ºç›¸å¯¹è·¯å¾„</p><pre class="line-numbers language-Text" data-language="Text"><code class="language-Text">&#x2F;&#x2F; æ³¨æ„ï¼šlive2d_path å‚æ•°åº”ä½¿ç”¨ç»å¯¹è·¯å¾„&#x2F;&#x2F;const live2d_path &#x3D; &quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;stevenjoezhang&#x2F;live2d-widget@latest&#x2F;&quot;;const live2d_path &#x3D; &quot;&#x2F;live2d-widget&#x2F;&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="5-ä¿®æ”¹ä»£ç "><a href="#5-ä¿®æ”¹ä»£ç " class="headerlink" title="5.ä¿®æ”¹ä»£ç "></a>5.ä¿®æ”¹ä»£ç </h3><p>ä¿®æ”¹<code>\themes\ä¸»é¢˜\layout\_partial</code>ä¸‹çš„<code>head.ejs</code>ï¼Œnextä¸»é¢˜åœ¨&#x2F;themes&#x2F;next&#x2F;layout&#x2F;_layout.swingç›®å½•ä¸‹</p><pre class="line-numbers language-Text" data-language="Text"><code class="language-Text">&lt;!--çœ‹æ¿å¨˜--&gt;&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;jquery&#x2F;dist&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script src&#x3D;&quot;&#x2F;live2d-widget&#x2F;autoload.js&quot;&gt;&lt;&#x2F;script&gt;&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;font-awesome&#x2F;css&#x2F;font-awesome.min.css&quot;&#x2F;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-å¯ç”¨é…ç½®"><a href="#6-å¯ç”¨é…ç½®" class="headerlink" title="6.å¯ç”¨é…ç½®"></a>6.å¯ç”¨é…ç½®</h3><p>åœ¨<code>_config.yml</code>å…¨å±€é…ç½®æ–‡æœ«æ·»åŠ </p><pre class="line-numbers language-Text" data-language="Text"><code class="language-Text">#è‡ªå®šä¹‰çœ‹æ¿å¨˜åŠ¨ç”»live2d: enable: true  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æƒ³ä¿®æ”¹çœ‹æ¿å¨˜å¤§å°ã€ä½ç½®ã€æ ¼å¼ã€æ–‡æœ¬å†…å®¹ç­‰ï¼Œå¯æŸ¥çœ‹å¹¶ä¿®æ”¹ waifu-tips.jsã€waifu-tips.jsonã€waifu.cssæ–‡ä»¶ã€‚</p><h3 id="7-æŸ¥çœ‹å¹¶éƒ¨ç½²"><a href="#7-æŸ¥çœ‹å¹¶éƒ¨ç½²" class="headerlink" title="7.æŸ¥çœ‹å¹¶éƒ¨ç½²"></a>7.æŸ¥çœ‹å¹¶éƒ¨ç½²</h3><pre class="line-numbers language-none"><code class="language-none">hexo cl &amp;&amp; hexo g &amp;&amp; hexo s &amp;&amp; hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ¡å‘½ä»¤ä¼šé¦–å…ˆæ¸…é™¤ç¼“å­˜ (<code>hexo clean</code>), ç„¶åç”Ÿæˆé™æ€ç½‘é¡µ (<code>hexo g</code>), æ¥ç€å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨é¢„è§ˆ (<code>hexo s</code>)ï¼Œæœ€åéƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“ (<code>hexo d</code>)ã€‚è¯·æ³¨æ„ï¼Œåœ¨éƒ¨ç½²å®Œæˆåï¼Œç”±äº<code>hexo s</code>ä»åœ¨è¿è¡Œï¼Œæœ¬åœ°é¢„è§ˆå°†ä¼šç»§ç»­æä¾›æœåŠ¡ï¼Œç›´åˆ°ä½ æ‰‹åŠ¨åœæ­¢å®ƒ(<code>Ctrl C</code>)</p><h3 id="8-æ¼”ç¤ºæ•ˆæœ"><a href="#8-æ¼”ç¤ºæ•ˆæœ" class="headerlink" title="8.æ¼”ç¤ºæ•ˆæœ"></a>8.æ¼”ç¤ºæ•ˆæœ</h3><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202401272151637.png" alt="image-20240127215123424"></p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p>æœ¬æ–‡å‚è€ƒä»¥ä¸‹å¤§ç¥çš„åšæ–‡ï¼š</p><p>Onlookerï¼š</p><ul><li><a href="https://diy-sprint.top/2021/050559226.html">https://diy-sprint.top/2021/050559226.html</a></li><li><a href="https://diy-sprint.top/2021/050635991.html">æ·»åŠ live2dçœ‹æ¿åŠ¨ç”»(å¯å¯¹è¯ï¼Œæ¢è£…äº’åŠ¨) | Onlooker (diy-sprint.top)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> live2D </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢(ä¸€) â€”â€”åŸºç¡€æ­å»º</title>
      <link href="/posts/15bb.html"/>
      <url>/posts/15bb.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="ä¸‹è½½git"><a href="#ä¸‹è½½git" class="headerlink" title="ä¸‹è½½git"></a>ä¸‹è½½git</h3><p>å®‰è£…git for windowsï¼ˆæˆ–è€…å…¶å®ƒgitå®¢æˆ·ç«¯ï¼‰<a href="https://git-scm.com/downloads">gitä¸‹è½½</a></p><p>éªŒè¯gitå®‰è£…å‘½ä»¤(cmdçª—å£æˆ–é¼ æ ‡å³é”®èœå•çš„git bash çª—å£)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¸‹è½½node-js"><a href="#ä¸‹è½½node-js" class="headerlink" title="ä¸‹è½½node.js"></a>ä¸‹è½½node.js</h3><p>åœ¨<a href="https://nodejs.org/zh-cn/">å®˜ç½‘</a>ä¸‹è½½node.jsçš„å®‰è£…ç¨‹åºï¼Œæ ¹æ®ä½ ç”µè„‘ç³»ç»Ÿçš„é…ç½®ä¿¡æ¯ï¼Œä¸‹è½½å¯¹åº”çš„å®‰è£…ç¨‹åºã€‚</p><p>éªŒè¯nodeå®‰è£…å‘½ä»¤ (cmdçª—å£æˆ–é¼ æ ‡å³é”®èœå•çš„git bash çª—å£)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">node</span> <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="vscodeå®‰è£…"><a href="#vscodeå®‰è£…" class="headerlink" title="vscodeå®‰è£…"></a>vscodeå®‰è£…</h3><p>Visual Studio Code <a href="https://visualstudio.microsoft.com/zh-hans/">å®˜ç½‘ä¸‹è½½</a></p><h3 id="githubè´¦å·"><a href="#githubè´¦å·" class="headerlink" title="githubè´¦å·"></a>githubè´¦å·</h3><p>å¦‚æœæ²¡æœ‰å°±æ³¨å†Œä¸€ä¸ªï¼š<a href="https://github.com/">https://github.com/</a></p><h2 id="Github-Pagesåˆ›å»º"><a href="#Github-Pagesåˆ›å»º" class="headerlink" title="Github Pagesåˆ›å»º"></a>Github Pagesåˆ›å»º</h2>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cuda å…¥é—¨</title>
      <link href="/posts/c7d8.html"/>
      <url>/posts/c7d8.html</url>
      
        <content type="html"><![CDATA[<h1 id="CUDAå…¥é—¨"><a href="#CUDAå…¥é—¨" class="headerlink" title="CUDAå…¥é—¨"></a>CUDAå…¥é—¨</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>06å¹´ï¼ŒNVIDIAå…¬å¸å‘å¸ƒäº†CUDAï¼Œå®ƒæ˜¯å»ºç«‹åœ¨NVIDIAçš„GPUä¸Šçš„ä¸€ä¸ªé€šç”¨å¹¶è¡Œè®¡ç®—å¹³å°å’Œç¼–ç¨‹æ¨¡å‹ã€‚CUDAç¼–ç¨‹ä½¿å¾—å¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨GPUçš„å¹¶è¡Œè®¡ç®—å¼•æ“æ¥è§£å†³å¤æ‚çš„è®¡ç®—é—®é¢˜ã€‚è¿‘å¹´æ¥ï¼ŒGPUåœ¨æ·±åº¦å­¦ä¹ é¢†åŸŸå–å¾—äº†å·¨å¤§æˆåŠŸï¼ŒåŸºäºGPUçš„å¹¶è¡Œè®¡ç®—å·²æˆä¸ºè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ ‡å‡†ã€‚</p><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼ŒGPUå¹¶éç‹¬ç«‹è¿è¡Œçš„è®¡ç®—å¹³å°ï¼Œè€Œæ˜¯éœ€è¦ä¸CPUååŒå·¥ä½œçš„ã€‚å®ƒå¯ä»¥è§†ä½œCPUçš„åå¤„ç†å™¨ï¼Œåœ¨æåŠGPUå¹¶è¡Œè®¡ç®—æ—¶ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯åŸºäºCPU+GPUçš„å¼‚æ„è®¡ç®—æ¶æ„ã€‚åœ¨è¿™ç§å¼‚æ„è®¡ç®—æ¶æ„ä¸­ï¼ŒGPUä¸CPUé€šè¿‡PCIeæ€»çº¿è¿æ¥åœ¨ä¸€èµ·ï¼ŒååŒå®Œæˆè®¡ç®—ä»»åŠ¡ã€‚CPUæ‰€åœ¨ä½ç½®è¢«ç§°ä¸ºä¸»æœºç«¯ï¼ˆhostï¼‰ï¼Œè€ŒGPUæ‰€åœ¨ä½ç½®è¢«ç§°ä¸ºè®¾å¤‡ç«¯ï¼ˆdeviceï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202312191415196.png" alt="image-20231219141540082" style="zoom:80%;" /><p>å½“æ¯”è¾ƒGPUå’ŒCPUæ—¶ï¼ŒGPUæ‹¥æœ‰æ›´å¤šçš„è®¡ç®—æ ¸å¿ƒï¼Œä½¿å…¶éå¸¸é€‚åˆå¤„ç†æ•°æ®å¹¶è¡Œçš„è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œä¾‹å¦‚å¤§å‹çŸ©é˜µè¿ç®—ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCPUçš„æ ¸å¿ƒæ•°é‡è¾ƒå°‘ï¼Œä½†å®ƒä»¬æ“…é•¿æ‰§è¡Œå¤æ‚çš„é€»è¾‘è¿ç®—ï¼Œé€‚ç”¨äºæ§åˆ¶å¯†é›†å‹ä»»åŠ¡ã€‚æ­¤å¤–ï¼ŒCPUä¸Šçš„çº¿ç¨‹é€šå¸¸æ˜¯é‡å‹çš„ï¼Œå¯¼è‡´è¾ƒå¤§çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œè€ŒGPUæ‹¥æœ‰è®¸å¤šè½»é‡çº§çº¿ç¨‹ã€‚</p><p>å› æ­¤ï¼ŒåŸºäºCPU+GPUçš„å¼‚æ„è®¡ç®—å¹³å°èƒ½å¤Ÿå……åˆ†å‘æŒ¥ä¼˜åŠ¿ã€‚CPUè´Ÿè´£å¤„ç†ä¸²è¡Œç¨‹åºä¸­çš„é€»è¾‘å¤æ‚éƒ¨åˆ†ï¼Œè€ŒGPUåˆ™ä¸“æ³¨äºå¤„ç†æ•°æ®å¯†é›†å‹ã€å¹¶è¡Œè®¡ç®—çš„éƒ¨åˆ†ï¼Œè¿™æ ·èƒ½å¤Ÿå®ç°æœ€ä½³æ€§èƒ½ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202312191433412.png" alt="image-20231219143336313" style="zoom:80%;" /><p>CUDAæ˜¯NVIDIAå…¬å¸å¼€å‘çš„GPUç¼–ç¨‹æ¨¡å‹ï¼Œå®ƒæä¾›äº†ç®€å•æ˜“ç”¨çš„æ¥å£ï¼Œå¯ç”¨äºæ„å»ºåŸºäºGPUè®¡ç®—çš„åº”ç”¨ç¨‹åºã€‚CUDAæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚C&#x2F;C++ã€Pythonå’ŒFortranç­‰ã€‚ä¸‹é¢æˆ‘ä»¬å°†ä½¿ç”¨CUDA C&#x2F;C++æ¥å£æ¥è®²è§£CUDAç¼–ç¨‹ã€‚Windowsç³»ç»Ÿä¸‹çš„CUDAå®‰è£…æ•™ç¨‹å¯ä»¥å‚è€ƒç»™å‡ºçš„é“¾æ¥è¿›è¡Œå®‰è£…ï¼š<a href="https://blog.csdn.net/chen565884393/article/details/127905428">CUDAå®‰è£…åŠç¯å¢ƒé…ç½®â€”â€”æœ€æ–°è¯¦ç»†ç‰ˆ-CSDNåšå®¢</a></p><h2 id="å…¥é—¨åŸºç¡€"><a href="#å…¥é—¨åŸºç¡€" class="headerlink" title="å…¥é—¨åŸºç¡€"></a>å…¥é—¨åŸºç¡€</h2><p>åœ¨CUDAç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œæ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼šhostå’Œdeviceã€‚</p><p>hostä»£è¡¨ç€CPUåŠå…¶ç›¸å…³å†…å­˜ï¼Œè€Œdeviceä»£è¡¨ç€GPUåŠå…¶ç›¸å…³å†…å­˜ã€‚CUDAç¨‹åºä¸­åŒæ—¶å­˜åœ¨hostç¨‹åºå’Œdeviceç¨‹åºï¼Œåˆ†åˆ«åœ¨CPUå’ŒGPUä¸Šè¿è¡Œã€‚æ­¤å¤–ï¼Œhostå’Œdeviceä¹‹é—´å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œå…è®¸æ•°æ®åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œä¼ è¾“ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œå…¸å‹çš„CUDAç¨‹åºæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆ†é…hostå†…å­˜å¹¶å¯¹æ•°æ®è¿›è¡Œåˆå§‹åŒ–</li><li>åˆ†é…deviceå†…å­˜ï¼Œå¹¶å°†æ•°æ®ä»hostæ‹·è´åˆ°deviceä¸Š</li><li>è°ƒç”¨CUDAçš„æ ¸å‡½æ•°ï¼ˆkernelï¼‰åœ¨deviceä¸Šå®ŒæˆæŒ‡å®šçš„å¹¶è¡Œè¿ç®—</li><li>å°†deviceä¸Šè®¡ç®—å¾—åˆ°çš„ç»“æœæ‹·è´å›host</li><li>é‡Šæ”¾deviceå’Œhostä¸Šåˆ†é…çš„å†…å­˜ç©ºé—´</li></ol><p>æ ¸å‡½æ•°ï¼ˆkernelï¼‰æ˜¯CUDAä¸­çš„å…³é”®æ¦‚å¿µï¼Œå®ƒæ˜¯åœ¨deviceä¸Šå¹¶è¡Œæ‰§è¡Œçš„å‡½æ•°ã€‚æ ¸å‡½æ•°ä»¥ <code>__global__</code> ä¿®é¥°ç¬¦å£°æ˜ï¼Œåœ¨è°ƒç”¨æ—¶éœ€è¦ä½¿ç”¨ <code>&lt;&lt;&lt;grid, block&gt;&gt;&gt;</code> æ¥æŒ‡å®škernelè¦æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚åœ¨CUDAä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œæ ¸å‡½æ•°ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„çº¿ç¨‹IDï¼Œå¯ä»¥é€šè¿‡æ ¸å‡½æ•°çš„å†…ç½®å˜é‡ threadIdx æ¥è·å–ã€‚</p><p>ç”±äºGPUæ˜¯å¼‚æ„è®¡ç®—æ¨¡å‹ï¼Œå› æ­¤éœ€è¦åŒºåˆ†hostå’Œdeviceä¸Šçš„ä»£ç ã€‚åœ¨CUDAä¸­ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°ç±»å‹é™å®šè¯æ¥åŒºåˆ†hostå’Œdeviceä¸Šçš„å‡½æ•°ã€‚ä¸»è¦çš„ä¸‰ç§å‡½æ•°ç±»å‹é™å®šè¯å¦‚ä¸‹ï¼š</p><ul><li><code>__global__</code>ï¼šåœ¨deviceä¸Šæ‰§è¡Œï¼Œå¯ä»¥ä»hostè°ƒç”¨ï¼ˆä¸€äº›ç‰¹å®šçš„GPUä¹Ÿèƒ½ä»deviceä¸Šè°ƒç”¨ï¼‰ã€‚è¿”å›ç±»å‹å¿…é¡»æ˜¯ voidï¼Œä¸æ”¯æŒå¯å˜å‚æ•°ï¼Œä¹Ÿä¸èƒ½æˆä¸ºç±»çš„æˆå‘˜å‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨ <code>__global__</code> å®šä¹‰çš„kernelæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œè¿™æ„å‘³ç€hostä¸ä¼šç­‰å¾…kernelæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li><li><code>__device__</code>ï¼šåœ¨deviceä¸Šæ‰§è¡Œï¼Œä»…å¯ä»¥ä»deviceä¸­è°ƒç”¨ï¼Œä¸èƒ½ä¸ <code>__global__</code> åŒæ—¶ä½¿ç”¨ã€‚</li><li><code>__host__</code>ï¼šåœ¨hostä¸Šæ‰§è¡Œï¼Œä»…å¯ä»¥ä»hostä¸­è°ƒç”¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ­¤ä¿®é¥°ç¬¦å¯ä»¥çœç•¥ä¸å†™ã€‚å®ƒä¸èƒ½ä¸ <code>__global__</code> åŒæ—¶ä½¿ç”¨ï¼Œä½†å¯ä»¥ä¸ <code>__device__</code> ç»“åˆä½¿ç”¨ï¼Œæ­¤æ—¶å‡½æ•°å¯åœ¨deviceå’Œhostä¸Šéƒ½ç¼–è¯‘ã€‚</li></ul><p>è¦æ·±å…¥ç†è§£kernelï¼Œéœ€è¦å¯¹kernelçš„çº¿ç¨‹å±‚æ¬¡ç»“æ„æœ‰æ¸…æ™°çš„è®¤è¯†ã€‚</p><ul><li>çº¿ç¨‹ç»“æ„çš„ç¬¬ä¸€å±‚æ¬¡ï¼šGPUä¸Šå­˜åœ¨å¤§é‡å¹¶è¡ŒåŒ–çš„è½»é‡çº§çº¿ç¨‹ã€‚å½“kernelåœ¨deviceä¸Šæ‰§è¡Œæ—¶ï¼Œå®é™…ä¸Šæ˜¯å¯åŠ¨äº†å¤§é‡çº¿ç¨‹ï¼Œä¸€ä¸ªkernelå¯åŠ¨çš„æ‰€æœ‰çº¿ç¨‹æ„æˆä¸€ä¸ªç½‘æ ¼ï¼ˆgridï¼‰</li><li>ç¬¬äºŒä¸ªå±‚æ¬¡ï¼šåœ¨åŒä¸€ä¸ªç½‘æ ¼å†…ï¼Œä¸€äº›çº¿ç¨‹å…±äº«ç›¸åŒçš„å…¨å±€å†…å­˜ç©ºé—´ï¼Œç½‘æ ¼è¢«åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯ä¸€ä¸ªçº¿ç¨‹å—ï¼ˆblockï¼‰ä¸€ä¸ªçº¿ç¨‹å—åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚</li><li>ç¬¬ä¸‰ä¸ªå±‚æ¬¡ï¼šåœ¨çº¿ç¨‹å—å†…ï¼Œçº¿ç¨‹è¢«åˆ’åˆ†ä¸ºæ›´å°çš„å•å…ƒï¼Œç§°ä¸ºçº¿ç¨‹ï¼ˆthreadï¼‰ã€‚è¿™æ˜¯GPUä¸Šçš„æœ€ç»†ç²’åº¦çš„å¹¶è¡Œå±‚æ¬¡ã€‚çº¿ç¨‹æ˜¯æ‰§è¡Œè®¡ç®—çš„åŸºæœ¬å•å…ƒï¼Œå®ƒä»¬å…±äº«çº¿ç¨‹å—å†…çš„èµ„æºï¼ŒåŒ…æ‹¬å¯„å­˜å™¨æ–‡ä»¶å’Œå…±äº«å†…å­˜ã€‚é€šè¿‡åˆç†çš„ç»„ç»‡å’ŒååŒå·¥ä½œï¼Œçº¿ç¨‹èƒ½å¤Ÿé«˜æ•ˆåœ°æ‰§è¡Œå„è‡ªçš„ä»»åŠ¡ï¼Œå®ç°æ›´ç»†è‡´çš„å¹¶è¡ŒåŒ–ã€‚</li></ul><p>çº¿ç¨‹çš„å±‚æ¬¡ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»¥äºŒç»´çš„gridå’Œblockä¸ºä¾‹ã€‚gridå’Œblockéƒ½è¢«å®šä¹‰ä¸º dim3 ç±»å‹çš„å˜é‡ï¼Œdim3 å¯ä»¥çœ‹ä½œåŒ…å«ä¸‰ä¸ªæ— ç¬¦å·æ•´æ•°ï¼ˆxï¼Œyï¼Œzï¼‰æˆå‘˜çš„ç»“æ„ä½“å˜é‡ï¼Œåœ¨å®šä¹‰æ—¶ï¼Œç¼ºçœå€¼é»˜è®¤ä¸º1ã€‚å› æ­¤ï¼Œgridå’Œblockå¯ä»¥çµæ´»å®šä¹‰ä¸º1ç»´ã€2ç»´æˆ–3ç»´ç»“æ„ã€‚åœ¨CUDAç¼–ç¨‹ä¸­ï¼Œè¿™äº›æ¦‚å¿µå’Œè§„åˆ™æ˜¯å…³é”®ï¼Œå¯¹äºç†è§£å’Œåˆ©ç”¨GPUå¹¶è¡Œè®¡ç®—æä¸ºé‡è¦ã€‚</p><p>è¦è°ƒç”¨kernelï¼Œå¿…é¡»é€šè¿‡æ‰§è¡Œé…ç½® <code>&lt;&lt;&lt;grid, block&gt;&gt;&gt;</code> æ¥æŒ‡å®škernelæ‰€ä½¿ç”¨çš„çº¿ç¨‹æ•°åŠç»“æ„ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">dim3 <span class="token function">grid</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dim3 <span class="token function">block</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>kernel_fun<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> grid<span class="token punctuation">,</span> block <span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">(</span>prams<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202312231222160.png" alt="Kernelçš„ä¸¤å±‚çº¿ç¨‹ç»„ç»‡ç»“æ„ï¼ˆ2-dimï¼‰" style="zoom:67%;" /><p>æ‰€ä»¥ï¼Œä¸€ä¸ªçº¿ç¨‹éœ€è¦ä¸¤ä¸ªå†…ç½®çš„åæ ‡å˜é‡ï¼ˆblockIdxï¼ŒthreadIdxï¼‰æ¥å”¯ä¸€æ ‡è¯†ï¼Œå®ƒä»¬éƒ½æ˜¯<code>dim3</code>ç±»å‹å˜é‡ï¼Œå…¶ä¸­blockIdxæŒ‡æ˜çº¿ç¨‹æ‰€åœ¨gridä¸­çš„ä½ç½®ï¼Œè€ŒthreaIdxæŒ‡æ˜çº¿ç¨‹æ‰€åœ¨blockä¸­çš„ä½ç½®ï¼Œå¦‚å›¾ä¸­çš„Thread (1,1)æ»¡è¶³ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">threadIdx<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span>threadIdx<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">1</span>blockIdx<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span>blockIdx<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨CUDAç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹å—ï¼ˆblockï¼‰ä¸­çš„çº¿ç¨‹è¢«åˆ†é…åˆ°åŒä¸€ä¸ªæµå¼å¤šå¤„ç†å™¨ï¼ˆSMï¼‰ä¸Šï¼Œä½†æ˜¯æ¯ä¸ªSMçš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œå› æ­¤çº¿ç¨‹å—ä¸­çš„çº¿ç¨‹æ•°é‡å—åˆ°é™åˆ¶ã€‚ç°ä»£GPUæ”¯æŒçš„çº¿ç¨‹å—ä¸­çš„çº¿ç¨‹æ•°é‡é€šå¸¸å¯è¾¾1024ä¸ªã€‚æœ‰æ—¶å€™ï¼Œéœ€è¦çŸ¥é“ä¸€ä¸ªçº¿ç¨‹åœ¨blockä¸­çš„å…¨å±€IDï¼Œè¿™å°±éœ€è¦äº†è§£blockçš„ç»„ç»‡ç»“æ„ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹çš„å†…ç½®å˜é‡ blockDim æ¥è·å–ã€‚å®ƒè·å–çº¿ç¨‹å—åœ¨å„ä¸ªç»´åº¦ä¸Šçš„å¤§å°ã€‚å¯¹äºä¸€ä¸ª2ç»´çš„block( D<del>x</del>, D<del>y</del>)ï¼Œçº¿ç¨‹(x, y)çš„IDå€¼ä¸º (x + y * D<del>x</del> )ï¼Œå¦‚æœæ˜¯3ç»´çš„block( D<del>x</del>, D<del>y</del>, D<del>z</del>)ï¼Œçº¿ç¨‹(x, y, z)çš„IDå€¼ä¸º (x + y * D<del>x</del> + z * D<del>x</del> * D<del>y</del>)ã€‚æ­¤å¤–ï¼Œçº¿ç¨‹è¿˜å…·æœ‰å†…ç½®å˜é‡ gridDimï¼Œç”¨äºè·å–ç½‘æ ¼å—åœ¨å„ä¸ªç»´åº¦ä¸Šçš„å¤§å°ã€‚</p><p>kernelçš„è¿™ç§çº¿ç¨‹ç»„ç»‡ç»“æ„å¤©ç„¶é€‚åˆvectorã€matrixç­‰è¿ç®—ï¼Œå¦‚æˆ‘ä»¬å°†åˆ©ç”¨ä¸Šå›¾2-dimç»“æ„å®ç°ä¸¤ä¸ªçŸ©é˜µçš„åŠ æ³•ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£å¤„ç†æ¯ä¸ªä½ç½®çš„ä¸¤ä¸ªå…ƒç´ ç›¸åŠ ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚çº¿ç¨‹å—å¤§å°ä¸º(16, 16)ï¼Œç„¶åå°†N * Nå¤§å°çš„çŸ©é˜µå‡åˆ†ä¸ºä¸åŒçš„çº¿ç¨‹å—æ¥æ‰§è¡ŒåŠ æ³•è¿ç®—ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">__global__ <span class="token keyword">void</span> <span class="token function">matrixAddition</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">float</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token keyword">float</span> <span class="token operator">*</span>c<span class="token punctuation">,</span> <span class="token keyword">int</span> N<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> row <span class="token operator">=</span> blockIdx<span class="token punctuation">.</span>y <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>y <span class="token operator">+</span> threadIdx<span class="token punctuation">.</span>y<span class="token punctuation">;</span>    <span class="token keyword">int</span> col <span class="token operator">=</span> blockIdx<span class="token punctuation">.</span>x <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>x <span class="token operator">+</span> threadIdx<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;</span> N <span class="token operator">&amp;&amp;</span> col <span class="token operator">&lt;</span> N<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> index <span class="token operator">=</span> row <span class="token operator">*</span> N <span class="token operator">+</span> col<span class="token punctuation">;</span>        c<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å…¶ä»–ä»£ç ...</span>    dim3 <span class="token function">blockSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dim3 <span class="token function">gridSize</span><span class="token punctuation">(</span><span class="token punctuation">(</span>N <span class="token operator">+</span> blockSize<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span>N <span class="token operator">+</span> blockSize<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>    matrixAddition<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>gridSize<span class="token punctuation">,</span> blockSize<span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">(</span>device_a<span class="token punctuation">,</span> device_b<span class="token punctuation">,</span> device_c<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å…¶ä»–ä»£ç ...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šä»£ç ä¸­ï¼Œkernelå‡½æ•° matrixAddition å®ç°äº†çŸ©é˜µåŠ æ³•æ“ä½œã€‚é€šè¿‡è®¡ç®—æ¯ä¸ªçº¿ç¨‹çš„è¡Œåˆ—ç´¢å¼•ï¼Œç¡®ä¿æ¯ä¸ªçº¿ç¨‹ä»…å¤„ç†æœ‰æ•ˆçš„çŸ©é˜µå…ƒç´ ã€‚ä¸»å‡½æ•°ä¸­ï¼Œæ ¹æ®çŸ©é˜µå¤§å° N å’Œè®¾å®šçš„çº¿ç¨‹å—å¤§å°ï¼Œè®¡ç®—å‡ºé€‚å½“çš„ grid å’Œ block å°ºå¯¸ï¼Œå¹¶è°ƒç”¨ kernel å‡½æ•°æ‰§è¡ŒçŸ©é˜µåŠ æ³•ã€‚</p><h3 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h3><p>è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹CUDAçš„å†…å­˜æ¨¡å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202312232011569.png" alt="CUDAå†…å­˜æ¨¡å‹" style="zoom: 67%;" /><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰æœ¬åœ°å†…å­˜ï¼ˆLocal Memoryï¼‰ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹å—æœ‰åŒ…å«å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰,å¯ä»¥è¢«çº¿ç¨‹å—ä¸­æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹å—ä¸€è‡´ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å…¨å±€å†…å­˜ï¼ˆGlobal Memoryï¼‰ã€‚è¿˜å¯ä»¥è®¿é—®ä¸€äº›åªè¯»å†…å­˜å—ï¼šå¸¸é‡å†…å­˜ï¼ˆConstant Memoryï¼‰å’Œçº¹ç†å†…å­˜ï¼ˆTexture Memoryï¼‰</p><p>è¿™äº›å†…å­˜ç±»å‹çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ol><li><p><strong>ç§æœ‰æœ¬åœ°å†…å­˜ï¼ˆLocal Memoryï¼‰</strong>ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç§æœ‰æœ¬åœ°å†…å­˜ï¼Œç”¨äºå­˜å‚¨çº¿ç¨‹ç§æœ‰çš„å˜é‡å’Œæ•°æ®ã€‚è¿™äº›å˜é‡é€šå¸¸æ˜¯åœ¨å¯„å­˜å™¨ä¸è¶³æ—¶æˆ–è€…åŠ¨æ€åˆ†é…å†…å­˜æ—¶ä½¿ç”¨ã€‚è®¿é—®æœ¬åœ°å†…å­˜çš„é€Ÿåº¦è¾ƒæ…¢ï¼Œå› æ­¤éœ€è¦å°½é‡å‡å°‘å¯¹æœ¬åœ°å†…å­˜çš„è®¿é—®ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</p></li><li><p><strong>å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰</strong>ï¼šæ¯ä¸ªçº¿ç¨‹å—éƒ½æ‹¥æœ‰å…±äº«å†…å­˜ï¼Œå®ƒå¯ä»¥è¢«è¯¥çº¿ç¨‹å—ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚å…±äº«å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹å—ä¸€è‡´ï¼Œå¯¹äºéœ€è¦åœ¨çº¿ç¨‹å—å†…å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«çš„æ•°æ®ï¼Œå¯ä»¥å­˜å‚¨åœ¨å…±äº«å†…å­˜ä¸­ã€‚å…±äº«å†…å­˜çš„è®¿é—®é€Ÿåº¦æ¯”å…¨å±€å†…å­˜å¿«å¾—å¤šï¼Œå› æ­¤å¯ä»¥ç”¨äºæé«˜çº¿ç¨‹å—å†…çš„æ•°æ®è®¿é—®æ•ˆç‡å’Œå¹¶è¡Œè®¡ç®—é€Ÿåº¦ã€‚</p></li><li><p><strong>å…¨å±€å†…å­˜ï¼ˆGlobal Memoryï¼‰</strong>ï¼šæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å…¨å±€å†…å­˜ï¼Œå®ƒæ˜¯GPUä¸­å®¹é‡æœ€å¤§çš„å†…å­˜ç±»å‹ã€‚å…¨å±€å†…å­˜é€šå¸¸ç”¨äºå­˜å‚¨æ•´ä¸ªç¨‹åºçš„æ•°æ®ï¼Œä½†å…¶è®¿é—®é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚å› æ­¤ï¼Œåœ¨CUDAç¼–ç¨‹ä¸­ï¼Œéœ€è¦è°¨æ…ä¼˜åŒ–å…¨å±€å†…å­˜çš„è®¿é—®ï¼Œä»¥æœ€å¤§åŒ–æ€§èƒ½ã€‚</p></li><li><p><strong>å¸¸é‡å†…å­˜ï¼ˆConstant Memoryï¼‰</strong>ï¼šå¸¸é‡å†…å­˜ç”¨äºå­˜å‚¨å¯¹æ‰€æœ‰çº¿ç¨‹åªè¯»çš„æ•°æ®ï¼Œå…¶ç‰¹ç‚¹æ˜¯å…·æœ‰ç¼“å­˜ï¼Œæä¾›å¯¹åªè¯»å†…å­˜çš„å¿«é€Ÿè®¿é—®ï¼Œé€‚ç”¨äºçº¿ç¨‹å†…çš„æ•°æ®å…±äº«ã€‚</p></li><li><p><strong>çº¹ç†å†…å­˜ï¼ˆTexture Memoryï¼‰</strong>ï¼šçº¹ç†å†…å­˜æ˜¯ä¸€ç§ç‰¹æ®Šçš„åªè¯»å†…å­˜ï¼Œé€‚ç”¨äºå›¾å½¢å¤„ç†é¢†åŸŸï¼Œæä¾›å¯¹æ•°æ®çš„é«˜æ•ˆè®¿é—®å’Œæ’å€¼ã€‚å®ƒé€šå¸¸ç”¨äºå›¾åƒå¤„ç†ç­‰åº”ç”¨åœºæ™¯ã€‚</p></li></ol><p>CUDAå†…å­˜æ¨¡å‹ä¸­ä¸åŒç±»å‹çš„å†…å­˜å…·æœ‰ä¸åŒçš„è®¿é—®ç‰¹æ€§å’Œé€Ÿåº¦ï¼Œåˆç†åœ°åˆ©ç”¨å’Œç®¡ç†è¿™äº›å†…å­˜ç±»å‹å¯ä»¥å¯¹CUDAç¨‹åºçš„æ€§èƒ½äº§ç”Ÿæ˜¾è‘—å½±å“ã€‚ä¼˜åŒ–å†…å­˜è®¿é—®æ˜¯CUDAç¼–ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦æ–¹é¢ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p><h3 id="ç¡¬ä»¶è®¤è¯†"><a href="#ç¡¬ä»¶è®¤è¯†" class="headerlink" title="ç¡¬ä»¶è®¤è¯†"></a>ç¡¬ä»¶è®¤è¯†</h3><p>è¿˜æœ‰é‡è¦ä¸€ç‚¹ï¼Œä½ éœ€è¦å¯¹GPUçš„ç¡¬ä»¶å®ç°æœ‰ä¸€ä¸ªåŸºæœ¬çš„è®¤è¯†ã€‚ä¸Šé¢è¯´åˆ°äº†kernelçš„çº¿ç¨‹ç»„ç»‡å±‚æ¬¡ï¼Œé‚£ä¹ˆä¸€ä¸ªkernelå®é™…ä¸Šä¼šå¯åŠ¨å¾ˆå¤šçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹æ˜¯é€»è¾‘ä¸Šå¹¶è¡Œçš„ï¼Œä½†æ˜¯åœ¨ç‰©ç†å±‚å´å¹¶ä¸ä¸€å®šã€‚</p><p>åœ¨GPUç¡¬ä»¶ä¸­ï¼Œä¸€ä¸ªå…³é”®ç»„ä»¶æ˜¯SMï¼ˆStreaming Multiprocessorï¼Œæµå¼å¤šå¤„ç†å™¨ï¼‰ã€‚SMåŒ…å«CUDAæ ¸å¿ƒã€å…±äº«å†…å­˜ã€å¯„å­˜å™¨ç­‰ã€‚SMèƒ½å¤ŸåŒæ—¶æ‰§è¡Œæ•°ç™¾ä¸ªçº¿ç¨‹ï¼Œå…¶å¹¶å‘èƒ½åŠ›å–å†³äºSMæ‹¥æœ‰çš„èµ„æºæ•°é‡ã€‚å½“ä¸€ä¸ªkernelè¢«æ‰§è¡Œæ—¶ï¼Œå…¶çº¿ç¨‹å—è¢«åˆ†é…åˆ°SMä¸Šã€‚ä¸€ä¸ªçº¿ç¨‹å—åªèƒ½åœ¨ä¸€ä¸ªSMä¸Šè¢«è°ƒåº¦ï¼Œè€Œä¸€ä¸ªSMé€šå¸¸èƒ½å¤Ÿè°ƒåº¦å¤šä¸ªçº¿ç¨‹å—ï¼Œè¿™å–å†³äºSMæœ¬èº«çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œä¸€ä¸ªkernelçš„çº¿ç¨‹å—å¯èƒ½è¢«åˆ†é…åˆ°å¤šä¸ªSMä¸Šï¼Œæ‰€ä»¥gridåªæ˜¯é€»è¾‘å±‚ï¼Œè€ŒSMæ‰æ˜¯æ‰§è¡Œçš„ç‰©ç†å±‚ã€‚</p><p>SMé‡‡ç”¨çš„æ˜¯<a href="https://link.zhihu.com/?target=http://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html%23simt-architecture">SIMT</a> (Single-Instruction, Multiple-Threadï¼Œå•æŒ‡ä»¤å¤šçº¿ç¨‹)æ¶æ„ï¼ŒåŸºæœ¬çš„æ‰§è¡Œå•å…ƒæ˜¯çº¿ç¨‹æŸï¼ˆwarps)ï¼Œæ¯ä¸ªçº¿ç¨‹æŸåŒ…å«32ä¸ªçº¿ç¨‹ã€‚è¿™äº›çº¿ç¨‹åŒæ—¶æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æŒ‡ä»¤åœ°å€è®¡æ•°å™¨å’Œå¯„å­˜å™¨çŠ¶æ€ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„ã€‚å› æ­¤ï¼Œå°½ç®¡çº¿ç¨‹æŸä¸­çš„çº¿ç¨‹åŒæ—¶æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ï¼Œä½†å®ƒä»¬å¯èƒ½å…·æœ‰ä¸åŒçš„è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯åœ¨é‡åˆ°åˆ†æ”¯ç»“æ„æ—¶ï¼Œå¯èƒ½å¯¼è‡´ä¸€äº›çº¿ç¨‹è¿›å…¥åˆ†æ”¯ï¼Œè€Œå…¶ä»–çº¿ç¨‹ä¸æ‰§è¡Œï¼Œè¿™äº›éæ‰§è¡Œçš„çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œå› ä¸ºGPUè§„å®šçº¿ç¨‹æŸä¸­æ‰€æœ‰çº¿ç¨‹åœ¨åŒä¸€å‘¨æœŸæ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ï¼Œçº¿ç¨‹æŸåˆ†åŒ–ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹å—è¢«åˆ’åˆ†åˆ°SMä¸Šæ—¶ï¼Œå®ƒä¼šè¿›ä¸€æ­¥åˆ’åˆ†ä¸ºå¤šä¸ªçº¿ç¨‹æŸï¼Œå› ä¸ºè¿™æ‰æ˜¯SMçš„åŸºæœ¬æ‰§è¡Œå•å…ƒã€‚ç„¶è€Œï¼Œä¸€ä¸ªSMåŒæ—¶å¹¶å‘çš„çº¿ç¨‹æŸæ•°é‡æ˜¯æœ‰é™çš„ï¼Œè¿™å—é™äºèµ„æºåˆ†é…ï¼Œå› ä¸ºSMè¦ä¸ºæ¯ä¸ªçº¿ç¨‹å—åˆ†é…å…±äº«å†…å­˜ï¼Œå¹¶ä¸ºæ¯ä¸ªçº¿ç¨‹æŸä¸­çš„çº¿ç¨‹åˆ†é…ç‹¬ç«‹çš„å¯„å­˜å™¨ã€‚å› æ­¤ï¼ŒSMçš„é…ç½®ä¼šå½±å“å…¶æ‰€æ”¯æŒçš„çº¿ç¨‹å—å’Œçº¿ç¨‹æŸçš„å¹¶å‘æ•°é‡ã€‚æ€»çš„æ¥è¯´ï¼Œè™½ç„¶kernelçš„gridå’Œblockåªæ˜¯é€»è¾‘ä¸Šçš„åˆ’åˆ†ï¼Œä½†åœ¨ç‰©ç†å±‚é¢ï¼Œä¸€ä¸ªkernelçš„æ‰€æœ‰çº¿ç¨‹å¹¶éä¸€å®šåŒæ—¶å¹¶å‘ã€‚å› æ­¤ï¼Œéœ€è¦æ³¨æ„è°ƒæ•´gridå’Œblockçš„é…ç½®ï¼Œä»¥å……åˆ†å‘æŒ¥GPUçš„æ€§èƒ½ã€‚æ­¤å¤–ï¼Œç”±äºçº¿ç¨‹æŸçš„åŸºæœ¬å¤§å°æ˜¯32ï¼Œå› æ­¤blockå¤§å°æœ€å¥½è®¾ç½®ä¸º32çš„å€æ•°ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202312232017228.png" alt="é€»è¾‘å±‚å’Œç‰©ç†å±‚" style="zoom:67%;" /><h3 id="ä¸ªäººé…ç½®"><a href="#ä¸ªäººé…ç½®" class="headerlink" title="ä¸ªäººé…ç½®"></a>ä¸ªäººé…ç½®</h3><p>åœ¨è¿›è¡ŒCUDAç¼–ç¨‹å‰ï¼Œå¯ä»¥å…ˆæ£€æŸ¥ä¸€ä¸‹è‡ªå·±çš„GPUç¡¬ä»¶é…ç½®ï¼Œè¿™æ ·æ‰èƒ½æœ‰çš„æ”¾çŸ¢ï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç è·å¾—GPUçš„é…ç½®å±æ€§ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cuda_runtime.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    cudaDeviceProp deviceProp<span class="token punctuation">;</span>    <span class="token function">cudaGetDeviceProperties</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>deviceProp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Device 0 information:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"è®¾å¤‡åç§°ä¸å‹å·: %s\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ˜¾å­˜å¤§å°: %d MB\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>deviceProp<span class="token punctuation">.</span>totalGlobalMem <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"è®¡ç®—èƒ½åŠ›: %d.%d\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>major<span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>minor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"å«æœ‰çš„SMæ•°é‡: %d\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>multiProcessorCount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"CUDA COREæ•°é‡: %d\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>multiProcessorCount <span class="token operator">*</span> <span class="token number">192</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ¯ä¸ªçº¿ç¨‹å—çš„å…±äº«å†…å­˜å¤§å°: %.2f KB\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>sharedMemPerBlock <span class="token operator">/</span> <span class="token number">1024.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ¯ä¸ªçº¿ç¨‹å—çš„æœ€å¤§çº¿ç¨‹æ•°: %d\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>maxThreadsPerBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ¯ä¸ªEMçš„æœ€å¤§çº¿ç¨‹æ•°: %d\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>maxThreadsPerMultiProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ¯ä¸ªSMçš„æœ€å¤§çº¿ç¨‹æŸæ•°: %d\n"</span><span class="token punctuation">,</span> deviceProp<span class="token punctuation">.</span>maxThreadsPerMultiProcessor <span class="token operator">/</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘é‡åŠ æ³•å®ä¾‹"><a href="#å‘é‡åŠ æ³•å®ä¾‹" class="headerlink" title="å‘é‡åŠ æ³•å®ä¾‹"></a>å‘é‡åŠ æ³•å®ä¾‹</h2><p>çŸ¥é“äº†CUDAç¼–ç¨‹åŸºç¡€ï¼Œæˆ‘ä»¬å°±æ¥ä¸ªç®€å•çš„å®æˆ˜ï¼Œåˆ©ç”¨CUDAç¼–ç¨‹å®ç°ä¸¤ä¸ªå‘é‡çš„åŠ æ³•ï¼Œåœ¨å®ç°ä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹CUDAç¼–ç¨‹ä¸­å†…å­˜ç®¡ç†APIã€‚</p><p>åœ¨CUDAç¼–ç¨‹ä¸­ï¼Œå†…å­˜ç®¡ç†æ˜¯è‡³å…³é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å†…å­˜ç®¡ç†å‡½æ•°çš„ç®€è¦ä»‹ç»ï¼š</p><ol><li><p><strong>cudaMalloc() å‡½æ•°</strong>ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">cudaError_t <span class="token function">cudaMalloc</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span> devPtr<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>cudaMalloc</code> ç”¨äºåœ¨è®¾å¤‡ï¼ˆGPUï¼‰ä¸Šåˆ†é…å†…å­˜ã€‚å®ƒç±»ä¼¼äºCè¯­è¨€ä¸­çš„ <code>malloc()</code> å‡½æ•°ï¼Œä½†æ˜¯åœ¨GPUçš„å…¨å±€å†…å­˜ä¸­åˆ†é…å†…å­˜ã€‚<code>devPtr</code> æ˜¯æŒ‡å‘åˆ†é…å†…å­˜èµ·å§‹ä½ç½®çš„æŒ‡é’ˆï¼Œ<code>size</code> è¡¨ç¤ºè¦åˆ†é…çš„å†…å­˜å­—èŠ‚æ•°ã€‚åˆ†é…æˆåŠŸæ—¶è¿”å› <code>cudaSuccess</code>ï¼Œå¦åˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ç ã€‚éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨å®Œå†…å­˜åï¼Œå¿…é¡»ä½¿ç”¨ <code>cudaFree()</code> å‡½æ•°é‡Šæ”¾ç›¸åº”çš„è®¾å¤‡å†…å­˜ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚</p><p>è¿™ä¸ªå‡½æ•°å’ŒCè¯­è¨€ä¸­çš„mallocç±»ä¼¼ï¼Œä½†æ˜¯åœ¨deviceä¸Šç”³è¯·ä¸€å®šå­—èŠ‚å¤§å°çš„æ˜¾å­˜ï¼Œå…¶ä¸­devPtræ˜¯æŒ‡å‘æ‰€åˆ†é…å†…å­˜çš„æŒ‡é’ˆã€‚</p><p>åŒæ—¶è¦é‡Šæ”¾åˆ†é…çš„å†…å­˜ä½¿ç”¨cudaFreeå‡½æ•°ï¼Œè¿™å’ŒCè¯­è¨€ä¸­çš„freeå‡½æ•°å¯¹åº”ã€‚</p></li><li><p><strong>cudaFree() å‡½æ•°</strong>ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">cudaError_t <span class="token function">cudaFree</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> devPtr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>cudaFree</code> ç”¨äºé‡Šæ”¾ä¹‹å‰ç”± <code>cudaMalloc</code> åˆ†é…çš„è®¾å¤‡å†…å­˜ã€‚ä¼ å…¥çš„å‚æ•° <code>devPtr</code> æ˜¯ä¹‹å‰åˆ†é…çš„è®¾å¤‡å†…å­˜çš„æŒ‡é’ˆã€‚é‡Šæ”¾æˆåŠŸæ—¶è¿”å› <code>cudaSuccess</code>ï¼Œå¦åˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ç ã€‚</p></li><li><p><strong>cudaMemcpy() å‡½æ•°</strong>ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">cudaError_t <span class="token function">cudaMemcpy</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> dst<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> src<span class="token punctuation">,</span> size_t count<span class="token punctuation">,</span> cudaMemcpyKind kind<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>cudaMemcpy</code> ç”¨äºåœ¨ä¸»æœºï¼ˆhostï¼‰å’Œè®¾å¤‡ï¼ˆdeviceï¼‰ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚å®ƒå¯ä»¥æ§åˆ¶æ•°æ®çš„å¤åˆ¶æ–¹å‘ï¼Œä¾‹å¦‚ä»ä¸»æœºåˆ°è®¾å¤‡ã€ä»è®¾å¤‡åˆ°ä¸»æœºã€è®¾å¤‡åˆ°è®¾å¤‡ç­‰ã€‚<code>dst</code> å’Œ <code>src</code> åˆ†åˆ«æ˜¯ç›®æ ‡å’Œæºçš„æŒ‡é’ˆï¼Œ<code>count</code>è¡¨ç¤ºè¦å¤åˆ¶çš„å­—èŠ‚æ•°ï¼Œ<code>kind</code>æŒ‡å®šäº†æ•°æ®ä¼ è¾“çš„æ–¹å‘ã€‚å¸¸ç”¨çš„ä¼ è¾“æ–¹å‘æœ‰ï¼š<code>cudaMemcpyHostToHost</code>ã€<code>cudaMemcpyHostToDevice</code>ã€<code>cudaMemcpyDeviceToHost</code>ã€<code>cudaMemcpyDeviceToDevice</code>ï¼Œæ ¹æ®è‹±æ–‡å³å¯çŸ¥é“ä¼ è¾“æ–¹å‘ã€‚</p></li></ol><p>åœ¨CUDAç¨‹åºä¸­ï¼Œåˆç†ä½¿ç”¨è¿™äº›å‡½æ•°è¿›è¡Œå†…å­˜åˆ†é…å’Œæ•°æ®ä¼ è¾“æ˜¯ä¿è¯ç¨‹åºæ­£ç¡®æ€§å’Œæ€§èƒ½çš„é‡è¦ä¸€æ­¥ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå‘é‡åŠ æ³•çš„å®ä¾‹ï¼Œè¿™é‡Œgridå’Œblockéƒ½è®¾è®¡ä¸º1-dimï¼Œé¦–å…ˆå®šä¹‰kernelå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// ä¸¤ä¸ªå‘é‡åŠ æ³•kernelï¼Œgridå’Œblockå‡ä¸ºä¸€ç»´</span>__global__ <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// è·å–å…¨å±€ç´¢å¼•</span>    <span class="token keyword">int</span> index <span class="token operator">=</span> threadIdx<span class="token punctuation">.</span>x <span class="token operator">+</span> blockIdx<span class="token punctuation">.</span>x <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token comment">// æ­¥é•¿</span>    <span class="token keyword">int</span> stride <span class="token operator">=</span> blockDim<span class="token punctuation">.</span>x <span class="token operator">*</span> gridDim<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">+=</span> stride<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­strideæ˜¯æ•´ä¸ªgridçš„çº¿ç¨‹æ•°ï¼Œæœ‰æ—¶å€™å‘é‡çš„å…ƒç´ æ•°å¾ˆå¤šï¼Œè¿™æ—¶å€™å¯ä»¥å°†åœ¨æ¯ä¸ªçº¿ç¨‹å®ç°å¤šä¸ªå…ƒç´ ï¼ˆå…ƒç´ æ€»æ•°&#x2F;çº¿ç¨‹æ€»æ•°ï¼‰çš„åŠ æ³•ï¼Œç›¸å½“äºä½¿ç”¨äº†å¤šä¸ªgridæ¥å¤„ç†ï¼Œè¿™æ˜¯ä¸€ç§<a href="https://link.zhihu.com/?target=https://devblogs.nvidia.com/cuda-pro-tip-write-flexible-kernels-grid-stride-loops/">grid-stride loop</a>æ–¹å¼ï¼Œä¸è¿‡ä¸‹é¢çš„ä¾‹å­ä¸€ä¸ªçº¿ç¨‹åªå¤„ç†ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥kernelé‡Œé¢çš„å¾ªç¯æ˜¯ä¸æ‰§è¡Œçš„ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å‘é‡åŠ æ³•ç¤ºä¾‹ï¼Œä½¿ç”¨CUDAç¼–ç¨‹ä¸­çš„åŸºæœ¬æ¦‚å¿µå’Œå‡½æ•°è¿›è¡Œå‘é‡ç›¸åŠ æ“ä½œï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cuda_runtime.h></span></span><span class="token comment">// ä¸¤ä¸ªå‘é‡åŠ æ³•kernelï¼Œgridå’Œblockå‡ä¸ºä¸€ç»´</span>__global__ <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è·å–å…¨å±€ç´¢å¼•</span>    <span class="token keyword">int</span> index <span class="token operator">=</span> threadIdx<span class="token punctuation">.</span>x <span class="token operator">+</span> blockIdx<span class="token punctuation">.</span>x <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token comment">// æ­¥é•¿</span>    <span class="token keyword">int</span> stride <span class="token operator">=</span> blockDim<span class="token punctuation">.</span>x <span class="token operator">*</span> gridDim<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">+=</span> stride<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// å‘é‡å¤§å°</span>    <span class="token keyword">int</span> nBytes <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">float</span> <span class="token operator">*</span>x<span class="token punctuation">,</span> <span class="token operator">*</span>y<span class="token punctuation">,</span> <span class="token operator">*</span>z<span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¸»æœºä¸Šçš„å‘é‡æŒ‡é’ˆ</span>    <span class="token keyword">float</span> <span class="token operator">*</span>dev_x<span class="token punctuation">,</span> <span class="token operator">*</span>dev_y<span class="token punctuation">,</span> <span class="token operator">*</span>dev_z<span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰è®¾å¤‡ä¸Šçš„å‘é‡æŒ‡é’ˆ</span>    <span class="token comment">// åœ¨ä¸»æœºä¸Šåˆ†é…å†…å­˜</span>    x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åœ¨è®¾å¤‡ä¸Šåˆ†é…å†…å­˜</span>    <span class="token function">cudaMalloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>dev_x<span class="token punctuation">,</span> nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMalloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>dev_y<span class="token punctuation">,</span> nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMalloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>dev_z<span class="token punctuation">,</span> nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆå§‹åŒ–ä¸»æœºä¸Šçš„å‘é‡æ•°æ®</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>        y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å°†ä¸»æœºä¸Šçš„å‘é‡æ•°æ®å¤åˆ¶åˆ°è®¾å¤‡</span>    <span class="token function">cudaMemcpy</span><span class="token punctuation">(</span>dev_x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> nBytes<span class="token punctuation">,</span> cudaMemcpyHostToDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMemcpy</span><span class="token punctuation">(</span>dev_y<span class="token punctuation">,</span> y<span class="token punctuation">,</span> nBytes<span class="token punctuation">,</span> cudaMemcpyHostToDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰ grid å’Œ block çš„å¤§å°</span>    <span class="token keyword">int</span> blockSize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> numBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> blockSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">;</span>    <span class="token comment">// è°ƒç”¨ kernel å‡½æ•°</span>    add<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>numBlocks<span class="token punctuation">,</span> blockSize<span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">(</span>dev_x<span class="token punctuation">,</span> dev_y<span class="token punctuation">,</span> dev_z<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å°†è®¾å¤‡ä¸Šçš„ç»“æœå¤åˆ¶å›ä¸»æœº</span>    <span class="token function">cudaMemcpy</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> dev_z<span class="token punctuation">,</span> nBytes<span class="token punctuation">,</span> cudaMemcpyDeviceToHost<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// éªŒè¯ç»“æœ</span>    <span class="token keyword">float</span> maxError <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        maxError <span class="token operator">=</span> <span class="token function">fmaxf</span><span class="token punctuation">(</span>maxError<span class="token punctuation">,</span> <span class="token function">fabsf</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æœ€å¤§è¯¯å·®: %f\n"</span><span class="token punctuation">,</span> maxError<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// é‡Šæ”¾è®¾å¤‡å’Œä¸»æœºä¸Šçš„å†…å­˜</span>    <span class="token function">cudaFree</span><span class="token punctuation">(</span>dev_x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaFree</span><span class="token punctuation">(</span>dev_y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaFree</span><span class="token punctuation">(</span>dev_z<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">free</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">free</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">free</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ®µä»£ç å®ç°äº†å‘é‡åŠ æ³•æ“ä½œï¼Œå®ƒä½¿ç”¨äº†CUDAçš„æ ¸å‡½æ•° <code>add</code>ï¼Œå°†ä¸¤ä¸ªå‘é‡ <code>x</code> å’Œ <code>y</code> ç›¸åŠ å¾—åˆ°ç»“æœå‘é‡ <code>z</code>ã€‚åœ¨ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´è¿›è¡Œå†…å­˜åˆ†é…ã€æ•°æ®ä¼ è¾“å’Œæ ¸å‡½æ•°è°ƒç”¨ï¼Œæœ€åå°†ç»“æœä»è®¾å¤‡å¤åˆ¶å›ä¸»æœºè¿›è¡ŒéªŒè¯ã€‚è¿™é‡Œçš„å‘é‡å¤§å°ä¸º1&lt;&lt;20ï¼Œè€Œblockå¤§å°ä¸º256ï¼Œgridå¤§å°æ˜¯4096ï¼Œkernelçš„çº¿ç¨‹å±‚çº§ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202312232141601.png" alt="kernelçš„çº¿ç¨‹å±‚æ¬¡ç»“æ„"></p><h2 id="nvprof"><a href="#nvprof" class="headerlink" title="nvprof"></a>nvprof</h2><p>NVIDIA nvprof &#x2F; nvvpå·¥å…·æ˜¯è‹±ä¼Ÿè¾¾Nå¡GPUç¼–ç¨‹ä¸­ç”¨äºè§‚å¯Ÿçš„åˆ©å™¨ã€‚å…¨ç§°æ˜¯NVIDIA Visual Profilerï¼Œæ˜¯ç”±2008å¹´èµ·å¼€å§‹æ”¯æŒçš„æ€§èƒ½åˆ†æå™¨ã€‚äº¤äº’æ€§å¥½ï¼Œåˆ©äºä½¿ç”¨ã€‚å…¶ä¸­è®°å½•è¿è¡Œæ—¥å¿—æ—¶ä½¿ç”¨å‘½ä»¤nvprofï¼Œå¯è§†åŒ–æ˜¾ç¤ºæ—¥å¿—æ—¶ä½¿ç”¨å‘½ä»¤nvvpã€‚</p><p>ä¸è¿‡åœ¨æœ€è¿‘å‡ å¹´ï¼Œè‹±ä¼Ÿè¾¾å®˜æ–¹æ¨å‡ºäº†æ–°çš„æ€§èƒ½åˆ†æå·¥å…·NSightï¼Œå®˜æ–¹æ›´åŠ å»ºè®®ä½¿ç”¨æ–°çš„å·¥å…·ï¼Œç»™å‡ºçš„åŸå› æ˜¯NSightè¿è¡Œæ—¶æ¶ˆè€—çš„èµ„æºæ›´å°‘ï¼Œç»Ÿè®¡çš„æ•°æ®æ›´åŠ è´´è¿‘å®é™…è¿è¡Œæƒ…å†µçš„æ•°æ®ã€‚ç›¸æ¯”ä¹‹ä¸‹ä½¿ç”¨nvprof&#x2F;nvvpæ–¹å¼è¿è¡Œæ—¶æ¶ˆè€—èµ„æºè¾ƒå¤šï¼Œæ•°æ®ç»Ÿè®¡å®¹æ˜“ä¸å‡†ç¡®ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><code>nvprof</code> æ˜¯ NVIDIA æä¾›çš„ä¸€ä¸ªç”¨äºåˆ†æ CUDA åº”ç”¨ç¨‹åºæ€§èƒ½çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå¯ä»¥ç”¨æ¥æ”¶é›†å’Œåˆ†æ CUDA åº”ç”¨ç¨‹åºçš„æ€§èƒ½æ•°æ®ï¼ŒåŒ…æ‹¬æ ¸å‡½æ•°æ‰§è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚</p><p>ä½¿ç”¨ <code>nvprof</code> å·¥å…·æ¥åˆ†æ CUDA æ ¸å‡½æ•°è¿è¡Œæƒ…å†µçš„åŸºæœ¬æ­¥éª¤ï¼š</p><ol><li><p><strong>ç¼–è¯‘ä»£ç </strong>ï¼šé¦–å…ˆï¼Œç¡®ä¿ä»£ç å·²ç»è¢«ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li><li><p>**è¿è¡Œ <code>nvprof</code>**ï¼šåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>nvprof</code> å¹¶æŒ‡å®šè¦åˆ†æçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvprof ./your_executable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™å°†å¯åŠ¨æ‚¨çš„ CUDA å¯æ‰§è¡Œæ–‡ä»¶å¹¶å¼€å§‹æ”¶é›†æ€§èƒ½æ•°æ®ã€‚</p></li><li><p><strong>æŸ¥çœ‹åˆ†æç»“æœ</strong>ï¼š<code>nvprof</code> ä¼šè¾“å‡ºæ ¸å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ç›¸å…³ä¿¡æ¯ã€‚é€šå¸¸ï¼Œæ‚¨å¯ä»¥åœ¨è¾“å‡ºä¸­æ‰¾åˆ°æœ‰å…³æ ¸å‡½æ•°æ‰§è¡Œæ—¶é—´ã€å†…å­˜ä¼ è¾“æ—¶é—´ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰æ–¹é¢çš„è¯¦ç»†ä¿¡æ¯ã€‚è¯¥è¾“å‡ºå¯ä»¥å¸®åŠ©æ‚¨ç¡®å®šå“ªäº›éƒ¨åˆ†çš„ä»£ç å¯èƒ½éœ€è¦ä¼˜åŒ–æˆ–å“ªäº›æ“ä½œå ç”¨äº†è¾ƒå¤šçš„æ—¶é—´å’Œèµ„æºã€‚</p></li><li><p><strong>é€‰æ‹©ç‰¹å®šçš„åˆ†æé€‰é¡¹</strong>ï¼š<code>nvprof</code> è¿˜æä¾›äº†è®¸å¤šé€‰é¡¹ï¼Œå¯ç”¨äºæŒ‡å®šæ”¶é›†çš„æ•°æ®ç±»å‹ã€è¾“å‡ºæ ¼å¼ã€åˆ†æèŒƒå›´ç­‰ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ä¸åŒçš„é€‰é¡¹è¿›è¡Œè¯¦ç»†çš„åˆ†æã€‚</p></li></ol><p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ <code>nvprof</code> å¯¹ç¤ºä¾‹ç¨‹åºè¿›è¡Œåˆ†æï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvprof ./your_executable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¼šæ”¶é›†å¹¶æ˜¾ç¤ºæœ‰å…³æ‚¨çš„ CUDA å¯æ‰§è¡Œæ–‡ä»¶çš„åŸºæœ¬æ€§èƒ½æ•°æ®ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–é€‰é¡¹æ¥è¿›è¡Œæ›´è¯¦ç»†çš„åˆ†æï¼Œä¾‹å¦‚æ”¶é›†å†…å­˜ä¿¡æ¯ã€æŒ‡å®šè¦åˆ†æçš„æ ¸å‡½æ•°ç­‰ç­‰ã€‚å¯ä»¥é€šè¿‡ <code>nvprof --help</code> æŸ¥çœ‹æ›´å¤šå¯ç”¨é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>è¯·æ³¨æ„ï¼Œ<code>nvprof</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ·±å…¥äº†è§£ CUDA åº”ç”¨ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–æœºä¼šã€‚</p><p>ä½¿ç”¨nvprofå·¥å…·å¯ä»¥åˆ†ækernelè¿è¡Œæƒ…å†µï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°kernelå‡½æ•°è´¹æ—¶çº¦1.5msã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">nvprof cuda9.exe==7244== NVPROF is profiling process 7244, command: cuda9.exeæœ€å¤§è¯¯å·®: 4.31602e+008==7244== Profiling application: cuda9.exe==7244== Profiling result:            Type  Time(%)      Time     Calls       Avg       Min       Max  Name GPU activities:   67.57%  3.2256ms         2  1.6128ms  1.6017ms  1.6239ms  [CUDA memcpy HtoD]                   32.43%  1.5478ms         1  1.5478ms  1.5478ms  1.5478ms  add(float*, float*, float*, int)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½ è°ƒæ•´blockçš„å¤§å°ï¼Œå¯¹æ¯”ä¸åŒé…ç½®ä¸‹çš„kernelè¿è¡Œæƒ…å†µï¼Œæˆ‘è¿™é‡Œæµ‹è¯•çš„æ˜¯å½“blockä¸º128æ—¶ï¼Œkernelè´¹æ—¶çº¦1.6msï¼Œè€Œblockä¸º512æ—¶kernelè´¹æ—¶çº¦1.7msï¼Œå½“blockä¸º64æ—¶ï¼Œkernelè´¹æ—¶çº¦2.3msã€‚çœ‹æ¥ä¸æ˜¯blockè¶Šå¤§è¶Šå¥½ï¼Œè€Œè¦é€‚å½“é€‰æ‹©ã€‚</p><h2 id="ç»Ÿä¸€å†…å­˜ç®¡ç†"><a href="#ç»Ÿä¸€å†…å­˜ç®¡ç†" class="headerlink" title="ç»Ÿä¸€å†…å­˜ç®¡ç†"></a>ç»Ÿä¸€å†…å­˜ç®¡ç†</h2><p>åœ¨å‰é¢çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬åœ¨hostå’Œdeviceä¸Šè¿›è¡Œå†…å­˜åˆ†é…ï¼Œå¹¶ä¸”è¦è¿›è¡Œæ•°æ®æ‹·è´ï¼Œè¿™æ˜¯å¾ˆå®¹æ˜“å‡ºé”™çš„ã€‚å¥½åœ¨CUDA 6.0å¼•å…¥ç»Ÿä¸€å†…å­˜ï¼ˆ<a href="https://link.zhihu.com/?target=http://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html%23um-unified-memory-programming-hd">Unified Memory</a>ï¼‰æ¥é¿å…è¿™ç§éº»çƒ¦ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç»Ÿä¸€å†…å­˜ä½¿ç”¨ä¸€ä¸ªæ‰˜ç®¡å†…å­˜æ¥å…±åŒç®¡ç†hostå’Œdeviceä¸­çš„å†…å­˜ï¼Œå¹¶ä¸”è‡ªåŠ¨åœ¨hostå’Œdeviceä¸­è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><p><code>cudaMallocManaged</code>æ˜¯CUDAç¼–ç¨‹ä¸­ç”¨äºåŠ¨æ€åˆ†é…å†…å­˜çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸ºè®¾å¤‡å’Œä¸»æœºæä¾›ç»Ÿä¸€çš„ã€å¯å…±äº«çš„å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªå‡½æ•°å±äºCUDAè¿è¡Œæ—¶APIçš„ä¸€éƒ¨åˆ†ã€‚</p><p>å‡½æ•°ï¼š</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">cudaError_t cudaMallocManaged(void **devPtr, size_t size, unsigned int flags&#x3D;0);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚æ•°è§£æï¼š</p><ol><li><p><code>void **devPtr</code>ï¼šè¾“å‡ºå‚æ•°ï¼ŒæŒ‡å‘è®¾å¤‡å†…å­˜çš„æŒ‡é’ˆã€‚è°ƒç”¨æˆåŠŸåï¼Œ<code>devPtr</code>å°†è¢«è®¾ç½®ä¸ºæ–°åˆ†é…å†…å­˜åŒºåŸŸçš„é¦–åœ°å€ï¼Œè¯¥å†…å­˜åŒºåŸŸå¯ä¾›GPUå’ŒCPUè®¿é—®ã€‚</p></li><li><p><code>size_t size</code>ï¼šè¾“å…¥å‚æ•°ï¼Œè¦åˆ†é…çš„å†…å­˜å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</p></li><li><p><code>unsigned int flags</code>ï¼šå¯é€‰è¾“å…¥å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º0ã€‚å¯ä»¥ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šå†…å­˜ç®¡ç†è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>cudaMemAttachHost</code>: è¡¨ç¤ºå†…å­˜åº”è¯¥åŒæ—¶å¯¹ä¸»æœºå’Œè®¾å¤‡å¯è§ï¼Œå¹¶ä¸”åœ¨éœ€è¦æ—¶è‡ªåŠ¨åŒæ­¥ã€‚</li><li><code>cudaMemAttachGlobal</code>: ä¸<code>cudaMemAttachHost</code>ç±»ä¼¼ï¼Œä½†ä¸ä¿è¯å†…å­˜å§‹ç»ˆé©»ç•™åœ¨ä¸»æœºä¸Šã€‚</li></ul></li></ol><p>è¿”å›å€¼ï¼š</p><ul><li><code>cudaSuccess</code>ï¼šå¦‚æœæˆåŠŸåˆ†é…äº†å†…å­˜ï¼Œåˆ™è¿”å›æ­¤çŠ¶æ€ã€‚</li><li>å…¶ä»–é”™è¯¯ä»£ç ï¼ˆå¦‚<code>cudaErrorMemoryAllocation</code>ç­‰ï¼‰ï¼šå¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå¦‚å†…å­˜ä¸è¶³æˆ–å…¶ä»–CUDAè¿è¡Œæ—¶é”™è¯¯ï¼Œåˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ä»£ç ã€‚</li></ul><p>é€šè¿‡<code>cudaMallocManaged</code>åˆ†é…çš„å†…å­˜ä¼šéµå¾ªç»Ÿä¸€å†…å­˜ï¼ˆUnified Memoryï¼‰æ¨¡å‹ï¼Œä½¿å¾—å¼€å‘è€…æ— éœ€æ‰‹åŠ¨ç®¡ç†æ•°æ®åœ¨ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„è¿ç§»ï¼Œå¤§å¤§ç®€åŒ–äº†å¹¶è¡Œè®¡ç®—ä¸­çš„å†…å­˜ç®¡ç†å¤æ‚åº¦ã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡ç»Ÿä¸€å†…å­˜æä¾›äº†ä¾¿æ·æ€§ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºå®ƒä¾èµ–äºCUDAé©±åŠ¨ç¨‹åºå’Œç¡¬ä»¶è¿›è¡Œé€æ˜çš„æ•°æ®è¿ç§»ã€‚</p><p>åˆ©ç”¨ç»Ÿä¸€å†…å­˜ï¼Œå¯ä»¥å°†å‰é¢çš„ç¨‹åºç®€åŒ–å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cuda_runtime.h></span></span>__global__ <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> index <span class="token operator">=</span> threadIdx<span class="token punctuation">.</span>x <span class="token operator">+</span> blockIdx<span class="token punctuation">.</span>x <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token keyword">int</span> stride <span class="token operator">=</span> blockDim<span class="token punctuation">.</span>x <span class="token operator">*</span> gridDim<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">+=</span> stride<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// å‘é‡å¤§å°</span>    <span class="token keyword">int</span> nBytes <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> <span class="token operator">*</span>z<span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ç»Ÿä¸€å†…å­˜ä¸­çš„å‘é‡æŒ‡é’ˆ</span>    <span class="token comment">// åœ¨ç»Ÿä¸€å†…å­˜ä¸­åˆ†é…å†…å­˜</span>    <span class="token function">cudaMallocManaged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>z<span class="token punctuation">,</span> nBytes <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ†é…ç»Ÿä¸€å†…å­˜å¤§å°ä¸ºä¸‰å€ï¼ŒåŒ…æ‹¬ x, y, z</span>    <span class="token keyword">float</span> <span class="token operator">*</span>x <span class="token operator">=</span> z<span class="token punctuation">;</span> <span class="token comment">// xæŒ‡é’ˆæŒ‡å‘ç»Ÿä¸€å†…å­˜</span>    <span class="token keyword">float</span> <span class="token operator">*</span>y <span class="token operator">=</span> x <span class="token operator">+</span> n<span class="token punctuation">;</span> <span class="token comment">// yæŒ‡é’ˆæŒ‡å‘ç»Ÿä¸€å†…å­˜ä¸­xçš„æœ«å°¾</span>    <span class="token keyword">float</span> <span class="token operator">*</span>dev_z <span class="token operator">=</span> y <span class="token operator">+</span> n<span class="token punctuation">;</span> <span class="token comment">// dev_zæŒ‡é’ˆæŒ‡å‘ç»Ÿä¸€å†…å­˜ä¸­yçš„æœ«å°¾</span>    <span class="token comment">// åˆå§‹åŒ–ä¸»æœºä¸Šçš„å‘é‡æ•°æ®</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>        y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å®šä¹‰ grid å’Œ block çš„å¤§å°</span>    <span class="token keyword">int</span> blockSize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> numBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> blockSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">;</span>    <span class="token comment">// è°ƒç”¨ kernel å‡½æ•°</span>    add<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>numBlocks<span class="token punctuation">,</span> blockSize<span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> dev_z<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åŒæ­¥device ä¿è¯ç»“æœèƒ½æ­£ç¡®è®¿é—®</span>    <span class="token function">cudaDeviceSynchronize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// éªŒè¯ç»“æœ</span>    <span class="token keyword">float</span> maxError <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        maxError <span class="token operator">=</span> <span class="token function">fmaxf</span><span class="token punctuation">(</span>maxError<span class="token punctuation">,</span> <span class="token function">fabsf</span><span class="token punctuation">(</span>dev_z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æœ€å¤§è¯¯å·®: %f\n"</span><span class="token punctuation">,</span> maxError<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// é‡Šæ”¾ç»Ÿä¸€å†…å­˜</span>    <span class="token function">cudaFree</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›¸æ¯”ä¹‹å‰çš„ä»£ç ï¼Œä½¿ç”¨ç»Ÿä¸€å†…å­˜æ›´ç®€æ´äº†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯kernelæ‰§è¡Œæ˜¯ä¸hostå¼‚æ­¥çš„ï¼Œç”±äºæ‰˜ç®¡å†…å­˜è‡ªåŠ¨è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè¿™é‡Œè¦ç”¨cudaDeviceSynchronize()å‡½æ•°ä¿è¯deviceå’ŒhoståŒæ­¥ï¼Œè¿™æ ·åé¢æ‰å¯ä»¥æ­£ç¡®è®¿é—®kernelè®¡ç®—çš„ç»“æœã€‚</p><h2 id="çŸ©é˜µä¹˜æ³•å®ä¾‹"><a href="#çŸ©é˜µä¹˜æ³•å®ä¾‹" class="headerlink" title="çŸ©é˜µä¹˜æ³•å®ä¾‹"></a>çŸ©é˜µä¹˜æ³•å®ä¾‹</h2><p>æœ€åå†å®ç°ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€äº›çš„ä¾‹å­ï¼Œå°±æ˜¯ä¸¤ä¸ªçŸ©é˜µçš„ä¹˜æ³•ï¼Œè®¾è¾“å…¥çŸ©é˜µä¸º A å’Œ B ï¼Œè¦å¾—åˆ° C&#x3D;AÃ—B ã€‚å®ç°æ€è·¯æ˜¯æ¯ä¸ªçº¿ç¨‹è®¡ç®— Cçš„ä¸€ä¸ªå…ƒç´ å€¼ C<del>i,j</del> ï¼Œå¯¹äºçŸ©é˜µè¿ç®—ï¼Œåº”è¯¥é€‰ç”¨gridå’Œblockä¸º2-Dçš„ã€‚é¦–å…ˆå®šä¹‰çŸ©é˜µçš„ç»“æ„ä½“ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// çŸ©é˜µç±»å‹ï¼Œè¡Œä¼˜å…ˆï¼ŒM(row, col) = *(M.elements + row * M.width + col)</span><span class="token keyword">struct</span> <span class="token class-name">Matrix</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> width<span class="token punctuation">;</span>    <span class="token keyword">int</span> height<span class="token punctuation">;</span>    <span class="token keyword">float</span> <span class="token operator">*</span>elements<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202312232322858.png" alt="çŸ©é˜µä¹˜æ³•" style="zoom: 67%;" /><p>ç„¶åå®ç°çŸ©é˜µä¹˜æ³•çš„æ ¸å‡½æ•°ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªè¾…åŠ©çš„<code>__device__</code>å‡½æ•°åˆ†åˆ«ç”¨äºè·å–çŸ©é˜µçš„å…ƒç´ å€¼å’Œä¸ºçŸ©é˜µå…ƒç´ èµ‹å€¼ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// è·å–çŸ©é˜µAçš„(row, col)å…ƒç´ </span>__device__ <span class="token keyword">float</span> <span class="token function">getElement</span><span class="token punctuation">(</span><span class="token keyword">const</span> Matrix<span class="token operator">*</span> A<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> col<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> A<span class="token operator">-></span>elements<span class="token punctuation">[</span>row <span class="token operator">*</span> A<span class="token operator">-></span>width <span class="token operator">+</span> col<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¸ºçŸ©é˜µAçš„(row, col)å…ƒç´ èµ‹å€¼</span>__device__ <span class="token keyword">void</span> <span class="token function">setElement</span><span class="token punctuation">(</span>Matrix<span class="token operator">*</span> A<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> col<span class="token punctuation">,</span> <span class="token keyword">float</span> value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    A<span class="token operator">-></span>elements<span class="token punctuation">[</span>row <span class="token operator">*</span> A<span class="token operator">-></span>width <span class="token operator">+</span> col<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// çŸ©é˜µç›¸ä¹˜kernelï¼Œ2-Dï¼Œæ¯ä¸ªçº¿ç¨‹è®¡ç®—ä¸€ä¸ªå…ƒç´ </span>__global__ <span class="token keyword">void</span> <span class="token function">matMulKernel</span><span class="token punctuation">(</span><span class="token keyword">const</span> Matrix<span class="token operator">*</span> A<span class="token punctuation">,</span> <span class="token keyword">const</span> Matrix<span class="token operator">*</span> B<span class="token punctuation">,</span> Matrix<span class="token operator">*</span> C<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">float</span> Cvalue <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> row <span class="token operator">=</span> threadIdx<span class="token punctuation">.</span>y <span class="token operator">+</span> blockIdx<span class="token punctuation">.</span>y <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>y<span class="token punctuation">;</span>    <span class="token keyword">int</span> col <span class="token operator">=</span> threadIdx<span class="token punctuation">.</span>x <span class="token operator">+</span> blockIdx<span class="token punctuation">.</span>x <span class="token operator">*</span> blockDim<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> A<span class="token operator">-></span>width<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        Cvalue <span class="token operator">+=</span> <span class="token function">getElement</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> row<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">getElement</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> i<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">setElement</span><span class="token punctuation">(</span>C<span class="token punctuation">,</span> row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> Cvalue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åé‡‡ç”¨ç»Ÿä¸€å†…å­˜ç¼–å†™çŸ©é˜µç›¸ä¹˜çš„æµ‹è¯•å®ä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>    Matrix <span class="token operator">*</span>A<span class="token punctuation">,</span> <span class="token operator">*</span>B<span class="token punctuation">,</span> <span class="token operator">*</span>C<span class="token punctuation">;</span>    <span class="token comment">// ç”³è¯·æ‰˜ç®¡å†…å­˜</span>    <span class="token function">cudaMallocManaged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>A<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Matrix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMallocManaged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>B<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Matrix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMallocManaged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>C<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Matrix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> nBytes <span class="token operator">=</span> width <span class="token operator">*</span> height <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMallocManaged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>A<span class="token operator">-></span>elements<span class="token punctuation">,</span> nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMallocManaged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>B<span class="token operator">-></span>elements<span class="token punctuation">,</span> nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">cudaMallocManaged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>C<span class="token operator">-></span>elements<span class="token punctuation">,</span> nBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆå§‹åŒ–æ•°æ®</span>    A<span class="token operator">-></span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>    A<span class="token operator">-></span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>    B<span class="token operator">-></span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>    B<span class="token operator">-></span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>    C<span class="token operator">-></span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>    C<span class="token operator">-></span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> width <span class="token operator">*</span> height<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        A<span class="token operator">-></span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>        B<span class="token operator">-></span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å®šä¹‰kernelçš„æ‰§è¡Œé…ç½®</span>    dim3 <span class="token function">blockSize</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dim3 <span class="token function">gridSize</span><span class="token punctuation">(</span><span class="token punctuation">(</span>width <span class="token operator">+</span> blockSize<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span>         <span class="token punctuation">(</span>height <span class="token operator">+</span> blockSize<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ‰§è¡Œkernel</span>    matMulKernel <span class="token operator">&lt;&lt;</span> <span class="token operator">&lt;</span> gridSize<span class="token punctuation">,</span> blockSize <span class="token operator">>></span> <span class="token operator">></span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åŒæ­¥device ä¿è¯ç»“æœèƒ½æ­£ç¡®è®¿é—®</span>    <span class="token function">cudaDeviceSynchronize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ£€æŸ¥æ‰§è¡Œç»“æœ</span>    <span class="token keyword">float</span> maxError <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> width <span class="token operator">*</span> height<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>        maxError <span class="token operator">=</span> <span class="token function">fmax</span><span class="token punctuation">(</span>maxError<span class="token punctuation">,</span> <span class="token function">fabs</span><span class="token punctuation">(</span>C<span class="token operator">-></span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"æœ€å¤§è¯¯å·®: "</span> <span class="token operator">&lt;&lt;</span> maxError <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡ŒçŸ©é˜µå¤§å°ä¸º1024ï¼Œè®¾è®¡çš„çº¿ç¨‹çš„blockå¤§å°ä¸º(32, 32)ï¼Œé‚£ä¹ˆgridå¤§å°ä¸º(32, 32)ï¼Œæœ€ç»ˆæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">nvprof cuda9.exe==16304== NVPROF is profiling process 16304, command: cuda9.exeæœ€å¤§è¯¯å·®: 0==16304== Profiling application: cuda9.exe==16304== Profiling result:            Type  Time(%)      Time     Calls       Avg       Min       Max  Name GPU activities:  100.00%  1.32752s         1  1.32752s  1.32752s  1.32752s  matMulKernel(Matrix*, Matrix*, Matrix*)      API calls:   83.11%  1.32762s         1  1.32762s  1.32762s  1.32762s  cudaDeviceSynchronize                   13.99%  223.40ms         6  37.233ms  37.341us  217.66ms  cudaMallocManaged                    2.81%  44.810ms         1  44.810ms  44.810ms  44.810ms  cudaLaunch                    0.08%  1.3300ms        94  14.149us       0ns  884.64us  cuDeviceGetAttribute                    0.01%  199.03us         1  199.03us  199.03us  199.03us  cuDeviceGetName                    0.00%  10.009us         1  10.009us  10.009us  10.009us  cuDeviceTotalMem                    0.00%  6.5440us         1  6.5440us  6.5440us  6.5440us  cudaConfigureCall                    0.00%  3.0800us         3  1.0260us     385ns  1.5400us  cudaSetupArgument                    0.00%  2.6940us         3     898ns     385ns  1.5390us  cuDeviceGetCount                    0.00%  1.9250us         2     962ns     385ns  1.5400us  cuDeviceGet==16304== Unified Memory profiling result:Device "GeForce GT 730 (0)"   Count  Avg Size  Min Size  Max Size  Total Size  Total Time  Name    2051  4.0000KB  4.0000KB  4.0000KB  8.011719MB  21.20721ms  Host To Device     270  45.570KB  4.0000KB  1.0000MB  12.01563MB  7.032508ms  Device To Host<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>CUDAç¼–ç¨‹å…¥é—¨ç›¸å¯¹ç®€å•ï¼Œé€šè¿‡æŒæ¡åŸºæœ¬çš„çº¿ç¨‹ç®¡ç†å’Œå†…å­˜æ“ä½œï¼Œå¯ä»¥å¿«é€Ÿå®ç°å¹¶è¡Œè®¡ç®—çš„åŸºæœ¬åº”ç”¨ã€‚ç„¶è€Œï¼Œéšç€é—®é¢˜å¤æ‚åº¦çš„æå‡ï¼Œæ·±å…¥CUDAé¢†åŸŸåˆ™éœ€é¢å¯¹æ›´å¤šæŒ‘æˆ˜ï¼šä¾‹å¦‚åŠ¨æ€å¹¶è¡Œæ€§ç®¡ç†ã€æµå¼å¤šå¤„ç†å™¨çš„ç»†ç²’åº¦åŒæ­¥æ§åˆ¶ã€å…¨å±€å†…å­˜ä¸å…±äº«å†…å­˜çš„æœ‰æ•ˆåˆ©ç”¨ï¼ˆåŒ…æ‹¬bankå†²çªå¤„ç†ï¼‰ã€çº¹ç†å’Œå¸¸é‡å†…å­˜ä¼˜åŒ–ã€ä»¥åŠå…ˆè¿›çš„å¹¶è¡Œç®—æ³•è®¾è®¡å¦‚å½’çº¦ã€æ‰«ç„ç­‰ã€‚æ­¤å¤–ï¼Œé’ˆå¯¹ç°ä»£GPUæ¶æ„çš„ç‰¹æ€§è¿›è¡Œæ€§èƒ½è°ƒä¼˜ï¼Œç†è§£å¹¶è§£å†³å†…å­˜å±‚æ¬¡ç»“æ„å¸¦æ¥çš„ç“¶é¢ˆï¼Œäº¦æ˜¯æ·±å…¥CUDAæŠ€æœ¯æ ˆçš„é‡è¦ç¯èŠ‚ã€‚åªæœ‰ä¸æ–­é’»ç ”è¿™äº›é«˜çº§æŠ€æœ¯å’Œæœ€ä½³å®è·µï¼Œæ‰èƒ½åœ¨å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—ä¸­å‘æŒ¥å‡ºCUDAçš„çœŸæ­£å¨åŠ›ï¼Œå®ç°ä»â€œå…¥é—¨â€åˆ°â€œç²¾é€šâ€çš„è·¨è¶Šã€‚</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://zhuanlan.zhihu.com/p/34587739">CUDAç¼–ç¨‹å…¥é—¨æç®€æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/TracelessLe/article/details/110880135">https://blog.csdn.net/TracelessLe/article/details/110880135</a></p>]]></content>
      
      
      <categories>
          
          <category> cuda </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cuda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»Šæ—¥è¯—å¥-ç¥ç¦å‰ç¨‹</title>
      <link href="/posts/f97.html"/>
      <url>/posts/f97.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç¥ç¦å‰ç¨‹"><a href="#ç¥ç¦å‰ç¨‹" class="headerlink" title="ç¥ç¦å‰ç¨‹"></a>ç¥ç¦å‰ç¨‹</h2><div class="ipage">   <div class="ititle">ç¥ç¦å‰ç¨‹</div>    <div class="izhengwen">      <p>        æ˜å¹´æ­¤æ—¥é’äº‘å»ï¼Œå´ç¬‘äººé—´ä¸¾å­å¿™ â€”â€”è¾›å¼ƒç–¾ã€Šé¹§é¸ªå¤©Â·é€å»“ä¹‹ç§‹è¯•ã€‹<br>        è«æ„å‰è·¯æ— çŸ¥å·±ï¼Œå¤©ä¸‹è°äººä¸è¯†å› â€”â€”é«˜é€‚ã€Šåˆ«è‘£å¤§ã€‹<br>        å¤©ä¸‹è°éå¥è€…ï¼Œæˆ‘è¾ˆç»ˆä¸ºå¥‡åœŸ â€”â€”å¼ ç¿¥ã€Šæ°´è°ƒæ­Œå¤´Â·ä¸‰åä¹å¹´æˆ‘ã€‹<br>        å‰ç¨‹è·¯é™©è«è¹‰è· â€”â€”å…ƒå§¬ç¿¼ã€Šä¸´æ±ŸÂ·å²æœˆæ— æƒ…å¦‚ç”µè½¬ã€‹<br>        ä¹˜é£ç ´æµªä¼šæœ‰æ—¶ï¼Œç›´æŒ‚äº‘å¸†æµæ²§æµ· â€”â€”æç™½ã€Šè¡Œè·¯éš¾ã€‹<br>        æ‰å­è¯äººï¼Œè‡ªæ˜¯ç™½è¡£å¿ç›¸ â€”â€”æŸ³æ°¸ã€Šé¹¤å†²å¤©ã€‹<br>        å¤§é¹ä¸€æ—¥åŒé£èµ·ï¼Œæ‰¶æ‘‡ç›´ä¸Šä¹ä¸‡é‡Œ â€”â€”æç™½ã€Šä¸Šæé‚•ã€‹<br>        æ˜¥é£å¾—æ„é©¬è¹„ç–¾ï¼Œä¸€æ—¥çœ‹å°½é•¿å®‰èŠ± â€”â€”å­ŸéƒŠã€Šç™»ç§‘åã€‹<br>        å¸Œå›ç”Ÿç¾½ç¿¼ï¼Œä¸€åŒ–åŒ—æºŸé±¼ â€”â€”æç™½ã€Šæ±Ÿå¤ä½¿å›å”å¸­ä¸Šèµ å²éƒä¸­ã€‹<br>         é¹°å‡»å¤©é£å£®ï¼Œé¹é£æµ·æµªæ˜¥ â€”â€”å¸é©¬å…‰ã€Šä¹‹ç¾ä¸¾è¿›å£«å¯“äº¬å¸ˆèŒƒæ­¤è¯—å¯„ä¹‹ã€‹<br>         æ„¿ç¥å›å¦‚æ­¤å±±æ°´ï¼Œæ»”æ»”å²Œå²Œé£äº‘èµ· â€”â€”å†¯æ—¶è¡Œã€Šé—å¤”é—¨æ•…ä¹¦ã€‹<br>           </p>    </div> </div><p>â€‹      </p>]]></content>
      
      
      <categories>
          
          <category> è¯—è¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯—è¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gmailåˆ†èº«</title>
      <link href="/posts/ae7f.html"/>
      <url>/posts/ae7f.html</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©è¦åˆ†äº«çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå‰é¢çš„é‚®ç®±è·ŸåŸé‚®ç®±å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åé¢å¤šäº†ä¸ª<code>+c1</code>ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨åŸé‚®ç®±åé¢ä½¿ç”¨ä¸€ä¸ª <code>+</code> å·è¿æ¥ä¸€ä¸ªå­—ç¬¦ä¸² <code>c1</code>ï¼Œåç¼€ä¸å˜ï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªæ–°é‚®ç®±ï¼Œä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä½ å°±å¯ä»¥å¼€å¯åˆ†èº«å¤§æ³•äº†ï¼š</p><blockquote><p>åŸé‚®ç®±ï¼štâ€¦â€¦<a href="mailto:&#x64;&#x40;&#103;&#x6d;&#x61;&#x69;&#x6c;&#46;&#99;&#111;&#x6d;">&#x64;&#x40;&#103;&#x6d;&#x61;&#x69;&#x6c;&#46;&#99;&#111;&#x6d;</a><br>æ–°é‚®ç®±ä¸€ï¼štâ€¦â€¦<a href="mailto:&#x64;&#43;&#99;&#x31;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#109;">&#x64;&#43;&#99;&#x31;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#109;</a><br>æ–°é‚®ç®±äºŒï¼štâ€¦â€¦<a href="mailto:&#100;&#43;&#99;&#50;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;">&#100;&#43;&#99;&#50;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;</a></p></blockquote><p>åŸç†æ˜¯å› ä¸ºåœ¨ Gmail çš„é‚®ä»¶åœ°å€é‡Œï¼Œ<code>+</code> å·æ˜¯ä¸€ä¸ªç‰¹æ®Šç¬¦å·ï¼Œåœ°å€ä¸­çš„ <code>+</code> ä»¥åŠåŠ å·åé¢çš„éƒ¨åˆ†ï¼Œä¼šè¢«è¿‡æ»¤æ‰ã€‚å…¶å®è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šç¬¦å· <code>.</code> ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸å¤ªå¥½ç”¨å®ç”¨ä»·å€¼ä¸å¤§ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚åˆ©ç”¨è¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†ŒæŸä¸ªå¹³å°çš„å¤šä¸ªå‡ è´¦å·æ—¶å°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®Œæˆ(ä¾‹å¦‚æŸ GPT)ã€‚è¿™æ¯”å¸‚é¢ä¸Šå¾ˆå¤šæ‰€è°“çš„ä¸´æ—¶é‚®ç®±æˆ–è€…é‚®ç®±åˆ†èº«ç”¨èµ·æ¥å¯å®‰å…¨å¯é å¤ªå¤šäº†ï¼Œå¹¶ä¸”éå¸¸æ–¹ä¾¿ï¼Œåœ¨ä¸€ä¸ªé‚®ç®±é‡Œé¢å°±èƒ½æ”¶åˆ°æ‰€æœ‰çš„é‚®ä»¶ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Gmail </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>123äº‘ç›˜èµ„æº</title>
      <link href="/posts/5d4b.html"/>
      <url>/posts/5d4b.html</url>
      
        <content type="html"><![CDATA[<p>Adobeå…¨å®¶æ¡¶ï¼š<a href="https://www.123pan.com/s/yS8UVv-NkFed.html">https://www.123pan.com/s/yS8UVv-NkFed.html</a> æå–ç :6666</p><p>AutoCADï¼š<a href="https://www.123pan.com/s/yS8UVv-2kFed.html">https://www.123pan.com/s/yS8UVv-2kFed.html</a> æå–ç :6666</p><p>ä¸“ä¸šè½¯ä»¶ï¼š<a href="https://www.123pan.com/s/yS8UVv-rkFed.html">https://www.123pan.com/s/yS8UVv-rkFed.html</a> æå–ç :6666</p><p>Unityï¼š<a href="https://www.123pan.com/s/yS8UVv-skFed.html">https://www.123pan.com/s/yS8UVv-skFed.html</a> æå–ç :6666</p><p>è¾¾èŠ¬å¥‡ï¼š<a href="https://www.123pan.com/s/yS8UVv-WkFed.html">https://www.123pan.com/s/yS8UVv-WkFed.html</a> æå–ç :6666</p><p>å»ºæ¨¡ç±»ï¼š<a href="https://www.123pan.com/s/yS8UVv-CkFed.html">https://www.123pan.com/s/yS8UVv-CkFed.html</a> æå–ç :6666</p><p>VMWareè™šæ‹Ÿæœºï¼š<a href="https://www.123pan.com/s/yS8UVv-OkFed.html">https://www.123pan.com/s/yS8UVv-OkFed.html</a> æå–ç :6666</p><p>ç¼–ç¨‹å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-RkFed.html">https://www.123pan.com/s/yS8UVv-RkFed.html</a> æå–ç :6666</p><p>ç”µè„‘å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-DkFed.html">https://www.123pan.com/s/yS8UVv-DkFed.html</a> æå–ç :6666</p><p>ä¸‹è½½å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-nkFed.html">https://www.123pan.com/s/yS8UVv-nkFed.html</a> æå–ç :6666</p><p>PS2024(Beta)_25.1æ€»ç´¢å¼•ï¼š<a href="https://www.123pan.com/s/yS8UVv-VcFed.html">https://www.123pan.com/s/yS8UVv-VcFed.html</a> æå–ç :6666ã€å«win+macã€‘</p><p>Adobeå…¨å®¶æ¡¶æ€»ç´¢å¼•ï¼š<a href="https://www.123pan.com/s/yS8UVv-HiFed.html">https://www.123pan.com/s/yS8UVv-HiFed.html</a> æå–ç :6666ã€å«å¤§å¸ˆç‰ˆå’ŒSPç‰ˆï¼Œwin+macã€‘</p><p>PSï¼šAdobeå…¨å®¶æ¡¶å¦‚æœæœ‰è§£å‹å¯†ç ï¼Œå¯†ç å°±æ˜¯@vposy</p><p>ã€å¤‡ç”¨ï¼šAdobeå…¨å®¶æ¡¶ï¼š<a href="https://www.123pan.com/s/yS8UVv-hiFed.html">https://www.123pan.com/s/yS8UVv-hiFed.html</a> æå–ç :6666ã€‘</p><p>éŸ³ä¹è½¯ä»¶æ€»ç´¢å¼•ï¼š<a href="https://www.123pan.com/s/yS8UVv-u7Fed.html">https://www.123pan.com/s/yS8UVv-u7Fed.html</a> æå–ç :6666ã€å«win+macã€‘</p><p>Win_Alç³»åˆ—è½¯ä»¶æ€»ç´¢å¼•ï¼š<a href="https://www.123pan.com/s/yS8UVv-h7Fed.html">https://www.123pan.com/s/yS8UVv-h7Fed.html</a> æå–ç :6666ã€åŒ…å«HitPawå…¨å®¶æ¡¶ï¼ŒTopazå…¨å®¶æ¡¶ã€‘</p><p>Mac_Alç³»åˆ—è½¯ä»¶æ€»ç´¢å¼•ï¼š<a href="https://www.123pan.com/s/yS8UVv-niFed.html">https://www.123pan.com/s/yS8UVv-niFed.html</a> æå–ç :6666ã€åŒ…å«HitPawå…¨å®¶æ¡¶ï¼ŒTopazå…¨å®¶æ¡¶ã€‘</p><p>è¿œç¨‹æ¡Œé¢RayLinkå®˜ç½‘<a href="https://www.raylink.live/">https://www.raylink.live/</a></p><p>Mac2024ï¼š<a href="https://www.123pan.com/s/yS8UVv-uIYed.html%E3%80%90">https://www.123pan.com/s/yS8UVv-uIYed.htmlã€</a> æå–ç :6666ã€‘</p><p>Win2024ï¼š<a href="https://www.123pan.com/s/yS8UVv-rIYed.html%E3%80%90">https://www.123pan.com/s/yS8UVv-rIYed.htmlã€</a> æå–ç :6666ã€‘</p><p>æ›´å¤šmonkrusèµ„æºï¼š<a href="https://www.123pan.com/s/yS8UVv-8IYed.html%E3%80%90">https://www.123pan.com/s/yS8UVv-8IYed.htmlã€</a> æå–ç :6666ã€‘</p><p>ğŸ‘‰Adobeå…¨å®¶æ¡¶æ‰€æœ‰ğŸ¬ï¼š<a href="https://www.123pan.com/s/yS8UVv-hiFed.html%E3%80%90">https://www.123pan.com/s/yS8UVv-hiFed.htmlã€</a> æå–ç :6666ã€‘</p><p>Adobeå…¨å®¶æ¡¶ï¼š</p><p>ã€å»ºè®®å»æ€»æ–‡ä»¶å¤¹ã€‘ï¼š<a href="https://www.123pan.com/s/yS8UVv-NkFed.html">https://www.123pan.com/s/yS8UVv-NkFed.html</a> æå–ç :6666</p><p>PSï¼š<a href="https://www.123pan.com/s/yS8UVv-bkFed.html">https://www.123pan.com/s/yS8UVv-bkFed.html</a> æå–ç :6666</p><p>PRï¼š<a href="https://www.123pan.com/s/yS8UVv-ZkFed.html">https://www.123pan.com/s/yS8UVv-ZkFed.html</a> æå–ç :6666</p><p>AEï¼š<a href="https://www.123pan.com/s/yS8UVv-ckFed.html">https://www.123pan.com/s/yS8UVv-ckFed.html</a> æå–ç :6666</p><p>Aiï¼š<a href="https://www.123pan.com/s/yS8UVv-ekFed.html">https://www.123pan.com/s/yS8UVv-ekFed.html</a> æå–ç :6666</p><p>MEï¼š<a href="https://www.123pan.com/s/yS8UVv-tkFed.html">https://www.123pan.com/s/yS8UVv-tkFed.html</a> æå–ç :6666</p><p>AUï¼š<a href="https://www.123pan.com/s/yS8UVv-ikFed.html">https://www.123pan.com/s/yS8UVv-ikFed.html</a> æå–ç :6666</p><p>Anï¼š<a href="https://www.123pan.com/s/yS8UVv-zkFed.html">https://www.123pan.com/s/yS8UVv-zkFed.html</a> æå–ç :6666</p><p>AdobeAcrobatï¼š<a href="https://www.123pan.com/s/yS8UVv-LkFed.html">https://www.123pan.com/s/yS8UVv-LkFed.html</a> æå–ç :6666</p><p>AdobeBridgeï¼š<a href="https://www.123pan.com/s/yS8UVv-5kFed.html">https://www.123pan.com/s/yS8UVv-5kFed.html</a> æå–ç :6666</p><p>AdobeDimensionï¼š<a href="https://www.123pan.com/s/yS8UVv-qkFed.html">https://www.123pan.com/s/yS8UVv-qkFed.html</a> æå–ç :6666</p><p>AdobeDreamweaverï¼š<a href="https://www.123pan.com/s/yS8UVv-6kFed.html">https://www.123pan.com/s/yS8UVv-6kFed.html</a> æå–ç :6666</p><p>AdobeFlashï¼š<a href="https://www.123pan.com/s/yS8UVv-ykFed.html">https://www.123pan.com/s/yS8UVv-ykFed.html</a> æå–ç :6666</p><p>AdobeFrameMakerï¼š<a href="https://www.123pan.com/s/yS8UVv-VkFed.html">https://www.123pan.com/s/yS8UVv-VkFed.html</a> æå–ç :6666</p><p>AdobeInCopyï¼š<a href="https://www.123pan.com/s/yS8UVv-jkFed.html">https://www.123pan.com/s/yS8UVv-jkFed.html</a> æå–ç :6666</p><p>AdobeInDesignï¼š<a href="https://www.123pan.com/s/yS8UVv-ToFed.html">https://www.123pan.com/s/yS8UVv-ToFed.html</a> æå–ç :6666</p><p>AdobePreludeï¼š<a href="https://www.123pan.com/s/yS8UVv-voFed.html">https://www.123pan.com/s/yS8UVv-voFed.html</a> æå–ç :6666</p><p>CharacterAnimatorï¼š<a href="https://www.123pan.com/s/yS8UVv-doFed.html">https://www.123pan.com/s/yS8UVv-doFed.html</a> æå–ç :6666</p><p>ExperienceDesignï¼š<a href="https://www.123pan.com/s/yS8UVv-3oFed.html">https://www.123pan.com/s/yS8UVv-3oFed.html</a> æå–ç :6666</p><p>LightroomClassicï¼š<a href="https://www.123pan.com/s/yS8UVv-hoFed.html">https://www.123pan.com/s/yS8UVv-hoFed.html</a> æå–ç :6666</p><p>PhotoshopElementsï¼š<a href="https://www.123pan.com/s/yS8UVv-HoFed.html">https://www.123pan.com/s/yS8UVv-HoFed.html</a> æå–ç :6666</p><p>PremiereElementsï¼š<a href="https://www.123pan.com/s/yS8UVv-AoFed.html">https://www.123pan.com/s/yS8UVv-AoFed.html</a> æå–ç :6666</p><p>PremiereRushï¼š<a href="https://www.123pan.com/s/yS8UVv-9oFed.html">https://www.123pan.com/s/yS8UVv-9oFed.html</a> æå–ç :6666</p><p>Substance3DDesignaterï¼š<a href="https://www.123pan.com/s/yS8UVv-QoFed.html">https://www.123pan.com/s/yS8UVv-QoFed.html</a> æå–ç :6666</p><p>VMWareè™šæ‹Ÿæœºï¼š<a href="https://www.123pan.com/s/yS8UVv-OkFed.html">https://www.123pan.com/s/yS8UVv-OkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼š16ï¼Œ17éƒ¨åˆ†ç‰ˆæœ¬</p><p>VisualStudioCode(å®˜ç½‘é“¾æ¥)ï¼š<a href="https://www.123pan.com/s/yS8UVv-EoFed.html">https://www.123pan.com/s/yS8UVv-EoFed.html</a> æå–ç :6666</p><p>VisualStudioï¼š<a href="https://www.123pan.com/s/yS8UVv-koFed.html">https://www.123pan.com/s/yS8UVv-koFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šä¸€äº›ç¤¾åŒºç‰ˆï¼Œä¸“ä¸šç‰ˆï¼Œä¼ä¸šç‰ˆ</p><p>JetBrainså®¶æ—ï¼š<a href="https://www.123pan.com/s/yS8UVv-ooFed.html">https://www.123pan.com/s/yS8UVv-ooFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šIntelliJIDEAï¼ŒJetBrainsWebStormï¼ŒPyCharm</p><p>IntelliJIDEAï¼š<a href="https://www.123pan.com/s/yS8UVv-moFed.html">https://www.123pan.com/s/yS8UVv-moFed.html</a> æå–ç :6666</p><p>JetBrainsWebStormï¼š<a href="https://www.123pan.com/s/yS8UVv-1oFed.html">https://www.123pan.com/s/yS8UVv-1oFed.html</a> æå–ç :6666</p><p>PyCharmï¼š<a href="https://www.123pan.com/s/yS8UVv-4oFed.html">https://www.123pan.com/s/yS8UVv-4oFed.html</a> æå–ç :6666</p><p>Androidï¼š<a href="https://www.123pan.com/s/yS8UVv-xoFed.html">https://www.123pan.com/s/yS8UVv-xoFed.html</a> æå–ç :6666</p><p>JAVA8ï¼Œ11éƒ¨åˆ†JDKï¼š<a href="https://www.123pan.com/s/yS8UVv-poFed.html">https://www.123pan.com/s/yS8UVv-poFed.html</a> æå–ç :6666</p><p>JetBrainså…¨å®¶æ¡¶2022-2023å¹´ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-F6Fed.html">https://www.123pan.com/s/yS8UVv-F6Fed.html</a> æå–ç ï¼š6666</p><p>JetBrainså…¨å®¶æ¡¶2022.2ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-g6Fed.html">https://www.123pan.com/s/yS8UVv-g6Fed.html</a> æå–ç ï¼š6666</p><p>ç”µè„‘å¸¸ç”¨å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-DkFed.html">https://www.123pan.com/s/yS8UVv-DkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šBandizipï¼Œå½•å±å·¥å…·ï¼Œåˆ†åŒºå·¥å…·ï¼Œç¡¬ç›˜æ¸…ç†å·¥å…·ï¼Œæ•°æ®æ¢å¤ï¼Œ7-zip</p><p>bandizipï¼š<a href="https://www.123pan.com/s/yS8UVv-foFed.html">https://www.123pan.com/s/yS8UVv-foFed.html</a> æå–ç :6666</p><p>å½•å±å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-aoFed.html">https://www.123pan.com/s/yS8UVv-aoFed.html</a> æå–ç :6666</p><p>åˆ†åŒºå·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-BoFed.html">https://www.123pan.com/s/yS8UVv-BoFed.html</a> æå–ç :6666</p><p>ç¡¬ç›˜æ¸…ç†å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-JoFed.html">https://www.123pan.com/s/yS8UVv-JoFed.html</a> æå–ç :6666</p><p>æ•°æ®æ¢å¤ï¼š<a href="https://www.123pan.com/s/yS8UVv-IoFed.html">https://www.123pan.com/s/yS8UVv-IoFed.html</a> æå–ç :6666</p><p>7-Zipï¼š<a href="https://www.123pan.com/s/yS8UVv-MoFed.html">https://www.123pan.com/s/yS8UVv-MoFed.html</a> æå–ç :6666</p><p>è¾¾èŠ¬å¥‡ï¼š<a href="https://www.123pan.com/s/yS8UVv-WkFed.html">https://www.123pan.com/s/yS8UVv-WkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼š14ï¼Œ15ï¼Œ16ï¼Œ1ï¼Œ18éƒ¨åˆ†ç‰ˆæœ¬</p><p>å»ºæ¨¡ç±»ï¼š<a href="https://www.123pan.com/s/yS8UVv-CkFed.html">https://www.123pan.com/s/yS8UVv-CkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼š3dsMaxï¼ŒMayaï¼ŒC4Dï¼ŒBlenderï¼ŒZBrushâ€¦â€¦.</p><p>3DsMaxï¼š<a href="https://www.123pan.com/s/yS8UVv-woFed.html">https://www.123pan.com/s/yS8UVv-woFed.html</a> æå–ç :6666</p><p>Mayaï¼š<a href="https://www.123pan.com/s/yS8UVv-goFed.html">https://www.123pan.com/s/yS8UVv-goFed.html</a> æå–ç :6666</p><p>C4Dï¼š<a href="https://www.123pan.com/s/yS8UVv-FoFed.html">https://www.123pan.com/s/yS8UVv-FoFed.html</a> æå–ç :6666</p><p>Blenderè‡ªç”¨ï¼š<a href="https://www.123pan.com/s/yS8UVv-YoFed.html">https://www.123pan.com/s/yS8UVv-YoFed.html</a> æå–ç :6666</p><p>ZBrushï¼š<a href="https://www.123pan.com/s/yS8UVv-GoFed.html">https://www.123pan.com/s/yS8UVv-GoFed.html</a> æå–ç :6666</p><p>SketchUpè‰å›¾å¤§å¸ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-PoFed.html">https://www.123pan.com/s/yS8UVv-PoFed.html</a> æå–ç :6666</p><p>VrayforSketchUpï¼š<a href="https://www.123pan.com/s/yS8UVv-XoFed.html">https://www.123pan.com/s/yS8UVv-XoFed.html</a> æå–ç :6666</p><p>VrayforRhinoï¼š<a href="https://www.123pan.com/s/yS8UVv-noFed.html">https://www.123pan.com/s/yS8UVv-noFed.html</a> æå–ç :6666</p><p>MarvelousDesigneï¼š<a href="https://www.123pan.com/s/yS8UVv-2oFed.html">https://www.123pan.com/s/yS8UVv-2oFed.html</a> æå–ç :6666</p><p>Lumionï¼š<a href="https://www.123pan.com/s/yS8UVv-soFed.html">https://www.123pan.com/s/yS8UVv-soFed.html</a> æå–ç :6666</p><p>Keyshotï¼š<a href="https://www.123pan.com/s/yS8UVv-WoFed.html">https://www.123pan.com/s/yS8UVv-WoFed.html</a> æå–ç :6666</p><p>Enscapeï¼š<a href="https://www.123pan.com/s/yS8UVv-CoFed.html">https://www.123pan.com/s/yS8UVv-CoFed.html</a> æå–ç :6666</p><p>CorelCADï¼š<a href="https://www.123pan.com/s/yS8UVv-NoFed.html">https://www.123pan.com/s/yS8UVv-NoFed.html</a> æå–ç :6666</p><p>Artlantisï¼š<a href="https://www.123pan.com/s/yS8UVv-OoFed.html">https://www.123pan.com/s/yS8UVv-OoFed.html</a> æå–ç :6666</p><p>CADï¼š<a href="https://www.123pan.com/s/yS8UVv-2kFed.html">https://www.123pan.com/s/yS8UVv-2kFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šCADï¼Œä¸­æœ›CADï¼Œæµ©è¾°CADç­‰ç­‰å¤šä¸ªç‰ˆæœ¬</p><p>CADï¼š<a href="https://www.123pan.com/s/yS8UVv-RoFed.html">https://www.123pan.com/s/yS8UVv-RoFed.html</a> æå–ç :6666</p><p>CADç²¾ç®€ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-DoFed.html">https://www.123pan.com/s/yS8UVv-DoFed.html</a> æå–ç :6666</p><p>CADå»ºç­‘ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-roFed.html">https://www.123pan.com/s/yS8UVv-roFed.html</a> æå–ç :6666</p><p>CADç”µæ°”ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-8oFed.html">https://www.123pan.com/s/yS8UVv-8oFed.html</a> æå–ç :6666</p><p>CADæœºæ¢°ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-0oFed.html">https://www.123pan.com/s/yS8UVv-0oFed.html</a> æå–ç :6666</p><p>ä¸­æœ›CADï¼š<a href="https://www.123pan.com/s/yS8UVv-KoFed.html">https://www.123pan.com/s/yS8UVv-KoFed.html</a> æå–ç :6666</p><p>ä¸­æœ›CADå»ºç­‘ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-uoFed.html">https://www.123pan.com/s/yS8UVv-uoFed.html</a> æå–ç :6666</p><p>ä¸­æœ›CADæœºæ¢°ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-UoFed.html">https://www.123pan.com/s/yS8UVv-UoFed.html</a> æå–ç :6666</p><p>æµ©è¾°CADï¼š<a href="https://www.123pan.com/s/yS8UVv-ZoFed.html">https://www.123pan.com/s/yS8UVv-ZoFed.html</a> æå–ç :6666</p><p>æµ©è¾°CADç”µæ°”ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-coFed.html">https://www.123pan.com/s/yS8UVv-coFed.html</a> æå–ç :6666</p><p>æµ©è¾°CADç”µåŠ›ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-eoFed.html">https://www.123pan.com/s/yS8UVv-eoFed.html</a> æå–ç :6666</p><p>æµ©è¾°CADå»ºç­‘ç‰ˆï¼š<a href="https://www.123pan.com/s/yS8UVv-toFed.html">https://www.123pan.com/s/yS8UVv-toFed.html</a> æå–ç :6666</p><p>CADè¿·ä½ ç”»å›¾ï¼š<a href="https://www.123pan.com/s/yS8UVv-SoFed.html">https://www.123pan.com/s/yS8UVv-SoFed.html</a> æå–ç :6666</p><p>CAXA3Då®ä½“è®¾è®¡ï¼š<a href="https://www.123pan.com/s/yS8UVv-loFed.html">https://www.123pan.com/s/yS8UVv-loFed.html</a> æå–ç :6666</p><p>CAXAç”µå­å›¾æ¿ï¼š<a href="https://www.123pan.com/s/yS8UVv-7oFed.html">https://www.123pan.com/s/yS8UVv-7oFed.html</a> æå–ç :6666</p><p>CAXAå·¥è‰ºå›¾è¡¨ï¼š<a href="https://www.123pan.com/s/yS8UVv-boFed.html">https://www.123pan.com/s/yS8UVv-boFed.html</a> æå–ç :6666</p><p>T20å¤©æ­£ç”µæ°”ï¼š<a href="https://www.123pan.com/s/yS8UVv-ioFed.html">https://www.123pan.com/s/yS8UVv-ioFed.html</a> æå–ç :6666</p><p>T20å¤©æ­£ç»“æ„ï¼š<a href="https://www.123pan.com/s/yS8UVv-zoFed.html">https://www.123pan.com/s/yS8UVv-zoFed.html</a> æå–ç :6666</p><p>T20å¤©æ­£æš–é€šï¼š<a href="https://www.123pan.com/s/yS8UVv-LoFed.html">https://www.123pan.com/s/yS8UVv-LoFed.html</a> æå–ç :6666</p><p>T20å¤©æ­£å»ºç­‘ï¼š<a href="https://www.123pan.com/s/yS8UVv-5oFed.html">https://www.123pan.com/s/yS8UVv-5oFed.html</a> æå–ç :6666</p><p>T20å¤©æ­£ç»™æ’æ°´ï¼š<a href="https://www.123pan.com/s/yS8UVv-qoFed.html">https://www.123pan.com/s/yS8UVv-qoFed.html</a> æå–ç :6666</p><p>ä¸‹è½½å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-nkFed.html">https://www.123pan.com/s/yS8UVv-nkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šIDMï¼Œæ¯”ç‰¹å½—æ˜Ÿå’Œä¸€äº›è§†é¢‘ä¸‹è½½å·¥å…·</p><p>åŠå…¬è½¯ä»¶ï¼š<a href="https://www.123pan.com/s/yS8UVv-8kFed.html">https://www.123pan.com/s/yS8UVv-8kFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šOfficeï¼ŒWpsï¼ŒPDFé˜…è¯»ã€ç¼–è¾‘å™¨ï¼ŒVisioï¼ŒProjectï¼ŒEndNoteï¼ŒLaTex</p><p>Officeï¼š<a href="https://www.123pan.com/s/yS8UVv-6oFed.html">https://www.123pan.com/s/yS8UVv-6oFed.html</a> æå–ç :6666</p><p>Wpsï¼š<a href="https://www.123pan.com/s/yS8UVv-yoFed.html">https://www.123pan.com/s/yS8UVv-yoFed.html</a> æå–ç :6666</p><p>Visioï¼š<a href="https://www.123pan.com/s/yS8UVv-VoFed.html">https://www.123pan.com/s/yS8UVv-VoFed.html</a> æå–ç :6666</p><p>Projectï¼š<a href="https://www.123pan.com/s/yS8UVv-joFed.html">https://www.123pan.com/s/yS8UVv-joFed.html</a> æå–ç :6666</p><p>EndNoteï¼š<a href="https://www.123pan.com/s/yS8UVv-TmFed.html">https://www.123pan.com/s/yS8UVv-TmFed.html</a> æå–ç :6666</p><p>LaTexï¼š<a href="https://www.123pan.com/s/yS8UVv-vmFed.html">https://www.123pan.com/s/yS8UVv-vmFed.html</a> æå–ç :6666</p><p>Foxitç¦æ˜•PDFç¼–è¾‘å™¨ï¼š<a href="https://www.123pan.com/s/yS8UVv-dmFed.html">https://www.123pan.com/s/yS8UVv-dmFed.html</a> æå–ç :6666</p><p>Foxitç¦æ˜•PDFé˜…è¯»å™¨ï¼š<a href="https://www.123pan.com/s/yS8UVv-3mFed.html">https://www.123pan.com/s/yS8UVv-3mFed.html</a> æå–ç :6666</p><p>PDFelementä¸‡å…´PDFä¸“å®¶ï¼š<a href="https://www.123pan.com/s/yS8UVv-HmFed.html">https://www.123pan.com/s/yS8UVv-HmFed.html</a> æå–ç :6666</p><p>PDFXChangeEditorï¼š<a href="https://www.123pan.com/s/yS8UVv-hmFed.html">https://www.123pan.com/s/yS8UVv-hmFed.html</a> æå–ç :6666</p><p>åª’ä½“å·¥å…·ï¼š<a href="https://www.123pan.com/s/yS8UVv-0kFed.html">https://www.123pan.com/s/yS8UVv-0kFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šnuendoï¼ŒCubase</p><p>nuendoï¼š<a href="https://www.123pan.com/s/yS8UVv-9mFed.html">https://www.123pan.com/s/yS8UVv-9mFed.html</a> æå–ç :6666</p><p>Cubaseï¼š<a href="https://www.123pan.com/s/yS8UVv-AmFed.html">https://www.123pan.com/s/yS8UVv-AmFed.html</a> æå–ç :6666</p><p>å›¾åƒå¤„ç†ï¼š<a href="https://www.123pan.com/s/yS8UVv-KkFed.html">https://www.123pan.com/s/yS8UVv-KkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šACDSeeï¼ŒAffinityPhotoï¼ŒCaptureOneï¼ŒCorelPainterï¼Œäº¿å›¾å›¾ç¤ºï¼ŒSketchBookï¼ŒEasyPaintToolSAI</p><p>ACDSeeï¼š<a href="https://www.123pan.com/s/yS8UVv-QmFed.html">https://www.123pan.com/s/yS8UVv-QmFed.html</a> æå–ç :6666</p><p>AffinityPhotoï¼š<a href="https://www.123pan.com/s/yS8UVv-EmFed.html">https://www.123pan.com/s/yS8UVv-EmFed.html</a> æå–ç :6666</p><p>CaptureOneï¼š<a href="https://www.123pan.com/s/yS8UVv-kmFed.html">https://www.123pan.com/s/yS8UVv-kmFed.html</a> æå–ç :6666</p><p>CorelPainterï¼š<a href="https://www.123pan.com/s/yS8UVv-omFed.html">https://www.123pan.com/s/yS8UVv-omFed.html</a> æå–ç :6666</p><p>äº¿å›¾å›¾ç¤ºï¼š<a href="https://www.123pan.com/s/yS8UVv-1mFed.html">https://www.123pan.com/s/yS8UVv-1mFed.html</a> æå–ç :6666</p><p>SketchBookï¼š<a href="https://www.123pan.com/s/yS8UVv-4mFed.html">https://www.123pan.com/s/yS8UVv-4mFed.html</a> æå–ç :6666</p><p>EasyPaintToolSAIï¼š<a href="https://www.123pan.com/s/yS8UVv-mmFed.html">https://www.123pan.com/s/yS8UVv-mmFed.html</a> æå–ç :6666</p><p>ä»¿çœŸæ¨¡æ‹Ÿï¼š<a href="https://www.123pan.com/s/yS8UVv-ukFed.html">https://www.123pan.com/s/yS8UVv-ukFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šCOMSOLMultiphysicsï¼ŒANSYSElectronicsSuiteï¼ŒANSYSProductsï¼ŒAltairHyperWorksï¼ŒAnsysMaxwellï¼ŒMSCAdamsï¼ŒAbaqusï¼ŒVeroVisiï¼ŒTecplot360EXï¼ŒAutodeskMoldflowï¼ŒMidasCivilï¼ŒDynaform</p><p>COMSOLMultiphysicsï¼š<a href="https://www.123pan.com/s/yS8UVv-ImFed.html">https://www.123pan.com/s/yS8UVv-ImFed.html</a> æå–ç :6666</p><p>ANSYSElectronicsSuiteï¼š<a href="https://www.123pan.com/s/yS8UVv-JmFed.html">https://www.123pan.com/s/yS8UVv-JmFed.html</a> æå–ç :6666</p><p>ANSYSProductsï¼š<a href="https://www.123pan.com/s/yS8UVv-BmFed.html">https://www.123pan.com/s/yS8UVv-BmFed.html</a> æå–ç :6666</p><p>AltairHyperWorksï¼š<a href="https://www.123pan.com/s/yS8UVv-amFed.html">https://www.123pan.com/s/yS8UVv-amFed.html</a> æå–ç :6666</p><p>AnsysMaxwellï¼š<a href="https://www.123pan.com/s/yS8UVv-fmFed.html">https://www.123pan.com/s/yS8UVv-fmFed.html</a> æå–ç :6666</p><p>MSCAdamsï¼š<a href="https://www.123pan.com/s/yS8UVv-pmFed.html">https://www.123pan.com/s/yS8UVv-pmFed.html</a> æå–ç :6666</p><p>Abaqusï¼š<a href="https://www.123pan.com/s/yS8UVv-xmFed.html">https://www.123pan.com/s/yS8UVv-xmFed.html</a> æå–ç :6666</p><p>VeroVisiï¼š<a href="https://www.123pan.com/s/yS8UVv-GmFed.html">https://www.123pan.com/s/yS8UVv-GmFed.html</a> æå–ç :6666</p><p>Tecplot360EXï¼š<a href="https://www.123pan.com/s/yS8UVv-FmFed.html">https://www.123pan.com/s/yS8UVv-FmFed.html</a> æå–ç :6666</p><p>AutodeskMoldflowï¼š<a href="https://www.123pan.com/s/yS8UVv-gmFed.html">https://www.123pan.com/s/yS8UVv-gmFed.html</a> æå–ç :6666</p><p>MidasCivilï¼š<a href="https://www.123pan.com/s/yS8UVv-wmFed.html">https://www.123pan.com/s/yS8UVv-wmFed.html</a> æå–ç :6666</p><p>Dynaformï¼š<a href="https://www.123pan.com/s/yS8UVv-MmFed.html">https://www.123pan.com/s/yS8UVv-MmFed.html</a> æå–ç :6666</p><p>æ•°æ®åˆ†æï¼š<a href="https://www.123pan.com/s/yS8UVv-UkFed.html">https://www.123pan.com/s/yS8UVv-UkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šMatlabï¼ŒMySQLï¼ŒSQLServerï¼ŒTableauDesktopï¼ŒStataï¼ŒIBMSPSSStatisticsï¼ŒOriginï¼ŒMinitabï¼ŒMathematicaï¼ŒMapleï¼ŒAmos</p><p>Matlabï¼š<a href="https://www.123pan.com/s/yS8UVv-nmFed.html">https://www.123pan.com/s/yS8UVv-nmFed.html</a> æå–ç :6666</p><p>MySQLï¼š<a href="https://www.123pan.com/s/yS8UVv-2mFed.html">https://www.123pan.com/s/yS8UVv-2mFed.html</a> æå–ç :6666</p><p>SQLServerï¼š<a href="https://www.123pan.com/s/yS8UVv-smFed.html">https://www.123pan.com/s/yS8UVv-smFed.html</a> æå–ç :6666</p><p>TableauDesktopï¼š<a href="https://www.123pan.com/s/yS8UVv-WmFed.html">https://www.123pan.com/s/yS8UVv-WmFed.html</a> æå–ç :6666</p><p>Stataï¼š<a href="https://www.123pan.com/s/yS8UVv-CmFed.html">https://www.123pan.com/s/yS8UVv-CmFed.html</a> æå–ç :6666</p><p>IBMSPSSStatisticsï¼š<a href="https://www.123pan.com/s/yS8UVv-NmFed.html">https://www.123pan.com/s/yS8UVv-NmFed.html</a> æå–ç :6666</p><p>Originï¼š<a href="https://www.123pan.com/s/yS8UVv-OmFed.html">https://www.123pan.com/s/yS8UVv-OmFed.html</a> æå–ç :6666</p><p>Minitabï¼š<a href="https://www.123pan.com/s/yS8UVv-RmFed.html">https://www.123pan.com/s/yS8UVv-RmFed.html</a> æå–ç :6666</p><p>Mathematicaï¼š<a href="https://www.123pan.com/s/yS8UVv-DmFed.html">https://www.123pan.com/s/yS8UVv-DmFed.html</a> æå–ç :6666</p><p>Mapleï¼š<a href="https://www.123pan.com/s/yS8UVv-rmFed.html">https://www.123pan.com/s/yS8UVv-rmFed.html</a> æå–ç :6666</p><p>Amosï¼š<a href="https://www.123pan.com/s/yS8UVv-8mFed.html">https://www.123pan.com/s/yS8UVv-8mFed.html</a> æå–ç :6666</p><p>æœºæ¢°è®¾è®¡ï¼š<a href="https://www.123pan.com/s/yS8UVv-SkFed.html">https://www.123pan.com/s/yS8UVv-SkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šRhinocerosçŠ€ç‰›ï¼ŒUnigraphicsNX(UGNX)ï¼ŒSolidWorksï¼ŒPowerMillï¼ŒProeï¼ŒMastercamï¼ŒInventorï¼ŒCreoï¼ŒCATIAComposerï¼ŒCATIA</p><p>RhinocerosçŠ€ç‰›ï¼š<a href="https://www.123pan.com/s/yS8UVv-0mFed.html">https://www.123pan.com/s/yS8UVv-0mFed.html</a> æå–ç :6666</p><p>UnigraphicsNX(UGNX)ï¼š<a href="https://www.123pan.com/s/yS8UVv-KmFed.html">https://www.123pan.com/s/yS8UVv-KmFed.html</a> æå–ç :6666</p><p>SolidWorksï¼š<a href="https://www.123pan.com/s/yS8UVv-umFed.html">https://www.123pan.com/s/yS8UVv-umFed.html</a> æå–ç :6666</p><p>PowerMillï¼š<a href="https://www.123pan.com/s/yS8UVv-UmFed.html">https://www.123pan.com/s/yS8UVv-UmFed.html</a> æå–ç :6666</p><p>Proeï¼š<a href="https://www.123pan.com/s/yS8UVv-SmFed.html">https://www.123pan.com/s/yS8UVv-SmFed.html</a> æå–ç :6666</p><p>Mastercamï¼š<a href="https://www.123pan.com/s/yS8UVv-lmFed.html">https://www.123pan.com/s/yS8UVv-lmFed.html</a> æå–ç :6666</p><p>Inventorï¼š<a href="https://www.123pan.com/s/yS8UVv-7mFed.html">https://www.123pan.com/s/yS8UVv-7mFed.html</a> æå–ç :6666</p><p>Creoï¼š<a href="https://www.123pan.com/s/yS8UVv-bmFed.html">https://www.123pan.com/s/yS8UVv-bmFed.html</a> æå–ç :6666</p><p>CATIAComposerï¼š<a href="https://www.123pan.com/s/yS8UVv-ZmFed.html">https://www.123pan.com/s/yS8UVv-ZmFed.html</a> æå–ç :6666</p><p>CATIAï¼š<a href="https://www.123pan.com/s/yS8UVv-cmFed.html">https://www.123pan.com/s/yS8UVv-cmFed.html</a> æå–ç :6666</p><p>å»ºç­‘è®¾è®¡ï¼š<a href="https://www.123pan.com/s/yS8UVv-lkFed.html">https://www.123pan.com/s/yS8UVv-lkFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šAutodeskRevitï¼ŒAutoCADCivil3Dï¼ŒNavisworksManageï¼ŒTeklaStructuresï¼ŒVectorworks</p><p>AutodeskRevitï¼š<a href="https://www.123pan.com/s/yS8UVv-imFed.html">https://www.123pan.com/s/yS8UVv-imFed.html</a> æå–ç :6666</p><p>AutoCADCivil3Dï¼š<a href="https://www.123pan.com/s/yS8UVv-emFed.html">https://www.123pan.com/s/yS8UVv-emFed.html</a> æå–ç :6666</p><p>NavisworksManageï¼š<a href="https://www.123pan.com/s/yS8UVv-tmFed.html">https://www.123pan.com/s/yS8UVv-tmFed.html</a> æå–ç :6666</p><p>TeklaStructuresï¼š<a href="https://www.123pan.com/s/yS8UVv-zmFed.html">https://www.123pan.com/s/yS8UVv-zmFed.html</a> æå–ç :6666</p><p>Vectorworksï¼š<a href="https://www.123pan.com/s/yS8UVv-LmFed.html">https://www.123pan.com/s/yS8UVv-LmFed.html</a> æå–ç :6666</p><p>ç”µå­ç”µè·¯ï¼š<a href="https://www.123pan.com/s/yS8UVv-7kFed.html">https://www.123pan.com/s/yS8UVv-7kFed.html</a> æå–ç :6666</p><p>åŒ…å«ï¼šProteusï¼ŒMultisimï¼ŒAltiumDesigner</p><p>Proteusï¼š<a href="https://www.123pan.com/s/yS8UVv-6mFed.html">https://www.123pan.com/s/yS8UVv-6mFed.html</a> æå–ç :6666</p><p>Multisimï¼š<a href="https://www.123pan.com/s/yS8UVv-qmFed.html">https://www.123pan.com/s/yS8UVv-qmFed.html</a> æå–ç :6666</p><p>AltiumDesignerï¼š<a href="https://www.123pan.com/s/yS8UVv-5mFed.html">https://www.123pan.com/s/yS8UVv-5mFed.html</a> æå–ç :6666</p><p>MSDNï¼š<a href="https://www.123pan.com/s/yS8UVv-ymFed.html">https://www.123pan.com/s/yS8UVv-ymFed.html</a> æå–ç :6666</p><hr><p>Macæ€»ç´¢å¼•ï¼š<a href="https://www.123pan.com/s/yS8UVv-bqged.html%E3%80%90">https://www.123pan.com/s/yS8UVv-bqged.htmlã€</a> æå–ç :6666ã€‘</p><p>ISOæ–‡ä»¶ï¼š<a href="https://www.123pan.com/s/yS8UVv-66Fed.html%E3%80%90">https://www.123pan.com/s/yS8UVv-66Fed.htmlã€</a> æå–ç :6666ã€‘</p><p>VMvareï¼š<a href="https://www.123pan.com/s/yS8UVv-OkFed.html%E3%80%90">https://www.123pan.com/s/yS8UVv-OkFed.htmlã€</a> æå–ç :6666ã€‘</p><p>unlockerï¼š<a href="https://www.123pan.com/s/yS8UVv-y6Fed.html%E3%80%90">https://www.123pan.com/s/yS8UVv-y6Fed.htmlã€</a> æå–ç :6666ã€‘</p><hr><p>MSDNæ–°ç½‘ç«™ï¼šnext.itellyou.cn</p><p>æç¤ºï¼š</p><p>Windowså˜æ­£ç‰ˆå·¥å…·KMSï¼š<a href="https://wwi.lanzout.com/igcDdyru6if">https://wwi.lanzout.com/igcDdyru6if</a></p><p>æˆ‘çš„è“ç­¹äº‘KMSï¼š<a href="https://wwcv.lanzouw.com/iyJBM0y2vtwj%E5%AF%86%E7%A0%81:crce">https://wwcv.lanzouw.com/iyJBM0y2vtwjå¯†ç :crce</a></p><p>å…¶ä»–æ­£ç‰ˆå·¥å…·å‚è€ƒï¼šrjctx.com</p><p>å¿…é¡»æ³¨æ„ï¼šä¸‹è½½çš„ç³»ç»Ÿæ–‡ä»¶å¿…é¡»æ ¡éªŒï¼Œæ ¡éªŒå·¥å…·å’ŒHashæ ¡éªŒå€¼ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰</p><p>ä¸æ ¡éªŒï¼Œå¯„äº†åˆå¾—é‡è£…ç³»ç»Ÿã€‚ã€‚ã€‚</p><p>ã€Windowsç³»ç»Ÿã€‘ï¼š</p><p>Win11ï¼š<a href="https://www.123pan.com/s/yS8UVv-sqged.html">https://www.123pan.com/s/yS8UVv-sqged.html</a> æå–ç :6666</p><p>Win10ï¼š<a href="https://www.123pan.com/s/yS8UVv-Wqged.html">https://www.123pan.com/s/yS8UVv-Wqged.html</a> æå–ç :6666</p><p>Win8.1ï¼š<a href="https://www.123pan.com/s/yS8UVv-Nqged.html">https://www.123pan.com/s/yS8UVv-Nqged.html</a> æå–ç :6666</p><p>Win8ï¼š<a href="https://www.123pan.com/s/yS8UVv-Oqged.html">https://www.123pan.com/s/yS8UVv-Oqged.html</a> æå–ç :6666</p><p>WinVistaï¼š<a href="https://www.123pan.com/s/yS8UVv-Dqged.html">https://www.123pan.com/s/yS8UVv-Dqged.html</a> æå–ç :6666</p><p>Win7ï¼š<a href="https://www.123pan.com/s/yS8UVv-Cqged.html">https://www.123pan.com/s/yS8UVv-Cqged.html</a> æå–ç :6666</p><p>WinXPï¼š<a href="https://www.123pan.com/s/yS8UVv-Rqged.html">https://www.123pan.com/s/yS8UVv-Rqged.html</a> æå–ç :6666</p><p>ã€WindowsæœåŠ¡å™¨ã€‘</p><p>WindowsServer2022ï¼š<a href="https://www.123pan.com/s/yS8UVv-rqged.html">https://www.123pan.com/s/yS8UVv-rqged.html</a> æå–ç :6666</p><p>WindowsServer2019ï¼š<a href="https://www.123pan.com/s/yS8UVv-8qged.html">https://www.123pan.com/s/yS8UVv-8qged.html</a> æå–ç :6666</p><p>WindowsServer2016ï¼š<a href="https://www.123pan.com/s/yS8UVv-0qged.html">https://www.123pan.com/s/yS8UVv-0qged.html</a> æå–ç :6666</p><hr><p>Windowsæ±‡æ€»ï¼š<a href="https://www.123pan.com/s/yS8UVv-cqged.html">https://www.123pan.com/s/yS8UVv-cqged.html</a> æå–ç :6666</p><p>ã€Linuxç³»ç»Ÿã€‘ï¼š</p><p>CentOSï¼š<a href="https://www.123pan.com/s/yS8UVv-lqged.html">https://www.123pan.com/s/yS8UVv-lqged.html</a> æå–ç :6666</p><p>Ubuntuï¼š<a href="https://www.123pan.com/s/yS8UVv-Sqged.html">https://www.123pan.com/s/yS8UVv-Sqged.html</a> æå–ç :6666</p><p>Fedoraï¼š<a href="https://www.123pan.com/s/yS8UVv-7qged.html">https://www.123pan.com/s/yS8UVv-7qged.html</a> æå–ç :6666</p><p>UOSï¼š<a href="https://www.123pan.com/s/yS8UVv-Uqged.html">https://www.123pan.com/s/yS8UVv-Uqged.html</a> æå–ç :6666</p><p>Deepinï¼š<a href="https://www.123pan.com/s/yS8UVv-uqged.html">https://www.123pan.com/s/yS8UVv-uqged.html</a> æå–ç :6666</p><hr><p>Linuxæ±‡æ€»ï¼š<a href="https://www.123pan.com/s/yS8UVv-Zqged.html">https://www.123pan.com/s/yS8UVv-Zqged.html</a> æå–ç :6666</p><p>ã€MacOSç³»ç»Ÿã€‘ï¼š</p><p>MacOSæ±‡æ€»ï¼š<a href="https://www.123pan.com/s/yS8UVv-bqged.html">https://www.123pan.com/s/yS8UVv-bqged.html</a> æå–ç :6666</p><p>ã€ChromiumOSç³»ç»Ÿã€‘ï¼š</p><p>ChromiumOSæ±‡æ€»ï¼š<a href="https://www.123pan.com/s/yS8UVv-eqged.html">https://www.123pan.com/s/yS8UVv-eqged.html</a> æå–ç :6666</p><p>ã€BSDç³»ç»Ÿã€‘ï¼š</p><p>FreeBSDï¼š<a href="https://www.123pan.com/s/yS8UVv-iqged.html">https://www.123pan.com/s/yS8UVv-iqged.html</a> æå–ç :6666</p><p>NetBSDï¼š<a href="https://www.123pan.com/s/yS8UVv-zqged.html">https://www.123pan.com/s/yS8UVv-zqged.html</a> æå–ç :6666</p><p>OpenBSDï¼š<a href="https://www.123pan.com/s/yS8UVv-Lqged.html">https://www.123pan.com/s/yS8UVv-Lqged.html</a> æå–ç :6666</p><p>DragonFlyBSDï¼š<a href="https://www.123pan.com/s/yS8UVv-5qged.html">https://www.123pan.com/s/yS8UVv-5qged.html</a> æå–ç :6666</p><hr><p>BSDæ±‡æ€»ï¼š<a href="https://www.123pan.com/s/yS8UVv-tqged.html">https://www.123pan.com/s/yS8UVv-tqged.html</a> æå–ç :6666</p><p>ã€ã€ã€PSï¼š123ç½‘ç›˜åˆ†äº«ï¼Œå…¨æ˜¯æ–‡ä»¶å¤¹ï¼Œç‚¹è¿›å»è‡ªå·±é€‰æ‹©ä¸‹è½½ç‰ˆæœ¬ã€‘ã€‘ã€‘</p><p>è½¯ä»¶ä¸»è¦æ¥æºï¼š</p><p>è€ƒæ‹‰ï¼šrjctx.comï¼Œè„šæœ¬ä¹‹å®¶ï¼š<a href="https://www.jb51.netï¼Œç³»ç»Ÿæ¬è¿è‡ªMSDNï¼šhttps://msdn.itellyou.cn/ï¼Œnext.itellyou.cn">https://www.jb51.netï¼Œç³»ç»Ÿæ¬è¿è‡ªMSDNï¼šhttps://msdn.itellyou.cn/ï¼Œnext.itellyou.cn</a></p>]]></content>
      
      
      <categories>
          
          <category> èµ„æº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èµ„æº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ±‡ç¼–è¯­è¨€</title>
      <link href="/posts/ec85.html"/>
      <url>/posts/ec85.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> æ±‡ç¼– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ±‡ç¼– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘æ›¾ä¸ƒæ¬¡é„™è§†è‡ªå·±çš„çµé­‚</title>
      <link href="/posts/essay-demo.html"/>
      <url>/posts/essay-demo.html</url>
      
        <content type="html"><![CDATA[<h3 id="éšç¬”æ¿å—ï¼Œåç»­ä¼šæ›´æ–°æ–‡ç« ï¼Œç›®å‰å¼„å¥½äº†æ¨¡æ¿æ ¼å¼"><a href="#éšç¬”æ¿å—ï¼Œåç»­ä¼šæ›´æ–°æ–‡ç« ï¼Œç›®å‰å¼„å¥½äº†æ¨¡æ¿æ ¼å¼" class="headerlink" title="éšç¬”æ¿å—ï¼Œåç»­ä¼šæ›´æ–°æ–‡ç« ï¼Œç›®å‰å¼„å¥½äº†æ¨¡æ¿æ ¼å¼~"></a>éšç¬”æ¿å—ï¼Œåç»­ä¼šæ›´æ–°æ–‡ç« ï¼Œç›®å‰å¼„å¥½äº†æ¨¡æ¿æ ¼å¼~</h3><div class="ipage">   <div class="ititle">èŠ‚é€‰è‡ªã€ŠSeven times have I despised my soulã€‹- Kahlil Gibran</div>   <div class="izhengwen">     <p>    æˆ‘æ›¾ä¸ƒæ¬¡é„™è§†è‡ªå·±çš„çµé­‚ - çºªä¼¯ä¼¦<br>    The first time when I saw her being meek that she might attain height.<br>    ç¬¬ä¸€æ¬¡, å½“å®ƒæœ¬å¯è¿›å–æ—¶, å´æ•…ä½œè°¦å‘<br>    The second time when I saw her limping before the crippled.<br>    ç¬¬äºŒæ¬¡, å½“å®ƒç©ºè™šæ—¶, ç”¨çˆ±æ¬²æ¥å¡«å……<br>    The third time when she was given to choose between the hard and the easy, and she chose the easy.<br>    ç¬¬ä¸‰æ¬¡, åœ¨å •è½å’ŒåŠªåŠ›ä¹‹é—´, å®ƒé€‰æ‹©äº†å •è½<br>    The fourth time when she committed a wrong, and comforted herself that others also commit wrong.<br>    ç¬¬å››æ¬¡, å®ƒçŠ¯äº†é”™, å´è—‰ç”±åˆ«äººçš„é”™æ¥å®½æ…°è‡ªå·±<br>     The fifth time when she forbore for weakness, and attributed her patience to strength.<br>    ç¬¬äº”æ¬¡, å®ƒè‡ªç”±è½¯å¼±ï¼Œå´æŠŠå®ƒè®¤ä¸ºæ˜¯ç”Ÿå‘½çš„åšéŸ§<br>    The sixth time when she despised the ugliness of a face and knew not that it was one of her own masks.<br>    ç¬¬å…­æ¬¡, å½“å®ƒå˜²ç¬‘ä»–äººæ„šè ¢æ—¶, å´ä¸çŸ¥è‡ªå·±æ›´æ˜¯è ¢æ<br>    The seventh time when she sang a song of praise and deemed it a virtue.<br>    ç¬¬ä¸ƒæ¬¡, å®ƒåœ¨æ³¥æ½­æ—¶æ—¢å½»åº•æ‘†ä¸äº†çƒ‚ä¹Ÿä¸å½»åº•ç”˜å¿ƒ<br>    </p>   </div> </div>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšç¬” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoåŸºç¡€å‘½ä»¤</title>
      <link href="/posts/ec85.html"/>
      <url>/posts/ec85.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hexo-åŸºç¡€å‘½ä»¤"><a href="#Hexo-åŸºç¡€å‘½ä»¤" class="headerlink" title="Hexo åŸºç¡€å‘½ä»¤"></a>Hexo åŸºç¡€å‘½ä»¤</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><pre class="line-numbers language-none"><code class="language-none">hexo new&quot;postName&quot;      æ–°å»ºæ–‡ç«  hexo new page&quot;pageName&quot; æ–°å»ºé¡µé¢ hexo generate           ç”Ÿæˆé™æ€é¡µé¢è‡³publicç›®å½• hexo clean              æ¸…é™¤ç”Ÿæˆå†…å®¹ hexo server             å¼€å¯é¢„è§ˆè®¿é—®ï¼ˆé»˜è®¤ç«¯å£4000ï¼Œ&#39;ctrl + c&#39;å…³é—­serverï¼‰ hexo deploy             å°†.deployç›®å½•éƒ¨ç½²åˆ°æŒ‡å®šç©ºé—´ hexo help               æŸ¥çœ‹å¸®åŠ© hexo version            æŸ¥çœ‹hexoçš„ç‰ˆæœ¬hexo server -p 5000 æ›´æ”¹ç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¼©å†™"><a href="#ç¼©å†™" class="headerlink" title="ç¼©å†™"></a>ç¼©å†™</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">hexo gï¼š hexo generatehexo clï¼šhexo cleanhexo sï¼š hexo serverhexo dï¼š hexo deployhexo n "æˆ‘çš„åšå®¢"      hexo new "æˆ‘çš„åšå®¢"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">hexo s -g    ç”Ÿæˆå¹¶æœ¬åœ°é¢„è§ˆhexo d -g    ç”Ÿæˆå¹¶ä¸Šä¼ hexo clean &amp;&amp; hexo g -s æ¸…é™¤ã€ç”Ÿæˆã€å¯åŠ¨hexo clean &amp;&amp; hexo g -d æ¸…é™¤ã€ç”Ÿæˆã€éƒ¨ç½²<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/3eeb.html"/>
      <url>/posts/3eeb.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mdè¯­æ³•</title>
      <link href="/posts/ec85.html"/>
      <url>/posts/ec85.html</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h1><h2 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a>æ ‡é¢˜</h2><p>åœ¨å•è¯æˆ–çŸ­è¯­å‰é¢æ·»åŠ äº•å· (<code>#</code>) ï¼š<code>#</code> çš„æ•°é‡ä»£è¡¨äº†æ ‡é¢˜çš„çº§åˆ«ã€‚å¦‚ï¼Œä¸‰ä¸ª <code>#</code> è¡¨ç¤ºä¸‰çº§æ ‡é¢˜ (<code>&lt;h3&gt;</code>)</p><pre class="line-numbers language-none"><code class="language-none"># ä¸€çº§æ ‡é¢˜## äºŒçº§æ ‡é¢˜###### å…­çº§æ ‡é¢˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h2><p>åœ¨è¡Œæœ«æ·»åŠ ä¸¤ä¸ªæˆ–å¤šä¸ªç©ºæ ¼ï¼Œç„¶åæŒ‰å›è½¦é”®ï¼Œå³å¯æ¢è¡Œ(<code>&lt;br&gt;</code>)<br>æœ‰äº‰è®®çš„ï¼Œå› ä¸ºå¾ˆéš¾åœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥çœ‹åˆ°ç©ºæ ¼ï¼Œå¹¶ä¸”å¾ˆå¤šäººåœ¨æ¯ä¸ªå¥å­åé¢éƒ½ä¼šæœ‰æ„æˆ–æ— æ„åœ°æ·»åŠ ä¸¤ä¸ªç©ºæ ¼ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œä½ å¯èƒ½è¦ä½¿ç”¨é™¤ç»“å°¾ç©ºæ ¼ä»¥å¤–çš„å…¶å®ƒæ–¹å¼æ¥æ¢è¡Œã€‚å¹¸è¿çš„æ˜¯ï¼Œå‡ ä¹æ¯ä¸ª Markdown åº”ç”¨ç¨‹åºéƒ½æ”¯æŒå¦ä¸€ç§æ¢è¡Œæ–¹å¼ï¼šHTML çš„ <code>&lt;br&gt;</code> æ ‡ç­¾ã€‚<br>ä¸ºäº†å…¼å®¹æ€§ï¼Œè¯·åœ¨è¡Œå°¾æ·»åŠ â€œç»“å°¾ç©ºæ ¼â€æˆ– HTML çš„ <code>&lt;br&gt;</code> æ ‡ç­¾æ¥å®ç°æ¢è¡Œã€‚</p><pre class="line-numbers language-none"><code class="language-none">å¼ƒæˆ‘å»è€…æ˜¨æ—¥ä¹‹æ—¥ä¸å¯ç•™&lt;br&gt;ä¹±æˆ‘å¿ƒè€…ä»Šæ—¥ä¹‹æ—¥å¤šçƒ¦å¿§<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼ƒæˆ‘å»è€…æ˜¨æ—¥ä¹‹æ—¥ä¸å¯ç•™<br>ä¹±æˆ‘å¿ƒè€…ä»Šæ—¥ä¹‹æ—¥å¤šçƒ¦å¿§</p><h2 id="å¼ºè°ƒ"><a href="#å¼ºè°ƒ" class="headerlink" title="å¼ºè°ƒ"></a>å¼ºè°ƒ</h2><h3 id="ç²—ä½“"><a href="#ç²—ä½“" class="headerlink" title="ç²—ä½“"></a>ç²—ä½“</h3><p>åœ¨éœ€è¦åŠ ç²—çš„éƒ¨åˆ†<code>å‰å</code>å„æ·»åŠ <code>ä¸¤ä¸ª</code>æ˜Ÿå·ï¼ˆasterisksï¼‰æˆ–ä¸‹åˆ’çº¿ï¼ˆunderscoresï¼‰</p><p>ä¸ºå…¼å®¹è€ƒè™‘ï¼Œè¯·ä½¿ç”¨æ˜Ÿå·ï¼ˆasterisksï¼‰</p><pre class="line-numbers language-none"><code class="language-none">**ç²—ä½“**<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ç²—ä½“</strong></p><h3 id="æ–œä½“"><a href="#æ–œä½“" class="headerlink" title="æ–œä½“"></a>æ–œä½“</h3><p>åœ¨éœ€è¦æ–œä½“çš„éƒ¨åˆ†<code>å‰å</code>å„æ·»åŠ <code>ä¸€ä¸ª</code>æ˜Ÿå·ï¼ˆasterisksï¼‰æˆ–ä¸‹åˆ’çº¿ï¼ˆunderscoresï¼‰</p><p>ä¸ºå…¼å®¹è€ƒè™‘ï¼Œè¯·ä½¿ç”¨æ˜Ÿå·ï¼ˆasterisksï¼‰</p><pre class="line-numbers language-none"><code class="language-none">*æ–œä½“*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><em>æ–œä½“</em></p><h3 id="æ–œä½“åŠ ç²—"><a href="#æ–œä½“åŠ ç²—" class="headerlink" title="æ–œä½“åŠ ç²—"></a>æ–œä½“åŠ ç²—</h3><p>åœ¨éœ€è¦åŠ ç²—çš„éƒ¨åˆ†<code>å‰å</code>å„æ·»åŠ <code>ä¸‰ä¸ª</code>æ˜Ÿå·ï¼ˆasterisksï¼‰æˆ–ä¸‹åˆ’çº¿ï¼ˆunderscoresï¼‰</p><p>ä¸ºå…¼å®¹è€ƒè™‘ï¼Œè¯·ä½¿ç”¨æ˜Ÿå·ï¼ˆasterisksï¼‰</p><pre class="line-numbers language-none"><code class="language-none">***æ–œä½“åŠ ç²—***<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong><em>æ–œä½“åŠ ç²—</em></strong></p><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>è¦åˆ›å»ºå—å¼•ç”¨ï¼Œè¯·åœ¨æ®µè½å‰æ·»åŠ ä¸€ä¸ª <code>&gt;</code> ç¬¦å·</p><pre class="line-numbers language-none"><code class="language-none">&gt; å—å¼•ç”¨<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å—å¼•ç”¨</p></blockquote><h3 id="åµŒå¥—å—å¼•ç”¨"><a href="#åµŒå¥—å—å¼•ç”¨" class="headerlink" title="åµŒå¥—å—å¼•ç”¨"></a>åµŒå¥—å—å¼•ç”¨</h3><pre class="line-numbers language-none"><code class="language-none">&gt; å—å¼•ç”¨&gt; å—å¼•ç”¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>å—å¼•ç”¨</p><blockquote><p>å—å¼•ç”¨</p></blockquote></blockquote><h2 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><h3 id="æœ‰åºåˆ—è¡¨"><a href="#æœ‰åºåˆ—è¡¨" class="headerlink" title="æœ‰åºåˆ—è¡¨"></a>æœ‰åºåˆ—è¡¨</h3><p>åœ¨è¡Œå¤´æ·»åŠ ä¸€ä¸ªæ•°å­—å’Œä¸€ä¸ªè‹±æ–‡å¥ç‚¹ï¼Œç„¶åç©ºæ ¼ã€‚æ•°å­—ä¸å¿…æŒ‰æ•°å­¦é¡ºåºæ’åˆ—ï¼Œä½†æ˜¯åˆ—è¡¨åº”å½“ä»¥æ•°å­— 1 èµ·å§‹</p><ol><li>ç¬¬ä¸€</li><li>ç¬¬äºŒ</li><li>ç¬¬ä¸‰</li></ol><h3 id="æ— åºåˆ—è¡¨"><a href="#æ— åºåˆ—è¡¨" class="headerlink" title="æ— åºåˆ—è¡¨"></a>æ— åºåˆ—è¡¨</h3><p>æ·»åŠ ç ´æŠ˜å· (-)ã€æ˜Ÿå· (*) æˆ–åŠ å· (+) ï¼Œç„¶åç©ºæ ¼</p><ul><li>ä¸€èŠ±</li><li>äºŒä¹ƒ</li><li>ä¸‰ç–</li><li>å››å¶</li><li>äº”æœˆ</li></ul><h3 id="åµŒå¥—åˆ—è¡¨"><a href="#åµŒå¥—åˆ—è¡¨" class="headerlink" title="åµŒå¥—åˆ—è¡¨"></a>åµŒå¥—åˆ—è¡¨</h3><p>åœ¨åˆ—è¡¨é¡¹ä¹‹ä¸‹ï¼Œè¾“å…¥<code>æ•°å­— è‹±æ–‡å¥ç‚¹</code> æˆ– <code>-</code> ã€ <code>+</code> ã€ <code>-</code>ï¼Œç„¶åè¾“å…¥ Tab é”®ç¼©è¿›</p><pre class="line-numbers language-none"><code class="language-none">1. äº”ç­‰åˆ†çš„èŠ±å«- ä¸€èŠ±- äºŒä¹ƒ- äº”ç­‰åˆ†çš„èŠ±å«1. ä¸‰ç–2. å››å¶3. äº”æœˆ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>äº”ç­‰åˆ†çš„èŠ±å«<ul><li>ä¸€èŠ±</li><li>äºŒä¹ƒ</li></ul></li></ol><ul><li>äº”ç­‰åˆ†çš„èŠ±å« <ol start="3"><li>ä¸‰ç– </li><li>å››å¶</li><li>äº”æœˆ</li></ol></li></ul><h2 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h2><h3 id="å•è¡Œ"><a href="#å•è¡Œ" class="headerlink" title="å•è¡Œ"></a>å•è¡Œ</h3><p>å°†å•è¡Œä»£ç æ”¾å…¥ä¸¤ä¸ªåå¼•å·&#96;&#96;ä¸­</p><pre class="line-numbers language-none"><code class="language-none">&#96;print(&quot;Hello World!&quot;)&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>print(&quot;Hello World!&quot;)</code></p><h3 id="å¤šè¡Œ"><a href="#å¤šè¡Œ" class="headerlink" title="å¤šè¡Œ"></a>å¤šè¡Œ</h3><p>ä»£ç å—ä¹‹å‰å’Œä¹‹åçš„è¡Œä¸Šä½¿ç”¨ä¸‰ä¸ªåå¼•å·**&#96;&#96;&#96;**æˆ–ä¸‰ä¸ªæ³¢æµªå·~ ~ ~,ç„¶ååœ¨åé¢è·Ÿä¸Šä»£ç è¯­è¨€</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="mathå…¬å¼"><a href="#mathå…¬å¼" class="headerlink" title="mathå…¬å¼"></a>mathå…¬å¼</h2><h3 id="è¡Œå†…å…¬å¼"><a href="#è¡Œå†…å…¬å¼" class="headerlink" title="è¡Œå†…å…¬å¼"></a>è¡Œå†…å…¬å¼</h3><p>åœ¨<code>$ $</code>ä¹‹ä¸­å¡«å†™å…¬å¼</p><pre class="line-numbers language-wolfram" data-language="wolfram"><code class="language-wolfram">$<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>$<span class="token global-variable variable">$e</span><span class="token operator">^</span><span class="token punctuation">&#123;</span>x<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">&#125;</span>\neq<span class="token punctuation">&#123;</span>e<span class="token operator">^</span>x<span class="token punctuation">&#125;</span><span class="token operator">^</span><span class="token number">2</span>$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>$e^{x^2}\neq{e^x}^2$</p><h3 id="å—å…¬å¼"><a href="#å—å…¬å¼" class="headerlink" title="å—å…¬å¼"></a>å—å…¬å¼</h3><p>åœ¨<code>$$ $$</code>ä¸­å¡«å†™å…¬å¼</p><pre class="line-numbers language-wolfram" data-language="wolfram"><code class="language-wolfram">$$<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>$$$<span class="token global-variable variable">$e</span><span class="token operator">^</span><span class="token punctuation">&#123;</span>x<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">&#125;</span>\neq<span class="token punctuation">&#123;</span>e<span class="token operator">^</span>x<span class="token punctuation">&#125;</span><span class="token operator">^</span><span class="token number">2</span>$$$<span class="token global-variable variable">$H</span><span class="token punctuation">(</span>D_2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>\frac<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>\ log_2 \frac<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token operator">+</span> \frac<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>\ log_2 \frac<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span>$$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>$$e^{x^2}\neq{e^x}^2$$<br>$$H(D_2) &#x3D; -(\frac{2}{4}\ log_2 \frac{2}{4} + \frac{2}{4}\ log_2 \frac{2}{4}) &#x3D; 1$$</p><h3 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h3><pre class="line-numbers language-wolfram" data-language="wolfram"><code class="language-wolfram">$$\begin<span class="token punctuation">&#123;</span>pmatrix<span class="token punctuation">&#125;</span>        <span class="token number">1</span> <span class="token operator">&amp;</span> a_1 <span class="token operator">&amp;</span> a_1<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">&amp;</span> \cdots <span class="token operator">&amp;</span> a_1<span class="token operator">^</span>n \\        <span class="token number">1</span> <span class="token operator">&amp;</span> a_2 <span class="token operator">&amp;</span> a_2<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">&amp;</span> \cdots <span class="token operator">&amp;</span> a_2<span class="token operator">^</span>n \\        \vdots <span class="token operator">&amp;</span> \vdots <span class="token operator">&amp;</span> \vdots <span class="token operator">&amp;</span> \ddots <span class="token operator">&amp;</span> \vdots \\        <span class="token number">1</span> <span class="token operator">&amp;</span> a_m <span class="token operator">&amp;</span> a_m<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">&amp;</span> \cdots <span class="token operator">&amp;</span> a_m<span class="token operator">^</span>n \\        \end<span class="token punctuation">&#123;</span>pmatrix<span class="token punctuation">&#125;</span>$$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$$<br>\begin{pmatrix}<br>    1 &amp; a_1 &amp; a_1^2 &amp; \cdots &amp; a_1^n \<br>    1 &amp; a_2 &amp; a_2^2 &amp; \cdots &amp; a_2^n \<br>    \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br>    1 &amp; a_m &amp; a_m^2 &amp; \cdots &amp; a_m^n \<br>    \end{pmatrix}<br>$$</p><h3 id="è¡Œåˆ—å¼"><a href="#è¡Œåˆ—å¼" class="headerlink" title="è¡Œåˆ—å¼"></a>è¡Œåˆ—å¼</h3><pre class="line-numbers language-wolfram" data-language="wolfram"><code class="language-wolfram">$$\mathbf<span class="token punctuation">&#123;</span>V<span class="token punctuation">&#125;</span>_1 \times \mathbf<span class="token punctuation">&#123;</span>V<span class="token punctuation">&#125;</span>_2 <span class="token operator">=</span>  \begin<span class="token punctuation">&#123;</span>vmatrix<span class="token punctuation">&#125;</span>\mathbf<span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> \mathbf<span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> \mathbf<span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span> \\\frac<span class="token punctuation">&#123;</span>\partial X<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>\partial u<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span>  \frac<span class="token punctuation">&#123;</span>\partial Y<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>\partial u<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token number">0</span> \\\frac<span class="token punctuation">&#123;</span>\partial X<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>\partial v<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span>  \frac<span class="token punctuation">&#123;</span>\partial Y<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>\partial v<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token number">0</span> \\\end<span class="token punctuation">&#123;</span>vmatrix<span class="token punctuation">&#125;</span>$$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$$<br>\mathbf{V}_1 \times \mathbf{V}_2 &#x3D; \begin{vmatrix}<br>\mathbf{i} &amp; \mathbf{j} &amp; \mathbf{k} \<br>\frac{\partial X}{\partial u} &amp; \frac{\partial Y}{\partial u} &amp; 0 \<br>\frac{\partial X}{\partial v} &amp; \frac{\partial Y}{\partial v} &amp; 0 \<br>\end{vmatrix}<br>$$</p><h2 id="åˆ†å‰²çº¿"><a href="#åˆ†å‰²çº¿" class="headerlink" title="åˆ†å‰²çº¿"></a>åˆ†å‰²çº¿</h2><p>åœ¨å•ç‹¬ä¸€è¡Œä¸Šä½¿ç”¨ä¸‰ä¸ªæˆ–å¤šä¸ªæ˜Ÿå· (<code>***</code>)ã€ç ´æŠ˜å· (<code>---</code>) æˆ–ä¸‹åˆ’çº¿ (<code>___</code>) ï¼Œç„¶åå›è½¦</p><p>ä¸ºäº†å…¼å®¹æ€§ï¼Œè¯·åœ¨åˆ†éš”çº¿çš„å‰åå‡æ·»åŠ ç©ºç™½è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">***---___<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><hr><hr><h2 id="åˆ é™¤çº¿"><a href="#åˆ é™¤çº¿" class="headerlink" title="åˆ é™¤çº¿"></a>åˆ é™¤çº¿</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">~~æ˜å¤©å¼€å§‹åŠªåŠ›~~ ç°åœ¨å¼€å§‹ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><del>æ˜å¤©å¼€å§‹åŠªåŠ›</del> ç°åœ¨å¼€å§‹ï¼</p><h2 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h2><p>é“¾æ¥åæ”¾åœ¨ä¸­æ‹¬å·å†…ï¼Œé“¾æ¥åœ°å€æ”¾åœ¨åé¢çš„æ‹¬å·ä¸­ï¼Œé“¾æ¥ title å¯é€‰</p><p>è¶…é“¾æ¥è¯­æ³•ï¼š<code>[è¶…é“¾æ¥æ˜¾ç¤ºå](è¶…é“¾æ¥åœ°å€ &quot;è¶…é“¾æ¥title&quot;)</code></p><pre class="line-numbers language-none"><code class="language-none">[loyehã®blog](https:&#x2F;&#x2F;lo-y-eh.github.io)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ˜¯ <a href="https://lo-y-eh.github.io/">loyeh ã® blog</a></p><h3 id="title"><a href="#title" class="headerlink" title="title"></a>title</h3><p>é“¾æ¥ title æ˜¯å½“é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šæ—¶ä¼šå‡ºç°çš„æ–‡å­—ï¼Œæ˜¯å¯é€‰çš„ï¼Œå®ƒæ”¾åœ¨åœ†æ‹¬å·ä¸­é“¾æ¥åœ°å€åé¢ï¼Œè·Ÿé“¾æ¥åœ°å€ä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">[Markdownè¯­æ³•](https://markdown.com.cn)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>[markdown å®˜æ–¹æ–‡æ¡£](<a href="https://markdown.com.cn/">Markdown å®˜æ–¹æ•™ç¨‹</a> â€œæœ€å¥½çš„ markdown æ•™ç¨‹â€)</p><h3 id="ç½‘å€å’Œ-Email-åœ°å€"><a href="#ç½‘å€å’Œ-Email-åœ°å€" class="headerlink" title="ç½‘å€å’Œ Email åœ°å€"></a>ç½‘å€å’Œ Email åœ°å€</h3><p>ä½¿ç”¨å°–æ‹¬å·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŠŠ URL æˆ–è€… email åœ°å€å˜æˆå¯ç‚¹å‡»çš„é“¾æ¥</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">&lt;https://markdown.com.cn>&lt;fake@example.com><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://markdown.com.cn/">https://markdown.com.cn</a></p><p><a href="mailto:&#x66;&#x61;&#x6b;&#x65;&#x40;&#101;&#x78;&#97;&#109;&#112;&#108;&#x65;&#46;&#x63;&#111;&#109;">&#x66;&#x61;&#x6b;&#x65;&#x40;&#101;&#x78;&#97;&#109;&#112;&#108;&#x65;&#46;&#x63;&#111;&#109;</a></p><h3 id="å¸¦æ ¼å¼åŒ–çš„é“¾æ¥"><a href="#å¸¦æ ¼å¼åŒ–çš„é“¾æ¥" class="headerlink" title="å¸¦æ ¼å¼åŒ–çš„é“¾æ¥"></a>å¸¦æ ¼å¼åŒ–çš„é“¾æ¥</h3><blockquote><p>ä¸åŒçš„ Markdown åº”ç”¨ç¨‹åºå¤„ç† URL ä¸­é—´çš„ç©ºæ ¼æ–¹å¼ä¸ä¸€æ ·ã€‚ä¸ºäº†å…¼å®¹ï¼Œè¯·å°½é‡ä½¿ç”¨%20 ä»£æ›¿ç©ºæ ¼</p></blockquote><ul><li><p>å¼ºè°ƒé“¾æ¥, åœ¨é“¾æ¥è¯­æ³•å‰åå¢åŠ æ˜Ÿå·</p><pre class="line-numbers language-none"><code class="language-none">This is the *[Markdown Guide](https:&#x2F;&#x2F;www.markdownguide.org)*.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>This is the <em><a href="https://www.markdownguide.org/">Markdown Guide</a></em></p></li><li><p>è¦å°†é“¾æ¥è¡¨ç¤ºä¸ºä»£ç ï¼Œè¯·åœ¨æ–¹æ‹¬å·ä¸­æ·»åŠ åå¼•å·</p><pre class="line-numbers language-none"><code class="language-none">See the section on [&#96;code&#96;](#code)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>See the section on <a href="https://markdown.com.cn/basic-syntax/links.html#code"><code>code</code></a>.</p></li></ul><h3 id="å¼•ç”¨ç±»å‹é“¾æ¥"><a href="#å¼•ç”¨ç±»å‹é“¾æ¥" class="headerlink" title="å¼•ç”¨ç±»å‹é“¾æ¥"></a>å¼•ç”¨ç±»å‹é“¾æ¥</h3><p>å¼•ç”¨æ ·å¼é“¾æ¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„é“¾æ¥ï¼Œå®ƒä½¿ URL åœ¨ Markdown ä¸­æ›´æ˜“äºæ˜¾ç¤ºå’Œé˜…è¯»</p><p>å‚è€ƒæ ·å¼é“¾æ¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸æ–‡æœ¬ä¿æŒå†…è”çš„éƒ¨åˆ†ä»¥åŠå­˜å‚¨åœ¨æ–‡ä»¶ä¸­å…¶ä»–ä½ç½®çš„éƒ¨åˆ†ï¼Œä»¥ä½¿æ–‡æœ¬æ˜“äºé˜…è¯»</p><h4 id="é“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†æ ¼å¼"><a href="#é“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†æ ¼å¼" class="headerlink" title="é“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†æ ¼å¼"></a>é“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†æ ¼å¼</h4><p>å¼•ç”¨ç±»å‹çš„é“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†ä½¿ç”¨ä¸¤ç»„æ‹¬å·è¿›è¡Œæ ¼å¼è®¾ç½®ã€‚ç¬¬ä¸€ç»„æ–¹æ‹¬å·åŒ…å›´åº”æ˜¾ç¤ºä¸ºé“¾æ¥çš„æ–‡æœ¬ã€‚ç¬¬äºŒç»„æ‹¬å·æ˜¾ç¤ºäº†ä¸€ä¸ªæ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾ç”¨äºæŒ‡å‘æ‚¨å­˜å‚¨åœ¨æ–‡æ¡£å…¶ä»–ä½ç½®çš„é“¾æ¥ã€‚</p><p>å°½ç®¡ä¸æ˜¯å¿…éœ€çš„ï¼Œå¯ä»¥åœ¨ç¬¬ä¸€ç»„å’Œç¬¬äºŒç»„æ‹¬å·ä¹‹é—´åŒ…å«ä¸€ä¸ªç©ºæ ¼ã€‚ç¬¬äºŒç»„æ‹¬å·ä¸­çš„æ ‡ç­¾ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥åŒ…å«å­—æ¯ï¼Œæ•°å­—ï¼Œç©ºæ ¼æˆ–æ ‡ç‚¹ç¬¦å·ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ ¼å¼å¯¹äºé“¾æ¥çš„ç¬¬ä¸€éƒ¨åˆ†æ•ˆæœç›¸åŒï¼š</p><ul><li><code>[hobbit-hole][1]</code></li><li><code>[hobbit-hole] [1]</code></li></ul><h4 id="é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ ¼å¼"><a href="#é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ ¼å¼" class="headerlink" title="é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ ¼å¼"></a>é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ ¼å¼</h4><p>å¼•ç”¨ç±»å‹é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†ä½¿ç”¨ä»¥ä¸‹å±æ€§è®¾ç½®æ ¼å¼ï¼š</p><ol><li>æ”¾åœ¨æ‹¬å·ä¸­çš„æ ‡ç­¾ï¼Œå…¶åç´§è·Ÿä¸€ä¸ªå†’å·å’Œè‡³å°‘ä¸€ä¸ªç©ºæ ¼ï¼ˆä¾‹å¦‚<code>[label]:</code>ï¼‰ã€‚</li><li>é“¾æ¥çš„ URLï¼Œå¯ä»¥é€‰æ‹©å°†å…¶æ‹¬åœ¨å°–æ‹¬å·ä¸­ã€‚</li><li>é“¾æ¥çš„å¯é€‰æ ‡é¢˜ï¼Œå¯ä»¥å°†å…¶æ‹¬åœ¨åŒå¼•å·ï¼Œå•å¼•å·æˆ–æ‹¬å·ä¸­ã€‚</li></ol><p>ä»¥ä¸‹ç¤ºä¾‹æ ¼å¼å¯¹äºé“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ•ˆæœç›¸åŒï¼š</p><ul><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle</code></li><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle &quot;Hobbit lifestyles&quot;</code></li><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle &#39;Hobbit lifestyles&#39;</code></li><li><code>[1]: https://en.wikipedia.org/wiki/Hobbit#Lifestyle (Hobbit lifestyles)</code></li><li><code>[1]: &lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&gt; &quot;Hobbit lifestyles&quot;</code></li><li><code>[1]: &lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&gt; &#39;Hobbit lifestyles&#39;</code></li><li><code>[1]: &lt;https://en.wikipedia.org/wiki/Hobbit#Lifestyle&gt; (Hobbit lifestyles)</code></li></ul><p>å¯ä»¥å°†é“¾æ¥çš„ç¬¬äºŒéƒ¨åˆ†æ”¾åœ¨ Markdown æ–‡æ¡£ä¸­çš„ä»»ä½•ä½ç½®ã€‚æœ‰äº›äººå°†å®ƒä»¬æ”¾åœ¨å‡ºç°çš„æ®µè½ä¹‹åï¼Œæœ‰äº›äººåˆ™å°†å®ƒä»¬æ”¾åœ¨æ–‡æ¡£çš„æœ«å°¾ï¼ˆä¾‹å¦‚å°¾æ³¨æˆ–è„šæ³¨ï¼‰</p><h2 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h2><p>è¦æ·»åŠ å›¾åƒï¼Œè¯·ä½¿ç”¨æ„Ÿå¹å· (<code>!</code>)ï¼Œç„¶ååœ¨æ–¹æ‹¬å·å¢åŠ æ›¿ä»£æ–‡æœ¬ï¼Œå›¾ç‰‡é“¾æ¥æ”¾åœ¨åœ†æ‹¬å·é‡Œï¼Œæ‹¬å·é‡Œçš„é“¾æ¥åå¯ä»¥å¢åŠ ä¸€ä¸ªå¯é€‰çš„å›¾ç‰‡æ ‡é¢˜æ–‡æœ¬ã€‚</p><p>æ’å…¥å›¾ç‰‡ Markdown è¯­æ³•ä»£ç ï¼š<code>![å›¾ç‰‡alt](å›¾ç‰‡é“¾æ¥ &quot;å›¾ç‰‡title&quot;)</code>ã€‚</p><p>å¯¹åº”çš„ HTML ä»£ç ï¼š<code>&lt;img src=&quot;å›¾ç‰‡é“¾æ¥&quot; alt=&quot;å›¾ç‰‡alt&quot; title=&quot;å›¾ç‰‡title&quot;&gt;</code></p><pre class="line-numbers language-text" data-language="text"><code class="language-text">![è¿™æ˜¯å›¾ç‰‡](https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202310012338379.webp "Magic Gardens")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202310012338379.webp" alt="è¿™æ˜¯å›¾ç‰‡" title="Bamboo"></p><h3 id="é“¾æ¥å›¾ç‰‡"><a href="#é“¾æ¥å›¾ç‰‡" class="headerlink" title="é“¾æ¥å›¾ç‰‡"></a>é“¾æ¥å›¾ç‰‡</h3><p>ç»™å›¾ç‰‡å¢åŠ é“¾æ¥ï¼Œè¯·å°†å›¾åƒçš„ Markdown æ‹¬åœ¨æ–¹æ‹¬å·ä¸­ï¼Œç„¶åå°†é“¾æ¥æ·»åŠ åœ¨åœ†æ‹¬å·ä¸­ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">[![ç«¹å­å›¾ç‰‡](/assets/img/bamboo.jpg "bamboo")](https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202310012338379.webp)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://cdn.jsdelivr.net/gh/Lo-Y-eH/image@main/image/202310012338379.webp"><img src="/assets/img/bamboo.jpg" alt="ç«¹å­å›¾ç‰‡" title="bamboo"></a></p><h2 id="è½¬ä¹‰å­—ç¬¦"><a href="#è½¬ä¹‰å­—ç¬¦" class="headerlink" title="è½¬ä¹‰å­—ç¬¦"></a>è½¬ä¹‰å­—ç¬¦</h2><p>ä»¥ä¸‹å­—ç¬¦éƒ½å¯ä»¥é€šè¿‡åæ–œæ å­—ç¬¦è¾¾åˆ°è½¬ä¹‰ç›®çš„</p><table><thead><tr><th align="center">character</th></tr></thead><tbody><tr><td align="center">\</td></tr><tr><td align="center">&#96;</td></tr><tr><td align="center">**</td></tr><tr><td align="center">_</td></tr><tr><td align="center">{}</td></tr><tr><td align="center">[]</td></tr><tr><td align="center">()</td></tr><tr><td align="center">#</td></tr><tr><td align="center">+</td></tr><tr><td align="center">-</td></tr><tr><td align="center">.</td></tr><tr><td align="center">!</td></tr><tr><td align="center">|</td></tr></tbody></table><h2 id="å†…åµŒ-HTML-æ ‡ç­¾"><a href="#å†…åµŒ-HTML-æ ‡ç­¾" class="headerlink" title="å†…åµŒ HTML æ ‡ç­¾"></a>å†…åµŒ HTML æ ‡ç­¾</h2><p>å¯¹äº Markdown æ¶µç›–èŒƒå›´ä¹‹å¤–çš„æ ‡ç­¾ï¼Œéƒ½å¯ä»¥ç›´æ¥åœ¨æ–‡ä»¶é‡Œé¢ç”¨ HTML æœ¬èº«ã€‚å¦‚éœ€ä½¿ç”¨ HTMLï¼Œä¸éœ€è¦é¢å¤–æ ‡æ³¨è¿™æ˜¯ HTML æˆ–æ˜¯ Markdownï¼Œåªéœ€ HTML æ ‡ç­¾æ·»åŠ åˆ° Markdown æ–‡æœ¬ä¸­å³å¯ã€‚</p><h3 id="è¡Œçº§å…§è”æ ‡ç­¾"><a href="#è¡Œçº§å…§è”æ ‡ç­¾" class="headerlink" title="è¡Œçº§å…§è”æ ‡ç­¾"></a>è¡Œçº§å…§è”æ ‡ç­¾</h3><p>HTML çš„è¡Œçº§å…§è”æ ‡ç­¾å¦‚ <code>&lt;span&gt;</code>ã€<code>&lt;cite&gt;</code>ã€<code>&lt;del&gt;</code> ä¸å—é™åˆ¶ï¼Œå¯ä»¥åœ¨ Markdown çš„æ®µè½ã€åˆ—è¡¨æˆ–æ˜¯æ ‡é¢˜é‡Œä»»æ„ä½¿ç”¨ã€‚ä¾ç…§ä¸ªäººä¹ æƒ¯ï¼Œç”šè‡³å¯ä»¥ä¸ç”¨ Markdown æ ¼å¼ï¼Œè€Œé‡‡ç”¨ HTML æ ‡ç­¾æ¥æ ¼å¼åŒ–ã€‚ä¾‹å¦‚ï¼šå¦‚æœæ¯”è¾ƒå–œæ¬¢ HTML çš„ <code>&lt;a&gt;</code> æˆ– <code>&lt;img&gt;</code> æ ‡ç­¾ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æ ‡ç­¾ï¼Œè€Œä¸ç”¨ Markdown æä¾›çš„é“¾æ¥æˆ–æ˜¯å›¾ç‰‡è¯­æ³•ã€‚å½“ä½ éœ€è¦æ›´æ”¹å…ƒç´ çš„å±æ€§æ—¶ï¼ˆä¾‹å¦‚ä¸ºæ–‡æœ¬æŒ‡å®šé¢œè‰²æˆ–æ›´æ”¹å›¾åƒçš„å®½åº¦ï¼‰ï¼Œä½¿ç”¨ HTML æ ‡ç­¾æ›´æ–¹ä¾¿äº›ã€‚</p><p>HTML è¡Œçº§å…§è”æ ‡ç­¾å’ŒåŒºå—æ ‡ç­¾ä¸åŒï¼Œåœ¨å…§è”æ ‡ç­¾çš„èŒƒå›´å†…ï¼Œ Markdown çš„è¯­æ³•æ˜¯å¯ä»¥è§£æçš„ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">This **word** is bold. This &lt;em>word&lt;/em> is italic.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¸²æŸ“æ•ˆæœå¦‚ä¸‹:</p><p>This <strong>word</strong> is bold. This <em>word</em> is italic.</p><h3 id="åŒºå—æ ‡ç­¾"><a href="#åŒºå—æ ‡ç­¾" class="headerlink" title="åŒºå—æ ‡ç­¾"></a>åŒºå—æ ‡ç­¾</h3><p>åŒºå—å…ƒç´  â”€â”€ æ¯”å¦‚ <code>&lt;div&gt;</code>ã€<code>&lt;table&gt;</code>ã€<code>&lt;pre&gt;</code>ã€<code>&lt;p&gt;</code> ç­‰æ ‡ç­¾ï¼Œå¿…é¡»åœ¨å‰ååŠ ä¸Šç©ºè¡Œï¼Œä»¥ä¾¿äºå†…å®¹åŒºåˆ†ã€‚è€Œä¸”è¿™äº›å…ƒç´ çš„å¼€å§‹ä¸ç»“å°¾æ ‡ç­¾ï¼Œä¸å¯ä»¥ç”¨ tab æˆ–æ˜¯ç©ºç™½æ¥ç¼©è¿›ã€‚Markdown ä¼šè‡ªåŠ¨è¯†åˆ«è¿™åŒºå—å…ƒç´ ï¼Œé¿å…åœ¨åŒºå—æ ‡ç­¾å‰ååŠ ä¸Šæ²¡æœ‰å¿…è¦çš„ <code>&lt;p&gt;</code> æ ‡ç­¾ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ Markdown æ–‡ä»¶é‡ŒåŠ ä¸Šä¸€æ®µ HTML è¡¨æ ¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">This is a regular paragraph.&lt;table&gt;    &lt;tr&gt;        &lt;td&gt;Foo&lt;&#x2F;td&gt;    &lt;&#x2F;tr&gt;&lt;&#x2F;table&gt;This is another regular paragraph.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This is a regular paragraph.</p><table>    <tr>        <td>Foo</td>    </tr></table><p>This is another regular paragraph.</p><p>è¯·æ³¨æ„ï¼ŒMarkdown è¯­æ³•åœ¨ HTML åŒºå—æ ‡ç­¾ä¸­å°†ä¸ä¼šè¢«è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œä½ æ— æ³•åœ¨ HTML åŒºå—å†…ä½¿ç”¨ Markdown å½¢å¼çš„<code>*å¼ºè°ƒ*</code>ã€‚</p><h3 id="HTML-ç”¨æ³•æœ€ä½³å®è·µ"><a href="#HTML-ç”¨æ³•æœ€ä½³å®è·µ" class="headerlink" title="HTML ç”¨æ³•æœ€ä½³å®è·µ"></a>HTML ç”¨æ³•æœ€ä½³å®è·µ</h3><p>å‡ºäºå®‰å…¨åŸå› ï¼Œå¹¶éæ‰€æœ‰ Markdown åº”ç”¨ç¨‹åºéƒ½æ”¯æŒåœ¨ Markdown æ–‡æ¡£ä¸­æ·»åŠ  HTMLã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·æŸ¥çœ‹ç›¸åº” Markdown åº”ç”¨ç¨‹åºçš„æ‰‹å†Œã€‚æŸäº›åº”ç”¨ç¨‹åºåªæ”¯æŒ HTML æ ‡ç­¾çš„å­é›†ã€‚</p><p>å¯¹äº HTML çš„å—çº§å…ƒç´  <code>&lt;div&gt;</code>ã€<code>&lt;table&gt;</code>ã€<code>&lt;pre&gt;</code> å’Œ <code>&lt;p&gt;</code>ï¼Œè¯·åœ¨å…¶å‰åä½¿ç”¨ç©ºè¡Œï¼ˆblank linesï¼‰ä¸å…¶å®ƒå†…å®¹è¿›è¡Œåˆ†éš”ã€‚å°½é‡ä¸è¦ä½¿ç”¨åˆ¶è¡¨ç¬¦ï¼ˆtabsï¼‰æˆ–ç©ºæ ¼ï¼ˆspacesï¼‰å¯¹ HTML æ ‡ç­¾åšç¼©è¿›ï¼Œå¦åˆ™å°†å½±å“æ ¼å¼ã€‚</p><p>åœ¨ HTML å—çº§æ ‡ç­¾å†…ä¸èƒ½ä½¿ç”¨ Markdown è¯­æ³•ã€‚ä¾‹å¦‚ <code>&lt;p&gt;italic and **bold**&lt;/p&gt;</code> å°†ä¸èµ·ä½œç”¨ã€‚</p><h1 id="æ‰©å±•è¯­æ³•"><a href="#æ‰©å±•è¯­æ³•" class="headerlink" title="æ‰©å±•è¯­æ³•"></a>æ‰©å±•è¯­æ³•</h1><p><a href="https://markdown.com.cn/basic_syntax">åŸºæœ¬è¯­æ³•</a>ä¸»è¦æ˜¯ä¸ºäº†åº”ä»˜å¤§å¤šæ•°æƒ…å†µä¸‹çš„æ—¥å¸¸æ‰€éœ€å…ƒç´ ï¼Œä½†å¯¹äºæŸäº›äººæ¥è¯´è¿˜ä¸å¤Ÿï¼Œè¿™å°±æ˜¯æ‰©å±•è¯­æ³•çš„ç”¨æ­¦ä¹‹åœ°</p><h2 id="å‰æƒ…æè¦"><a href="#å‰æƒ…æè¦" class="headerlink" title="å‰æƒ…æè¦"></a>å‰æƒ…æè¦</h2><h3 id="å¯ç”¨æ€§"><a href="#å¯ç”¨æ€§" class="headerlink" title="å¯ç”¨æ€§"></a>å¯ç”¨æ€§</h3><p>å¹¶éæ‰€æœ‰Markdownåº”ç”¨ç¨‹åºéƒ½æ”¯æŒæ‰©å±•è¯­æ³•å…ƒç´ ã€‚æ‚¨éœ€è¦æ£€æŸ¥æ‚¨çš„åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„è½»é‡çº§æ ‡è®°è¯­è¨€æ˜¯å¦æ”¯æŒæ‚¨è¦ä½¿ç”¨çš„æ‰©å±•è¯­æ³•å…ƒç´ ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆä»ç„¶æœ‰å¯èƒ½åœ¨Markdownå¤„ç†å™¨ä¸­å¯ç”¨æ‰©å±•ã€‚</p><h3 id="è½»é‡æ ‡è®°è¯­è¨€"><a href="#è½»é‡æ ‡è®°è¯­è¨€" class="headerlink" title="è½»é‡æ ‡è®°è¯­è¨€"></a>è½»é‡æ ‡è®°è¯­è¨€</h3><p>æœ‰å‡ ç§è½»é‡çº§æ ‡è®°è¯­è¨€æ˜¯Markdownçš„è¶…é›†ã€‚å®ƒä»¬åŒ…å«Gruberçš„åŸºæœ¬è¯­æ³•ï¼Œå¹¶é€šè¿‡æ·»åŠ å…¶ä»–å…ƒç´ ï¼ˆä¾‹å¦‚è¡¨ï¼Œä»£ç å—ï¼Œè¯­æ³•çªå‡ºæ˜¾ç¤ºï¼ŒURLè‡ªåŠ¨é“¾æ¥å’Œè„šæ³¨ï¼‰åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºã€‚è®¸å¤šæœ€å—æ¬¢è¿çš„Markdownåº”ç”¨ç¨‹åºä½¿ç”¨ä»¥ä¸‹è½»é‡çº§æ ‡è®°è¯­è¨€ä¹‹ä¸€ï¼š</p><ul><li><a href="https://commonmark.org/">CommonMark</a></li><li><a href="https://github.github.com/gfm/">GitHub Flavored Markdown (GFM)</a></li><li><a href="https://michelf.ca/projects/php-markdown/extra/">Markdown Extra</a></li><li><a href="https://fletcherpenney.net/multimarkdown/">MultiMarkdown</a></li><li><a href="https://rmarkdown.rstudio.com/">R Markdown</a></li></ul><h3 id="Markdown-å¤„ç†å™¨"><a href="#Markdown-å¤„ç†å™¨" class="headerlink" title="Markdown å¤„ç†å™¨"></a>Markdown å¤„ç†å™¨</h3><p>æœ‰è®¸å¤š<a href="https://github.com/markdown/markdown.github.com/wiki/Implementations">Markdownå¤„ç†å™¨</a>å¯ç”¨ï¼Œå®ƒä»¬ä¸­çš„è®¸å¤šå…è®¸æ‚¨æ·»åŠ å¯ç”¨æ‰©å±•è¯­æ³•å…ƒç´ çš„æ‰©å±•ã€‚æŸ¥çœ‹æ‚¨æ‰€ä½¿ç”¨å¤„ç†å™¨çš„æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p><h2 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h2><p>æ·»åŠ è¡¨æ ¼ï¼Œä½¿ç”¨ä¸‰ä¸ªæˆ–å¤šä¸ªè¿å­—ç¬¦ï¼ˆ<code>---</code>ï¼‰åˆ›å»ºæ¯åˆ—çš„æ ‡é¢˜ï¼Œå¹¶ä½¿ç”¨ç®¡é“ï¼ˆ<code>|</code>ï¼‰åˆ†éš”æ¯åˆ—ã€‚</p><pre class="line-numbers language-none"><code class="language-none">| Syntax      | Description || ----------- | ----------- || Header      | Title       || Paragraph   | Text        |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="left">Syntax</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">Header</td><td align="left">Title</td></tr><tr><td align="left">Paragraph</td><td align="left">Text</td></tr></tbody></table><p>å•å…ƒæ ¼å®½åº¦å¯ä»¥å˜åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å‘ˆç°çš„è¾“å‡ºå°†çœ‹èµ·æ¥ç›¸åŒã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">| Syntax | Description || --- | ----------- || Header | Title || Paragraph | Text |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>Syntax</th><th>Description</th></tr></thead><tbody><tr><td>Header</td><td>Title</td></tr><tr><td>Paragraph</td><td>Text</td></tr></tbody></table><h3 id="å¯¹é½"><a href="#å¯¹é½" class="headerlink" title="å¯¹é½"></a>å¯¹é½</h3><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨æ ‡é¢˜è¡Œä¸­çš„è¿å­—ç¬¦çš„å·¦ä¾§ï¼Œå³ä¾§æˆ–ä¸¤ä¾§æ·»åŠ å†’å·ï¼ˆ<code>:</code>ï¼‰ï¼Œå°†åˆ—ä¸­çš„æ–‡æœ¬å¯¹é½åˆ°å·¦ä¾§ï¼Œå³ä¾§æˆ–ä¸­å¿ƒã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">| Syntax      | Description | Test Text     || :---        |    :----:   |          ---: || Header      | Title       | Here's this   || Paragraph   | Text        | And more      |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="left">Syntax</th><th align="center">Description</th><th align="right">Test Text</th></tr></thead><tbody><tr><td align="left">Header</td><td align="center">Title</td><td align="right">Hereâ€™s this</td></tr><tr><td align="left">Paragraph</td><td align="center">Text</td><td align="right">And more</td></tr></tbody></table><h3 id="è¡¨æ ¼ä¸­çš„æ–‡å­—"><a href="#è¡¨æ ¼ä¸­çš„æ–‡å­—" class="headerlink" title="è¡¨æ ¼ä¸­çš„æ–‡å­—"></a>è¡¨æ ¼ä¸­çš„æ–‡å­—</h3><p>å¯ä»¥åœ¨è¡¨æ ¼ä¸­è®¾ç½®æ–‡æœ¬æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ é“¾æ¥ï¼Œå•è¡Œä»£ç ï¼ˆä»…åå¼•å· &#96;&#96; ï¼‰å’Œå¼ºè°ƒã€‚</p><p>ä¸èƒ½æ·»åŠ æ ‡é¢˜ï¼Œå—å¼•ç”¨ï¼Œåˆ—è¡¨ï¼Œæ°´å¹³è§„åˆ™ï¼Œå›¾åƒæˆ–HTMLæ ‡ç­¾ã€‚</p><h3 id="è¡¨ä¸­è½¬ä¹‰-â€œ-â€"><a href="#è¡¨ä¸­è½¬ä¹‰-â€œ-â€" class="headerlink" title="è¡¨ä¸­è½¬ä¹‰ â€œ|â€"></a>è¡¨ä¸­è½¬ä¹‰ â€œ|â€</h3><p>å¯ä»¥ä½¿ç”¨è¡¨æ ¼çš„HTMLå­—ç¬¦ä»£ç ï¼ˆ<code>|</code>ï¼‰åœ¨è¡¨ä¸­æ˜¾ç¤ºç«–çº¿ï¼ˆ<code>|</code>ï¼‰å­—ç¬¦ã€‚</p><h2 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h2><p>è„šæ³¨ä½¿æ‚¨å¯ä»¥æ·»åŠ æ³¨é‡Šå’Œå‚è€ƒï¼Œè€Œä¸ä¼šä½¿æ–‡æ¡£æ­£æ–‡æ··ä¹±ã€‚å½“æ‚¨åˆ›å»ºè„šæ³¨æ—¶ï¼Œå¸¦æœ‰è„šæ³¨çš„ä¸Šæ ‡æ•°å­—ä¼šå‡ºç°åœ¨æ‚¨æ·»åŠ è„šæ³¨å‚è€ƒçš„ä½ç½®ã€‚è¯»è€…å¯ä»¥å•å‡»é“¾æ¥ä»¥è·³è‡³é¡µé¢åº•éƒ¨çš„è„šæ³¨å†…å®¹ã€‚</p><p>è¦åˆ›å»ºè„šæ³¨å‚è€ƒï¼Œè¯·åœ¨æ–¹æ‹¬å·ï¼ˆ<code>[^1]</code>ï¼‰å†…æ·»åŠ æ’å…¥ç¬¦å·å’Œæ ‡è¯†ç¬¦ã€‚æ ‡è¯†ç¬¦å¯ä»¥æ˜¯æ•°å­—æˆ–å•è¯ï¼Œä½†ä¸èƒ½åŒ…å«ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ã€‚æ ‡è¯†ç¬¦ä»…å°†è„šæ³¨å‚è€ƒä¸è„šæ³¨æœ¬èº«ç›¸å…³è”-åœ¨è¾“å‡ºä¸­ï¼Œè„šæ³¨æŒ‰é¡ºåºç¼–å·ã€‚</p><p>åœ¨æ‹¬å·å†…ä½¿ç”¨å¦ä¸€ä¸ªæ’å…¥ç¬¦å·å’Œæ•°å­—æ·»åŠ è„šæ³¨ï¼Œå¹¶ç”¨å†’å·å’Œæ–‡æœ¬ï¼ˆ<code>[^1]: My footnote.</code>ï¼‰ã€‚æ‚¨ä¸å¿…åœ¨æ–‡æ¡£æœ«å°¾æ·»åŠ è„šæ³¨ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨é™¤åˆ—è¡¨ï¼Œå—å¼•å·å’Œè¡¨ä¹‹ç±»çš„å…¶ä»–å…ƒç´ ä¹‹å¤–çš„ä»»ä½•ä½ç½®ã€‚</p><pre class="line-numbers language-none"><code class="language-none">è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è„šæ³¨ï¼Œ[^1] [^1]: è¿™æ˜¯ç¬¬ä¸€ä¸ªè„šæ³¨è¿™æ˜¯ä¸€ä¸ªæ›´é•¿çš„è„šæ³¨ï¼Œ[^bignote][^bignote]: Here&#39;s one with multiple paragraphs and code.    Indent paragraphs to include them in the footnote.    &#96;&#123; my code &#125;&#96;    Add as many paragraphs as you like.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è„šæ³¨ï¼Œ<a href="%E8%BF%99%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%84%9A%E6%B3%A8">^1</a> </p><p>è¿™æ˜¯ä¸€ä¸ªæ›´é•¿çš„è„šæ³¨ï¼Œ[^bignote]</p><p>[^bignote]: Hereâ€™s one with multiple paragraphs and code.</p><pre><code>Indent paragraphs to include them in the footnote.`&#123; my code &#125;`Add as many paragraphs as you like.</code></pre><h2 id="æ ‡é¢˜ID"><a href="#æ ‡é¢˜ID" class="headerlink" title="æ ‡é¢˜ID"></a>æ ‡é¢˜ID</h2><p>è®¸å¤šMarkdownå¤„ç†å™¨æ”¯æŒ<code>æ ‡é¢˜</code>è‡ªå®šä¹‰IDï¼Œä¸€äº›Markdownå¤„ç†å™¨ä¼šè‡ªåŠ¨æ·»åŠ å®ƒä»¬ã€‚æ·»åŠ è‡ªå®šä¹‰IDå…è®¸ä½ ç›´æ¥é“¾æ¥åˆ°æ ‡é¢˜å¹¶ä½¿ç”¨CSSå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚è¦æ·»åŠ è‡ªå®šä¹‰æ ‡é¢˜IDï¼Œè¯·åœ¨ä¸æ ‡é¢˜ç›¸åŒçš„è¡Œä¸Šç”¨å¤§æ‹¬å·æ‹¬èµ·è¯¥è‡ªå®šä¹‰IDã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">### My Great Heading &#123;#custom-id&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>HTMLçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>custom-id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>My Great Heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="é“¾æ¥åˆ°æ ‡é¢˜ID"><a href="#é“¾æ¥åˆ°æ ‡é¢˜ID" class="headerlink" title="é“¾æ¥åˆ°æ ‡é¢˜ID"></a>é“¾æ¥åˆ°æ ‡é¢˜ID</h3><p>é€šè¿‡åˆ›å»ºå¸¦æœ‰æ•°å­—ç¬¦å·ï¼ˆ<code>#</code>ï¼‰å’Œè‡ªå®šä¹‰æ ‡é¢˜IDçš„<a href="(/basic-syntax/links.html">æ ‡å‡†é“¾æ¥</a>ï¼Œå¯ä»¥é“¾æ¥åˆ°æ–‡ä»¶ä¸­å…·æœ‰è‡ªå®šä¹‰IDçš„æ ‡é¢˜ã€‚</p><table><thead><tr><th>Markdown</th><th>HTML</th><th>é¢„è§ˆæ•ˆæœ</th></tr></thead><tbody><tr><td><code>[Heading IDs](#heading-ids)</code></td><td><code>&lt;a href=&quot;#heading-ids&quot;&gt;Heading IDs&lt;/a&gt;</code></td><td><a href="https://markdown.com.cn/extended-syntax/heading-ids.html#heading-ids">Heading IDs</a></td></tr></tbody></table><p>å…¶ä»–ç½‘ç«™å¯ä»¥é€šè¿‡å°†è‡ªå®šä¹‰æ ‡é¢˜IDæ·»åŠ åˆ°ç½‘é¡µçš„å®Œæ•´URL</p><h2 id="ä»»åŠ¡è¡¨"><a href="#ä»»åŠ¡è¡¨" class="headerlink" title="ä»»åŠ¡è¡¨"></a>ä»»åŠ¡è¡¨</h2><p>åˆ›å»ºä»»åŠ¡åˆ—è¡¨ï¼Œåœ¨ä»»åŠ¡åˆ—è¡¨é¡¹ä¹‹å‰æ·»åŠ ç ´æŠ˜å·<code>-</code>å’Œæ–¹æ‹¬å·<code>[ ]</code>ï¼Œå¹¶åœ¨<code>[ ]</code>å‰é¢åŠ ä¸Šç©ºæ ¼ã€‚è¦é€‰æ‹©ä¸€ä¸ªå¤é€‰æ¡†ï¼Œè¯·åœ¨æ–¹æ‹¬å·<code>[x]</code>ä¹‹é—´æ·»åŠ  x </p><pre class="line-numbers language-text" data-language="text"><code class="language-text">- [x] Write the press release- [ ] Update the website- [ ] Contact the media<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><input checked="" disabled="" type="checkbox"> Write the press release</li><li><input disabled="" type="checkbox"> Update the website</li><li><input disabled="" type="checkbox"> Contact the media</li></ul><h2 id="Emoji"><a href="#Emoji" class="headerlink" title="Emoji"></a>Emoji</h2><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å°†è¡¨æƒ…ç¬¦å·æ·»åŠ åˆ°Markdownæ–‡ä»¶ä¸­ï¼šå°†è¡¨æƒ…ç¬¦å·å¤åˆ¶å¹¶ç²˜è´´åˆ°Markdownæ ¼å¼çš„æ–‡æœ¬ä¸­ï¼Œæˆ–è€…é”®å…¥<em>emoji shortcodes</em>ã€‚</p><p>###å¤åˆ¶å’Œç²˜è´´è¡¨æƒ…ç¬¦å·</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°ä»<a href="https://emojipedia.org/">Emojipedia</a> ç­‰æ¥æºå¤åˆ¶è¡¨æƒ…ç¬¦å·å¹¶å°†å…¶ç²˜è´´åˆ°æ–‡æ¡£ä¸­ã€‚è®¸å¤šMarkdownåº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨ä»¥Markdownæ ¼å¼çš„æ–‡æœ¬æ˜¾ç¤ºè¡¨æƒ…ç¬¦å·ã€‚ä»Markdownåº”ç”¨ç¨‹åºå¯¼å‡ºçš„HTMLå’ŒPDFæ–‡ä»¶åº”æ˜¾ç¤ºè¡¨æƒ…ç¬¦å·ã€‚</p><p><strong>Tip:</strong> å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œè¯·ç¡®ä¿å°†HTMLé¡µé¢ç¼–ç ä¸ºUTF-8ã€‚.</p><p>###ä½¿ç”¨è¡¨æƒ…ç¬¦å·ç®€ç </p><p>ä¸€äº›Markdownåº”ç”¨ç¨‹åºå…è®¸æ‚¨é€šè¿‡é”®å…¥è¡¨æƒ…ç¬¦å·çŸ­ä»£ç æ¥æ’å…¥è¡¨æƒ…ç¬¦å·ã€‚è¿™äº›ä»¥å†’å·å¼€å¤´å’Œç»“å°¾ï¼Œå¹¶åŒ…å«è¡¨æƒ…ç¬¦å·çš„åç§°ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">å»éœ²è¥äº†ï¼ :tent: å¾ˆå¿«å›æ¥ã€‚çœŸå¥½ç¬‘ï¼ :joy:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p>å»éœ²è¥äº†ï¼â›ºå¾ˆå¿«å›æ¥ã€‚</p><p>çœŸå¥½ç¬‘ï¼ğŸ˜‚</p><p><strong>Note:</strong> æ³¨æ„ï¼šæ‚¨å¯ä»¥ä½¿ç”¨æ­¤<a href="https://gist.github.com/rxaviers/7360908">è¡¨æƒ…ç¬¦å·ç®€ç åˆ—è¡¨</a>ï¼Œä½†è¯·è®°ä½ï¼Œè¡¨æƒ…ç¬¦å·ç®€ç å› åº”ç”¨ç¨‹åºè€Œå¼‚ã€‚</p><h1 id="è‡ªåŠ¨ç½‘å€é“¾æ¥"><a href="#è‡ªåŠ¨ç½‘å€é“¾æ¥" class="headerlink" title="è‡ªåŠ¨ç½‘å€é“¾æ¥"></a>è‡ªåŠ¨ç½‘å€é“¾æ¥</h1><p>è®¸å¤šMarkdownå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†URLè½¬æ¢ä¸ºé“¾æ¥ã€‚è¿™æ„å‘³ç€å¦‚æœè¾“å…¥<a href="http://www.example.comï¼Œå³ä½¿æœª[ä½¿ç”¨æ–¹æ‹¬å·](https://markdown.com.cn/basic-syntax/links.html)ï¼Œä¹Ÿä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºé“¾æ¥ã€‚">http://www.example.comï¼Œå³ä½¿æœª[ä½¿ç”¨æ–¹æ‹¬å·](https://markdown.com.cn/basic-syntax/links.html)ï¼Œä¹Ÿä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºé“¾æ¥ã€‚</a></p><pre class="line-numbers language-text" data-language="text"><code class="language-text">http://www.example.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ˆç°çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><a href="http://www.example.com/">http://www.example.com</a></p><h3 id="ç¦ç”¨è‡ªåŠ¨URLé“¾æ¥"><a href="#ç¦ç”¨è‡ªåŠ¨URLé“¾æ¥" class="headerlink" title="ç¦ç”¨è‡ªåŠ¨URLé“¾æ¥"></a>ç¦ç”¨è‡ªåŠ¨URLé“¾æ¥</h3><p>å¦‚æœä¸å¸Œæœ›è‡ªåŠ¨é“¾æ¥URLï¼Œåˆ™å¯ä»¥ä½¿ç”¨åå¼•å·æ¥ç¦æ­¢</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">`http://www.example.com`<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ˆç°çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><code>http://www.example.com</code></p><h2 id="Diagrams"><a href="#Diagrams" class="headerlink" title="Diagrams"></a>Diagrams</h2>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
            <tag> typora </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
